
<!doctype html>
<html lang="en" class="no-js">
  <head>
    
      <meta charset="utf-8">
      <meta name="viewport" content="width=device-width,initial-scale=1">
      
        <meta name="description" content="A collection of Kubernetes Labs for learning and practicing Kubernetes skills.">
      
      
        <meta name="author" content="Nir Geier - nirgeier@gmail.com">
      
      
        <link rel="canonical" href="https://nirgeier.github.io/KubernetesLabs/print_page/">
      
      
      
      
        
      
      
      <link rel="icon" href="../assets/favicon.png">
      <meta name="generator" content="mkdocs-1.6.1, mkdocs-material-9.7.1">
    
    
      
        <title>Print Site - KubernetesLabs</title>
      
    
    
      <link rel="stylesheet" href="../assets/stylesheets/main.484c7ddc.min.css">
      
        
        <link rel="stylesheet" href="../assets/stylesheets/palette.ab4e12ef.min.css">
      
      
  
  
    
      
      
    
  
  
  <style>:root{--md-admonition-icon--note:url('data:image/svg+xml;charset=utf-8,%3Csvg%20xmlns%3D%22http%3A//www.w3.org/2000/svg%22%20viewBox%3D%220%200%2024%2024%22%3E%3Cpath%20d%3D%22M12%202a7%207%200%200%200-7%207c0%202.38%201.19%204.47%203%205.74V17a1%201%200%200%200%201%201h6a1%201%200%200%200%201-1v-2.26c1.81-1.27%203-3.36%203-5.74a7%207%200%200%200-7-7M9%2021a1%201%200%200%200%201%201h4a1%201%200%200%200%201-1v-1H9z%22/%3E%3C/svg%3E');}</style>



    
    
      
    
    
      
        
        
        <link rel="preconnect" href="https://fonts.gstatic.com" crossorigin>
        <link rel="stylesheet" href="https://fonts.googleapis.com/css?family=Mulish:300,300i,400,400i,700,700i%7CJetBrains+Mono:400,400i,700,700i&display=fallback">
        <style>:root{--md-text-font:"Mulish";--md-code-font:"JetBrains Mono"}</style>
      
    
    
      <link rel="stylesheet" href="../css/print-site.css">
    
      <link rel="stylesheet" href="../css/print-site-material.css">
    
      <link rel="stylesheet" href="../assets/stylesheets/codewizard.css?v=1765676292">
    
    <script>__md_scope=new URL("/KubernetesLabs/",location),__md_hash=e=>[...e].reduce(((e,_)=>(e<<5)-e+_.charCodeAt(0)),0),__md_get=(e,_=localStorage,t=__md_scope)=>JSON.parse(_.getItem(t.pathname+"."+e)),__md_set=(e,_,t=localStorage,a=__md_scope)=>{try{t.setItem(a.pathname+"."+e,JSON.stringify(_))}catch(e){}}</script>
    
      

    
    
  
        <script type="text/javascript">
        document.addEventListener('DOMContentLoaded', function () {
            remove_material_navigation();remove_mkdocs_theme_navigation();generate_toc();
        })
        </script>
        </head>
  
  
    
    
      
    
    
    
    
    <body dir="ltr" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="teal">
  
    
    <input class="md-toggle" data-md-toggle="drawer" type="checkbox" id="__drawer" autocomplete="off">
    <input class="md-toggle" data-md-toggle="search" type="checkbox" id="__search" autocomplete="off">
    <label class="md-overlay" for="__drawer"></label>
    <div data-md-component="skip">
      
        
        <a href="#welcome" class="md-skip">
          Skip to content
        </a>
      
    </div>
    <div data-md-component="announce">
      
    </div>
    
    
      <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Determine classes -->



<!-- Header -->
<header class="md-header" data-md-component="header">
  <nav class="md-header__inner md-grid" aria-label="Header">

    <!-- Link to home -->
    <a href=".." title="KubernetesLabs"
      class="md-header__button md-logo" aria-label="KubernetesLabs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>

    <!-- Button to open drawer -->
    <label class="md-header__button md-icon" for="__drawer">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M3 6h18v2H3zm0 5h18v2H3zm0 5h18v2H3z"/></svg>
    </label>

    <!-- Header title -->
    <div class="md-header__title" data-md-component="header-title">
      <div class="md-header__ellipsis">
        <div class="md-header__topic">
          <span class="md-ellipsis">
            KubernetesLabs
          </span>
        </div>
        <div class="md-header__topic" data-md-component="header-topic">
          <span class="md-ellipsis">
            
            Print Site
            
          </span>
        </div>
      </div>
    </div>

    <div class="m-social__top">
      <!-- Social links -->
      
      
<div class="md-social">
    
    
    
    
    
    <a href="https://github.com/ivana-devops/KubernetesLabs" target="_blank" rel="noopener" title="View on GitHub"
        class="md-social__link social-class__github">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
    
    
    
    
    
    <a href="https://github.com/ivana-devops/KubernetesLabs/network/members" target="_blank" rel="noopener" title="Fork this repo"
        class="md-social__link social-class__fork">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0M5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0m6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5m-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0"/></svg>
    </a>
    
    
    
    
    
    <a href="https://github.com/ivana-devops/KubernetesLabs/stargazers" target="_blank" rel="noopener" title="Star this repo"
        class="md-social__link social-class__star">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25m0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://www.linkedin.com/in/nirgeier/" target="_blank" rel="noopener" title="Connect on LinkedIn"
        class="md-social__link social-class__linkedin">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://discord.gg/U6xW23Ss" target="_blank" rel="noopener" title="Follow me on Discord"
        class="md-social__link social-class__discord">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg>
    </a>
    
    
    
    
    
    <a href="https://stackoverflow.com/users/1755598/codewizard" target="_blank" rel="noopener" title="Follow me on Stack Overflow"
        class="md-social__link social-class__stackoverflow">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M291 311 95.3 269.7 87.1 309l195.7 41zm51-87L188.5 95.7 163 126.5l153.5 128.3zm-31.2 39.7L129.5 179l-16.7 36.5L294 300zM262.3 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H43V320H3v160h359.5V320h-40z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://wa.me/972548122310" target="_blank" rel="noopener" title="Follow me on WhatsApp"
        class="md-social__link social-class__whatsapp">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157m-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1s56.2 81.2 56.1 130.5c0 101.8-84.9 184.6-186.6 184.6m101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7s-12.5-30.1-17.1-41.2c-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3s19.9 53.7 22.6 57.4c2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4s4.6-24.1 3.2-26.4c-1.3-2.5-5-3.9-10.5-6.6"/></svg>
    </a>
    
    
    
    
    
    <a href="mailto:nirg@codewizard.co.il" target="_blank" rel="noopener" title="Email me"
        class="md-social__link social-class__email">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l208 156a48 48 0 0 0 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 196v188c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V196L313.6 344.8c-34.1 25.6-81.1 25.6-115.2 0z"/></svg>
    </a>
    
</div>
      
    </div>

    <!-- Color palette toggle -->
    
    
    <form class="md-header__option" data-md-component="palette">
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="slate" data-md-color-primary="indigo" data-md-color-accent="teal"  aria-label="Switch to Light Mode"  type="radio" name="__palette" id="__palette_0">
    
      <label class="md-header__button md-icon" title="Switch to Light Mode" for="__palette_1" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="m17.75 4.09-2.53 1.94.91 3.06-2.63-1.81-2.63 1.81.91-3.06-2.53-1.94L12.44 4l1.06-3 1.06 3zm3.5 6.91-1.64 1.25.59 1.98-1.7-1.17-1.7 1.17.59-1.98L15.75 11l2.06-.05L18.5 9l.69 1.95zm-2.28 4.95c.83-.08 1.72 1.1 1.19 1.85-.32.45-.66.87-1.08 1.27C15.17 23 8.84 23 4.94 19.07c-3.91-3.9-3.91-10.24 0-14.14.4-.4.82-.76 1.27-1.08.75-.53 1.93.36 1.85 1.19-.27 2.86.69 5.83 2.89 8.02a9.96 9.96 0 0 0 8.02 2.89m-1.64 2.02a12.08 12.08 0 0 1-7.8-3.47c-2.17-2.19-3.33-5-3.49-7.82-2.81 3.14-2.7 7.96.31 10.98 3.02 3.01 7.84 3.12 10.98.31"/></svg>
      </label>
    
  
    
    
    
    <input class="md-option" data-md-color-media="" data-md-color-scheme="default" data-md-color-primary="indigo" data-md-color-accent="teal"  aria-label="Switch to Dark Mode"  type="radio" name="__palette" id="__palette_1">
    
      <label class="md-header__button md-icon" title="Switch to Dark Mode" for="__palette_0" hidden>
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M12 7a5 5 0 0 1 5 5 5 5 0 0 1-5 5 5 5 0 0 1-5-5 5 5 0 0 1 5-5m0 2a3 3 0 0 0-3 3 3 3 0 0 0 3 3 3 3 0 0 0 3-3 3 3 0 0 0-3-3m0-7 2.39 3.42C13.65 5.15 12.84 5 12 5s-1.65.15-2.39.42zM3.34 7l4.16-.35A7.2 7.2 0 0 0 5.94 8.5c-.44.74-.69 1.5-.83 2.29zm.02 10 1.76-3.77a7.131 7.131 0 0 0 2.38 4.14zM20.65 7l-1.77 3.79a7.02 7.02 0 0 0-2.38-4.15zm-.01 10-4.14.36c.59-.51 1.12-1.14 1.54-1.86.42-.73.69-1.5.83-2.29zM12 22l-2.41-3.44c.74.27 1.55.44 2.41.44.82 0 1.63-.17 2.37-.44z"/></svg>
      </label>
    
  
</form>
    
    

    <!-- User preference: color palette -->
    
    <script>var palette=__md_get("__palette");if(palette&&palette.color){if("(prefers-color-scheme)"===palette.color.media){var media=matchMedia("(prefers-color-scheme: light)"),input=document.querySelector(media.matches?"[data-md-color-media='(prefers-color-scheme: light)']":"[data-md-color-media='(prefers-color-scheme: dark)']");palette.color.media=input.getAttribute("data-md-color-media"),palette.color.scheme=input.getAttribute("data-md-color-scheme"),palette.color.primary=input.getAttribute("data-md-color-primary"),palette.color.accent=input.getAttribute("data-md-color-accent")}for(var[key,value]of Object.entries(palette.color))document.body.setAttribute("data-md-color-"+key,value)}</script>
    

    <!-- Site language selector -->
    

    <!-- Button to open search modal -->
    
    

    <!-- Check if search is actually enabled - see https://t.ly/DT_0V -->
    
    <label class="md-header__button md-icon" for="__search">
      
      <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
    </label>

    <!-- Search interface -->
    <div class="md-search" data-md-component="search" role="dialog">
  <label class="md-search__overlay" for="__search"></label>
  <div class="md-search__inner" role="search">
    <form class="md-search__form" name="search">
      <input type="text" class="md-search__input" name="query" aria-label="Search" placeholder="Search" autocapitalize="off" autocorrect="off" autocomplete="off" spellcheck="false" data-md-component="search-query" required>
      <label class="md-search__icon md-icon" for="__search">
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M9.5 3A6.5 6.5 0 0 1 16 9.5c0 1.61-.59 3.09-1.56 4.23l.27.27h.79l5 5-1.5 1.5-5-5v-.79l-.27-.27A6.52 6.52 0 0 1 9.5 16 6.5 6.5 0 0 1 3 9.5 6.5 6.5 0 0 1 9.5 3m0 2C7 5 5 7 5 9.5S7 14 9.5 14 14 12 14 9.5 12 5 9.5 5"/></svg>
        
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M20 11v2H8l5.5 5.5-1.42 1.42L4.16 12l7.92-7.92L13.5 5.5 8 11z"/></svg>
      </label>
      <nav class="md-search__options" aria-label="Search">
        
          <a href="javascript:void(0)" class="md-search__icon md-icon" title="Share" aria-label="Share" data-clipboard data-clipboard-text="" data-md-component="search-share" tabindex="-1">
            
            <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M18 16.08c-.76 0-1.44.3-1.96.77L8.91 12.7c.05-.23.09-.46.09-.7s-.04-.47-.09-.7l7.05-4.11c.54.5 1.25.81 2.04.81a3 3 0 0 0 3-3 3 3 0 0 0-3-3 3 3 0 0 0-3 3c0 .24.04.47.09.7L8.04 9.81C7.5 9.31 6.79 9 6 9a3 3 0 0 0-3 3 3 3 0 0 0 3 3c.79 0 1.5-.31 2.04-.81l7.12 4.15c-.05.21-.08.43-.08.66 0 1.61 1.31 2.91 2.92 2.91s2.92-1.3 2.92-2.91A2.92 2.92 0 0 0 18 16.08"/></svg>
          </a>
        
        <button type="reset" class="md-search__icon md-icon" title="Clear" aria-label="Clear" tabindex="-1">
          
          <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 24 24"><path d="M19 6.41 17.59 5 12 10.59 6.41 5 5 6.41 10.59 12 5 17.59 6.41 19 12 13.41 17.59 19 19 17.59 13.41 12z"/></svg>
        </button>
      </nav>
      
        <div class="md-search__suggest" data-md-component="search-suggest"></div>
      
    </form>
    <div class="md-search__output">
      <div class="md-search__scrollwrap" tabindex="0" data-md-scrollfix>
        <div class="md-search-result" data-md-component="search-result">
          <div class="md-search-result__meta">
            Initializing search
          </div>
          <ol class="md-search-result__list" role="presentation"></ol>
        </div>
      </div>
    </div>
  </div>
</div>
    
    

    <!-- Repository information -->
    
    <div class="md-header__source">
      <a href="https://github.com/nirgeier/KubernetesLabs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    nirgeier/KubernetesLabs
  </div>
</a>
    </div>
    
  </nav>

  <!-- Navigation tabs (sticky) -->
  
</header>
    
    <div class="md-container" data-md-component="container">
      
      
        
          
            
<nav class="md-tabs" aria-label="Tabs" data-md-component="tabs">
  <div class="md-grid">
    <ul class="md-tabs__list">
      
        
  
  
  
  
    <li class="md-tabs__item">
      <a href="../welcome/" class="md-tabs__link">
        
  
  
    
  
  Start Here

      </a>
    </li>
  

      
        
  
  
  
  
    
    
      <li class="md-tabs__item">
        <a href=".." class="md-tabs__link">
          
  
  
    
  
  Labs

        </a>
      </li>
    
  

      
    </ul>
  </div>
</nav>
          
        
      
      <main class="md-main" data-md-component="main">
        <div class="md-main__inner md-grid">
          
            
              
              <div class="md-sidebar md-sidebar--primary" data-md-component="sidebar" data-md-type="navigation" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    


  


<nav class="md-nav md-nav--primary md-nav--lifted" aria-label="Navigation" data-md-level="0">
  <label class="md-nav__title" for="__drawer">
    <a href=".." title="KubernetesLabs" class="md-nav__button md-logo" aria-label="KubernetesLabs" data-md-component="logo">
      
  
  <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 89 89">
  <path d="M3.136,17.387l0,42.932l42.932,21.467l-42.932,-64.399Z" />
  <path d="M21.91,8l42.933,64.398l-18.775,9.388l-42.932,-64.399l18.774,-9.387Z" style="fill-opacity: 0.5" />
  <path d="M67.535,17.387l-27.262,18.156l21.878,32.818l5.384,2.691l0,-53.665Z" />
  <path d="M67.535,17.387l0,53.666l18.774,-9.388l0,-53.665l-18.774,9.387Z" style="fill-opacity: 0.25" />
</svg>

    </a>
    KubernetesLabs
  </label>
  
    <div class="md-nav__source">
      <a href="https://github.com/nirgeier/KubernetesLabs" title="Go to repository" class="md-source" data-md-component="source">
  <div class="md-source__icon md-icon">
    
    <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
  </div>
  <div class="md-source__repository">
    nirgeier/KubernetesLabs
  </div>
</a>
    </div>
  
  <ul class="md-nav__list" data-md-scrollfix>
    
      
      
  
  
  
  
    <li class="md-nav__item">
      <a href="../welcome/" class="md-nav__link">
        
  
  
  <span class="md-ellipsis">
    
  
    Start Here
  

    
  </span>
  
  

      </a>
    </li>
  

    
      
      
  
  
  
  
    
    
      
        
          
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
        
      
    
    
    
      
      
        
      
    
    
      
        
        
      
    
    <li class="md-nav__item md-nav__item--pruned md-nav__item--nested">
      
        
  
  
  
    <a href=".." class="md-nav__link">
      
  
  
  <span class="md-ellipsis">
    
  
    Labs
  

    
  </span>
  
  

      
        <span class="md-nav__icon md-icon"></span>
      
    </a>
  

      
    </li>
  

    
  </ul>
</nav>
                  </div>
                </div>
              </div>
            
            
              
              <div class="md-sidebar md-sidebar--secondary" data-md-component="sidebar" data-md-type="toc" >
                <div class="md-sidebar__scrollwrap">
                  <div class="md-sidebar__inner">
                    

<nav class="md-nav md-nav--secondary" aria-label="Table of contents">
  
  
  
  
    <label class="md-nav__title" for="__toc">
      <span class="md-nav__icon md-icon"></span>
      Table of contents
    </label>
    <ul class="md-nav__list" data-md-component="toc" data-md-scrollfix>
      
        <li class="md-nav__item">
  <a href="#welcome" class="md-nav__link">
    <span class="md-ellipsis">
      
        1 Start Here
      
    </span>
  </a>
  
</li>
      
        <li class="md-nav__item">
  <a href="#section-2" class="md-nav__link">
    <span class="md-ellipsis">
      
        2 Labs
      
    </span>
  </a>
  
    <nav class="md-nav" aria-label="2 Labs">
      <ul class="md-nav__list">
        
          <li class="md-nav__item">
  <a href="#index" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.1 Kubernetes Labs
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#00-verifycluster" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.2 00 Verify Cluster
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#01-namespace" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.3 01 Namespace
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#02-deployments-imperative" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.4 02 Deployments Imperative
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#03-deployments-declarative" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.5 03 Deployments Declarative
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#04-rollout" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.6 04 Rollout
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#05-services" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.7 05 Services
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#06-datastore" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.8 06 DataStore
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#07-nginx-ingress" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.9 07 Nginx Ingress
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#08-kustomization" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.10 08 Kustomization
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#09-statefulset" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.11 09 StatefulSet
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#10-istio" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.12 10 Istio
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#11-crd-custom-resource-definition" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.13 11 CRD Custom Resource Definition
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#12-wordpress-mysql-pvc" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.14 12 Wordpress MySQL PVC
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#13-helmchart" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.15 13 HelmChart
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#14-logging" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.16 14 Logging
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#15-prometheus-grafana" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.17 15 Prometheus Grafana
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#16-affinity-taint-toleration" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.18 16 Affinity Taint Toleration
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#17-poddisruptionbudgets-pdb" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.19 17 PodDisruptionBudgets PDB
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#18-argocd" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.20 18 ArgoCD
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#19-customscheduler" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.21 19 CustomScheduler
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#20-cronjob" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.22 20 CronJob
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21-auditing" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.23 21 Auditing
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#21-kubeapi" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.24 21 KubeAPI
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#22-rancher" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.25 22 Rancher
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#23-metricserver" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.26 23 Metrics Server
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#24-helmoperator" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.27 24 HelmOperator
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#25-kubebuilder" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.28 25 Kubebuilder
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#26-k9s-basics" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.29 26 k9s Basics
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#27-krew" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.30 27 Krew
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#28-kubeapps" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.31 28 Kubeapps
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#29-kubeadm" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.32 29 Kubeadm
      
    </span>
  </a>
  
</li>
        
          <li class="md-nav__item">
  <a href="#30-k9s-advanced" class="md-nav__link">
    <span class="md-ellipsis">
      
        2.33 30 k9s Advanced
      
    </span>
  </a>
  
</li>
        
      </ul>
    </nav>
  
</li>
      
    </ul>
  
</nav>
                  </div>
                </div>
              </div>
            
          
          
            <div class="md-content" data-md-component="content">
              
              <article class="md-content__inner md-typeset">
                
                  



<div id="print-site-page" class="print-site-enumerate-headings print-site-enumerate-figures">
        <section class="print-page">
            <div id="print-page-toc" data-toc-depth="3">
                <nav role='navigation' class='print-page-toc-nav'>
                <h1 class='print-page-toc-title'>Table of Contents</h1>
                </nav>
            </div>
        </section>
        <section class="print-page" id="welcome" heading-number="1"><h1 id="welcome-welcome">Start Here</h1><h2 id="_1"><img alt="Kubernetes Logo" src="../assets/images/Kubernetes-Logo.wine.png" /><a class="headerlink" href="#welcome-_1" title="Permanent link">&para;</a></h2>
<h2 id="welcome-kubernetes-labs">Kubernetes Labs<a class="headerlink" href="#welcome-kubernetes-labs" title="Permanent link">&para;</a></h2>
<p>This is a comprehensive collection of hands-on labs designed to help you learn and master Kubernetes concepts, from basic deployments to advanced topics like Istio, ArgoCD and custom schedulers.</p>
<hr />
<h2 id="welcome-what-youll-learn">üìö What You&rsquo;ll Learn<a class="headerlink" href="#welcome-what-youll-learn" title="Permanent link">&para;</a></h2>
<ul>
<li>This lab series covers a wide range of <code>Kubernetes</code> topics:</li>
</ul>
<div class="grid cards">
<ul>
<li>
<h4 id="welcome-basics"><i class="fas fa-layer-group" style="color: #3e84e0;"></i>&emsp;Basics<a class="headerlink" href="#welcome-basics" title="Permanent link">&para;</a></h4>
<p>Namespaces, Deployments, Services and Rollouts</p>
</li>
<li>
<h4 id="welcome-storage"><i class="fas fa-database" style="color: #3e84e0;"></i>&emsp;Storage<a class="headerlink" href="#welcome-storage" title="Permanent link">&para;</a></h4>
<p>DataStores, Persistent Volume Claims and StatefulSets</p>
</li>
<li>
<h4 id="welcome-networking"><i class="fas fa-network-wired" style="color: #3e84e0;"></i>&emsp;Networking<a class="headerlink" href="#welcome-networking" title="Permanent link">&para;</a></h4>
<p>Ingress Controllers and Service Mesh (Istio)</p>
</li>
<li>
<h4 id="welcome-configuration-management"><i class="fas fa-cogs" style="color: #3e84e0;"></i>&emsp;Configuration Management<a class="headerlink" href="#welcome-configuration-management" title="Permanent link">&para;</a></h4>
<p>Kustomization and Helm Charts</p>
</li>
<li>
<h4 id="welcome-gitops"><i class="fas fa-code-branch" style="color: #3e84e0;"></i>&emsp;GitOps<a class="headerlink" href="#welcome-gitops" title="Permanent link">&para;</a></h4>
<p>ArgoCD for continuous deployment</p>
</li>
<li>
<h4 id="welcome-observability"><i class="fas fa-eye" style="color: #3e84e0;"></i>&emsp;Observability<a class="headerlink" href="#welcome-observability" title="Permanent link">&para;</a></h4>
<p>Istio, Kiali, Logging, Prometheus and Grafana</p>
</li>
<li>
<h4 id="welcome-advanced-topics"><i class="fas fa-rocket" style="color: #3e84e0;"></i>&emsp;Advanced Topics<a class="headerlink" href="#welcome-advanced-topics" title="Permanent link">&para;</a></h4>
<p>Custom Resource Definitions (CRDs), Custom Schedulers and Pod Disruption Budgets</p>
</li>
<li>
<h4 id="welcome-tools"><i class="fas fa-tools" style="color: #3e84e0;"></i>&emsp;Tools<a class="headerlink" href="#welcome-tools" title="Permanent link">&para;</a></h4>
<p>k9s, Krew, Kubeapps, Kubeadm and Rancher</p>
</li>
</ul>
</div>
<hr />
<h2 id="welcome-prerequisites">üõ†Ô∏è Prerequisites<a class="headerlink" href="#welcome-prerequisites" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>Before starting these labs, you should have:</p>
</li>
<li>
<p>Basic understanding of containerization (Docker)</p>
</li>
<li>Command-line (CLI) familiarity</li>
<li>A Kubernetes cluster (Minikube, Kind, or cloud-based cluster)</li>
<li><code>kubectl</code> installed and configured</li>
</ul>
<hr />
<ul>
<li>Recommended Software Installations:</li>
</ul>
<table>
<thead>
<tr>
<th>Tool Name</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>DevBox</strong></td>
<td>Development environment manager</td>
</tr>
<tr>
<td><strong>Docker</strong></td>
<td>Containerization tool</td>
</tr>
<tr>
<td><strong>Git</strong></td>
<td>Version control system</td>
</tr>
<tr>
<td><strong>Helm</strong></td>
<td>Kubernetes package manager</td>
</tr>
<tr>
<td><strong>Kubernetes</strong></td>
<td>Container orchestration platform</td>
</tr>
<tr>
<td><strong>Node.js</strong></td>
<td>JavaScript runtime environment</td>
</tr>
<tr>
<td><strong>Visual Studio Code</strong></td>
<td>Source code editor</td>
</tr>
<tr>
<td><strong>k9s</strong></td>
<td>Kubernetes CLI tool</td>
</tr>
<tr>
<td><strong>Kind</strong></td>
<td>Kubernetes cluster</td>
</tr>
<tr>
<td><strong>kubectl</strong></td>
<td>Kubernetes command-line tool</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="welcome-devbox-installation">DevBox Installation<a class="headerlink" href="#welcome-devbox-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="1:4"><input checked="checked" id="welcome-__tabbed_1_1" name="welcome-__tabbed_1" type="radio" /><input id="welcome-__tabbed_1_2" name="welcome-__tabbed_1" type="radio" /><input id="welcome-__tabbed_1_3" name="welcome-__tabbed_1" type="radio" /><input id="welcome-__tabbed_1_4" name="welcome-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="welcome-__tabbed_1_1">üçé macOS</label><label for="welcome-__tabbed_1_2">üêß Linux (Ubuntu/Debian)</label><label for="welcome-__tabbed_1_3">üêß Linux (CentOS)</label><label for="welcome-__tabbed_1_4">‚äû Windows</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><strong>Install DevBox using Homebrew</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#welcome-__codelineno-0-1"></a>brew<span class="w"> </span>install<span class="w"> </span>getdevbox/tap/devbox
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#welcome-__codelineno-1-1"></a>devbox<span class="w"> </span>--version
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Download and install DevBox</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#welcome-__codelineno-2-1"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://get.devbox.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
</span></code></pre></div></p>
<p><strong>Restart terminal or run:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#welcome-__codelineno-3-1"></a><span class="nb">source</span><span class="w"> </span>~/.bashrc
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#welcome-__codelineno-4-1"></a>devbox<span class="w"> </span>--version
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Download and install DevBox</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#welcome-__codelineno-5-1"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://get.devbox.sh<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
</span></code></pre></div></p>
<p><strong>Restart terminal or run:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#welcome-__codelineno-6-1"></a><span class="nb">source</span><span class="w"> </span>~/.bashrc
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#welcome-__codelineno-7-1"></a>devbox<span class="w"> </span>--version
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Install DevBox using Scoop</strong>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#welcome-__codelineno-8-1"></a><span class="n">scoop</span> <span class="n">install</span> <span class="n">devbox</span>
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#welcome-__codelineno-9-1"></a><span class="n">devbox</span> <span class="p">-</span><span class="n">-version</span>
</span></code></pre></div></p>
</div>
</div>
</div>
<hr />
<h3 id="welcome-docker-installation">üê≥ Docker Installation<a class="headerlink" href="#welcome-docker-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="2:4"><input checked="checked" id="welcome-__tabbed_2_1" name="welcome-__tabbed_2" type="radio" /><input id="welcome-__tabbed_2_2" name="welcome-__tabbed_2" type="radio" /><input id="welcome-__tabbed_2_3" name="welcome-__tabbed_2" type="radio" /><input id="welcome-__tabbed_2_4" name="welcome-__tabbed_2" type="radio" /><div class="tabbed-labels"><label for="welcome-__tabbed_2_1">üçé macOS</label><label for="welcome-__tabbed_2_2">üêß Linux (Ubuntu/Debian)</label><label for="welcome-__tabbed_2_3">üêß Linux (CentOS)</label><label for="welcome-__tabbed_2_4">‚äû Windows</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><strong>Install orbstack</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#welcome-__codelineno-10-1"></a>brew<span class="w"> </span>install<span class="w"> </span>--cask<span class="w"> </span>orbstack
</span></code></pre></div></p>
<p><strong>Start orbstack</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#welcome-__codelineno-11-1"></a>open<span class="w"> </span>-a<span class="w"> </span>orbstack
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Update package index</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#welcome-__codelineno-12-1"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>update
</span></code></pre></div></p>
<p><strong>Install Docker</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#welcome-__codelineno-13-1"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://get.docker.com<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh
</span></code></pre></div></p>
<p><strong>Add user to docker group</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#welcome-__codelineno-14-1"></a>sudo<span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span>docker<span class="w"> </span><span class="nv">$USER</span>
</span></code></pre></div></p>
<p><strong>Restart session or run:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#welcome-__codelineno-15-1"></a>newgrp<span class="w"> </span>docker
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Set up the repository</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#welcome-__codelineno-16-1"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>yum-utils
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#welcome-__codelineno-16-2"></a>sudo<span class="w"> </span>yum-config-manager<span class="w"> </span>--add-repo<span class="w"> </span>https://download.docker.com/linux/centos/docker-ce.repo
</span></code></pre></div></p>
<p><strong>Install Docker</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#welcome-__codelineno-17-1"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>docker-ce<span class="w"> </span>docker-ce-cli<span class="w"> </span>containerd.io
</span></code></pre></div></p>
<p><strong>Start Docker</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#welcome-__codelineno-18-1"></a>sudo<span class="w"> </span>systemctl<span class="w"> </span>start<span class="w"> </span>docker
</span></code></pre></div></p>
<p><strong>Add user to docker group</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#welcome-__codelineno-19-1"></a>sudo<span class="w"> </span>usermod<span class="w"> </span>-aG<span class="w"> </span>docker<span class="w"> </span><span class="nv">$USER</span>
</span></code></pre></div></p>
<p><strong>Restart session or run:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#welcome-__codelineno-20-1"></a>newgrp<span class="w"> </span>docker
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Install Docker Desktop</strong>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#welcome-__codelineno-21-1"></a><span class="n">winget</span> <span class="n">install</span> <span class="p">-</span><span class="n">-id</span> <span class="n">Docker</span><span class="p">.</span><span class="n">DockerDesktop</span> <span class="n">-e</span>
</span></code></pre></div></p>
<p><strong>Start Docker Desktop</strong>
<div class="language-powershell highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#welcome-__codelineno-22-1"></a><span class="nb">Start-Process</span> <span class="s2">&quot;C:\Program Files\Docker\Docker\Docker Desktop.exe&quot;</span>
</span></code></pre></div></p>
</div>
</div>
</div>
<hr />
<h3 id="welcome-git-installation">üì• Git Installation<a class="headerlink" href="#welcome-git-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="3:4"><input checked="checked" id="welcome-__tabbed_3_1" name="welcome-__tabbed_3" type="radio" /><input id="welcome-__tabbed_3_2" name="welcome-__tabbed_3" type="radio" /><input id="welcome-__tabbed_3_3" name="welcome-__tabbed_3" type="radio" /><input id="welcome-__tabbed_3_4" name="welcome-__tabbed_3" type="radio" /><div class="tabbed-labels"><label for="welcome-__tabbed_3_1">üçé macOS</label><label for="welcome-__tabbed_3_2">üêß Linux (Ubuntu/Debian)</label><label for="welcome-__tabbed_3_3">üêß Linux (CentOS)</label><label for="welcome-__tabbed_3_4">‚äû Windows</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><strong>Install Git using Homebrew</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#welcome-__codelineno-23-1"></a>brew<span class="w"> </span>install<span class="w"> </span>git
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#welcome-__codelineno-24-1"></a>git<span class="w"> </span>--version
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Update package index</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#welcome-__codelineno-25-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>update
</span></code></pre></div></p>
<p><strong>Install Git</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#welcome-__codelineno-26-1"></a>sudo<span class="w"> </span>apt<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>git
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#welcome-__codelineno-27-1"></a>git<span class="w"> </span>--version
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Install Git</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#welcome-__codelineno-28-1"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>git
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#welcome-__codelineno-29-1"></a>git<span class="w"> </span>--version
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p>Download Git from the official website: <a href="https://git-scm.com/download/win">https://git-scm.com/download/win</a></p>
</div>
</div>
</div>
<hr />
<h3 id="welcome-helm-installation">‚öì Helm Installation<a class="headerlink" href="#welcome-helm-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="4:4"><input checked="checked" id="welcome-__tabbed_4_1" name="welcome-__tabbed_4" type="radio" /><input id="welcome-__tabbed_4_2" name="welcome-__tabbed_4" type="radio" /><input id="welcome-__tabbed_4_3" name="welcome-__tabbed_4" type="radio" /><input id="welcome-__tabbed_4_4" name="welcome-__tabbed_4" type="radio" /><div class="tabbed-labels"><label for="welcome-__tabbed_4_1">üçé macOS</label><label for="welcome-__tabbed_4_2">üêß Linux (Ubuntu/Debian)</label><label for="welcome-__tabbed_4_3">üêß Linux (CentOS)</label><label for="welcome-__tabbed_4_4">‚äû Windows</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><strong>Install Helm using Homebrew</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#welcome-__codelineno-30-1"></a>brew<span class="w"> </span>install<span class="w"> </span>helm
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#welcome-__codelineno-31-1"></a>helm<span class="w"> </span>version
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Download and install Helm</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#welcome-__codelineno-32-1"></a>curl<span class="w"> </span>https://get.helm.sh/helm-v3.12.0-linux-amd64.tar.gz<span class="w"> </span>-o<span class="w"> </span>helm.tar.gz
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#welcome-__codelineno-32-2"></a>tar<span class="w"> </span>-zxvf<span class="w"> </span>helm.tar.gz
</span><span id="__span-32-3"><a id="__codelineno-32-3" name="__codelineno-32-3" href="#welcome-__codelineno-32-3"></a>sudo<span class="w"> </span>mv<span class="w"> </span>linux-amd64/helm<span class="w"> </span>/usr/local/bin/helm
</span><span id="__span-32-4"><a id="__codelineno-32-4" name="__codelineno-32-4" href="#welcome-__codelineno-32-4"></a>rm<span class="w"> </span>-rf<span class="w"> </span>linux-amd64<span class="w"> </span>helm.tar.gz
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#welcome-__codelineno-33-1"></a>helm<span class="w"> </span>version
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Download and install Helm</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#welcome-__codelineno-34-1"></a>curl<span class="w"> </span>https://get.helm.sh/helm-v3.12.0-linux-amd64.tar.gz<span class="w"> </span>-o<span class="w"> </span>helm.tar.gz
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#welcome-__codelineno-34-2"></a>tar<span class="w"> </span>-zxvf<span class="w"> </span>helm.tar.gz
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#welcome-__codelineno-34-3"></a>sudo<span class="w"> </span>mv<span class="w"> </span>linux-amd64/helm<span class="w"> </span>/usr/local/bin/helm
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#welcome-__codelineno-34-4"></a>rm<span class="w"> </span>-rf<span class="w"> </span>linux-amd64<span class="w"> </span>helm.tar.gz
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#welcome-__codelineno-35-1"></a>helm<span class="w"> </span>version
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p>Download Helm from: <a href="https://get.helm.sh/helm-v3.12.0-windows-amd64.zip">https://get.helm.sh/helm-v3.12.0-windows-amd64.zip</a></p>
</div>
</div>
</div>
<hr />
<h3 id="welcome-kubectl-installation">‚ò∏Ô∏è kubectl Installation<a class="headerlink" href="#welcome-kubectl-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="5:4"><input checked="checked" id="welcome-__tabbed_5_1" name="welcome-__tabbed_5" type="radio" /><input id="welcome-__tabbed_5_2" name="welcome-__tabbed_5" type="radio" /><input id="welcome-__tabbed_5_3" name="welcome-__tabbed_5" type="radio" /><input id="welcome-__tabbed_5_4" name="welcome-__tabbed_5" type="radio" /><div class="tabbed-labels"><label for="welcome-__tabbed_5_1">üçé macOS</label><label for="welcome-__tabbed_5_2">üêß Linux (Ubuntu/Debian)</label><label for="welcome-__tabbed_5_3">üêß Linux (CentOS)</label><label for="welcome-__tabbed_5_4">‚äû Windows</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><strong>Install kubectl using Homebrew</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#welcome-__codelineno-36-1"></a>brew<span class="w"> </span>install<span class="w"> </span>kubectl
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#welcome-__codelineno-37-1"></a>kubectl<span class="w"> </span>version<span class="w"> </span>--client
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Download kubectl</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#welcome-__codelineno-38-1"></a>curl<span class="w"> </span>-LO<span class="w"> </span><span class="s2">&quot;https://dl.k8s.io/release/</span><span class="k">$(</span>curl<span class="w"> </span>-L<span class="w"> </span>-s<span class="w"> </span>https://dl.k8s.io/release/stable.txt<span class="k">)</span><span class="s2">/bin/linux/amd64/kubectl&quot;</span>
</span></code></pre></div></p>
<p><strong>Make it executable</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#welcome-__codelineno-39-1"></a>chmod<span class="w"> </span>+x<span class="w"> </span>kubectl
</span></code></pre></div></p>
<p><strong>Move to PATH</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#welcome-__codelineno-40-1"></a>sudo<span class="w"> </span>mv<span class="w"> </span>kubectl<span class="w"> </span>/usr/local/bin/
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#welcome-__codelineno-41-1"></a>kubectl<span class="w"> </span>version<span class="w"> </span>--client
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Download kubectl</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#welcome-__codelineno-42-1"></a>curl<span class="w"> </span>-LO<span class="w"> </span><span class="s2">&quot;https://dl.k8s.io/release/</span><span class="k">$(</span>curl<span class="w"> </span>-L<span class="w"> </span>-s<span class="w"> </span>https://dl.k8s.io/release/stable.txt<span class="k">)</span><span class="s2">/bin/linux/amd64/kubectl&quot;</span>
</span></code></pre></div></p>
<p><strong>Make it executable</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#welcome-__codelineno-43-1"></a>chmod<span class="w"> </span>+x<span class="w"> </span>kubectl
</span></code></pre></div></p>
<p><strong>Move to PATH</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#welcome-__codelineno-44-1"></a>sudo<span class="w"> </span>mv<span class="w"> </span>kubectl<span class="w"> </span>/usr/local/bin/
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#welcome-__codelineno-45-1"></a>kubectl<span class="w"> </span>version<span class="w"> </span>--client
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p>Download kubectl from: <a href="https://kubernetes.io/docs/tasks/tools/">https://kubernetes.io/docs/tasks/tools/</a></p>
</div>
</div>
</div>
<hr />
<h3 id="welcome-nodejs-installation">üü¢ Node.js Installation<a class="headerlink" href="#welcome-nodejs-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="6:4"><input checked="checked" id="welcome-__tabbed_6_1" name="welcome-__tabbed_6" type="radio" /><input id="welcome-__tabbed_6_2" name="welcome-__tabbed_6" type="radio" /><input id="welcome-__tabbed_6_3" name="welcome-__tabbed_6" type="radio" /><input id="welcome-__tabbed_6_4" name="welcome-__tabbed_6" type="radio" /><div class="tabbed-labels"><label for="welcome-__tabbed_6_1">üçé macOS</label><label for="welcome-__tabbed_6_2">üêß Linux (Ubuntu/Debian)</label><label for="welcome-__tabbed_6_3">üêß Linux (CentOS)</label><label for="welcome-__tabbed_6_4">‚äû Windows</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><strong>Install Node.js using Homebrew</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#welcome-__codelineno-46-1"></a>brew<span class="w"> </span>install<span class="w"> </span>node
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#welcome-__codelineno-47-1"></a>node<span class="w"> </span>--version
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#welcome-__codelineno-47-2"></a>npm<span class="w"> </span>--version
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Install Node.js using NodeSource repository</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#welcome-__codelineno-48-1"></a>curl<span class="w"> </span>-fsSL<span class="w"> </span>https://deb.nodesource.com/setup_lts.x<span class="w"> </span><span class="p">|</span><span class="w"> </span>sudo<span class="w"> </span>-E<span class="w"> </span>bash<span class="w"> </span>-
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#welcome-__codelineno-48-2"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>nodejs
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#welcome-__codelineno-49-1"></a>node<span class="w"> </span>--version
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#welcome-__codelineno-49-2"></a>npm<span class="w"> </span>--version
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<div class="language-bash highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#welcome-__codelineno-50-1"></a>dnf<span class="w"> </span>module<span class="w"> </span>reset<span class="w"> </span>nodejs<span class="w"> </span>-y
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#welcome-__codelineno-50-2"></a>dnf<span class="w"> </span>module<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>nodejs:20<span class="w"> </span>-y
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#welcome-__codelineno-50-3"></a>dnf<span class="w"> </span>install<span class="w"> </span>nodejs<span class="w"> </span>-y
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#welcome-__codelineno-50-4"></a>node<span class="w"> </span>-v
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#welcome-__codelineno-50-5"></a>npm<span class="w"> </span>-v
</span></code></pre></div>
</div>
<div class="tabbed-block">
<p>Download Node.js from: <a href="https://nodejs.org/">https://nodejs.org/</a></p>
</div>
</div>
</div>
<hr />
<h3 id="welcome-visual-studio-code-installation">üíª Visual Studio Code Installation<a class="headerlink" href="#welcome-visual-studio-code-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="7:4"><input checked="checked" id="welcome-__tabbed_7_1" name="welcome-__tabbed_7" type="radio" /><input id="welcome-__tabbed_7_2" name="welcome-__tabbed_7" type="radio" /><input id="welcome-__tabbed_7_3" name="welcome-__tabbed_7" type="radio" /><input id="welcome-__tabbed_7_4" name="welcome-__tabbed_7" type="radio" /><div class="tabbed-labels"><label for="welcome-__tabbed_7_1">üçé macOS</label><label for="welcome-__tabbed_7_2">üêß Linux (Ubuntu/Debian)</label><label for="welcome-__tabbed_7_3">üêß Linux (CentOS)</label><label for="welcome-__tabbed_7_4">‚äû Windows</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><strong>Install VS Code using Homebrew</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#welcome-__codelineno-51-1"></a>brew<span class="w"> </span>install<span class="w"> </span>--cask<span class="w"> </span>visual-studio-code
</span></code></pre></div></p>
<p><strong>Start VS Code</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#welcome-__codelineno-52-1"></a>code<span class="w"> </span>.
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Install VS Code using snap</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#welcome-__codelineno-53-1"></a>sudo<span class="w"> </span>snap<span class="w"> </span>install<span class="w"> </span>code<span class="w"> </span>--classic
</span></code></pre></div></p>
<p><strong>Or using apt repository</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#welcome-__codelineno-54-1"></a><span class="c1"># wget -qO- https://packages.microsoft.com/keys/microsoft.asc | gpg --dearmor &gt; packages.microsoft.gpg</span>
</span><span id="__span-54-2"><a id="__codelineno-54-2" name="__codelineno-54-2" href="#welcome-__codelineno-54-2"></a><span class="c1"># sudo install -o root -g root -m 644 packages.microsoft.gpg /etc/apt/trusted.gpg.d/</span>
</span><span id="__span-54-3"><a id="__codelineno-54-3" name="__codelineno-54-3" href="#welcome-__codelineno-54-3"></a><span class="c1"># sudo sh -c &#39;echo &quot;deb [arch=amd64,arm64,armhf signed-by=/etc/apt/trusted.gpg.d/packages.microsoft.gpg] https://packages.microsoft.com/repos/code stable main&quot; &gt; /etc/apt/sources.list.d/vscode.list&#39;</span>
</span><span id="__span-54-4"><a id="__codelineno-54-4" name="__codelineno-54-4" href="#welcome-__codelineno-54-4"></a><span class="c1"># sudo apt update</span>
</span><span id="__span-54-5"><a id="__codelineno-54-5" name="__codelineno-54-5" href="#welcome-__codelineno-54-5"></a><span class="c1"># sudo apt install code</span>
</span></code></pre></div></p>
<p><strong>Start VS Code</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#welcome-__codelineno-55-1"></a>code<span class="w"> </span>.
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Import Microsoft GPG key</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#welcome-__codelineno-56-1"></a>sudo<span class="w"> </span>rpm<span class="w"> </span>--import<span class="w"> </span>https://packages.microsoft.com/keys/microsoft.asc
</span></code></pre></div></p>
<p><strong>Add VS Code repository</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#welcome-__codelineno-57-1"></a>sudo<span class="w"> </span>sh<span class="w"> </span>-c<span class="w"> </span><span class="s1">&#39;echo -e &quot;[code]\nname=Visual Studio Code\nbaseurl=https://packages.microsoft.com/yumrepos/vscode\nenabled=1\ngpgcheck=1\ngpgkey=https://packages.microsoft.com/keys/microsoft.asc&quot; &gt; /etc/yum.repos.d/vscode.repo&#39;</span>
</span></code></pre></div></p>
<p><strong>Install VS Code</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#welcome-__codelineno-58-1"></a>sudo<span class="w"> </span>yum<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>code
</span></code></pre></div></p>
<p><strong>Start VS Code</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#welcome-__codelineno-59-1"></a>code<span class="w"> </span>.
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p>Download Visual Studio Code from: <a href="https://code.visualstudio.com/download">https://code.visualstudio.com/download</a></p>
</div>
</div>
</div>
<hr />
<h3 id="welcome-k9s-installation">üê∂ k9s Installation<a class="headerlink" href="#welcome-k9s-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="8:4"><input checked="checked" id="welcome-__tabbed_8_1" name="welcome-__tabbed_8" type="radio" /><input id="welcome-__tabbed_8_2" name="welcome-__tabbed_8" type="radio" /><input id="welcome-__tabbed_8_3" name="welcome-__tabbed_8" type="radio" /><input id="welcome-__tabbed_8_4" name="welcome-__tabbed_8" type="radio" /><div class="tabbed-labels"><label for="welcome-__tabbed_8_1">üçé macOS</label><label for="welcome-__tabbed_8_2">üêß Linux (Ubuntu/Debian)</label><label for="welcome-__tabbed_8_3">üêß Linux (CentOS)</label><label for="welcome-__tabbed_8_4">‚äû Windows</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><strong>Install k9s using Homebrew</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#welcome-__codelineno-60-1"></a>brew<span class="w"> </span>install<span class="w"> </span>k9s
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#welcome-__codelineno-61-1"></a>k9s<span class="w"> </span>version
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Install k9s using webinstall</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-62-1"><a id="__codelineno-62-1" name="__codelineno-62-1" href="#welcome-__codelineno-62-1"></a>curl<span class="w"> </span>-sS<span class="w"> </span>https://webinstall.dev/k9s<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
</span></code></pre></div></p>
<p><strong>Or download binary</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-63-1"><a id="__codelineno-63-1" name="__codelineno-63-1" href="#welcome-__codelineno-63-1"></a><span class="c1"># curl -L https://github.com/derailed/k9s/releases/latest/download/k9s_Linux_amd64.tar.gz -o k9s.tar.gz</span>
</span><span id="__span-63-2"><a id="__codelineno-63-2" name="__codelineno-63-2" href="#welcome-__codelineno-63-2"></a><span class="c1"># tar -xzf k9s.tar.gz</span>
</span><span id="__span-63-3"><a id="__codelineno-63-3" name="__codelineno-63-3" href="#welcome-__codelineno-63-3"></a><span class="c1"># sudo mv k9s /usr/local/bin/</span>
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-64-1"><a id="__codelineno-64-1" name="__codelineno-64-1" href="#welcome-__codelineno-64-1"></a>k9s<span class="w"> </span>version
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Download k9s binary</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-65-1"><a id="__codelineno-65-1" name="__codelineno-65-1" href="#welcome-__codelineno-65-1"></a>curl<span class="w"> </span>-L<span class="w"> </span>https://github.com/derailed/k9s/releases/latest/download/k9s_Linux_amd64.tar.gz<span class="w"> </span>-o<span class="w"> </span>k9s.tar.gz
</span><span id="__span-65-2"><a id="__codelineno-65-2" name="__codelineno-65-2" href="#welcome-__codelineno-65-2"></a>tar<span class="w"> </span>-xzf<span class="w"> </span>k9s.tar.gz
</span><span id="__span-65-3"><a id="__codelineno-65-3" name="__codelineno-65-3" href="#welcome-__codelineno-65-3"></a>sudo<span class="w"> </span>mv<span class="w"> </span>k9s<span class="w"> </span>/usr/local/bin/
</span><span id="__span-65-4"><a id="__codelineno-65-4" name="__codelineno-65-4" href="#welcome-__codelineno-65-4"></a>rm<span class="w"> </span>k9s.tar.gz
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-66-1"><a id="__codelineno-66-1" name="__codelineno-66-1" href="#welcome-__codelineno-66-1"></a>k9s<span class="w"> </span>version
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p>Download k9s from: <a href="https://github.com/derailed/k9s/releases">https://github.com/derailed/k9s/releases</a></p>
</div>
</div>
</div>
<hr />
<h3 id="welcome-kind-installation">üéØ Kind Installation<a class="headerlink" href="#welcome-kind-installation" title="Permanent link">&para;</a></h3>
<div class="tabbed-set tabbed-alternate" data-tabs="9:4"><input checked="checked" id="welcome-__tabbed_9_1" name="welcome-__tabbed_9" type="radio" /><input id="welcome-__tabbed_9_2" name="welcome-__tabbed_9" type="radio" /><input id="welcome-__tabbed_9_3" name="welcome-__tabbed_9" type="radio" /><input id="welcome-__tabbed_9_4" name="welcome-__tabbed_9" type="radio" /><div class="tabbed-labels"><label for="welcome-__tabbed_9_1">üçé macOS</label><label for="welcome-__tabbed_9_2">üêß Linux (Ubuntu/Debian)</label><label for="welcome-__tabbed_9_3">üêß Linux (CentOS)</label><label for="welcome-__tabbed_9_4">‚äû Windows</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><strong>Install Kind using Homebrew</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-67-1"><a id="__codelineno-67-1" name="__codelineno-67-1" href="#welcome-__codelineno-67-1"></a>brew<span class="w"> </span>install<span class="w"> </span>kind
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-68-1"><a id="__codelineno-68-1" name="__codelineno-68-1" href="#welcome-__codelineno-68-1"></a>kind<span class="w"> </span>version
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Download Kind binary</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-69-1"><a id="__codelineno-69-1" name="__codelineno-69-1" href="#welcome-__codelineno-69-1"></a>curl<span class="w"> </span>-Lo<span class="w"> </span>./kind<span class="w"> </span>https://kind.sigs.k8s.io/dl/v0.20.0/kind-linux-amd64
</span><span id="__span-69-2"><a id="__codelineno-69-2" name="__codelineno-69-2" href="#welcome-__codelineno-69-2"></a>chmod<span class="w"> </span>+x<span class="w"> </span>./kind
</span><span id="__span-69-3"><a id="__codelineno-69-3" name="__codelineno-69-3" href="#welcome-__codelineno-69-3"></a>sudo<span class="w"> </span>mv<span class="w"> </span>./kind<span class="w"> </span>/usr/local/bin/kind
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-70-1"><a id="__codelineno-70-1" name="__codelineno-70-1" href="#welcome-__codelineno-70-1"></a>kind<span class="w"> </span>version
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Download Kind binary</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-71-1"><a id="__codelineno-71-1" name="__codelineno-71-1" href="#welcome-__codelineno-71-1"></a>curl<span class="w"> </span>-Lo<span class="w"> </span>./kind<span class="w"> </span>https://kind.sigs.k8s.io/dl/v0.20.0/kind-linux-amd64
</span><span id="__span-71-2"><a id="__codelineno-71-2" name="__codelineno-71-2" href="#welcome-__codelineno-71-2"></a>chmod<span class="w"> </span>+x<span class="w"> </span>./kind
</span><span id="__span-71-3"><a id="__codelineno-71-3" name="__codelineno-71-3" href="#welcome-__codelineno-71-3"></a>sudo<span class="w"> </span>mv<span class="w"> </span>./kind<span class="w"> </span>/usr/local/bin/kind
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-72-1"><a id="__codelineno-72-1" name="__codelineno-72-1" href="#welcome-__codelineno-72-1"></a>kind<span class="w"> </span>version
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p>Download Kind from: <a href="https://kind.sigs.k8s.io/dl/v0.20.0/kind-windows-amd64">https://kind.sigs.k8s.io/dl/v0.20.0/kind-windows-amd64</a></p>
</div>
</div>
</div>
<hr />
<h2 id="welcome-getting-started">Getting Started<a class="headerlink" href="#welcome-getting-started" title="Permanent link">&para;</a></h2>
<p>Let&rsquo;s dive into the world of Kubernetes together!</p>
<p>üëâ <a href="#00-verifycluster"><strong>Start the Labs here! (Lab 00 - Verify Cluster)</strong></a></p></section>
                    <section class='print-page md-section' id='section-2' heading-number='2'>
                        <h1>Labs<a class='headerlink' href='#section-2' title='Permanent link'></a>
                        </h1>
                    <section class="print-page" id="index" heading-number="2.1"><h1 id="index-kubernetes-labs">Kubernetes Labs<a class="headerlink" href="#index-kubernetes-labs" title="Permanent link">&para;</a></h1>
<h2 id="index-lab-overview">üìã Lab Overview<a class="headerlink" href="#index-lab-overview" title="Permanent link">&para;</a></h2>
<p>Welcome to the hands-on Kubernetes labs! This comprehensive series of labs will guide you through essential Kubernetes concepts and advanced topics.</p>
<h2 id="index-available-labs">üóÇÔ∏è Available Labs<a class="headerlink" href="#index-available-labs" title="Permanent link">&para;</a></h2>
<h3 id="index-foundation-labs">Foundation Labs<a class="headerlink" href="#index-foundation-labs" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Lab</th>
<th>Topic</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#00-verifycluster">00</a></td>
<td>Verify Cluster</td>
<td>Ensure your Kubernetes cluster is properly configured</td>
</tr>
<tr>
<td><a href="#01-namespace">01</a></td>
<td>Namespace</td>
<td>Learn to organize resources with namespaces</td>
</tr>
<tr>
<td><a href="#02-deployments-imperative">02</a></td>
<td>Deployments (Imperative)</td>
<td>Create deployments using kubectl commands</td>
</tr>
<tr>
<td><a href="#03-deployments-declarative">03</a></td>
<td>Deployments (Declarative)</td>
<td>Create deployments using YAML manifests</td>
</tr>
<tr>
<td><a href="#04-rollout">04</a></td>
<td>Rollout</td>
<td>Manage deployment updates and rollbacks</td>
</tr>
<tr>
<td><a href="#05-services">05</a></td>
<td>Services</td>
<td>Expose applications with Kubernetes services</td>
</tr>
</tbody>
</table>
<h3 id="index-storage-statefulsets">Storage &amp; StatefulSets<a class="headerlink" href="#index-storage-statefulsets" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Lab</th>
<th>Topic</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#06-datastore">06</a></td>
<td>DataStore</td>
<td>Work with persistent storage in Kubernetes</td>
</tr>
<tr>
<td><a href="#09-statefulset">09</a></td>
<td>StatefulSet</td>
<td>Deploy stateful applications</td>
</tr>
<tr>
<td><a href="#12-wordpress-mysql-pvc">12</a></td>
<td>WordPress MySQL PVC</td>
<td>Complete stateful application with persistent storage</td>
</tr>
</tbody>
</table>
<h3 id="index-networking-ingress">Networking &amp; Ingress<a class="headerlink" href="#index-networking-ingress" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Lab</th>
<th>Topic</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#07-nginx-ingress">07</a></td>
<td>Nginx Ingress</td>
<td>Configure ingress controllers for external access</td>
</tr>
<tr>
<td><a href="#10-istio">10</a></td>
<td>Istio</td>
<td>Implement service mesh for microservices</td>
</tr>
</tbody>
</table>
<h3 id="index-configuration-management">Configuration Management<a class="headerlink" href="#index-configuration-management" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Lab</th>
<th>Topic</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#08-kustomization">08</a></td>
<td>Kustomization</td>
<td>Manage configurations with Kustomize</td>
</tr>
<tr>
<td><a href="#13-helmchart">13</a></td>
<td>Helm Chart</td>
<td>Package and deploy applications with Helm</td>
</tr>
</tbody>
</table>
<h3 id="index-gitops-cicd">GitOps &amp; CI/CD<a class="headerlink" href="#index-gitops-cicd" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Lab</th>
<th>Topic</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#18-argocd">18</a></td>
<td>ArgoCD</td>
<td>Implement GitOps with ArgoCD</td>
</tr>
</tbody>
</table>
<h3 id="index-observability">Observability<a class="headerlink" href="#index-observability" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Lab</th>
<th>Topic</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#14-logging">14</a></td>
<td>Logging</td>
<td>Centralized logging with Fluentd</td>
</tr>
<tr>
<td><a href="#15-prometheus-grafana">15</a></td>
<td>Prometheus &amp; Grafana</td>
<td>Monitoring and visualization</td>
</tr>
<tr>
<td><a href="#23-metricserver">23</a></td>
<td>Metric Server</td>
<td>Resource metrics collection</td>
</tr>
</tbody>
</table>
<h3 id="index-advanced-topics">Advanced Topics<a class="headerlink" href="#index-advanced-topics" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Lab</th>
<th>Topic</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#11-crd-custom-resource-definition">11</a></td>
<td>Custom Resource Definition</td>
<td>Extend Kubernetes API with CRDs</td>
</tr>
<tr>
<td><a href="#16-affinity-taint-toleration">16</a></td>
<td>Affinity, Taint &amp; Toleration</td>
<td>Control pod scheduling</td>
</tr>
<tr>
<td><a href="#17-poddisruptionbudgets-pdb">17</a></td>
<td>Pod Disruption Budgets</td>
<td>Ensure availability during disruptions</td>
</tr>
<tr>
<td><a href="#19-customscheduler">19</a></td>
<td>Custom Scheduler</td>
<td>Build custom scheduling logic</td>
</tr>
<tr>
<td><a href="#20-cronjob">20</a></td>
<td>CronJob</td>
<td>Schedule recurring tasks</td>
</tr>
<tr>
<td><a href="#21-auditing">21</a></td>
<td>Auditing</td>
<td>Track cluster activities</td>
</tr>
<tr>
<td><a href="#21-kubeapi">21</a></td>
<td>Kube API</td>
<td>Work with Kubernetes API</td>
</tr>
<tr>
<td><a href="#24-helmoperator">24</a></td>
<td>Helm Operator</td>
<td>Manage Helm releases with operators</td>
</tr>
<tr>
<td><a href="#25-kubebuilder">25</a></td>
<td>Kubebuilder</td>
<td>Build Kubernetes operators</td>
</tr>
</tbody>
</table>
<h3 id="index-tools-utilities">Tools &amp; Utilities<a class="headerlink" href="#index-tools-utilities" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Lab</th>
<th>Topic</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><a href="#22-rancher">22</a></td>
<td>Rancher</td>
<td>Multi-cluster management platform</td>
</tr>
<tr>
<td><a href="#26-k9s-basics">26</a></td>
<td>k9s</td>
<td>Terminal-based Kubernetes UI</td>
</tr>
<tr>
<td><a href="#27-krew">27</a></td>
<td>Krew</td>
<td>kubectl plugin manager</td>
</tr>
<tr>
<td><a href="#28-kubeapps">28</a></td>
<td>Kubeapps</td>
<td>Application dashboard for Kubernetes</td>
</tr>
<tr>
<td><a href="#29-kubeadm">29</a></td>
<td>Kubeadm</td>
<td>Bootstrap Kubernetes clusters</td>
</tr>
<tr>
<td><a href="#30-k9s-advanced">30</a></td>
<td>k9s (Advanced)</td>
<td>Advanced k9s usage</td>
</tr>
</tbody>
</table>
<h2 id="index-learning-path">üéØ Learning Path<a class="headerlink" href="#index-learning-path" title="Permanent link">&para;</a></h2>
<h3 id="index-beginner-track">Beginner Track<a class="headerlink" href="#index-beginner-track" title="Permanent link">&para;</a></h3>
<p>Start here if you&rsquo;re new to Kubernetes:<br>
1. Lab 00: Verify Cluster <br>
2. Lab 01: Namespace <br>
3. Lab 02: Deployments (Imperative) <br>
4. Lab 03: Deployments (Declarative) <br>
5. Lab 05: Services <br></p>
<h3 id="index-intermediate-track">Intermediate Track<a class="headerlink" href="#index-intermediate-track" title="Permanent link">&para;</a></h3>
<p>For those with basic Kubernetes knowledge:<br>
1. Lab 04: Rollout <br>
2. Lab 06: DataStore <br>
3. Lab 07: Nginx Ingress <br>
4. Lab 08: Kustomization <br>
5. Lab 13: Helm Chart <br></p>
<h3 id="index-advanced-track">Advanced Track<a class="headerlink" href="#index-advanced-track" title="Permanent link">&para;</a></h3>
<p>For experienced Kubernetes users:<br>
1. Lab 10: Istio<br>
2. Lab 11: Custom Resource Definition<br>
3. Lab 18: ArgoCD<br>
4. Lab 19: Custom Scheduler<br>
5. Lab 25: Kubebuilder<br></p>
<h2 id="index-tips-for-success">üí° Tips for Success<a class="headerlink" href="#index-tips-for-success" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Take your time</strong>: Don&rsquo;t rush through the labs</li>
<li><strong>Practice regularly</strong>: Repetition builds muscle memory</li>
<li><strong>Experiment</strong>: Try variations of the examples</li>
<li><strong>Read the docs</strong>: Kubernetes documentation is excellent</li>
<li><strong>Join the community</strong>: Engage with other learners</li>
</ul>
<h2 id="index-get-started">üöÄ Get Started<a class="headerlink" href="#index-get-started" title="Permanent link">&para;</a></h2>
<p>Ready to begin? Click on any lab on the left menu, or start with <a href="#00-verifycluster">Lab 00: Verify Cluster</a>!</p></section><section class="print-page" id="00-verifycluster" heading-number="2.2"><h1 id="00-verifycluster-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#00-verifycluster-k8s-hands-on" title="Permanent link">&para;</a></h1>
<h3 id="00-verifycluster-verify-pre-requirements">Verify pre-requirements<a class="headerlink" href="#00-verifycluster-verify-pre-requirements" title="Permanent link">&para;</a></h3>
<ul>
<li><strong><code>kubectl</code></strong> - short for Kubernetes Controller - is the CLI for Kubernetes cluster and is required in order to be able to run the labs.</li>
<li>In order to install <code>kubectl</code> and if required creating a local cluster, please refer to <a href="https://kubernetes.io/docs/tasks/tools/">Kubernetes - Install Tools</a></li>
</ul>
<hr />
<h3 id="00-verifycluster-01-installing-kind">01. Installing Kind<a class="headerlink" href="#00-verifycluster-01-installing-kind" title="Permanent link">&para;</a></h3>
<ul>
<li>If you don&rsquo;t have an existing cluster you can use google cloud for the labs hands-on</li>
<li>
<p>Click on the button below to be able to run the labs on Google Shell <br/>
  <strong>[Use: <kbd>CTRL + click to open in new window]</strong> </p>
<p><a href="https://console.cloud.google.com/cloudshell/editor?cloudshell_git_repo=https://github.com/nirgeier/KubernetesLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a></p>
</li>
<li>
<p>Run the following commands based on your operating system:</p>
</li>
</ul>
<div class="tabbed-set tabbed-alternate" data-tabs="1:4"><input checked="checked" id="00-verifycluster-__tabbed_1_1" name="00-verifycluster-__tabbed_1" type="radio" /><input id="00-verifycluster-__tabbed_1_2" name="00-verifycluster-__tabbed_1" type="radio" /><input id="00-verifycluster-__tabbed_1_3" name="00-verifycluster-__tabbed_1" type="radio" /><input id="00-verifycluster-__tabbed_1_4" name="00-verifycluster-__tabbed_1" type="radio" /><div class="tabbed-labels"><label for="00-verifycluster-__tabbed_1_1">üçé macOS</label><label for="00-verifycluster-__tabbed_1_2">üêß Linux (Ubuntu/Debian)</label><label for="00-verifycluster-__tabbed_1_3">üêß Linux (CentOS)</label><label for="00-verifycluster-__tabbed_1_4">‚äû Windows</label></div>
<div class="tabbed-content">
<div class="tabbed-block">
<p><strong>Install Kind using Homebrew</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#00-verifycluster-__codelineno-0-1"></a>brew<span class="w"> </span>install<span class="w"> </span>kind
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#00-verifycluster-__codelineno-1-1"></a>kind<span class="w"> </span>version
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Download Kind binary</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#00-verifycluster-__codelineno-2-1"></a>curl<span class="w"> </span>-Lo<span class="w"> </span>./kind<span class="w"> </span>https://kind.sigs.k8s.io/dl/v0.20.0/kind-linux-amd64
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#00-verifycluster-__codelineno-2-2"></a>chmod<span class="w"> </span>+x<span class="w"> </span>./kind
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#00-verifycluster-__codelineno-2-3"></a>sudo<span class="w"> </span>mv<span class="w"> </span>./kind<span class="w"> </span>/usr/local/bin/kind
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#00-verifycluster-__codelineno-3-1"></a>kind<span class="w"> </span>version
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p><strong>Download Kind binary</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#00-verifycluster-__codelineno-4-1"></a>curl<span class="w"> </span>-Lo<span class="w"> </span>./kind<span class="w"> </span>https://kind.sigs.k8s.io/dl/v0.20.0/kind-linux-amd64
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#00-verifycluster-__codelineno-4-2"></a>chmod<span class="w"> </span>+x<span class="w"> </span>./kind
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#00-verifycluster-__codelineno-4-3"></a>sudo<span class="w"> </span>mv<span class="w"> </span>./kind<span class="w"> </span>/usr/local/bin/kind
</span></code></pre></div></p>
<p><strong>Verify installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#00-verifycluster-__codelineno-5-1"></a>kind<span class="w"> </span>version
</span></code></pre></div></p>
</div>
<div class="tabbed-block">
<p>Download Kind from: <a href="https://kind.sigs.k8s.io/dl/v0.20.0/kind-windows-amd64">https://kind.sigs.k8s.io/dl/v0.20.0/kind-windows-amd64</a></p>
</div>
</div>
</div>
<h3 id="00-verifycluster-02-create-kind-cluster">02. Create Kind cluster<a class="headerlink" href="#00-verifycluster-02-create-kind-cluster" title="Permanent link">&para;</a></h3>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#00-verifycluster-__codelineno-6-1"></a>kind<span class="w"> </span>create<span class="w"> </span>cluster
</span></code></pre></div>
<ul>
<li>You should see an output like this:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#00-verifycluster-__codelineno-7-1"></a>Creating<span class="w"> </span>cluster<span class="w"> </span><span class="s2">&quot;kind&quot;</span><span class="w"> </span>...
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#00-verifycluster-__codelineno-7-2"></a><span class="w"> </span>‚Ä¢<span class="w"> </span>Ensuring<span class="w"> </span>node<span class="w"> </span>image<span class="w"> </span><span class="o">(</span>kindest/node:v1.27.3<span class="o">)</span><span class="w"> </span>üñº
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#00-verifycluster-__codelineno-7-3"></a><span class="w"> </span>‚Ä¢<span class="w"> </span>Preparing<span class="w"> </span>nodes<span class="w"> </span>üì¶
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#00-verifycluster-__codelineno-7-4"></a><span class="w"> </span>‚Ä¢<span class="w"> </span>Writing<span class="w"> </span>configuration<span class="w"> </span>üìú
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#00-verifycluster-__codelineno-7-5"></a><span class="w"> </span>‚Ä¢<span class="w"> </span>Starting<span class="w"> </span>control-plane<span class="w"> </span>üïπÔ∏è
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#00-verifycluster-__codelineno-7-6"></a><span class="w"> </span>‚Ä¢<span class="w"> </span>Installing<span class="w"> </span>CNI<span class="w"> </span>üîå
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#00-verifycluster-__codelineno-7-7"></a><span class="w"> </span>‚Ä¢<span class="w"> </span>Installing<span class="w"> </span>StorageClass<span class="w"> </span>üíæ
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#00-verifycluster-__codelineno-7-8"></a>Set<span class="w"> </span>kubectl<span class="w"> </span>context<span class="w"> </span>to<span class="w"> </span><span class="s2">&quot;kind-kind&quot;</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#00-verifycluster-__codelineno-7-9"></a>You<span class="w"> </span>can<span class="w"> </span>now<span class="w"> </span>use<span class="w"> </span>your<span class="w"> </span>cluster<span class="w"> </span>with:
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#00-verifycluster-__codelineno-7-10"></a>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#00-verifycluster-__codelineno-7-11"></a>kubectl<span class="w"> </span>cluster-info<span class="w"> </span>--context<span class="w"> </span>kind-kind
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#00-verifycluster-__codelineno-7-12"></a>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#00-verifycluster-__codelineno-7-13"></a>Thanks<span class="w"> </span><span class="k">for</span><span class="w"> </span>using<span class="w"> </span>kind!<span class="w"> </span>üòä
</span></code></pre></div>
<h3 id="00-verifycluster-03-check-the-kind-cluster-status">03. Check the Kind cluster status<a class="headerlink" href="#00-verifycluster-03-check-the-kind-cluster-status" title="Permanent link">&para;</a></h3>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#00-verifycluster-__codelineno-8-1"></a>kubectl<span class="w"> </span>cluster-info
</span></code></pre></div>
<ul>
<li>You should see output similar to this one:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#00-verifycluster-__codelineno-9-1"></a>Kubernetes<span class="w"> </span>control<span class="w"> </span>plane<span class="w"> </span>is<span class="w"> </span>running<span class="w"> </span>at<span class="w"> </span>https://127.0.0.1:6443
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#00-verifycluster-__codelineno-9-2"></a>CoreDNS<span class="w"> </span>is<span class="w"> </span>running<span class="w"> </span>at<span class="w"> </span>https://127.0.0.1:6443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#00-verifycluster-__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#00-verifycluster-__codelineno-9-4"></a>To<span class="w"> </span>further<span class="w"> </span>debug<span class="w"> </span>and<span class="w"> </span>diagnose<span class="w"> </span>cluster<span class="w"> </span>problems,<span class="w"> </span>use<span class="w"> </span><span class="s1">&#39;kubectl cluster-info dump&#39;</span>.
</span></code></pre></div>
<h3 id="00-verifycluster-04-verify-that-the-cluster-is-up-and-running">04. Verify that the cluster is up and running<a class="headerlink" href="#00-verifycluster-04-verify-that-the-cluster-is-up-and-running" title="Permanent link">&para;</a></h3>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#00-verifycluster-__codelineno-10-1"></a>kubectl<span class="w"> </span>cluster-info
</span></code></pre></div>
<ul>
<li>Verify that <code>kubectl</code> is installed and configured</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#00-verifycluster-__codelineno-11-1"></a>kubectl<span class="w"> </span>config<span class="w"> </span>view
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#00-verifycluster-__codelineno-12-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#00-verifycluster-__codelineno-12-2"></a><span class="nt">clusters</span><span class="p">:</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#00-verifycluster-__codelineno-12-3"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">cluster</span><span class="p">:</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#00-verifycluster-__codelineno-12-4"></a><span class="w">    </span><span class="nt">certificate-authority-data</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">DATA+OMITTED</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#00-verifycluster-__codelineno-12-5"></a><span class="w">    </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://127.0.0.1:6443</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#00-verifycluster-__codelineno-12-6"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kind-kind</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#00-verifycluster-__codelineno-12-7"></a><span class="nt">contexts</span><span class="p">:</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#00-verifycluster-__codelineno-12-8"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">context</span><span class="p">:</span>
</span><span id="__span-12-9"><a id="__codelineno-12-9" name="__codelineno-12-9" href="#00-verifycluster-__codelineno-12-9"></a><span class="w">    </span><span class="nt">cluster</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kind-kind</span>
</span><span id="__span-12-10"><a id="__codelineno-12-10" name="__codelineno-12-10" href="#00-verifycluster-__codelineno-12-10"></a><span class="w">    </span><span class="nt">user</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kind-kind</span>
</span><span id="__span-12-11"><a id="__codelineno-12-11" name="__codelineno-12-11" href="#00-verifycluster-__codelineno-12-11"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kind-kind</span>
</span><span id="__span-12-12"><a id="__codelineno-12-12" name="__codelineno-12-12" href="#00-verifycluster-__codelineno-12-12"></a><span class="nt">current-context</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kind-kind</span>
</span><span id="__span-12-13"><a id="__codelineno-12-13" name="__codelineno-12-13" href="#00-verifycluster-__codelineno-12-13"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Config</span>
</span><span id="__span-12-14"><a id="__codelineno-12-14" name="__codelineno-12-14" href="#00-verifycluster-__codelineno-12-14"></a><span class="nt">preferences</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">{}</span>
</span><span id="__span-12-15"><a id="__codelineno-12-15" name="__codelineno-12-15" href="#00-verifycluster-__codelineno-12-15"></a><span class="nt">users</span><span class="p">:</span>
</span><span id="__span-12-16"><a id="__codelineno-12-16" name="__codelineno-12-16" href="#00-verifycluster-__codelineno-12-16"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kind-kind</span>
</span><span id="__span-12-17"><a id="__codelineno-12-17" name="__codelineno-12-17" href="#00-verifycluster-__codelineno-12-17"></a><span class="w">  </span><span class="nt">user</span><span class="p">:</span>
</span><span id="__span-12-18"><a id="__codelineno-12-18" name="__codelineno-12-18" href="#00-verifycluster-__codelineno-12-18"></a><span class="w">    </span><span class="nt">client-certificate-data</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REDACTED</span>
</span><span id="__span-12-19"><a id="__codelineno-12-19" name="__codelineno-12-19" href="#00-verifycluster-__codelineno-12-19"></a><span class="w">    </span><span class="nt">client-key-data</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">REDACTED</span>
</span></code></pre></div>
</div>
<h3 id="00-verifycluster-05-verify-that-you-can-talk-to-your-cluster">05. Verify that you can &ldquo;talk&rdquo; to your cluster<a class="headerlink" href="#00-verifycluster-05-verify-that-you-can-talk-to-your-cluster" title="Permanent link">&para;</a></h3>
<p><strong>Check the nodes in the Kind cluster</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#00-verifycluster-__codelineno-13-1"></a><span class="c1"># Check the nodes in the Kind cluster</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#00-verifycluster-__codelineno-13-2"></a>kubectl<span class="w"> </span>get<span class="w"> </span>nodes
</span></code></pre></div></p>
<ul>
<li>You should see output similar to this:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#00-verifycluster-__codelineno-14-1"></a>NAME<span class="w">                 </span>STATUS<span class="w">   </span>ROLES<span class="w">           </span>AGE<span class="w">    </span>VERSION
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#00-verifycluster-__codelineno-14-2"></a>kind-control-plane<span class="w">   </span>Ready<span class="w">    </span>control-plane<span class="w">   </span>2m<span class="w">     </span>v1.27.3
</span></code></pre></div></section><section class="print-page" id="01-namespace" heading-number="2.3"><h1 id="01-namespace-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#01-namespace-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="01-namespace-namespaces">Namespaces<a class="headerlink" href="#01-namespace-namespaces" title="Permanent link">&para;</a></h2>
<ul>
<li>Kubernetes supports <strong>multiple virtual clusters</strong> backed by the same <strong>physical cluster</strong>.</li>
<li>These virtual clusters are called <code>namespaces</code>.</li>
<li><code>Namespaces</code> are the default way for Kubernetes to separate resources.</li>
<li>Using <code>namespaces</code> we can isolate the development, improve security and much more.</li>
<li>Kubernetes clusters has a builtin <code>namespace</code> called <strong>default</strong> and might contain more <code>namespaces</code>, like <code>kube-system</code>, for example.</li>
</ul>
<hr />
<h3 id="01-namespace-prerequisites">Prerequisites<a class="headerlink" href="#01-namespace-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>K8S cluster - <a href="#00-verifycluster">Setting up minikube cluster instruction</a></li>
</ul>
<p><a href="https://ide.cloud.google.com/?cloudshell_git_repo=https://github.com/nirgeier/KubernetesLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a><br />
<strong><kbd>CTRL</kbd> + <kbd>click</kbd> to open in new window</strong></p>
<hr />
<h3 id="01-namespace-step-01-create-namespace">Step 01 - Create Namespace<a class="headerlink" href="#01-namespace-step-01-create-namespace" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#01-namespace-__codelineno-0-1"></a>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>codewizard
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#01-namespace-__codelineno-1-1"></a>namespace/codewizard created
</span></code></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Challenge</p>
<p>Try to create the following namespace (with <code>_</code> &amp; <code>-</code>), and see what happens:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#01-namespace-__codelineno-2-1"></a>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>my_namespace-
</span></code></pre></div></p>
</div>
<hr />
<h3 id="01-namespace-step-02-setting-the-default-namespace-for-kubectl">Step 02 - Setting the default Namespace for <code>kubectl</code><a class="headerlink" href="#01-namespace-step-02-setting-the-default-namespace-for-kubectl" title="Permanent link">&para;</a></h3>
<ul>
<li>To set the default namespace run:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#01-namespace-__codelineno-3-1"></a>kubectl<span class="w"> </span>config<span class="w"> </span>set-context<span class="w"> </span><span class="k">$(</span>kubectl<span class="w"> </span>config<span class="w"> </span>current-context<span class="k">)</span><span class="w"> </span>--namespace<span class="o">=</span>codewizard
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#01-namespace-__codelineno-4-1"></a>Context minikube modified.
</span></code></pre></div>
</div>
<hr />
<h3 id="01-namespace-step-03-verify-that-youve-updated-the-namespace">Step 03 - Verify that you&rsquo;ve updated the namespace<a class="headerlink" href="#01-namespace-step-03-verify-that-youve-updated-the-namespace" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#01-namespace-__codelineno-5-1"></a>kubectl<span class="w"> </span>config<span class="w"> </span>get-contexts
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#01-namespace-__codelineno-6-1"></a>CURRENT     NAME                 CLUSTER          AUTHINFO         NAMESPACE
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#01-namespace-__codelineno-6-2"></a>            docker-desktop       docker-desktop   docker-desktop
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#01-namespace-__codelineno-6-3"></a>            docker-for-desktop   docker-desktop   docker-desktop
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#01-namespace-__codelineno-6-4"></a>*           minikube             minikube         minikube         codewizard
</span></code></pre></div>
</div>
<hr />
<h3 id="01-namespace-step-04-using-the-n-flag">Step 04 - Using the <code>-n</code> Flag<a class="headerlink" href="#01-namespace-step-04-using-the-n-flag" title="Permanent link">&para;</a></h3>
<ul>
<li>When using <code>kubectl</code> you can pass the <code>-n</code> flag in order to execute the <code>kubectl</code> command on a desired <code>namespace</code>.</li>
<li>For example:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#01-namespace-__codelineno-7-1"></a><span class="c1"># get resources of a specific workspace</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#01-namespace-__codelineno-7-2"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>&lt;namespace&gt;
</span></code></pre></div></section><section class="print-page" id="02-deployments-imperative" heading-number="2.4"><h1 id="02-deployments-imperative-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#02-deployments-imperative-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="02-deployments-imperative-deployment-imperative">Deployment - Imperative<a class="headerlink" href="#02-deployments-imperative-deployment-imperative" title="Permanent link">&para;</a></h2>
<h2 id="02-deployments-imperative-creating-deployments-using-kubectl-create">Creating deployments using <code>kubectl create</code><a class="headerlink" href="#02-deployments-imperative-creating-deployments-using-kubectl-create" title="Permanent link">&para;</a></h2>
<ul>
<li>We start with creating the following deployment
  <a href="https://github.com/Praqma/Network-MultiTool">praqma/network-multitool</a></li>
<li>This is a multitool for container/network testing and troubleshooting.</li>
</ul>
<hr />
<h3 id="02-deployments-imperative-prerequisites">Prerequisites<a class="headerlink" href="#02-deployments-imperative-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>K8S cluster - <a href="#00-verifycluster">Setting up minikube cluster instruction</a></li>
</ul>
<p><a href="https://ide.cloud.google.com/?cloudshell_git_repo=https://github.com/nirgeier/KubernetesLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a><br />
<strong><kbd>CTRL</kbd> + <kbd>click</kbd> to open in new window</strong></p>
<hr />
<h3 id="02-deployments-imperative-step-01-create-namespace">Step 01 - Create Namespace<a class="headerlink" href="#02-deployments-imperative-step-01-create-namespace" title="Permanent link">&para;</a></h3>
<ul>
<li>As completed in the previous lab, create the desired namespace [codewizard]:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#02-deployments-imperative-__codelineno-0-1"></a>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>codewizard
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#02-deployments-imperative-__codelineno-1-1"></a>namespace/codewizard created
</span></code></pre></div>
</div>
<ul>
<li>In order to set this is as the default namespace, please refer to <a href="#01-namespace-2-setting-the-default-namespace-for-kubectl">set default namespace</a>.</li>
</ul>
<hr />
<h3 id="02-deployments-imperative-step-02-deploy-multitool-image">Step 02 - Deploy Multitool Image<a class="headerlink" href="#02-deployments-imperative-step-02-deploy-multitool-image" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#02-deployments-imperative-__codelineno-2-1"></a>kubectl<span class="w"> </span>create<span class="w"> </span>deployment<span class="w"> </span>multitool<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>--image<span class="o">=</span>praqma/network-multitool
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#02-deployments-imperative-__codelineno-3-1"></a>deployment.apps/multitool created
</span></code></pre></div>
</div>
<ul>
<li><code>kubectl create deployment</code> actually creating a replica set for us.</li>
<li>We can verify it by running:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#02-deployments-imperative-__codelineno-4-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>codewizard
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#02-deployments-imperative-__codelineno-5-1"></a>NAME                                    READY    UP-TO-DATE  AVAILABLE
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#02-deployments-imperative-__codelineno-5-2"></a>deployment.apps/multitool               1/1      1           1
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#02-deployments-imperative-__codelineno-5-3"></a>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#02-deployments-imperative-__codelineno-5-4"></a>NAME                                    DESIRED  CURRENT     READY
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#02-deployments-imperative-__codelineno-5-5"></a>replicaset.apps/multitool-7885b5f94f    1        1           1
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#02-deployments-imperative-__codelineno-5-6"></a>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#02-deployments-imperative-__codelineno-5-7"></a>NAME                                    READY    STATUS      RESTARTS
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#02-deployments-imperative-__codelineno-5-8"></a>pod/multitool-7885b5f94f-9s7xh          1/1      Running     0
</span></code></pre></div>
</div>
<hr />
<h3 id="02-deployments-imperative-step-03-test-the-deployment">Step 03 - Test the Deployment<a class="headerlink" href="#02-deployments-imperative-step-03-test-the-deployment" title="Permanent link">&para;</a></h3>
<ul>
<li>The above deployment contains a container named, <code>multitool</code>.</li>
<li>In order for us to be able to access this <code>multitool</code> container, we need to create a resource of type <code>Service</code> which will &ldquo;open&rdquo; the server for incoming traffic.</li>
</ul>
<h4 id="02-deployments-imperative-create-a-service-using-kubectl-expose">Create a service using <code>kubectl expose</code><a class="headerlink" href="#02-deployments-imperative-create-a-service-using-kubectl-expose" title="Permanent link">&para;</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#02-deployments-imperative-__codelineno-6-1"></a>kubectl<span class="w"> </span>expose<span class="w"> </span>deployment<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>multitool<span class="w"> </span>--port<span class="w"> </span><span class="m">80</span><span class="w"> </span>--type<span class="w"> </span>NodePort
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#02-deployments-imperative-__codelineno-7-1"></a>service/multitool exposed
</span></code></pre></div>
</div>
<ul>
<li>Verify that the service have been created by running:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#02-deployments-imperative-__codelineno-8-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>service<span class="w"> </span>-n<span class="w"> </span>codewizard
</span></code></pre></div>
<hr />
<h4 id="02-deployments-imperative-find-the-port-the-ip-which-was-assigned-to-our-pod-by-the-cluster">Find the port &amp; the IP which was assigned to our pod by the cluster.<a class="headerlink" href="#02-deployments-imperative-find-the-port-the-ip-which-was-assigned-to-our-pod-by-the-cluster" title="Permanent link">&para;</a></h4>
<ul>
<li>Grab the port from the previous output.</li>
<li>Port: In the above sample its <code>31418</code> [<code>80:31418/TCP</code>]</li>
<li>IP: we will need to grab the cluster ip using <code>kubectl cluster-info</code></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#02-deployments-imperative-__codelineno-9-1"></a>kubectl<span class="w"> </span>cluster-info
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#02-deployments-imperative-__codelineno-10-1"></a>Kubernetes control plane is running at https://192.168.49.2:8443
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#02-deployments-imperative-__codelineno-10-2"></a>KubeDNS is running at https://192.168.49.2:8443/api/v1/namespaces/kube-system/services/kube-dns:dns/proxy
</span></code></pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Automation Script</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#02-deployments-imperative-__codelineno-11-1"></a><span class="c1"># Programmatically get the port and the IP</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#02-deployments-imperative-__codelineno-11-2"></a><span class="nv">CLUSTER_IP</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>nodes<span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#02-deployments-imperative-__codelineno-11-3"></a><span class="w">            </span>--selector<span class="o">=</span>node-role.kubernetes.io/control-plane<span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#02-deployments-imperative-__codelineno-11-4"></a><span class="w">            </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{$.items[*].status.addresses[?(@.type==&quot;InternalIP&quot;)].address}&#39;</span><span class="k">)</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#02-deployments-imperative-__codelineno-11-5"></a>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#02-deployments-imperative-__codelineno-11-6"></a><span class="nv">NODE_PORT</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>-o<span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-7"><a id="__codelineno-11-7" name="__codelineno-11-7" href="#02-deployments-imperative-__codelineno-11-7"></a><span class="w">            </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.spec.ports[0].nodePort}&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-8"><a id="__codelineno-11-8" name="__codelineno-11-8" href="#02-deployments-imperative-__codelineno-11-8"></a><span class="w">            </span>services<span class="w"> </span>multitool<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="k">)</span>
</span></code></pre></div>
</div>
<ul>
<li>In this sample the cluster-ip is <code>192.168.49.2</code></li>
</ul>
<hr />
<h4 id="02-deployments-imperative-test-the-deployment">Test the deployment<a class="headerlink" href="#02-deployments-imperative-test-the-deployment" title="Permanent link">&para;</a></h4>
<ul>
<li>Test to see if the deployment worked using the <code>ip address and port number</code> we have retrieved above.</li>
<li>Execute <code>curl</code> with the following parameters: <code>http://${CLUSTER_IP}:${NODE_PORT}</code></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#02-deployments-imperative-__codelineno-12-1"></a>curl<span class="w"> </span>http://<span class="si">${</span><span class="nv">CLUSTER_IP</span><span class="si">}</span>:<span class="si">${</span><span class="nv">NODE_PORT</span><span class="si">}</span>
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#02-deployments-imperative-__codelineno-13-1"></a>Praqma Network MultiTool (with NGINX) ...
</span></code></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Manual Example</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#02-deployments-imperative-__codelineno-14-1"></a>curl<span class="w"> </span><span class="m">192</span>.168.49.2:30436
</span></code></pre></div>
</div>
<ul>
<li>If you get the above output, congratulations! You have successfully created a deployment using imperative commands.</li>
</ul></section><section class="print-page" id="03-deployments-declarative" heading-number="2.5"><h1 id="03-deployments-declarative-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#03-deployments-declarative-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="03-deployments-declarative-deployment-declarative">Deployment - Declarative<a class="headerlink" href="#03-deployments-declarative-deployment-declarative" title="Permanent link">&para;</a></h2>
<h3 id="03-deployments-declarative-prerequisites">Prerequisites<a class="headerlink" href="#03-deployments-declarative-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>K8S cluster - <a href="#00-verifycluster">Setting up minikube cluster instruction</a></li>
</ul>
<p><a href="https://ide.cloud.google.com/?cloudshell_git_repo=https://github.com/nirgeier/KubernetesLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a><br />
<strong><kbd>CTRL</kbd> + <kbd>click</kbd> to open in new window</strong></p>
<hr />
<h3 id="03-deployments-declarative-step-01-create-namespace">Step 01 - Create Namespace<a class="headerlink" href="#03-deployments-declarative-step-01-create-namespace" title="Permanent link">&para;</a></h3>
<ul>
<li>As completed in the previous lab, create the desired namespace [codewizard]:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#03-deployments-declarative-__codelineno-0-1"></a>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>codewizard
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#03-deployments-declarative-__codelineno-1-1"></a>namespace/codewizard created
</span></code></pre></div>
</div>
<ul>
<li>In order to set this is as the default namespace, please refer to <a href="#01-namespace-2-setting-the-default-namespace-for-kubectl">set default namespace</a>.</li>
</ul>
<hr />
<h3 id="03-deployments-declarative-step-02-deploy-nginx-using-yaml-file-declarative">Step 02 - Deploy nginx using yaml file (declarative)<a class="headerlink" href="#03-deployments-declarative-step-02-deploy-nginx-using-yaml-file-declarative" title="Permanent link">&para;</a></h3>
<ul>
<li>Let&rsquo;s create the <code>YAML</code> file for the deployment.</li>
<li>If this is your first <code>k8s</code> <code>YAML</code> file, its advisable that you type it in order to get the feeling of the structure.</li>
<li>Save the file with the following name: <code>nginx.yaml</code></li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#03-deployments-declarative-__codelineno-2-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#03-deployments-declarative-__codelineno-2-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span><span class="w"> </span><span class="c1"># We use a deployment and not pod !!!!</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#03-deployments-declarative-__codelineno-2-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#03-deployments-declarative-__codelineno-2-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span><span class="w"> </span><span class="c1"># Deployment name</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#03-deployments-declarative-__codelineno-2-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codewizard</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#03-deployments-declarative-__codelineno-2-6"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#03-deployments-declarative-__codelineno-2-7"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span><span class="w"> </span><span class="c1"># Deployment label</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#03-deployments-declarative-__codelineno-2-8"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#03-deployments-declarative-__codelineno-2-9"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#03-deployments-declarative-__codelineno-2-10"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#03-deployments-declarative-__codelineno-2-11"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span><span class="w"> </span><span class="c1"># Labels for the replica selector</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#03-deployments-declarative-__codelineno-2-12"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#03-deployments-declarative-__codelineno-2-13"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#03-deployments-declarative-__codelineno-2-14"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#03-deployments-declarative-__codelineno-2-15"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#03-deployments-declarative-__codelineno-2-16"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span><span class="w"> </span><span class="c1"># Labels for the replica selector</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#03-deployments-declarative-__codelineno-2-17"></a><span class="w">        </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1.17&quot;</span><span class="w"> </span><span class="c1"># Specify specific verion if required</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#03-deployments-declarative-__codelineno-2-18"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#03-deployments-declarative-__codelineno-2-19"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#03-deployments-declarative-__codelineno-2-20"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span><span class="w"> </span><span class="c1"># The name of the pod</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#03-deployments-declarative-__codelineno-2-21"></a><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:1.17</span><span class="w"> </span><span class="c1"># The image which we will deploy</span>
</span><span id="__span-2-22"><a id="__codelineno-2-22" name="__codelineno-2-22" href="#03-deployments-declarative-__codelineno-2-22"></a><span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-2-23"><a id="__codelineno-2-23" name="__codelineno-2-23" href="#03-deployments-declarative-__codelineno-2-23"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span></code></pre></div>
<ul>
<li>Create the deployment using the <code>-f</code> flag &amp; <code>--record=true</code></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#03-deployments-declarative-__codelineno-3-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>-f<span class="w"> </span>nginx.yaml<span class="w"> </span>--record<span class="o">=</span><span class="nb">true</span>
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#03-deployments-declarative-__codelineno-4-1"></a>deployment.apps/nginx created
</span></code></pre></div>
</div>
<hr />
<h3 id="03-deployments-declarative-step-03-verify-that-the-deployment-has-been-created">Step 03 - Verify that the deployment has been created<a class="headerlink" href="#03-deployments-declarative-step-03-verify-that-the-deployment-has-been-created" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#03-deployments-declarative-__codelineno-5-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>deployments<span class="w"> </span>-n<span class="w"> </span>codewizard
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#03-deployments-declarative-__codelineno-6-1"></a>NAME        DESIRED   CURRENT   UP-TO-DATE   AVAILABLE
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#03-deployments-declarative-__codelineno-6-2"></a>multitool   1         1         1            1
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#03-deployments-declarative-__codelineno-6-3"></a>nginx       1         1         1            1
</span></code></pre></div>
</div>
<hr />
<h3 id="03-deployments-declarative-step-04-check-if-the-pods-are-running">Step 04 - Check if the pods are running<a class="headerlink" href="#03-deployments-declarative-step-04-check-if-the-pods-are-running" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#03-deployments-declarative-__codelineno-7-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>codewizard
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#03-deployments-declarative-__codelineno-8-1"></a>NAME                         READY   STATUS    RESTARTS
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#03-deployments-declarative-__codelineno-8-2"></a>multitool-7885b5f94f-9s7xh   1/1     Running   0
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#03-deployments-declarative-__codelineno-8-3"></a>nginx-647fb5956d-v8d2w       1/1     Running   0
</span></code></pre></div>
</div>
<h3 id="03-deployments-declarative-step-05-playing-with-k8s-replicas">Step 05 - Playing with K8S replicas<a class="headerlink" href="#03-deployments-declarative-step-05-playing-with-k8s-replicas" title="Permanent link">&para;</a></h3>
<ul>
<li>Let&rsquo;s play with the replica and see K8S in action.</li>
<li>Open a second terminal and execute:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#03-deployments-declarative-__codelineno-9-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>--watch
</span></code></pre></div>
<hr />
<h3 id="03-deployments-declarative-step-06-update-the-nginxyaml-file-with-replicas-value-of-5">Step 06 - Update the <code>nginx.yaml</code> file with replica&rsquo;s value of 5<a class="headerlink" href="#03-deployments-declarative-step-06-update-the-nginxyaml-file-with-replicas-value-of-5" title="Permanent link">&para;</a></h3>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#03-deployments-declarative-__codelineno-10-1"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#03-deployments-declarative-__codelineno-10-2"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span></code></pre></div>
<hr />
<h3 id="03-deployments-declarative-step-07-update-the-deployment-using-kubectl-apply">Step 07 - Update the deployment using <code>kubectl apply</code><a class="headerlink" href="#03-deployments-declarative-step-07-update-the-deployment-using-kubectl-apply" title="Permanent link">&para;</a></h3>
<p><div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#03-deployments-declarative-__codelineno-11-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>-f<span class="w"> </span>nginx.yaml<span class="w"> </span>--record<span class="o">=</span><span class="nb">true</span>
</span></code></pre></div>
$ kubectl apply -n codewizard -f nginx.yaml &ndash;record=true
deployment.apps/nginx configured
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#03-deployments-declarative-__codelineno-12-1"></a>---
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#03-deployments-declarative-__codelineno-12-2"></a>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#03-deployments-declarative-__codelineno-12-3"></a>- Switch to the second terminal and you should see something like the following:
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#03-deployments-declarative-__codelineno-12-4"></a>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#03-deployments-declarative-__codelineno-12-5"></a>```bash
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#03-deployments-declarative-__codelineno-12-6"></a>kubectl get pods --watch -n codewizard
</span></code></pre></div></p>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#03-deployments-declarative-__codelineno-13-1"></a>NAME                         READY   STATUS    RESTARTS   AGE
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#03-deployments-declarative-__codelineno-13-2"></a>multitool-74477484b8-dj7th   1/1     Running   0          20m
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#03-deployments-declarative-__codelineno-13-3"></a>nginx-dc8bb9b45-hqdv9        1/1     Running   0          111s
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#03-deployments-declarative-__codelineno-13-4"></a>nginx-dc8bb9b45-vdmp5        0/1     Pending   0          0s
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#03-deployments-declarative-__codelineno-13-5"></a>nginx-dc8bb9b45-28wwq        0/1     Pending   0          0s
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#03-deployments-declarative-__codelineno-13-6"></a>nginx-dc8bb9b45-wkc68        0/1     Pending   0          0s
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#03-deployments-declarative-__codelineno-13-7"></a>...
</span></code></pre></div>
</div>
<p><br>
- Can you explain what do you see?</p>
<p><code>Why are there more containers than requested?</code></p>
<hr />
<h3 id="03-deployments-declarative-step-08-scaling-down-with-kubectl-scale">Step 08 - Scaling down with <code>kubectl scale</code><a class="headerlink" href="#03-deployments-declarative-step-08-scaling-down-with-kubectl-scale" title="Permanent link">&para;</a></h3>
<ul>
<li>Scaling down using <code>kubectl</code>, and not by editing the <code>YAML</code> file:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#03-deployments-declarative-__codelineno-14-1"></a>kubectl<span class="w"> </span>scale<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>--replicas<span class="o">=</span><span class="m">1</span><span class="w"> </span>deployment/nginx
</span></code></pre></div>
<ul>
<li>Switch to the second terminal. The current output should show something like this:</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#03-deployments-declarative-__codelineno-15-1"></a>NAME                         READY   STATUS    RESTARTS   AGE
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#03-deployments-declarative-__codelineno-15-2"></a>multitool-74477484b8-dj7th   1/1     Running   0          29m
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#03-deployments-declarative-__codelineno-15-3"></a>nginx-dc8bb9b45-28wwq        1/1     Running   0          4m41s
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#03-deployments-declarative-__codelineno-15-4"></a>nginx-dc8bb9b45-hqdv9        1/1     Running   0          10m
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#03-deployments-declarative-__codelineno-15-5"></a>nginx-dc8bb9b45-vdmp5        1/1     Running   0          4m41s
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#03-deployments-declarative-__codelineno-15-6"></a>nginx-dc8bb9b45-wkc68        1/1     Running   0          4m41s
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#03-deployments-declarative-__codelineno-15-7"></a>nginx-dc8bb9b45-x7j4g        1/1     Running   0          4m41s
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#03-deployments-declarative-__codelineno-15-8"></a>nginx-dc8bb9b45-x7j4g        1/1     Terminating   0          6m21s
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#03-deployments-declarative-__codelineno-15-9"></a>nginx-dc8bb9b45-vdmp5        1/1     Terminating   0          6m21s
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#03-deployments-declarative-__codelineno-15-10"></a>nginx-dc8bb9b45-28wwq        1/1     Terminating   0          6m21s
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#03-deployments-declarative-__codelineno-15-11"></a>nginx-dc8bb9b45-wkc68        1/1     Terminating   0          6m21s
</span><span id="__span-15-12"><a id="__codelineno-15-12" name="__codelineno-15-12" href="#03-deployments-declarative-__codelineno-15-12"></a>nginx-dc8bb9b45-x7j4g        0/1     Terminating   0          6m22s
</span><span id="__span-15-13"><a id="__codelineno-15-13" name="__codelineno-15-13" href="#03-deployments-declarative-__codelineno-15-13"></a>nginx-dc8bb9b45-vdmp5        0/1     Terminating   0          6m22s
</span><span id="__span-15-14"><a id="__codelineno-15-14" name="__codelineno-15-14" href="#03-deployments-declarative-__codelineno-15-14"></a>nginx-dc8bb9b45-wkc68        0/1     Terminating   0          6m22s
</span><span id="__span-15-15"><a id="__codelineno-15-15" name="__codelineno-15-15" href="#03-deployments-declarative-__codelineno-15-15"></a>nginx-dc8bb9b45-28wwq        0/1     Terminating   0          6m22s
</span><span id="__span-15-16"><a id="__codelineno-15-16" name="__codelineno-15-16" href="#03-deployments-declarative-__codelineno-15-16"></a>nginx-dc8bb9b45-28wwq        0/1     Terminating   0          6m26s
</span><span id="__span-15-17"><a id="__codelineno-15-17" name="__codelineno-15-17" href="#03-deployments-declarative-__codelineno-15-17"></a>nginx-dc8bb9b45-28wwq        0/1     Terminating   0          6m26s
</span><span id="__span-15-18"><a id="__codelineno-15-18" name="__codelineno-15-18" href="#03-deployments-declarative-__codelineno-15-18"></a>nginx-dc8bb9b45-vdmp5        0/1     Terminating   0          6m26s
</span><span id="__span-15-19"><a id="__codelineno-15-19" name="__codelineno-15-19" href="#03-deployments-declarative-__codelineno-15-19"></a>nginx-dc8bb9b45-vdmp5        0/1     Terminating   0          6m26s
</span><span id="__span-15-20"><a id="__codelineno-15-20" name="__codelineno-15-20" href="#03-deployments-declarative-__codelineno-15-20"></a>nginx-dc8bb9b45-wkc68        0/1     Terminating   0          6m27s
</span><span id="__span-15-21"><a id="__codelineno-15-21" name="__codelineno-15-21" href="#03-deployments-declarative-__codelineno-15-21"></a>nginx-dc8bb9b45-wkc68        0/1     Terminating   0          6m27s
</span><span id="__span-15-22"><a id="__codelineno-15-22" name="__codelineno-15-22" href="#03-deployments-declarative-__codelineno-15-22"></a>nginx-dc8bb9b45-x7j4g        0/1     Terminating   0          6m27s
</span><span id="__span-15-23"><a id="__codelineno-15-23" name="__codelineno-15-23" href="#03-deployments-declarative-__codelineno-15-23"></a>nginx-dc8bb9b45-x7j4g        0/1     Terminating   0          6m27s
</span></code></pre></div></section><section class="print-page" id="04-rollout" heading-number="2.6"><h1 id="04-rollout-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#04-rollout-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="04-rollout-rollout-rolling-update">Rollout (Rolling Update)<a class="headerlink" href="#04-rollout-rollout-rolling-update" title="Permanent link">&para;</a></h2>
<ul>
<li>In this step we will deploy the same application with several different versions and we will &ldquo;switch&rdquo; between them.</li>
<li>For learning purposes we will play a little with the <code>CLI</code>.</li>
</ul>
<hr />
<h3 id="04-rollout-prerequisites">Prerequisites<a class="headerlink" href="#04-rollout-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>K8S cluster - <a href="#00-verifycluster">Setting up minikube cluster instruction</a></li>
</ul>
<p><a href="https://ide.cloud.google.com/?cloudshell_git_repo=https://github.com/nirgeier/KubernetesLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a><br />
<strong><kbd>CTRL</kbd> + <kbd>click</kbd> to open in new window</strong></p>
<hr />
<h3 id="04-rollout-step-01-create-namespace">Step 01 - Create Namespace<a class="headerlink" href="#04-rollout-step-01-create-namespace" title="Permanent link">&para;</a></h3>
<ul>
<li>As completed in the previous lab, create the desired namespace [codewizard]:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#04-rollout-__codelineno-0-1"></a>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>codewizard
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#04-rollout-__codelineno-1-1"></a>namespace/codewizard created
</span></code></pre></div>
</div>
<ul>
<li>In order to set this is as the default namespace, please refer to <a href="#01-namespace-2-setting-the-default-namespace-for-kubectl">set default namespace</a>.</li>
</ul>
<hr />
<h3 id="04-rollout-step-02-create-the-desired-deployment">Step 02 - Create the desired deployment<a class="headerlink" href="#04-rollout-step-02-create-the-desired-deployment" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>We will use the <code>save-config</code> flag</p>
<blockquote>
<p><code>save-config</code><br />
If true, the configuration of current object will be saved in its annotation.<br />
Otherwise, the annotation will be unchanged.<br />
This flag is useful when you want to perform <code>kubectl apply</code> on this object in the future.</p>
</blockquote>
</li>
<li>
<p>Let&rsquo;s run the following:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#04-rollout-__codelineno-2-1"></a>kubectl<span class="w"> </span>create<span class="w"> </span>deployment<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>nginx<span class="w"> </span>--image<span class="o">=</span>nginx:1.17<span class="w"> </span>--save-config
</span></code></pre></div></p>
</li>
</ul>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#04-rollout-__codelineno-3-1"></a>deployment.apps/nginx created
</span></code></pre></div>
</div>
<p>Note that in case we already have this deployed, we will get an error message.</p>
<hr />
<h3 id="04-rollout-step-03-expose-nginx-as-a-service">Step 03 - Expose nginx as a service<a class="headerlink" href="#04-rollout-step-03-expose-nginx-as-a-service" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#04-rollout-__codelineno-4-1"></a>kubectl<span class="w"> </span>expose<span class="w"> </span>deployment<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>nginx<span class="w"> </span>--port<span class="w"> </span><span class="m">80</span><span class="w"> </span>--type<span class="w"> </span>NodePort
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#04-rollout-__codelineno-5-1"></a>service/nginx exposed
</span></code></pre></div>
</div>
<p>Again, note that in case we already have this service we will get an error message as well.</p>
<hr />
<h3 id="04-rollout-step-04-verify-that-the-pods-and-the-service-are-running">Step 04 - Verify that the pods and the service are running<a class="headerlink" href="#04-rollout-step-04-verify-that-the-pods-and-the-service-are-running" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#04-rollout-__codelineno-6-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>codewizard
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#04-rollout-__codelineno-7-1"></a>NAME                        READY      STATUS    RESTARTS   AGE
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#04-rollout-__codelineno-7-2"></a>pod/nginx-db749865c-lmgtv   1/1        Running   0          66s
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#04-rollout-__codelineno-7-3"></a>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#04-rollout-__codelineno-7-4"></a>NAME                        TYPE       CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#04-rollout-__codelineno-7-5"></a>service/nginx               NodePort   10.102.79.9   &lt;none&gt;        80:31204/TCP   30s
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#04-rollout-__codelineno-7-6"></a>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#04-rollout-__codelineno-7-7"></a>NAME                    READY   UP-TO-DATE   AVAILABLE   AGE
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#04-rollout-__codelineno-7-8"></a>deployment.apps/nginx   1/1     1            1           66s
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#04-rollout-__codelineno-7-9"></a>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#04-rollout-__codelineno-7-10"></a>NAME                              DESIRED   CURRENT   READY   AGE
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#04-rollout-__codelineno-7-11"></a>replicaset.apps/nginx-db749865c   1         1         1       66s
</span></code></pre></div>
</div>
<hr />
<h3 id="04-rollout-step-05-change-the-number-of-replicas-to-3">Step 05 - Change the number of replicas to 3<a class="headerlink" href="#04-rollout-step-05-change-the-number-of-replicas-to-3" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#04-rollout-__codelineno-8-1"></a>kubectl<span class="w"> </span>scale<span class="w"> </span>deployment<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>nginx<span class="w"> </span>--replicas<span class="o">=</span><span class="m">3</span>
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#04-rollout-__codelineno-9-1"></a>deployment.apps/nginx scaled
</span></code></pre></div>
</div>
<hr />
<h3 id="04-rollout-step-06-verify-that-now-we-have-3-replicas">Step 06 - Verify that now we have 3 replicas<a class="headerlink" href="#04-rollout-step-06-verify-that-now-we-have-3-replicas" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#04-rollout-__codelineno-10-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>codewizard
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#04-rollout-__codelineno-11-1"></a>NAME                    READY   STATUS    RESTARTS   AGE
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#04-rollout-__codelineno-11-2"></a>nginx-db749865c-f5mkt   1/1     Running   0          86s
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#04-rollout-__codelineno-11-3"></a>nginx-db749865c-jgcvb   1/1     Running   0          86s
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#04-rollout-__codelineno-11-4"></a>nginx-db749865c-lmgtv   1/1     Running   0          4m44s
</span></code></pre></div>
</div>
<hr />
<h3 id="04-rollout-step-07-test-the-deployment">Step 07 - Test the deployment<a class="headerlink" href="#04-rollout-step-07-test-the-deployment" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#04-rollout-__codelineno-12-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>services<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>-o<span class="w"> </span>wide
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#04-rollout-__codelineno-13-1"></a>NAME    TYPE       CLUSTER-IP    EXTERNAL-IP   PORT(S)        AGE    SELECTOR
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#04-rollout-__codelineno-13-2"></a>nginx   NodePort   10.102.79.9   &lt;none&gt;        80:31204/TCP   7m7s   app=nginx
</span></code></pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Test Command</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#04-rollout-__codelineno-14-1"></a><span class="c1"># Get the cluster IP and port</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#04-rollout-__codelineno-14-2"></a>kubectl<span class="w"> </span>cluster-info
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#04-rollout-__codelineno-14-3"></a>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#04-rollout-__codelineno-14-4"></a><span class="c1"># Test the nginx server (replace with your host and port)</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#04-rollout-__codelineno-14-5"></a>curl<span class="w"> </span>-sI<span class="w"> </span>&lt;host&gt;:&lt;port&gt;
</span></code></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Expected Response</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#04-rollout-__codelineno-15-1"></a>HTTP/1.1 200 OK
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#04-rollout-__codelineno-15-2"></a>Server: nginx/1.17.10
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#04-rollout-__codelineno-15-3"></a>...
</span></code></pre></div>
</div>
<hr />
<h3 id="04-rollout-step-08-deploy-another-version-of-nginx">Step 08 - Deploy another version of nginx<a class="headerlink" href="#04-rollout-step-08-deploy-another-version-of-nginx" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#04-rollout-__codelineno-16-1"></a>kubectl<span class="w"> </span><span class="nb">set</span><span class="w"> </span>image<span class="w"> </span>deployment<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>nginx<span class="w"> </span><span class="nv">nginx</span><span class="o">=</span>nginx:1.16<span class="w"> </span>--record
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#04-rollout-__codelineno-17-1"></a>deployment.apps/nginx image updated
</span></code></pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Test New Version</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#04-rollout-__codelineno-18-1"></a>curl<span class="w"> </span>-sI<span class="w"> </span>&lt;host&gt;:&lt;port&gt;
</span></code></pre></div>
</div>
<div class="admonition note">
<p class="admonition-title">Expected Response</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#04-rollout-__codelineno-19-1"></a>HTTP/1.1 200 OK
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#04-rollout-__codelineno-19-2"></a>Server: nginx/1.16.1
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#04-rollout-__codelineno-19-3"></a>...
</span></code></pre></div>
</div>
<hr />
<h3 id="04-rollout-step-09-investigate-rollout-history">Step 09 - Investigate rollout history<a class="headerlink" href="#04-rollout-step-09-investigate-rollout-history" title="Permanent link">&para;</a></h3>
<ul>
<li>The rollout history command print out all the saved records:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#04-rollout-__codelineno-20-1"></a>kubectl<span class="w"> </span>rollout<span class="w"> </span><span class="nb">history</span><span class="w"> </span>deployment<span class="w"> </span>nginx<span class="w"> </span>-n<span class="w"> </span>codewizard
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#04-rollout-__codelineno-21-1"></a>deployment.apps/nginx
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#04-rollout-__codelineno-21-2"></a>REVISION  CHANGE-CAUSE
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#04-rollout-__codelineno-21-3"></a>1         &lt;none&gt;
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#04-rollout-__codelineno-21-4"></a>2         kubectl set image deployment nginx nginx=nginx:1.16 --record=true
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#04-rollout-__codelineno-21-5"></a>3         kubectl set image deployment nginx nginx=nginx:1.15 --record=true
</span></code></pre></div>
</div>
<hr />
<h3 id="04-rollout-step-10-lets-see-what-was-changed-during-the-previous-updates">Step 10 - Let&rsquo;s see what was changed during the previous updates<a class="headerlink" href="#04-rollout-step-10-lets-see-what-was-changed-during-the-previous-updates" title="Permanent link">&para;</a></h3>
<ul>
<li>Print out the rollout changes:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#04-rollout-__codelineno-22-1"></a><span class="c1"># Replace &lt;X&gt; with a revision ID (e.g., 1 or 2)</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#04-rollout-__codelineno-22-2"></a>kubectl<span class="w"> </span>rollout<span class="w"> </span><span class="nb">history</span><span class="w"> </span>deployment<span class="w"> </span>nginx<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>--revision<span class="o">=</span>&lt;X&gt;
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#04-rollout-__codelineno-23-1"></a>deployment.apps/nginx with revision #1
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#04-rollout-__codelineno-23-2"></a>Pod Template:
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#04-rollout-__codelineno-23-3"></a>  Labels:       app=nginx
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#04-rollout-__codelineno-23-4"></a>        pod-template-hash=db749865c
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#04-rollout-__codelineno-23-5"></a>  Containers:
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#04-rollout-__codelineno-23-6"></a>   nginx:
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#04-rollout-__codelineno-23-7"></a>    Image:      nginx:1.17
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#04-rollout-__codelineno-23-8"></a>    ...
</span></code></pre></div>
</div>
<hr />
<h3 id="04-rollout-step-11-undo-the-version-upgrade-by-rolling-back-and-restoring-previous-version">Step 11 - Undo the version upgrade by rolling back and restoring previous version<a class="headerlink" href="#04-rollout-step-11-undo-the-version-upgrade-by-rolling-back-and-restoring-previous-version" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#04-rollout-__codelineno-24-1"></a><span class="c1"># Undo the last deployment</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#04-rollout-__codelineno-24-2"></a>kubectl<span class="w"> </span>rollout<span class="w"> </span>undo<span class="w"> </span>deployment<span class="w"> </span>nginx
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#04-rollout-__codelineno-25-1"></a>deployment.apps/nginx rolled back
</span></code></pre></div>
</div>
<div class="admonition tip">
<p class="admonition-title">Verify Version</p>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#04-rollout-__codelineno-26-1"></a>curl<span class="w"> </span>-sI<span class="w"> </span>&lt;host&gt;:&lt;port&gt;
</span></code></pre></div>
</div>
<hr />
<h3 id="04-rollout-step-12-rolling-restart">Step 12 - Rolling Restart<a class="headerlink" href="#04-rollout-step-12-rolling-restart" title="Permanent link">&para;</a></h3>
<ul>
<li>If we deploy using <code>imagePullPolicy: always</code> set in the <code>YAML</code> file, we can use <code>rollout restart</code> to force <code>K8S</code> to grab the latest image.</li>
<li><strong>This is the fastest restart method these days</strong></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#04-rollout-__codelineno-27-1"></a>kubectl<span class="w"> </span>rollout<span class="w"> </span>restart<span class="w"> </span>deployment<span class="w"> </span><span class="o">[</span>deployment_name<span class="o">]</span>
</span></code></pre></div></section><section class="print-page" id="05-services" heading-number="2.7"><h1 id="05-services-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#05-services-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="05-services-service-discovery">Service Discovery<a class="headerlink" href="#05-services-service-discovery" title="Permanent link">&para;</a></h2>
<ul>
<li>In the following lab we will learn what is a <code>Service</code> and go over the different <code>Service</code> types.</li>
</ul>
<hr />
<h3 id="05-services-prerequisites">Prerequisites<a class="headerlink" href="#05-services-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>K8S cluster - <a href="#00-verifycluster">Setting up minikube cluster instruction</a></li>
</ul>
<p><a href="https://ide.cloud.google.com/?cloudshell_git_repo=https://github.com/nirgeier/KubernetesLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a><br />
<strong><kbd>CTRL</kbd> + <kbd>click</kbd> to open in new window</strong></p>
<hr />
<h2 id="05-services-some-general-notes-on-what-is-a-service">Some general notes on what is a <code>Service</code><a class="headerlink" href="#05-services-some-general-notes-on-what-is-a-service" title="Permanent link">&para;</a></h2>
<ul>
<li><code>Service</code> is a unit of application behavior bound to a unique name in a <code>service registry</code>. </li>
<li><code>Service</code> consist of multiple <code>network endpoints</code> implemented by workload instances running on pods, containers, VMs etc.</li>
<li><code>Service</code> allow us to gain access to any given pod or container (e.g., a web service).</li>
<li>A <code>service</code> is (normally) created on top of an existing deployment and exposing it to the &ldquo;world&rdquo;, using IP(s) &amp; port(s).</li>
<li><code>K8S</code> define 3 main ways (+FQDN internally) to define a service, which means that we have 4 different ways to access Pods.</li>
<li>There are several proxy mode which implements different behaviour, for example in <code>user proxy mode</code> for each <code>Service</code> <code>kube-proxy</code> opens a port (randomly chosen) on the local node. Any connections to this &ldquo;proxy port&rdquo; are proxied to one of the Service&rsquo;s backend Pods (as reported via Endpoints).</li>
<li>All the service types are assigned with a <code>Cluster-IP</code>.</li>
<li>Every service also creates <code>Endpoint(s)</code>, which point to the actual pods. <code>Endpoints</code> are usually referred to as <code>back-ends</code> of a particular service.</li>
</ul>
<hr />
<h3 id="05-services-step-01-create-namespace-and-clear-previous-data-if-there-is-any">Step 01 - Create namespace and clear previous data if there is any<a class="headerlink" href="#05-services-step-01-create-namespace-and-clear-previous-data-if-there-is-any" title="Permanent link">&para;</a></h3>
<p><strong>If the namespace already exists, let&rsquo;s clean it</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#05-services-__codelineno-0-1"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>namespace<span class="w"> </span>codewizard
</span></code></pre></div></p>
<p><strong>Create the desired namespace [codewizard]</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#05-services-__codelineno-1-1"></a>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>codewizard
</span></code></pre></div></p>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#05-services-__codelineno-2-1"></a>namespace/codewizard created
</span></code></pre></div>
</div>
<hr />
<h3 id="05-services-step-02-create-the-required-resources-for-this-hand-on">Step 02 - Create the required resources for this hand-on<a class="headerlink" href="#05-services-step-02-create-the-required-resources-for-this-hand-on" title="Permanent link">&para;</a></h3>
<p><strong>Network tools pod</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#05-services-__codelineno-3-1"></a>kubectl<span class="w"> </span>create<span class="w"> </span>deployment<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>multitool<span class="w"> </span>--image<span class="o">=</span>praqma/network-multitool
</span></code></pre></div></p>
<hr />
<h2 id="05-services-service-types">Service types<a class="headerlink" href="#05-services-service-types" title="Permanent link">&para;</a></h2>
<ul>
<li>As previously mentioned, there are several services type. Let&rsquo;s practice them:</li>
</ul>
<h3 id="05-services-service-type-clusterip">Service type: ClusterIP<a class="headerlink" href="#05-services-service-type-clusterip" title="Permanent link">&para;</a></h3>
<ul>
<li>If not specified, the default service type is <code>ClusterIP</code>.</li>
<li>In order to expose the deployment as a service, use: <code>--type=ClusterIP</code></li>
<li><code>ClusterIP</code> will expose the pods within the cluster. Since we don&rsquo;t have an <code>external IP</code>, it will not be reachable from outside the cluster.</li>
<li>When the service is created <code>K8S</code> attaches a DNS record to the service in the following format: <code>&lt;service name&gt;.&lt;namespace&gt;.svc.cluster.local</code></li>
</ul>
<hr />
<h3 id="05-services-step-03-expose-the-nginx-with-clusterip">Step 03 - Expose the nginx with ClusterIP<a class="headerlink" href="#05-services-step-03-expose-the-nginx-with-clusterip" title="Permanent link">&para;</a></h3>
<p><strong>Expose the service on port 80</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#05-services-__codelineno-4-1"></a>kubectl<span class="w"> </span>expose<span class="w"> </span>deployment<span class="w"> </span>nginx<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>--port<span class="w"> </span><span class="m">80</span><span class="w"> </span>--type<span class="w"> </span>ClusterIP
</span></code></pre></div></p>
<p><strong>Check the services</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#05-services-__codelineno-5-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>services<span class="w"> </span>-n<span class="w"> </span>codewizard
</span></code></pre></div></p>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#05-services-__codelineno-6-1"></a>NAME         TYPE        CLUSTER-IP       EXTERNAL-IP   PORT(S)
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#05-services-__codelineno-6-2"></a>nginx        ClusterIP   10.109.78.182   &lt;none&gt;        80/TCP
</span></code></pre></div>
</div>
<hr />
<h3 id="05-services-step-04-test-the-nginx-with-clusterip">Step 04 - Test the nginx with ClusterIP<a class="headerlink" href="#05-services-step-04-test-the-nginx-with-clusterip" title="Permanent link">&para;</a></h3>
<ul>
<li>Since the service is a <code>ClusterIP</code>, we will test if we can access the service using the multitool pod.</li>
</ul>
<p><strong>Get the name of the multitool pod</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#05-services-__codelineno-7-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>codewizard
</span></code></pre></div></p>
<p><strong>Run an interactive shell</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#05-services-__codelineno-8-1"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>&lt;pod<span class="w"> </span>name&gt;<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>--<span class="w"> </span>sh
</span></code></pre></div></p>
<ul>
<li>Connect to the service in <strong>any</strong> of the following ways:</li>
</ul>
<h4 id="05-services-test-the-nginx-with-clusterip">Test the nginx with ClusterIP<a class="headerlink" href="#05-services-test-the-nginx-with-clusterip" title="Permanent link">&para;</a></h4>
<h5 id="05-services-1-using-the-ip-from-the-services-output-grab-the-server-response">1. using the IP from the services output. grab the server response:<a class="headerlink" href="#05-services-1-using-the-ip-from-the-services-output-grab-the-server-response" title="Permanent link">&para;</a></h5>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#05-services-__codelineno-9-1"></a>curl<span class="w"> </span>-s<span class="w"> </span>&lt;ClusterIP&gt;
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#05-services-__codelineno-10-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#05-services-__codelineno-10-2"></a><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#05-services-__codelineno-10-3"></a>...
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#05-services-__codelineno-10-4"></a><span class="p">&lt;</span><span class="nt">h1</span><span class="p">&gt;</span>Welcome to nginx!<span class="p">&lt;/</span><span class="nt">h1</span><span class="p">&gt;</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#05-services-__codelineno-10-5"></a>...
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#05-services-__codelineno-10-6"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></code></pre></div>
</div>
<p><br></p>
<h5 id="05-services-2-test-the-nginx-using-the-deployment-name-using-the-service-name-since-its-the-dns-name-behind-the-scenes">2. Test the nginx using the deployment name - using the service name since its the DNS name behind the scenes<a class="headerlink" href="#05-services-2-test-the-nginx-using-the-deployment-name-using-the-service-name-since-its-the-dns-name-behind-the-scenes" title="Permanent link">&para;</a></h5>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#05-services-__codelineno-11-1"></a>curl<span class="w"> </span>-s<span class="w"> </span>nginx
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-html highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#05-services-__codelineno-12-1"></a><span class="cp">&lt;!DOCTYPE html&gt;</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#05-services-__codelineno-12-2"></a><span class="p">&lt;</span><span class="nt">html</span><span class="p">&gt;</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#05-services-__codelineno-12-3"></a>...
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#05-services-__codelineno-12-4"></a><span class="p">&lt;/</span><span class="nt">html</span><span class="p">&gt;</span>
</span></code></pre></div>
</div>
<p><br></p>
<h5 id="05-services-3-using-the-full-dns-name-for-every-service-we-have-a-full-fqdn-fully-qualified-domain-name-so-we-can-use-it-as-well">3. using the full DNS name - for every service we have a full <code>FQDN</code> (Fully qualified domain name) so we can use it as well<a class="headerlink" href="#05-services-3-using-the-full-dns-name-for-every-service-we-have-a-full-fqdn-fully-qualified-domain-name-so-we-can-use-it-as-well" title="Permanent link">&para;</a></h5>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#05-services-__codelineno-13-1"></a>curl<span class="w"> </span>-s<span class="w"> </span>nginx.codewizard.svc.cluster.local
</span></code></pre></div>
<hr />
<h1 id="05-services-service-type-nodeport">Service type: NodePort<a class="headerlink" href="#05-services-service-type-nodeport" title="Permanent link">&para;</a></h1>
<ul>
<li><code>NodePort</code>: Exposes the Service on each Node&rsquo;s IP at a <strong>static port</strong> (the <code>NodePort</code>).</li>
<li>A <code>ClusterIP</code> Service, to which the <code>NodePort</code> Service routes, <strong>is automatically created</strong>.</li>
<li><code>NodePort</code> service is reachable from outside the cluster, by requesting <code>&lt;Node IP&gt;:&lt;Node Port&gt;</code>.</li>
</ul>
<h3 id="05-services-step-05-create-nodeport">Step 05 - Create NodePort<a class="headerlink" href="#05-services-step-05-create-nodeport" title="Permanent link">&para;</a></h3>
<h5 id="05-services-1-delete-previous-service">1. Delete previous service<a class="headerlink" href="#05-services-1-delete-previous-service" title="Permanent link">&para;</a></h5>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#05-services-__codelineno-14-1"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>svc<span class="w"> </span>nginx<span class="w"> </span>-n<span class="w"> </span>codewizard
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#05-services-__codelineno-15-1"></a>service &quot;nginx&quot; deleted
</span></code></pre></div>
</div>
<p><br></p>
<h5 id="05-services-2-create-nodeport-service">2. Create <code>NodePort</code> service<a class="headerlink" href="#05-services-2-create-nodeport-service" title="Permanent link">&para;</a></h5>
<p><strong>Create NodePort service</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#05-services-__codelineno-16-1"></a>kubectl<span class="w"> </span>expose<span class="w"> </span>deployment<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>nginx<span class="w"> </span>--port<span class="w"> </span><span class="m">80</span><span class="w"> </span>--type<span class="w"> </span>NodePort
</span></code></pre></div></p>
<p><strong>Verify service</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#05-services-__codelineno-17-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>codewizard
</span></code></pre></div></p>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#05-services-__codelineno-18-1"></a>NAME         TYPE        CLUSTER-IP     EXTERNAL-IP   PORT(S)
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#05-services-__codelineno-18-2"></a>nginx        NodePort    100.65.29.172  &lt;none&gt;        80:32593/TCP
</span></code></pre></div>
</div>
<p><br></p>
<h5 id="05-services-3-test-the-nodeport-service">3. Test the <code>NodePort</code> service<a class="headerlink" href="#05-services-3-test-the-nodeport-service" title="Permanent link">&para;</a></h5>
<ul>
<li>
<p>If we have the host IP and the node port number, we can connect directly to the pod.</p>
</li>
<li>
<p>If you followed the previous labs, you should be able to do it yourself by now......</p>
</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#05-services-__codelineno-19-1"></a>kubectl<span class="w"> </span>cluster-info
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#05-services-__codelineno-19-2"></a>kubectl<span class="w"> </span>get<span class="w"> </span>services<span class="w"> </span>-n<span class="w"> </span>codewizard
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#05-services-__codelineno-20-1"></a>Welcome to nginx!
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#05-services-__codelineno-20-2"></a>...
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#05-services-__codelineno-20-3"></a>Thank you for using nginx.
</span></code></pre></div>
</div>
<hr />
<h1 id="05-services-service-type-loadbalancer">Service type: LoadBalancer<a class="headerlink" href="#05-services-service-type-loadbalancer" title="Permanent link">&para;</a></h1>
<div class="admonition warning">
<p class="admonition-title">Note</p>
<p><strong>We cannot test a <code>LoadBalancer</code> service locally on a localhost, but only on a cluster which can provide an <code>external-IP</code></strong></p>
</div>
<h3 id="05-services-step-06-create-loadbalancer-only-if-you-are-on-real-cloud">Step 06 - Create LoadBalancer (only if you are on real cloud)<a class="headerlink" href="#05-services-step-06-create-loadbalancer-only-if-you-are-on-real-cloud" title="Permanent link">&para;</a></h3>
<p><br></p>
<h5 id="05-services-1-delete-previous-service_1">1. Delete previous service<a class="headerlink" href="#05-services-1-delete-previous-service_1" title="Permanent link">&para;</a></h5>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#05-services-__codelineno-21-1"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>svc<span class="w"> </span>nginx<span class="w"> </span>-n<span class="w"> </span>codewizard
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#05-services-__codelineno-22-1"></a>service &quot;nginx&quot; deleted
</span></code></pre></div>
</div>
<p><br>
<br></p>
<h5 id="05-services-2-create-loadbalancer-service">2. Create <code>LoadBalancer</code> Service<a class="headerlink" href="#05-services-2-create-loadbalancer-service" title="Permanent link">&para;</a></h5>
<p><strong>Create LoadBalancer Service</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#05-services-__codelineno-23-1"></a>kubectl<span class="w"> </span>expose<span class="w"> </span>deployment<span class="w"> </span>nginx<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>--port<span class="w"> </span><span class="m">80</span><span class="w"> </span>--type<span class="w"> </span>LoadBalancer
</span></code></pre></div></p>
<p><strong>Verify service</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#05-services-__codelineno-24-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>codewizard
</span></code></pre></div></p>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#05-services-__codelineno-25-1"></a>NAME         TYPE           CLUSTER-IP     EXTERNAL-IP   PORT(S)
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#05-services-__codelineno-25-2"></a>nginx        LoadBalancer   100.69.15.89   35.205.60.29  80:31354/TCP
</span></code></pre></div>
</div>
<p><br></p>
<h5 id="05-services-3-test-the-loadbalancer-service">3. Test the <code>LoadBalancer</code> Service<a class="headerlink" href="#05-services-3-test-the-loadbalancer-service" title="Permanent link">&para;</a></h5>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#05-services-__codelineno-26-1"></a>curl<span class="w"> </span>-s<span class="w"> </span>&lt;EXTERNAL-IP&gt;
</span></code></pre></div></section><section class="print-page" id="06-datastore" heading-number="2.8"><h1 id="06-datastore-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#06-datastore-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="06-datastore-datastore-volumes-pvc-pv">DataStore (Volumes, PVC &amp; PV)<a class="headerlink" href="#06-datastore-datastore-volumes-pvc-pv" title="Permanent link">&para;</a></h2>
<h2 id="06-datastore-secrets-and-configmaps">Secrets and ConfigMaps<a class="headerlink" href="#06-datastore-secrets-and-configmaps" title="Permanent link">&para;</a></h2>
<ul>
<li>Secrets &amp; ConfigMap are ways to store and inject configurations into your deployments.</li>
<li>Secrets usually store passwords, certificates, API keys and more.</li>
<li>ConfigMap usually store configuration (data).</li>
</ul>
<hr />
<h3 id="06-datastore-prerequisites">Prerequisites<a class="headerlink" href="#06-datastore-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>K8S cluster - <a href="#00-verifycluster">Setting up minikube cluster instruction</a></li>
</ul>
<p><a href="https://ide.cloud.google.com/?cloudshell_git_repo=https://github.com/nirgeier/KubernetesLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a><br />
<strong><kbd>CTRL</kbd> + <kbd>click</kbd> to open in new window</strong></p>
<hr />
<h1 id="06-datastore-first-lets-play-a-bit-with-secrets">First, Let&rsquo;s play a bit with Secrets<a class="headerlink" href="#06-datastore-first-lets-play-a-bit-with-secrets" title="Permanent link">&para;</a></h1>
<h3 id="06-datastore-step-01-create-namespace-and-clear-previous-data-if-there-is-any">Step 01 - Create namespace and clear previous data (if there is any)<a class="headerlink" href="#06-datastore-step-01-create-namespace-and-clear-previous-data-if-there-is-any" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#06-datastore-__codelineno-0-1"></a><span class="c1"># If the namespace already exists, let&#39;s clean it</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#06-datastore-__codelineno-0-2"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>namespace<span class="w"> </span>codewizard
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#06-datastore-__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#06-datastore-__codelineno-0-4"></a><span class="c1"># Create the desired namespace [codewizard]</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#06-datastore-__codelineno-0-5"></a>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>codewizard
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#06-datastore-__codelineno-1-1"></a>namespace/codewizard created
</span></code></pre></div>
</div>
<div class="admonition warning">
<p class="admonition-title">Note</p>
<p><strong>You can skip section number 02. if you don&rsquo;t wish to build and push your docker container</strong></p>
</div>
<hr />
<h3 id="06-datastore-step-02-build-the-docker-container">Step 02 - Build the docker container<a class="headerlink" href="#06-datastore-step-02-build-the-docker-container" title="Permanent link">&para;</a></h3>
<h5 id="06-datastore-1-write-the-server-code">1. write the server code<a class="headerlink" href="#06-datastore-1-write-the-server-code" title="Permanent link">&para;</a></h5>
<ul>
<li>For this demo we will use a tiny NodeJS server which will consume the desired configuration values from the secret</li>
<li>This is the code of our server <a href="../06-DataStore/resources/server.js">server.js</a>:</li>
</ul>
<div class="language-js highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#06-datastore-__codelineno-2-1"></a><span class="c1">//</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#06-datastore-__codelineno-2-2"></a><span class="c1">// server.js</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#06-datastore-__codelineno-2-3"></a><span class="c1">//</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#06-datastore-__codelineno-2-4"></a><span class="kd">const</span><span class="w"> </span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#06-datastore-__codelineno-2-5"></a><span class="w">  </span><span class="c1">// Get those values in runtime.</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#06-datastore-__codelineno-2-6"></a><span class="w">  </span><span class="c1">// The variables will be passed from the Docker file and later on from K8S ConfigMap/Secret</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#06-datastore-__codelineno-2-7"></a><span class="w">  </span><span class="nx">language</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">LANGUAGE</span><span class="p">,</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#06-datastore-__codelineno-2-8"></a><span class="w">  </span><span class="nx">token</span><span class="w"> </span><span class="o">=</span><span class="w"> </span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">TOKEN</span><span class="p">;</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#06-datastore-__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#06-datastore-__codelineno-2-10"></a><span class="nx">require</span><span class="p">(</span><span class="s2">&quot;http&quot;</span><span class="p">)</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#06-datastore-__codelineno-2-11"></a><span class="w">  </span><span class="p">.</span><span class="nx">createServer</span><span class="p">((</span><span class="nx">request</span><span class="p">,</span><span class="w"> </span><span class="nx">response</span><span class="p">)</span><span class="w"> </span><span class="p">=&gt;</span><span class="w"> </span><span class="p">{</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#06-datastore-__codelineno-2-12"></a><span class="w">    </span><span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="sb">`Language: </span><span class="si">${</span><span class="nx">language</span><span class="si">}</span><span class="sb">`</span><span class="p">);</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#06-datastore-__codelineno-2-13"></a><span class="w">    </span><span class="nx">response</span><span class="p">.</span><span class="nx">write</span><span class="p">(</span><span class="sb">`Token   : </span><span class="si">${</span><span class="nx">token</span><span class="si">}</span><span class="sb">\n`</span><span class="p">);</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#06-datastore-__codelineno-2-14"></a><span class="w">    </span><span class="nx">response</span><span class="p">.</span><span class="nx">end</span><span class="p">(</span><span class="sb">`\n`</span><span class="p">);</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#06-datastore-__codelineno-2-15"></a><span class="w">  </span><span class="p">})</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#06-datastore-__codelineno-2-16"></a><span class="w">  </span><span class="c1">// Set the default port to 5000</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#06-datastore-__codelineno-2-17"></a><span class="w">  </span><span class="p">.</span><span class="nx">listen</span><span class="p">(</span><span class="nx">process</span><span class="p">.</span><span class="nx">env</span><span class="p">.</span><span class="nx">PORT</span><span class="w"> </span><span class="o">||</span><span class="w"> </span><span class="mf">5000</span><span class="w"> </span><span class="p">);</span>
</span></code></pre></div>
<p><br></p>
<h5 id="06-datastore-2-write-the-dockerfile">2. Write the DockerFile<a class="headerlink" href="#06-datastore-2-write-the-dockerfile" title="Permanent link">&para;</a></h5>
<ul>
<li>First, let&rsquo;s wrap it up as <code>docker container</code></li>
<li>If you wish, you can skip this and use the existing docker image: <code>nirgeier/k8s-secrets-sample</code></li>
<li>In the <code>Dockerfile</code> we will set the <code>ENV</code> for or variables</li>
</ul>
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#06-datastore-__codelineno-3-1"></a><span class="c"># Base Image</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#06-datastore-__codelineno-3-2"></a><span class="k">FROM</span><span class="w">        </span><span class="s">node</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#06-datastore-__codelineno-3-3"></a>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#06-datastore-__codelineno-3-4"></a><span class="c"># exposed port - same port is defined in the server.js</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#06-datastore-__codelineno-3-5"></a><span class="k">EXPOSE</span><span class="w">      </span><span class="s">5000</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#06-datastore-__codelineno-3-6"></a>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#06-datastore-__codelineno-3-7"></a><span class="c"># The &quot;configuration&quot; which we pass in runtime</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#06-datastore-__codelineno-3-8"></a><span class="c"># The server will &quot;read&quot; those variables at run time and will print them out</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#06-datastore-__codelineno-3-9"></a><span class="k">ENV</span><span class="w">         </span>LANGUAGE<span class="w">    </span>Hebrew
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#06-datastore-__codelineno-3-10"></a><span class="k">ENV</span><span class="w">         </span>TOKEN<span class="w">       </span>Hard-To-Guess
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#06-datastore-__codelineno-3-11"></a>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#06-datastore-__codelineno-3-12"></a><span class="c"># Copy the server to the container</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#06-datastore-__codelineno-3-13"></a><span class="k">COPY</span><span class="w">        </span>server.js<span class="w"> </span>.
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#06-datastore-__codelineno-3-14"></a>
</span><span id="__span-3-15"><a id="__codelineno-3-15" name="__codelineno-3-15" href="#06-datastore-__codelineno-3-15"></a><span class="c"># start the server</span>
</span><span id="__span-3-16"><a id="__codelineno-3-16" name="__codelineno-3-16" href="#06-datastore-__codelineno-3-16"></a><span class="k">ENTRYPOINT</span><span class="w">  </span>node<span class="w"> </span>server.js
</span></code></pre></div>
<p><br></p>
<h5 id="06-datastore-3-build-the-docker-container">3. Build the docker container<a class="headerlink" href="#06-datastore-3-build-the-docker-container" title="Permanent link">&para;</a></h5>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#06-datastore-__codelineno-4-1"></a><span class="c1"># Replace the prefix with your Dockerhub account</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#06-datastore-__codelineno-4-2"></a>docker<span class="w"> </span>build<span class="w"> </span>.<span class="w"> </span>-t<span class="w"> </span>nirgeier/k8s-secrets-sample
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#06-datastore-__codelineno-5-1"></a>Successfully built f5cbb1895d66
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#06-datastore-__codelineno-5-2"></a>Successfully tagged nirgeier/k8s-secrets-sample:latest
</span></code></pre></div>
</div>
<p><br></p>
<h5 id="06-datastore-4-test-the-container">4. Test the container<a class="headerlink" href="#06-datastore-4-test-the-container" title="Permanent link">&para;</a></h5>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#06-datastore-__codelineno-6-1"></a><span class="c1"># Run the container</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#06-datastore-__codelineno-6-2"></a>docker<span class="w"> </span>run<span class="w"> </span>-d<span class="w"> </span>-p5000:5000<span class="w"> </span>--name<span class="w"> </span>server<span class="w"> </span>nirgeier/k8s-secrets-sample
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#06-datastore-__codelineno-6-3"></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#06-datastore-__codelineno-6-4"></a><span class="c1"># Test the response</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#06-datastore-__codelineno-6-5"></a>curl<span class="w"> </span><span class="m">127</span>.0.0.1:5000
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#06-datastore-__codelineno-7-1"></a>Language: Hebrew
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#06-datastore-__codelineno-7-2"></a>Token   : Hard-To-Guess
</span></code></pre></div>
</div>
<p><br></p>
<ul>
<li>Stop the container</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#06-datastore-__codelineno-8-1"></a>docker<span class="w"> </span>stop<span class="w"> </span>server
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#06-datastore-__codelineno-9-1"></a>server
</span></code></pre></div>
</div>
<ul>
<li>Push the container to your docker hub account if you wish</li>
</ul>
<hr />
<h3 id="06-datastore-step-03-using-k8s-deployment-secretsconfigmap">Step 03 - Using K8S deployment &amp; Secrets/ConfigMap<a class="headerlink" href="#06-datastore-step-03-using-k8s-deployment-secretsconfigmap" title="Permanent link">&para;</a></h3>
<h5 id="06-datastore-1-writing-the-deployment-service-file">1. Writing the deployment &amp; service file<a class="headerlink" href="#06-datastore-1-writing-the-deployment-service-file" title="Permanent link">&para;</a></h5>
<ul>
<li>Deploy the docker container that you have prepared in the previous step with the following <code>Deployment</code> file.</li>
<li>In this sample we will define the values in the <code>YAML</code> file, later on we will use Secrets/ConfigMap <a href="../06-DataStore/resources/variables-from-yaml.yaml">variables-from-yaml.yaml</a></li>
</ul>
<p><div class="language-yaml highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#06-datastore-__codelineno-10-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#06-datastore-__codelineno-10-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Namespace</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#06-datastore-__codelineno-10-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#06-datastore-__codelineno-10-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codewizard</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#06-datastore-__codelineno-10-5"></a><span class="nn">---</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#06-datastore-__codelineno-10-6"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#06-datastore-__codelineno-10-7"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#06-datastore-__codelineno-10-8"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#06-datastore-__codelineno-10-9"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secrets-app</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#06-datastore-__codelineno-10-10"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codewizard</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#06-datastore-__codelineno-10-11"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#06-datastore-__codelineno-10-12"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#06-datastore-__codelineno-10-13"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#06-datastore-__codelineno-10-14"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#06-datastore-__codelineno-10-15"></a><span class="w">      </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secrets-app</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#06-datastore-__codelineno-10-16"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#06-datastore-__codelineno-10-17"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#06-datastore-__codelineno-10-18"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#06-datastore-__codelineno-10-19"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secrets-app</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#06-datastore-__codelineno-10-20"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#06-datastore-__codelineno-10-21"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-10-22"><a id="__codelineno-10-22" name="__codelineno-10-22" href="#06-datastore-__codelineno-10-22"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secrets-app</span>
</span><span id="__span-10-23"><a id="__codelineno-10-23" name="__codelineno-10-23" href="#06-datastore-__codelineno-10-23"></a><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nirgeier/k8s-secrets-sample</span>
</span><span id="__span-10-24"><a id="__codelineno-10-24" name="__codelineno-10-24" href="#06-datastore-__codelineno-10-24"></a><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Always</span>
</span><span id="__span-10-25"><a id="__codelineno-10-25" name="__codelineno-10-25" href="#06-datastore-__codelineno-10-25"></a><span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-10-26"><a id="__codelineno-10-26" name="__codelineno-10-26" href="#06-datastore-__codelineno-10-26"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5000</span>
</span><span id="__span-10-27"><a id="__codelineno-10-27" name="__codelineno-10-27" href="#06-datastore-__codelineno-10-27"></a><span class="w">          </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-10-28"><a id="__codelineno-10-28" name="__codelineno-10-28" href="#06-datastore-__codelineno-10-28"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LANGUAGE</span>
</span><span id="__span-10-29"><a id="__codelineno-10-29" name="__codelineno-10-29" href="#06-datastore-__codelineno-10-29"></a><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Hebrew</span>
</span><span id="__span-10-30"><a id="__codelineno-10-30" name="__codelineno-10-30" href="#06-datastore-__codelineno-10-30"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TOKEN</span>
</span><span id="__span-10-31"><a id="__codelineno-10-31" name="__codelineno-10-31" href="#06-datastore-__codelineno-10-31"></a><span class="w">              </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Hard-To-Guess2</span>
</span><span id="__span-10-32"><a id="__codelineno-10-32" name="__codelineno-10-32" href="#06-datastore-__codelineno-10-32"></a><span class="w">          </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-10-33"><a id="__codelineno-10-33" name="__codelineno-10-33" href="#06-datastore-__codelineno-10-33"></a><span class="w">            </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-10-34"><a id="__codelineno-10-34" name="__codelineno-10-34" href="#06-datastore-__codelineno-10-34"></a><span class="w">              </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;500m&quot;</span>
</span><span id="__span-10-35"><a id="__codelineno-10-35" name="__codelineno-10-35" href="#06-datastore-__codelineno-10-35"></a><span class="w">              </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;256Mi&quot;</span>
</span><span id="__span-10-36"><a id="__codelineno-10-36" name="__codelineno-10-36" href="#06-datastore-__codelineno-10-36"></a><span class="nn">---</span>
</span><span id="__span-10-37"><a id="__codelineno-10-37" name="__codelineno-10-37" href="#06-datastore-__codelineno-10-37"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-10-38"><a id="__codelineno-10-38" name="__codelineno-10-38" href="#06-datastore-__codelineno-10-38"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span><span id="__span-10-39"><a id="__codelineno-10-39" name="__codelineno-10-39" href="#06-datastore-__codelineno-10-39"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-10-40"><a id="__codelineno-10-40" name="__codelineno-10-40" href="#06-datastore-__codelineno-10-40"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codewizard-secrets</span>
</span><span id="__span-10-41"><a id="__codelineno-10-41" name="__codelineno-10-41" href="#06-datastore-__codelineno-10-41"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codewizard</span>
</span><span id="__span-10-42"><a id="__codelineno-10-42" name="__codelineno-10-42" href="#06-datastore-__codelineno-10-42"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-10-43"><a id="__codelineno-10-43" name="__codelineno-10-43" href="#06-datastore-__codelineno-10-43"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-10-44"><a id="__codelineno-10-44" name="__codelineno-10-44" href="#06-datastore-__codelineno-10-44"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codewizard-secrets</span>
</span><span id="__span-10-45"><a id="__codelineno-10-45" name="__codelineno-10-45" href="#06-datastore-__codelineno-10-45"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-10-46"><a id="__codelineno-10-46" name="__codelineno-10-46" href="#06-datastore-__codelineno-10-46"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span id="__span-10-47"><a id="__codelineno-10-47" name="__codelineno-10-47" href="#06-datastore-__codelineno-10-47"></a><span class="w">      </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5000</span>
</span><span id="__span-10-48"><a id="__codelineno-10-48" name="__codelineno-10-48" href="#06-datastore-__codelineno-10-48"></a><span class="w">      </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5000</span>
</span></code></pre></div>
<br></p>
<h5 id="06-datastore-2-deploy-to-cluster">2. Deploy to cluster<a class="headerlink" href="#06-datastore-2-deploy-to-cluster" title="Permanent link">&para;</a></h5>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#06-datastore-__codelineno-11-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>-f<span class="w"> </span>variables-from-yaml.yaml
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#06-datastore-__codelineno-12-1"></a>deployment.apps/codewizard-secrets configured
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#06-datastore-__codelineno-12-2"></a>service/codewizard-secrets created
</span></code></pre></div>
</div>
<p><br></p>
<h5 id="06-datastore-3-test-the-app">3. Test the app<a class="headerlink" href="#06-datastore-3-test-the-app" title="Permanent link">&para;</a></h5>
<ul>
<li>We will need a second container for executing the curl request.</li>
<li>We will use a <code>busyBox image</code> for this purpose.</li>
</ul>
<p><strong>Get the pod name</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#06-datastore-__codelineno-13-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>codewizard
</span></code></pre></div></p>
<p><strong>Login and test</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#06-datastore-__codelineno-14-1"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>&lt;pod<span class="w"> </span>name&gt;<span class="w"> </span>--<span class="w"> </span>sh
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#06-datastore-__codelineno-14-2"></a>curl<span class="w"> </span>localhost:5000
</span></code></pre></div></p>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#06-datastore-__codelineno-15-1"></a>Language: Hebrew
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#06-datastore-__codelineno-15-2"></a>Token   : Hard-To-Guess2
</span></code></pre></div>
</div>
<hr />
<h3 id="06-datastore-step-04-using-secrets-config-maps">Step 04 - Using Secrets &amp; config maps<a class="headerlink" href="#06-datastore-step-04-using-secrets-config-maps" title="Permanent link">&para;</a></h3>
<h5 id="06-datastore-1-create-the-desired-secret-and-config-map-for-this-lab">1. Create the desired secret and config map for this lab<a class="headerlink" href="#06-datastore-1-create-the-desired-secret-and-config-map-for-this-lab" title="Permanent link">&para;</a></h5>
<p><strong>Create Secret</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#06-datastore-__codelineno-16-1"></a>kubectl<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>token<span class="w"> </span>--from-literal<span class="o">=</span><span class="nv">TOKEN</span><span class="o">=</span>Hard-To-Guess3
</span></code></pre></div></p>
<p><strong>Create ConfigMap</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#06-datastore-__codelineno-17-1"></a>kubectl<span class="w"> </span>create<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>configmap<span class="w"> </span>language<span class="w"> </span>--from-literal<span class="o">=</span><span class="nv">LANGUAGE</span><span class="o">=</span>English
</span></code></pre></div></p>
<p><strong>Verify</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#06-datastore-__codelineno-18-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>secrets,cm<span class="w"> </span>-n<span class="w"> </span>codewizard
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#06-datastore-__codelineno-18-2"></a>kubectl<span class="w"> </span>describe<span class="w"> </span>secret<span class="w"> </span>token<span class="w"> </span>-n<span class="w"> </span>codewizard
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#06-datastore-__codelineno-18-3"></a>kubectl<span class="w"> </span>describe<span class="w"> </span>cm<span class="w"> </span>language<span class="w"> </span>-n<span class="w"> </span>codewizard
</span></code></pre></div></p>
<p><br></p>
<h5 id="06-datastore-2-update-the-deployment-to-read-the-values-from-secrets-configmap">2. Update the deployment to read the values from Secrets &amp; ConfigMap<a class="headerlink" href="#06-datastore-2-update-the-deployment-to-read-the-values-from-secrets-configmap" title="Permanent link">&para;</a></h5>
<ul>
<li>Change the <code>env</code> section to the following:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#06-datastore-__codelineno-19-1"></a><span class="w">          </span><span class="nt">env</span><span class="p">:</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#06-datastore-__codelineno-19-2"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">LANGUAGE</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#06-datastore-__codelineno-19-3"></a><span class="w">              </span><span class="nt">valueFrom</span><span class="p">:</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#06-datastore-__codelineno-19-4"></a><span class="w">                </span><span class="nt">configMapKeyRef</span><span class="p">:</span><span class="w">    </span><span class="c1"># This value will be read from the config map</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#06-datastore-__codelineno-19-5"></a><span class="w">                  </span><span class="nt">name</span><span class="p">:</span><span class="w">   </span><span class="l l-Scalar l-Scalar-Plain">language</span><span class="w">  </span><span class="c1"># The name of the ConfigMap</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#06-datastore-__codelineno-19-6"></a><span class="w">                  </span><span class="nt">key</span><span class="p">:</span><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">LANGUAGE</span><span class="w">  </span><span class="c1"># The key in the config map</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#06-datastore-__codelineno-19-7"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TOKEN</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#06-datastore-__codelineno-19-8"></a><span class="w">              </span><span class="nt">valueFrom</span><span class="p">:</span>
</span><span id="__span-19-9"><a id="__codelineno-19-9" name="__codelineno-19-9" href="#06-datastore-__codelineno-19-9"></a><span class="w">                  </span><span class="nt">secretKeyRef</span><span class="p">:</span><span class="w">         </span><span class="c1"># This value will be read from the secret</span>
</span><span id="__span-19-10"><a id="__codelineno-19-10" name="__codelineno-19-10" href="#06-datastore-__codelineno-19-10"></a><span class="w">                      </span><span class="nt">name</span><span class="p">:</span><span class="w">   </span><span class="l l-Scalar l-Scalar-Plain">token</span><span class="w">     </span><span class="c1"># The name of the secret</span>
</span><span id="__span-19-11"><a id="__codelineno-19-11" name="__codelineno-19-11" href="#06-datastore-__codelineno-19-11"></a><span class="w">                      </span><span class="nt">key</span><span class="p">:</span><span class="w">    </span><span class="l l-Scalar l-Scalar-Plain">TOKEN</span><span class="w">     </span><span class="c1"># The key in the secret</span>
</span></code></pre></div>
<p><br></p>
<h5 id="06-datastore-3-update-the-deployment-to-read-values-from-k8s-resources">3. Update the deployment to read values from K8S resources<a class="headerlink" href="#06-datastore-3-update-the-deployment-to-read-values-from-k8s-resources" title="Permanent link">&para;</a></h5>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#06-datastore-__codelineno-20-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>-f<span class="w"> </span>variables-from-secrets.yaml
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#06-datastore-__codelineno-21-1"></a>deployment.apps/codewizard-secrets configured
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#06-datastore-__codelineno-21-2"></a>service/codewizard-secrets unchanged
</span></code></pre></div>
</div>
<p><br></p>
<h5 id="06-datastore-4-test-the-changes">4. Test the changes<a class="headerlink" href="#06-datastore-4-test-the-changes" title="Permanent link">&para;</a></h5>
<ul>
<li>Refer to <a href="#06-datastore-3-test-the-app">step 3.3</a> for testing your server</li>
</ul>
<p>```bash</p>
<h1 id="06-datastore-replace-with-your-actual-pod-name">Replace with your actual pod name<a class="headerlink" href="#06-datastore-replace-with-your-actual-pod-name" title="Permanent link">&para;</a></h1>
<p>kubectl exec -it <pod_name> -n codewizard &ndash; sh
curl localhost:5000
<div class="language-text highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#06-datastore-__codelineno-22-1"></a>!!! success &quot;Expected Result&quot;
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#06-datastore-__codelineno-22-2"></a>    ```text
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#06-datastore-__codelineno-22-3"></a>    Language: English
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#06-datastore-__codelineno-22-4"></a>    Token   : Hard-To-Guess3
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#06-datastore-__codelineno-22-5"></a>    ```
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#06-datastore-__codelineno-22-6"></a>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#06-datastore-__codelineno-22-7"></a>---
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#06-datastore-__codelineno-22-8"></a>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#06-datastore-__codelineno-22-9"></a>&lt;br&gt;
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#06-datastore-__codelineno-22-10"></a>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#06-datastore-__codelineno-22-11"></a>!!! warning &quot;Note&quot;
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#06-datastore-__codelineno-22-12"></a>    Pods are not recreated or updated automatically when `Secrets` or `ConfigMaps` change, so you will have to restart your pods manually
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#06-datastore-__codelineno-22-13"></a>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#06-datastore-__codelineno-22-14"></a>- To update existing secrets or ConfigMap:
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#06-datastore-__codelineno-22-15"></a>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#06-datastore-__codelineno-22-16"></a>```bash
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#06-datastore-__codelineno-22-17"></a>kubectl create secret generic token -n codewizard --from-literal=Token=Token3 -o yaml --dry-run=client | kubectl replace -f -
</span></code></pre></div></p>
<ul>
<li>Test your server and verify that you see the old values.</li>
<li>Delete the old pods so they can come back to life with the new values.</li>
<li>Test your server again, now you should be able to see the changes.</li>
</ul></section><section class="print-page" id="07-nginx-ingress" heading-number="2.9"><h1 id="07-nginx-ingress-head">&lt;&lt;&lt;&lt;&lt;&lt;&lt; HEAD<a class="headerlink" href="#07-nginx-ingress-head" title="Permanent link">&para;</a></h1>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<blockquote>
<p>upstream/master</p>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
</blockquote>
<h1 id="07-nginx-ingress-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#07-nginx-ingress-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="07-nginx-ingress-nginx-ingress-controller">Nginx Ingress Controller<a class="headerlink" href="#07-nginx-ingress-nginx-ingress-controller" title="Permanent link">&para;</a></h2>
<div class="admonition important -">
<p class="admonition-title">Important</p>
<p>We cannot see it in action on a <code>localhost</code> (meaning that it will not get an external IP) unless we use the explicit <code>http://host:port</code> format.</p>
</div>
<ul>
<li>Kubernetes <code>ingress</code> object is a <code>DNS</code></li>
<li>To enable an <code>ingress object</code>, we need an <code>ingress controller</code></li>
<li>In this demo we will use <code>Nginx-Ingress</code></li>
</ul>
<hr />
<h3 id="07-nginx-ingress-prerequisites">Prerequisites<a class="headerlink" href="#07-nginx-ingress-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>K8S cluster - <a href="#00-verifycluster">Setting up minikube cluster instruction</a></li>
</ul>
<p><a href="https://ide.cloud.google.com/?cloudshell_git_repo=https://github.com/nirgeier/KubernetesLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a><br />
<strong><kbd>CTRL</kbd> + <kbd>click</kbd> to open in new window</strong></p>
<hr />
<h3 id="07-nginx-ingress-step-01-deploy-sample-app">Step 01 - Deploy sample app<a class="headerlink" href="#07-nginx-ingress-step-01-deploy-sample-app" title="Permanent link">&para;</a></h3>
<ul>
<li>To get started with <code>Nginx-Ingress</code>, we will deploy out previous app:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#07-nginx-ingress-__codelineno-0-1"></a><span class="c1"># Create deployment with 3 replicas</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#07-nginx-ingress-__codelineno-0-2"></a>kubectl<span class="w"> </span>create<span class="w"> </span>deployment<span class="w"> </span>ingress-pods<span class="w"> </span>--image<span class="o">=</span>nirgeier/k8s-secrets-sample<span class="w"> </span>--replicas<span class="o">=</span><span class="m">3</span>
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#07-nginx-ingress-__codelineno-1-1"></a>deployment.apps/ingress-pods created
</span></code></pre></div>
</div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#07-nginx-ingress-__codelineno-2-1"></a><span class="c1"># Expose the service</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#07-nginx-ingress-__codelineno-2-2"></a>kubectl<span class="w"> </span>expose<span class="w"> </span>deployment<span class="w"> </span>ingress-pods<span class="w"> </span>--port<span class="o">=</span><span class="m">5000</span>
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#07-nginx-ingress-__codelineno-3-1"></a>service/ingress-pods exposed
</span></code></pre></div>
</div>
<hr />
<h3 id="07-nginx-ingress-step-02-deploy-default-backend">Step 02 - Deploy default backend<a class="headerlink" href="#07-nginx-ingress-step-02-deploy-default-backend" title="Permanent link">&para;</a></h3>
<ul>
<li>Now lets deploy the <code>Nginx-Ingress</code> (grabbed from the official site):</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#07-nginx-ingress-__codelineno-4-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#07-nginx-ingress-__codelineno-4-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#07-nginx-ingress-__codelineno-4-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#07-nginx-ingress-__codelineno-4-4"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-http-backend</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#07-nginx-ingress-__codelineno-4-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#07-nginx-ingress-__codelineno-4-6"></a><span class="w">    </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#07-nginx-ingress-__codelineno-4-7"></a><span class="w">    </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#07-nginx-ingress-__codelineno-4-8"></a><span class="w">        </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#07-nginx-ingress-__codelineno-4-9"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-http-backend</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#07-nginx-ingress-__codelineno-4-10"></a><span class="w">    </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#07-nginx-ingress-__codelineno-4-11"></a><span class="w">        </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#07-nginx-ingress-__codelineno-4-12"></a><span class="w">        </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#07-nginx-ingress-__codelineno-4-13"></a><span class="w">            </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-http-backend</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#07-nginx-ingress-__codelineno-4-14"></a><span class="w">        </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#07-nginx-ingress-__codelineno-4-15"></a><span class="w">            </span><span class="nt">terminationGracePeriodSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">60</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#07-nginx-ingress-__codelineno-4-16"></a><span class="w">            </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#07-nginx-ingress-__codelineno-4-17"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-http-backend</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#07-nginx-ingress-__codelineno-4-18"></a><span class="w">                </span><span class="l l-Scalar l-Scalar-Plain"># Any image is permissible as long as</span><span class="p p-Indicator">:</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#07-nginx-ingress-__codelineno-4-19"></a><span class="w">                </span><span class="c1"># 1. It serves a 404 page at /</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#07-nginx-ingress-__codelineno-4-20"></a><span class="w">                </span><span class="c1"># 2. It serves 200 on a /healthz endpoint</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#07-nginx-ingress-__codelineno-4-21"></a><span class="w">                </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gcr.io/google_containers/defaultbackend:1.0</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#07-nginx-ingress-__codelineno-4-22"></a><span class="w">                </span><span class="nt">livenessProbe</span><span class="p">:</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#07-nginx-ingress-__codelineno-4-23"></a><span class="w">                </span><span class="nt">httpGet</span><span class="p">:</span>
</span><span id="__span-4-24"><a id="__codelineno-4-24" name="__codelineno-4-24" href="#07-nginx-ingress-__codelineno-4-24"></a><span class="w">                    </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/healthz</span>
</span><span id="__span-4-25"><a id="__codelineno-4-25" name="__codelineno-4-25" href="#07-nginx-ingress-__codelineno-4-25"></a><span class="w">                    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id="__span-4-26"><a id="__codelineno-4-26" name="__codelineno-4-26" href="#07-nginx-ingress-__codelineno-4-26"></a><span class="w">                    </span><span class="nt">scheme</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HTTP</span>
</span><span id="__span-4-27"><a id="__codelineno-4-27" name="__codelineno-4-27" href="#07-nginx-ingress-__codelineno-4-27"></a><span class="w">                </span><span class="nt">initialDelaySeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">30</span>
</span><span id="__span-4-28"><a id="__codelineno-4-28" name="__codelineno-4-28" href="#07-nginx-ingress-__codelineno-4-28"></a><span class="w">                </span><span class="nt">timeoutSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id="__span-4-29"><a id="__codelineno-4-29" name="__codelineno-4-29" href="#07-nginx-ingress-__codelineno-4-29"></a><span class="w">                </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-4-30"><a id="__codelineno-4-30" name="__codelineno-4-30" href="#07-nginx-ingress-__codelineno-4-30"></a><span class="w">                </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id="__span-4-31"><a id="__codelineno-4-31" name="__codelineno-4-31" href="#07-nginx-ingress-__codelineno-4-31"></a><span class="w">                </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-4-32"><a id="__codelineno-4-32" name="__codelineno-4-32" href="#07-nginx-ingress-__codelineno-4-32"></a><span class="w">                </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-4-33"><a id="__codelineno-4-33" name="__codelineno-4-33" href="#07-nginx-ingress-__codelineno-4-33"></a><span class="w">                    </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10m</span>
</span><span id="__span-4-34"><a id="__codelineno-4-34" name="__codelineno-4-34" href="#07-nginx-ingress-__codelineno-4-34"></a><span class="w">                    </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20Mi</span>
</span><span id="__span-4-35"><a id="__codelineno-4-35" name="__codelineno-4-35" href="#07-nginx-ingress-__codelineno-4-35"></a><span class="w">                </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-4-36"><a id="__codelineno-4-36" name="__codelineno-4-36" href="#07-nginx-ingress-__codelineno-4-36"></a><span class="w">                    </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10m</span>
</span><span id="__span-4-37"><a id="__codelineno-4-37" name="__codelineno-4-37" href="#07-nginx-ingress-__codelineno-4-37"></a><span class="w">                    </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">20Mi</span>
</span></code></pre></div>
<hr />
<h3 id="07-nginx-ingress-step-03-create-service">Step 03 - Create service<a class="headerlink" href="#07-nginx-ingress-step-03-create-service" title="Permanent link">&para;</a></h3>
<ul>
<li>Next, let&rsquo;s create the service:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#07-nginx-ingress-__codelineno-5-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#07-nginx-ingress-__codelineno-5-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#07-nginx-ingress-__codelineno-5-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#07-nginx-ingress-__codelineno-5-4"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-http-backend</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#07-nginx-ingress-__codelineno-5-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#07-nginx-ingress-__codelineno-5-6"></a><span class="w">    </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#07-nginx-ingress-__codelineno-5-7"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-http-backend</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#07-nginx-ingress-__codelineno-5-8"></a><span class="w">    </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#07-nginx-ingress-__codelineno-5-9"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">protocol</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">TCP</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#07-nginx-ingress-__codelineno-5-10"></a><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">80</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#07-nginx-ingress-__codelineno-5-11"></a><span class="w">    </span><span class="nt">targetPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8080</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#07-nginx-ingress-__codelineno-5-12"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
</span></code></pre></div>
<hr />
<h3 id="07-nginx-ingress-step-04-import-ssl-certificate">Step 04 - Import <code>ssl</code> certificate<a class="headerlink" href="#07-nginx-ingress-step-04-import-ssl-certificate" title="Permanent link">&para;</a></h3>
<ul>
<li>In this demo we will use certificate.    </li>
<li>The certificate is in the same folder as this file</li>
<li>The certificate is for the hostname: <code>ingress.local</code></li>
</ul>
<p><strong>Create the certificate</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#07-nginx-ingress-__codelineno-6-1"></a>openssl<span class="w"> </span>req<span class="w"> </span>-x509<span class="w"> </span>-nodes<span class="w"> </span>-days<span class="w"> </span><span class="m">365</span><span class="w"> </span>-newkey<span class="w"> </span>rsa:2048<span class="w"> </span>-keyout<span class="w"> </span>certificate.key<span class="w"> </span>-out<span class="w"> </span>certificate.crt
</span></code></pre></div></p>
<p><strong>Create DH parameters</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#07-nginx-ingress-__codelineno-7-1"></a>openssl<span class="w"> </span>dhparam<span class="w"> </span>-out<span class="w"> </span>certificate.pem<span class="w"> </span><span class="m">2048</span>
</span></code></pre></div></p>
<ul>
<li>Store the certificate in secret:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#07-nginx-ingress-__codelineno-8-1"></a><span class="c1"># Store TLS certificate</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#07-nginx-ingress-__codelineno-8-2"></a>kubectl<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>tls<span class="w"> </span>tls-certificate<span class="w"> </span>--key<span class="w"> </span>certificate.key<span class="w"> </span>--cert<span class="w"> </span>certificate.crt
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#07-nginx-ingress-__codelineno-8-3"></a>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#07-nginx-ingress-__codelineno-8-4"></a><span class="c1"># Store DH parameters</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#07-nginx-ingress-__codelineno-8-5"></a>kubectl<span class="w"> </span>create<span class="w"> </span>secret<span class="w"> </span>generic<span class="w"> </span>tls-dhparam<span class="w"> </span>--from-file<span class="o">=</span>certificate.pem
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#07-nginx-ingress-__codelineno-9-1"></a>secret/tls-certificate created
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#07-nginx-ingress-__codelineno-9-2"></a>secret/tls-dhparam created
</span></code></pre></div>
</div>
<hr />
<h3 id="07-nginx-ingress-step-05-deploy-the-ingress">Step 05 - Deploy the ingress<a class="headerlink" href="#07-nginx-ingress-step-05-deploy-the-ingress" title="Permanent link">&para;</a></h3>
<ul>
<li>Now that we have the certificate, we can deploy the <code>Ingress</code>:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#07-nginx-ingress-__codelineno-10-1"></a><span class="c1"># Ingress.yaml</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#07-nginx-ingress-__codelineno-10-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">extensions/v1beta1</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#07-nginx-ingress-__codelineno-10-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Ingress</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#07-nginx-ingress-__codelineno-10-4"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#07-nginx-ingress-__codelineno-10-5"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-first-ingress</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#07-nginx-ingress-__codelineno-10-6"></a><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#07-nginx-ingress-__codelineno-10-7"></a><span class="w">    </span><span class="nt">kubernetes.io/ingress.class</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;nginx&quot;</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#07-nginx-ingress-__codelineno-10-8"></a><span class="w">    </span><span class="nt">nginx.org/ssl-services</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;my-service&quot;</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#07-nginx-ingress-__codelineno-10-9"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#07-nginx-ingress-__codelineno-10-10"></a><span class="w">    </span><span class="nt">tls</span><span class="p">:</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#07-nginx-ingress-__codelineno-10-11"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">hosts</span><span class="p">:</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#07-nginx-ingress-__codelineno-10-12"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp.local</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#07-nginx-ingress-__codelineno-10-13"></a><span class="w">        </span><span class="nt">secretName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">tls-certificate</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#07-nginx-ingress-__codelineno-10-14"></a><span class="w">    </span><span class="nt">rules</span><span class="p">:</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#07-nginx-ingress-__codelineno-10-15"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp.local</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#07-nginx-ingress-__codelineno-10-16"></a><span class="w">        </span><span class="l l-Scalar l-Scalar-Plain">http</span><span class="p p-Indicator">:</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#07-nginx-ingress-__codelineno-10-17"></a><span class="w">        </span><span class="nt">paths</span><span class="p">:</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#07-nginx-ingress-__codelineno-10-18"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#07-nginx-ingress-__codelineno-10-19"></a><span class="w">            </span><span class="l l-Scalar l-Scalar-Plain">backend</span><span class="p p-Indicator">:</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#07-nginx-ingress-__codelineno-10-20"></a><span class="w">            </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ingress-pods</span>
</span><span id="__span-10-21"><a id="__codelineno-10-21" name="__codelineno-10-21" href="#07-nginx-ingress-__codelineno-10-21"></a><span class="w">            </span><span class="nt">servicePort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5000</span>
</span></code></pre></div>
<hr />
<h3 id="07-nginx-ingress-step-06-enable-the-ingress-addon">Step 06 - Enable the ingress addon<a class="headerlink" href="#07-nginx-ingress-step-06-enable-the-ingress-addon" title="Permanent link">&para;</a></h3>
<ul>
<li>The <code>Ingress</code> is not enabled by default, so we have to &ldquo;turn it on&rdquo;:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#07-nginx-ingress-__codelineno-11-1"></a>minikube<span class="w"> </span>addons<span class="w"> </span><span class="nb">enable</span><span class="w"> </span>ingress
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#07-nginx-ingress-__codelineno-12-1"></a>‚úÖ  ingress was successfully enabled
</span></code></pre></div>
</div></section><section class="print-page" id="08-kustomization" heading-number="2.10"><h1 id="08-kustomization-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#08-kustomization-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="08-kustomization-kustomization">Kustomization<a class="headerlink" href="#08-kustomization-kustomization" title="Permanent link">&para;</a></h2>
<ul>
<li><code>kubectl kustomize</code></li>
</ul>
<h2 id="08-kustomization-declarative-configuration-in-kubernetes">Declarative Configuration in Kubernetes<a class="headerlink" href="#08-kustomization-declarative-configuration-in-kubernetes" title="Permanent link">&para;</a></h2>
<ul>
<li><code>Kustomize</code> is a very powerful tool for customizing and building Kubernetes resources.</li>
<li><code>Kustomize</code> started at 2017, and added to <code>kubectl</code> since version 1.14.</li>
<li><code>Kustomize</code> has many useful features for managing and deploying resource.</li>
<li>When you execute a Kustomization beside using the builtin features, it will also re-order the resources in a logical way for the K8S to be deployed.</li>
</ul>
<h3 id="08-kustomization-step-01-re-order-the-resources">Step 01 - Re-order the resources<a class="headerlink" href="#08-kustomization-step-01-re-order-the-resources" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><code>Kustomization</code> re-orders the <code>Kind</code> for optimization. For this demo, we will need an existing <code>namespace</code> before using it.</p>
</li>
<li>
<p>The order of the resources is defined in the <a href="https://github.com/kubernetes-sigs/kustomize/blob/master/api/resid/gvk.go">source code</a></p>
</li>
</ul>
<div class="language-go highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#08-kustomization-__codelineno-0-1"></a><span class="c1">// An attempt to order things to help k8s, e.g.</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#08-kustomization-__codelineno-0-2"></a><span class="c1">// - Namespace should be first.</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#08-kustomization-__codelineno-0-3"></a><span class="c1">// - Service should come before things that refer to it.</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#08-kustomization-__codelineno-0-4"></a><span class="c1">// In some cases order just specified to provide determinism.</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#08-kustomization-__codelineno-0-5"></a><span class="kd">var</span><span class="w"> </span><span class="nx">orderFirst</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#08-kustomization-__codelineno-0-6"></a><span class="w">    </span><span class="s">&quot;Namespace&quot;</span><span class="p">,</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#08-kustomization-__codelineno-0-7"></a><span class="w">    </span><span class="s">&quot;ResourceQuota&quot;</span><span class="p">,</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#08-kustomization-__codelineno-0-8"></a><span class="w">    </span><span class="s">&quot;StorageClass&quot;</span><span class="p">,</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#08-kustomization-__codelineno-0-9"></a><span class="w">    </span><span class="s">&quot;CustomResourceDefinition&quot;</span><span class="p">,</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#08-kustomization-__codelineno-0-10"></a><span class="w">    </span><span class="s">&quot;ServiceAccount&quot;</span><span class="p">,</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#08-kustomization-__codelineno-0-11"></a><span class="w">    </span><span class="s">&quot;PodSecurityPolicy&quot;</span><span class="p">,</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#08-kustomization-__codelineno-0-12"></a><span class="w">    </span><span class="s">&quot;Role&quot;</span><span class="p">,</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#08-kustomization-__codelineno-0-13"></a><span class="w">    </span><span class="s">&quot;ClusterRole&quot;</span><span class="p">,</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#08-kustomization-__codelineno-0-14"></a><span class="w">    </span><span class="s">&quot;RoleBinding&quot;</span><span class="p">,</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#08-kustomization-__codelineno-0-15"></a><span class="w">    </span><span class="s">&quot;ClusterRoleBinding&quot;</span><span class="p">,</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#08-kustomization-__codelineno-0-16"></a><span class="w">    </span><span class="s">&quot;ConfigMap&quot;</span><span class="p">,</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#08-kustomization-__codelineno-0-17"></a><span class="w">    </span><span class="s">&quot;Secret&quot;</span><span class="p">,</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#08-kustomization-__codelineno-0-18"></a><span class="w">    </span><span class="s">&quot;Endpoints&quot;</span><span class="p">,</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#08-kustomization-__codelineno-0-19"></a><span class="w">    </span><span class="s">&quot;Service&quot;</span><span class="p">,</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#08-kustomization-__codelineno-0-20"></a><span class="w">    </span><span class="s">&quot;LimitRange&quot;</span><span class="p">,</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#08-kustomization-__codelineno-0-21"></a><span class="w">    </span><span class="s">&quot;PriorityClass&quot;</span><span class="p">,</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#08-kustomization-__codelineno-0-22"></a><span class="w">    </span><span class="s">&quot;PersistentVolume&quot;</span><span class="p">,</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#08-kustomization-__codelineno-0-23"></a><span class="w">    </span><span class="s">&quot;PersistentVolumeClaim&quot;</span><span class="p">,</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#08-kustomization-__codelineno-0-24"></a><span class="w">    </span><span class="s">&quot;Deployment&quot;</span><span class="p">,</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#08-kustomization-__codelineno-0-25"></a><span class="w">    </span><span class="s">&quot;StatefulSet&quot;</span><span class="p">,</span>
</span><span id="__span-0-26"><a id="__codelineno-0-26" name="__codelineno-0-26" href="#08-kustomization-__codelineno-0-26"></a><span class="w">    </span><span class="s">&quot;CronJob&quot;</span><span class="p">,</span>
</span><span id="__span-0-27"><a id="__codelineno-0-27" name="__codelineno-0-27" href="#08-kustomization-__codelineno-0-27"></a><span class="w">    </span><span class="s">&quot;PodDisruptionBudget&quot;</span><span class="p">,</span>
</span><span id="__span-0-28"><a id="__codelineno-0-28" name="__codelineno-0-28" href="#08-kustomization-__codelineno-0-28"></a><span class="p">}</span>
</span><span id="__span-0-29"><a id="__codelineno-0-29" name="__codelineno-0-29" href="#08-kustomization-__codelineno-0-29"></a>
</span><span id="__span-0-30"><a id="__codelineno-0-30" name="__codelineno-0-30" href="#08-kustomization-__codelineno-0-30"></a><span class="kd">var</span><span class="w"> </span><span class="nx">orderLast</span><span class="w"> </span><span class="p">=</span><span class="w"> </span><span class="p">[]</span><span class="kt">string</span><span class="p">{</span>
</span><span id="__span-0-31"><a id="__codelineno-0-31" name="__codelineno-0-31" href="#08-kustomization-__codelineno-0-31"></a><span class="w">    </span><span class="s">&quot;MutatingWebhookConfiguration&quot;</span><span class="p">,</span>
</span><span id="__span-0-32"><a id="__codelineno-0-32" name="__codelineno-0-32" href="#08-kustomization-__codelineno-0-32"></a><span class="w">    </span><span class="s">&quot;ValidatingWebhookConfiguration&quot;</span><span class="p">,</span>
</span><span id="__span-0-33"><a id="__codelineno-0-33" name="__codelineno-0-33" href="#08-kustomization-__codelineno-0-33"></a><span class="p">}</span>
</span></code></pre></div>
<hr />
<h3 id="08-kustomization-step-02-base-resource-for-our-demo">Step 02 - Base resource for our demo<a class="headerlink" href="#08-kustomization-step-02-base-resource-for-our-demo" title="Permanent link">&para;</a></h3>
<ul>
<li>In the following samples we will refer to the following <code>base.yaml</code> file:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#08-kustomization-__codelineno-1-1"></a><span class="c1"># base.yaml</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#08-kustomization-__codelineno-1-2"></a><span class="c1"># This is the base file for all the demos in this folder</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#08-kustomization-__codelineno-1-3"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#08-kustomization-__codelineno-1-4"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#08-kustomization-__codelineno-1-5"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#08-kustomization-__codelineno-1-6"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#08-kustomization-__codelineno-1-7"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#08-kustomization-__codelineno-1-8"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#08-kustomization-__codelineno-1-9"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#08-kustomization-__codelineno-1-10"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#08-kustomization-__codelineno-1-11"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#08-kustomization-__codelineno-1-12"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-1-13"><a id="__codelineno-1-13" name="__codelineno-1-13" href="#08-kustomization-__codelineno-1-13"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-1-14"><a id="__codelineno-1-14" name="__codelineno-1-14" href="#08-kustomization-__codelineno-1-14"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-1-15"><a id="__codelineno-1-15" name="__codelineno-1-15" href="#08-kustomization-__codelineno-1-15"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-1-16"><a id="__codelineno-1-16" name="__codelineno-1-16" href="#08-kustomization-__codelineno-1-16"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-1-17"><a id="__codelineno-1-17" name="__codelineno-1-17" href="#08-kustomization-__codelineno-1-17"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-1-18"><a id="__codelineno-1-18" name="__codelineno-1-18" href="#08-kustomization-__codelineno-1-18"></a><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">__image__</span>
</span></code></pre></div>
<hr />
<h3 id="08-kustomization-step-03-common-features">Step 03 - Common Features<a class="headerlink" href="#08-kustomization-step-03-common-features" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="#08-kustomization-commonannotation">common Annotation</a></li>
<li><a href="#08-kustomization-commonlabels">common Labels</a></li>
<li><a href="#08-kustomization-generators">Generators</a></li>
<li><a href="#08-kustomization-configmapgenerator">Config Map Generator</a><ul>
<li><a href="#08-kustomization-from-env">From Env</a></li>
<li><a href="#08-kustomization-from-file">From File</a></li>
<li><a href="#08-kustomization-from-literal">From Literal</a></li>
</ul>
</li>
<li><a href="#08-kustomization-secret-generator">Secret Generator</a></li>
<li><a href="#08-kustomization-images">images</a></li>
<li><a href="#08-kustomization-namespaces">Namespaces</a></li>
<li><a href="#08-kustomization-prefix-suffix">Prefix / Suffix</a></li>
<li><a href="#08-kustomization-replicas">Replicas</a></li>
<li><a href="#08-kustomization-patches">Patches</a><ul>
<li><a href="#08-kustomization-patch-addupdate">Patch Add/Update</a></li>
<li><a href="#08-kustomization-patch-delete">Patch Delete</a></li>
<li><a href="#08-kustomization-patch-replace">Patch Replace</a></li>
</ul>
</li>
</ul>
<hr />
<h2 id="08-kustomization-commonannotation"><code>commonAnnotation</code><a class="headerlink" href="#08-kustomization-commonannotation" title="Permanent link">&para;</a></h2>
<p><strong>Run the command</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#08-kustomization-__codelineno-2-1"></a>kubectl<span class="w"> </span>kustomize<span class="w"> </span>samples/01-commonAnnotation
</span></code></pre></div></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#08-kustomization-__codelineno-3-1"></a><span class="c1">### FileName: kustomization.yaml</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#08-kustomization-__codelineno-3-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#08-kustomization-__codelineno-3-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#08-kustomization-__codelineno-3-4"></a>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#08-kustomization-__codelineno-3-5"></a><span class="c1"># This will add annotation under every metadata entry</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#08-kustomization-__codelineno-3-6"></a><span class="c1"># ex: main metadata, spec.metadata etc</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#08-kustomization-__codelineno-3-7"></a><span class="nt">commonAnnotations</span><span class="p">:</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#08-kustomization-__codelineno-3-8"></a><span class="w">  </span><span class="nt">author</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nirgeier@gmail.com</span>
</span></code></pre></div>
<ul>
<li>Output:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#08-kustomization-__codelineno-4-1"></a><span class="c1">### commonAnnotation output</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#08-kustomization-__codelineno-4-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#08-kustomization-__codelineno-4-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#08-kustomization-__codelineno-4-4"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#08-kustomization-__codelineno-4-5"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#08-kustomization-__codelineno-4-6"></a><span class="w">    </span><span class="c1">### Annotation added here</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#08-kustomization-__codelineno-4-7"></a><span class="w">    </span><span class="nt">author</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nirgeier@gmail.com</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#08-kustomization-__codelineno-4-8"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#08-kustomization-__codelineno-4-9"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#08-kustomization-__codelineno-4-10"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#08-kustomization-__codelineno-4-11"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#08-kustomization-__codelineno-4-12"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#08-kustomization-__codelineno-4-13"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#08-kustomization-__codelineno-4-14"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#08-kustomization-__codelineno-4-15"></a><span class="w">      </span><span class="c1">### Annotation added here</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#08-kustomization-__codelineno-4-16"></a><span class="w">      </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#08-kustomization-__codelineno-4-17"></a><span class="w">        </span><span class="nt">author</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nirgeier@gmail.com</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#08-kustomization-__codelineno-4-18"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#08-kustomization-__codelineno-4-19"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#08-kustomization-__codelineno-4-20"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-4-21"><a id="__codelineno-4-21" name="__codelineno-4-21" href="#08-kustomization-__codelineno-4-21"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-4-22"><a id="__codelineno-4-22" name="__codelineno-4-22" href="#08-kustomization-__codelineno-4-22"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">__image__</span>
</span><span id="__span-4-23"><a id="__codelineno-4-23" name="__codelineno-4-23" href="#08-kustomization-__codelineno-4-23"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span></code></pre></div>
<hr />
<h2 id="08-kustomization-commonlabels"><code>commonLabels</code><a class="headerlink" href="#08-kustomization-commonlabels" title="Permanent link">&para;</a></h2>
<p><strong>Run the command</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#08-kustomization-__codelineno-5-1"></a>kubectl<span class="w"> </span>kustomize<span class="w"> </span>samples/02-commonLabels
</span></code></pre></div></p>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#08-kustomization-__codelineno-6-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#08-kustomization-__codelineno-6-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#08-kustomization-__codelineno-6-3"></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#08-kustomization-__codelineno-6-4"></a><span class="c1"># This will add annotation under every metadata entry</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#08-kustomization-__codelineno-6-5"></a><span class="c1"># ex: main metadata, spec.metadata etc</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#08-kustomization-__codelineno-6-6"></a><span class="nt">commonLabels</span><span class="p">:</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#08-kustomization-__codelineno-6-7"></a><span class="w">  </span><span class="nt">author</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nirgeier@gmail.com</span>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#08-kustomization-__codelineno-6-8"></a><span class="w">  </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codeWizard-cluster</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#08-kustomization-__codelineno-6-9"></a>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#08-kustomization-__codelineno-6-10"></a><span class="nt">bases</span><span class="p">:</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#08-kustomization-__codelineno-6-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../_base</span>
</span></code></pre></div>
<ul>
<li>Output:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#08-kustomization-__codelineno-7-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#08-kustomization-__codelineno-7-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#08-kustomization-__codelineno-7-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#08-kustomization-__codelineno-7-4"></a><span class="w">    </span><span class="c1"># Labels added ....</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#08-kustomization-__codelineno-7-5"></a><span class="w">    </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#08-kustomization-__codelineno-7-6"></a><span class="w">    </span><span class="nt">author</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nirgeier@gmail.com</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#08-kustomization-__codelineno-7-7"></a><span class="w">    </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codeWizard-cluster</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#08-kustomization-__codelineno-7-8"></a><span class="w w-Error">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#08-kustomization-__codelineno-7-9"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#08-kustomization-__codelineno-7-10"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#08-kustomization-__codelineno-7-11"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#08-kustomization-__codelineno-7-12"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#08-kustomization-__codelineno-7-13"></a><span class="w">      </span><span class="c1"># Labels added ....</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#08-kustomization-__codelineno-7-14"></a><span class="w">      </span><span class="nt">author</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nirgeier@gmail.com</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#08-kustomization-__codelineno-7-15"></a><span class="w">      </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codeWizard-cluster</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#08-kustomization-__codelineno-7-16"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#08-kustomization-__codelineno-7-17"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#08-kustomization-__codelineno-7-18"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#08-kustomization-__codelineno-7-19"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#08-kustomization-__codelineno-7-20"></a><span class="w">        </span><span class="c1"># Labels added ....</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#08-kustomization-__codelineno-7-21"></a><span class="w">        </span><span class="nt">author</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nirgeier@gmail.com</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#08-kustomization-__codelineno-7-22"></a><span class="w">        </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codeWizard-cluster</span>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#08-kustomization-__codelineno-7-23"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24" href="#08-kustomization-__codelineno-7-24"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25" href="#08-kustomization-__codelineno-7-25"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">__image__</span>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26" href="#08-kustomization-__codelineno-7-26"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span></code></pre></div>
<hr />
<h2 id="08-kustomization-generators">Generators<a class="headerlink" href="#08-kustomization-generators" title="Permanent link">&para;</a></h2>
<ul>
<li>Kustomization also support generate <code>ConfigMap</code> / <code>Secret</code> in several ways.</li>
<li>The default behavior is adding the output hash value as suffix to the name, e.g.: <code>secretMapFromFile-495dtcb64g</code></li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#08-kustomization-__codelineno-8-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#08-kustomization-__codelineno-8-2"></a><span class="nt">data</span><span class="p">:</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#08-kustomization-__codelineno-8-3"></a><span class="w">  </span><span class="nt">APP_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ZGV2ZWxvcG1lbnQ=</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#08-kustomization-__codelineno-8-4"></a><span class="w">  </span><span class="nt">LOG_DEBUG</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">dHJ1ZQ==</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#08-kustomization-__codelineno-8-5"></a><span class="w">  </span><span class="nt">NODE_ENV</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ZGV2</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#08-kustomization-__codelineno-8-6"></a><span class="w">  </span><span class="nt">REGION</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">d2V1</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#08-kustomization-__codelineno-8-7"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Secret</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#08-kustomization-__codelineno-8-8"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#08-kustomization-__codelineno-8-9"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secretMapFromFile-495dtcb64g</span><span class="w"> </span><span class="c1"># &lt;--------------------------</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#08-kustomization-__codelineno-8-10"></a><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Opaque</span>
</span></code></pre></div>
<ul>
<li>We can disable the suffix with the following addition to the <code>kustomization.yaml</code></li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#08-kustomization-__codelineno-9-1"></a><span class="nt">generatorOptions</span><span class="p">:</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#08-kustomization-__codelineno-9-2"></a><span class="w">  </span><span class="nt">disableNameSuffixHash</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div>
<hr />
<h3 id="08-kustomization-configmapgenerator"><code>configMapGenerator</code><a class="headerlink" href="#08-kustomization-configmapgenerator" title="Permanent link">&para;</a></h3>
<ul>
<li>
<h4 id="08-kustomization-from-env">From Env<a class="headerlink" href="#08-kustomization-from-env" title="Permanent link">&para;</a></h4>
<ul>
<li><code>.env</code>
  <div class="language-sh highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#08-kustomization-__codelineno-10-1"></a><span class="nv">key1</span><span class="o">=</span>value1
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#08-kustomization-__codelineno-10-2"></a><span class="nv">env</span><span class="o">=</span>qa
</span></code></pre></div></li>
<li>
<p><code>kustomization.yaml</code>
  <div class="language-yaml highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#08-kustomization-__codelineno-11-1"></a><span class="c1"># Generate config file from env file</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#08-kustomization-__codelineno-11-2"></a><span class="nt">configMapGenerator</span><span class="p">:</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#08-kustomization-__codelineno-11-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configMapFromEnv</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#08-kustomization-__codelineno-11-4"></a><span class="w">    </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env</span>
</span></code></pre></div></p>
</li>
<li>
<p>The output of <code>configMapFromEnv</code>:
  <div class="language-yaml highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#08-kustomization-__codelineno-12-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#08-kustomization-__codelineno-12-2"></a><span class="nt">data</span><span class="p">:</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#08-kustomization-__codelineno-12-3"></a><span class="w">  </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">qa</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#08-kustomization-__codelineno-12-4"></a><span class="w">  </span><span class="nt">key1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value1</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#08-kustomization-__codelineno-12-5"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#08-kustomization-__codelineno-12-6"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#08-kustomization-__codelineno-12-7"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configMapFromEnv-c9655hf97k</span>
</span></code></pre></div></p>
</li>
</ul>
</li>
<li>
<h4 id="08-kustomization-from-file">From File<a class="headerlink" href="#08-kustomization-from-file" title="Permanent link">&para;</a></h4>
<ul>
<li><code>.env</code>
  <div class="language-sh highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#08-kustomization-__codelineno-13-1"></a><span class="nv">key1</span><span class="o">=</span>value1
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#08-kustomization-__codelineno-13-2"></a><span class="nv">env</span><span class="o">=</span>qa
</span></code></pre></div></li>
<li>
<p><code>kustomization.yaml</code>
  <div class="language-yaml highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#08-kustomization-__codelineno-14-1"></a><span class="c1"># Generate config file from env file</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#08-kustomization-__codelineno-14-2"></a><span class="nt">configMapGenerator</span><span class="p">:</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#08-kustomization-__codelineno-14-3"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configMapFromEnv</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#08-kustomization-__codelineno-14-4"></a><span class="w">    </span><span class="nt">files</span><span class="p">:</span><span class="w"> </span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#08-kustomization-__codelineno-14-5"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env</span>
</span></code></pre></div></p>
</li>
<li>
<p>The output of <code>configMapFromEnv</code>:
  <div class="language-yaml highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#08-kustomization-__codelineno-15-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#08-kustomization-__codelineno-15-2"></a><span class="nt">data</span><span class="p">:</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#08-kustomization-__codelineno-15-3"></a><span class="w">  </span><span class="nt">.env</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;key1=value1\r\nenv=qa&quot;</span><span class="w"> </span><span class="c1"># &lt;--------------------------</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#08-kustomization-__codelineno-15-4"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#08-kustomization-__codelineno-15-5"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#08-kustomization-__codelineno-15-6"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configFromFile-dfhmctd84d</span>
</span></code></pre></div></p>
</li>
</ul>
</li>
<li>
<h4 id="08-kustomization-from-literal">From Literal<a class="headerlink" href="#08-kustomization-from-literal" title="Permanent link">&para;</a></h4>
<ul>
<li><code>.env</code>
  <div class="language-sh highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#08-kustomization-__codelineno-16-1"></a><span class="nv">key1</span><span class="o">=</span>value1
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#08-kustomization-__codelineno-16-2"></a><span class="nv">env</span><span class="o">=</span>qa
</span></code></pre></div></li>
<li>
<p><code>kustomization.yaml</code>
  <div class="language-yaml highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#08-kustomization-__codelineno-17-1"></a><span class="nt">configMapGenerator</span><span class="p">:</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#08-kustomization-__codelineno-17-2"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configFromLiterals</span>
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#08-kustomization-__codelineno-17-3"></a><span class="w">    </span><span class="nt">literals</span><span class="p">:</span>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#08-kustomization-__codelineno-17-4"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Key1=value1</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#08-kustomization-__codelineno-17-5"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Key2=value2</span>
</span></code></pre></div></p>
</li>
<li>
<p>The output of <code>configMapFromEnv</code>:
  <div class="language-yaml highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#08-kustomization-__codelineno-18-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#08-kustomization-__codelineno-18-2"></a><span class="nt">data</span><span class="p">:</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#08-kustomization-__codelineno-18-3"></a><span class="w">  </span><span class="nt">Key1</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value1</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#08-kustomization-__codelineno-18-4"></a><span class="w">  </span><span class="nt">Key2</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">value2</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#08-kustomization-__codelineno-18-5"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#08-kustomization-__codelineno-18-6"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#08-kustomization-__codelineno-18-7"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">configFromLiterals-h777b4gdf5</span>
</span></code></pre></div></p>
</li>
</ul>
</li>
</ul>
<hr />
<h2 id="08-kustomization-secret-generator"><code>Secret</code> Generator<a class="headerlink" href="#08-kustomization-secret-generator" title="Permanent link">&para;</a></h2>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#08-kustomization-__codelineno-19-1"></a><span class="c1"># Similar to configMap but with an additional type field</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#08-kustomization-__codelineno-19-2"></a><span class="nt">secretGenerator</span><span class="p">:</span>
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#08-kustomization-__codelineno-19-3"></a><span class="w">  </span><span class="c1"># Generate secret from env file</span>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#08-kustomization-__codelineno-19-4"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">secretMapFromFile</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#08-kustomization-__codelineno-19-5"></a><span class="w">    </span><span class="nt">env</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">.env</span>
</span><span id="__span-19-6"><a id="__codelineno-19-6" name="__codelineno-19-6" href="#08-kustomization-__codelineno-19-6"></a><span class="w">    </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Opaque</span>
</span><span id="__span-19-7"><a id="__codelineno-19-7" name="__codelineno-19-7" href="#08-kustomization-__codelineno-19-7"></a><span class="nt">generatorOptions</span><span class="p">:</span>
</span><span id="__span-19-8"><a id="__codelineno-19-8" name="__codelineno-19-8" href="#08-kustomization-__codelineno-19-8"></a><span class="w">  </span><span class="nt">disableNameSuffixHash</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div>
<hr />
<h2 id="08-kustomization-images"><code>images</code><a class="headerlink" href="#08-kustomization-images" title="Permanent link">&para;</a></h2>
<ul>
<li>Modify the name, tags and/or digest for images.</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#08-kustomization-__codelineno-20-1"></a>kubectl<span class="w"> </span>kustomize<span class="w"> </span>samples/04-images
</span></code></pre></div>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#08-kustomization-__codelineno-21-1"></a><span class="c1"># kustomization.yaml</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#08-kustomization-__codelineno-21-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#08-kustomization-__codelineno-21-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#08-kustomization-__codelineno-21-4"></a>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#08-kustomization-__codelineno-21-5"></a><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-21-6"><a id="__codelineno-21-6" name="__codelineno-21-6" href="#08-kustomization-__codelineno-21-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">./base.yaml</span>
</span><span id="__span-21-7"><a id="__codelineno-21-7" name="__codelineno-21-7" href="#08-kustomization-__codelineno-21-7"></a>
</span><span id="__span-21-8"><a id="__codelineno-21-8" name="__codelineno-21-8" href="#08-kustomization-__codelineno-21-8"></a><span class="nt">images</span><span class="p">:</span>
</span><span id="__span-21-9"><a id="__codelineno-21-9" name="__codelineno-21-9" href="#08-kustomization-__codelineno-21-9"></a><span class="w">  </span><span class="c1"># The image as its defined in the Deployment file</span>
</span><span id="__span-21-10"><a id="__codelineno-21-10" name="__codelineno-21-10" href="#08-kustomization-__codelineno-21-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">__image__</span>
</span><span id="__span-21-11"><a id="__codelineno-21-11" name="__codelineno-21-11" href="#08-kustomization-__codelineno-21-11"></a><span class="w">    </span><span class="c1"># The new name to set</span>
</span><span id="__span-21-12"><a id="__codelineno-21-12" name="__codelineno-21-12" href="#08-kustomization-__codelineno-21-12"></a><span class="w">    </span><span class="nt">newName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-registry/my-image</span>
</span><span id="__span-21-13"><a id="__codelineno-21-13" name="__codelineno-21-13" href="#08-kustomization-__codelineno-21-13"></a><span class="w">    </span><span class="c1"># optional: image tag</span>
</span><span id="__span-21-14"><a id="__codelineno-21-14" name="__codelineno-21-14" href="#08-kustomization-__codelineno-21-14"></a><span class="w">    </span><span class="nt">newTag</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span></code></pre></div>
<ul>
<li>Output:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#08-kustomization-__codelineno-22-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#08-kustomization-__codelineno-22-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#08-kustomization-__codelineno-22-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#08-kustomization-__codelineno-22-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#08-kustomization-__codelineno-22-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-22-6"><a id="__codelineno-22-6" name="__codelineno-22-6" href="#08-kustomization-__codelineno-22-6"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-22-7"><a id="__codelineno-22-7" name="__codelineno-22-7" href="#08-kustomization-__codelineno-22-7"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-22-8"><a id="__codelineno-22-8" name="__codelineno-22-8" href="#08-kustomization-__codelineno-22-8"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-22-9"><a id="__codelineno-22-9" name="__codelineno-22-9" href="#08-kustomization-__codelineno-22-9"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-22-10"><a id="__codelineno-22-10" name="__codelineno-22-10" href="#08-kustomization-__codelineno-22-10"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-22-11"><a id="__codelineno-22-11" name="__codelineno-22-11" href="#08-kustomization-__codelineno-22-11"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-22-12"><a id="__codelineno-22-12" name="__codelineno-22-12" href="#08-kustomization-__codelineno-22-12"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-22-13"><a id="__codelineno-22-13" name="__codelineno-22-13" href="#08-kustomization-__codelineno-22-13"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-22-14"><a id="__codelineno-22-14" name="__codelineno-22-14" href="#08-kustomization-__codelineno-22-14"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-22-15"><a id="__codelineno-22-15" name="__codelineno-22-15" href="#08-kustomization-__codelineno-22-15"></a><span class="w">        </span><span class="c1"># --- This image was updated</span>
</span><span id="__span-22-16"><a id="__codelineno-22-16" name="__codelineno-22-16" href="#08-kustomization-__codelineno-22-16"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">my-registry/my-image:v1</span>
</span><span id="__span-22-17"><a id="__codelineno-22-17" name="__codelineno-22-17" href="#08-kustomization-__codelineno-22-17"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span></code></pre></div>
<hr />
<h2 id="08-kustomization-namespaces"><code>Namespaces</code><a class="headerlink" href="#08-kustomization-namespaces" title="Permanent link">&para;</a></h2>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#08-kustomization-__codelineno-23-1"></a>kubectl<span class="w"> </span>kustomize<span class="w"> </span>samples/05-Namespace
</span></code></pre></div>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#08-kustomization-__codelineno-24-1"></a><span class="c1"># kustomization.yaml</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#08-kustomization-__codelineno-24-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#08-kustomization-__codelineno-24-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#08-kustomization-__codelineno-24-4"></a>
</span><span id="__span-24-5"><a id="__codelineno-24-5" name="__codelineno-24-5" href="#08-kustomization-__codelineno-24-5"></a><span class="c1"># Add the desired namespace to all resources</span>
</span><span id="__span-24-6"><a id="__codelineno-24-6" name="__codelineno-24-6" href="#08-kustomization-__codelineno-24-6"></a><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize-namespace</span>
</span><span id="__span-24-7"><a id="__codelineno-24-7" name="__codelineno-24-7" href="#08-kustomization-__codelineno-24-7"></a>
</span><span id="__span-24-8"><a id="__codelineno-24-8" name="__codelineno-24-8" href="#08-kustomization-__codelineno-24-8"></a><span class="nt">bases</span><span class="p">:</span>
</span><span id="__span-24-9"><a id="__codelineno-24-9" name="__codelineno-24-9" href="#08-kustomization-__codelineno-24-9"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../_base</span>
</span></code></pre></div>
<ul>
<li>Output:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#08-kustomization-__codelineno-25-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-25-2"><a id="__codelineno-25-2" name="__codelineno-25-2" href="#08-kustomization-__codelineno-25-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-25-3"><a id="__codelineno-25-3" name="__codelineno-25-3" href="#08-kustomization-__codelineno-25-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-25-4"><a id="__codelineno-25-4" name="__codelineno-25-4" href="#08-kustomization-__codelineno-25-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-25-5"><a id="__codelineno-25-5" name="__codelineno-25-5" href="#08-kustomization-__codelineno-25-5"></a><span class="w">  </span><span class="c1"># Namespace added here</span>
</span><span id="__span-25-6"><a id="__codelineno-25-6" name="__codelineno-25-6" href="#08-kustomization-__codelineno-25-6"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize-namespace</span>
</span></code></pre></div>
<hr />
<h3 id="08-kustomization-prefix-suffix"><code>Prefix-suffix</code><a class="headerlink" href="#08-kustomization-prefix-suffix" title="Permanent link">&para;</a></h3>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#08-kustomization-__codelineno-26-1"></a>kubectl<span class="w"> </span>kustomize<span class="w"> </span>samples/06-Prefix-Suffix
</span></code></pre></div>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#08-kustomization-__codelineno-27-1"></a><span class="c1"># kustomization.yaml</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#08-kustomization-__codelineno-27-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
</span><span id="__span-27-3"><a id="__codelineno-27-3" name="__codelineno-27-3" href="#08-kustomization-__codelineno-27-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
</span><span id="__span-27-4"><a id="__codelineno-27-4" name="__codelineno-27-4" href="#08-kustomization-__codelineno-27-4"></a>
</span><span id="__span-27-5"><a id="__codelineno-27-5" name="__codelineno-27-5" href="#08-kustomization-__codelineno-27-5"></a><span class="c1"># Add the desired Prefix to all resources</span>
</span><span id="__span-27-6"><a id="__codelineno-27-6" name="__codelineno-27-6" href="#08-kustomization-__codelineno-27-6"></a><span class="nt">namePrefix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prefix-codeWizard-</span>
</span><span id="__span-27-7"><a id="__codelineno-27-7" name="__codelineno-27-7" href="#08-kustomization-__codelineno-27-7"></a><span class="nt">nameSuffix</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-suffix-codeWizard</span>
</span><span id="__span-27-8"><a id="__codelineno-27-8" name="__codelineno-27-8" href="#08-kustomization-__codelineno-27-8"></a>
</span><span id="__span-27-9"><a id="__codelineno-27-9" name="__codelineno-27-9" href="#08-kustomization-__codelineno-27-9"></a><span class="nt">bases</span><span class="p">:</span>
</span><span id="__span-27-10"><a id="__codelineno-27-10" name="__codelineno-27-10" href="#08-kustomization-__codelineno-27-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../_base</span>
</span></code></pre></div>
<ul>
<li>Output:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#08-kustomization-__codelineno-28-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#08-kustomization-__codelineno-28-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-28-3"><a id="__codelineno-28-3" name="__codelineno-28-3" href="#08-kustomization-__codelineno-28-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-28-4"><a id="__codelineno-28-4" name="__codelineno-28-4" href="#08-kustomization-__codelineno-28-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">prefix-codeWizard-myapp-suffix-codeWizard</span>
</span></code></pre></div>
<hr />
<h2 id="08-kustomization-replicas"><code>Replicas</code><a class="headerlink" href="#08-kustomization-replicas" title="Permanent link">&para;</a></h2>
<ul>
<li>deployment</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#08-kustomization-__codelineno-29-1"></a><span class="c1"># deployment.yaml</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#08-kustomization-__codelineno-29-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-29-3"><a id="__codelineno-29-3" name="__codelineno-29-3" href="#08-kustomization-__codelineno-29-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-29-4"><a id="__codelineno-29-4" name="__codelineno-29-4" href="#08-kustomization-__codelineno-29-4"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-29-5"><a id="__codelineno-29-5" name="__codelineno-29-5" href="#08-kustomization-__codelineno-29-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deployment</span>
</span><span id="__span-29-6"><a id="__codelineno-29-6" name="__codelineno-29-6" href="#08-kustomization-__codelineno-29-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-29-7"><a id="__codelineno-29-7" name="__codelineno-29-7" href="#08-kustomization-__codelineno-29-7"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5</span>
</span><span id="__span-29-8"><a id="__codelineno-29-8" name="__codelineno-29-8" href="#08-kustomization-__codelineno-29-8"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-29-9"><a id="__codelineno-29-9" name="__codelineno-29-9" href="#08-kustomization-__codelineno-29-9"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deployment</span>
</span><span id="__span-29-10"><a id="__codelineno-29-10" name="__codelineno-29-10" href="#08-kustomization-__codelineno-29-10"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-29-11"><a id="__codelineno-29-11" name="__codelineno-29-11" href="#08-kustomization-__codelineno-29-11"></a><span class="w">    </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-29-12"><a id="__codelineno-29-12" name="__codelineno-29-12" href="#08-kustomization-__codelineno-29-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">container</span>
</span><span id="__span-29-13"><a id="__codelineno-29-13" name="__codelineno-29-13" href="#08-kustomization-__codelineno-29-13"></a><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry/conatiner:latest</span>
</span></code></pre></div>
<ul>
<li>kustomization</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#08-kustomization-__codelineno-30-1"></a><span class="c1"># kustomization.yaml</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#08-kustomization-__codelineno-30-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
</span><span id="__span-30-3"><a id="__codelineno-30-3" name="__codelineno-30-3" href="#08-kustomization-__codelineno-30-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
</span><span id="__span-30-4"><a id="__codelineno-30-4" name="__codelineno-30-4" href="#08-kustomization-__codelineno-30-4"></a>
</span><span id="__span-30-5"><a id="__codelineno-30-5" name="__codelineno-30-5" href="#08-kustomization-__codelineno-30-5"></a><span class="nt">replicas</span><span class="p">:</span>
</span><span id="__span-30-6"><a id="__codelineno-30-6" name="__codelineno-30-6" href="#08-kustomization-__codelineno-30-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deployment</span>
</span><span id="__span-30-7"><a id="__codelineno-30-7" name="__codelineno-30-7" href="#08-kustomization-__codelineno-30-7"></a><span class="w">    </span><span class="nt">count</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</span><span id="__span-30-8"><a id="__codelineno-30-8" name="__codelineno-30-8" href="#08-kustomization-__codelineno-30-8"></a>
</span><span id="__span-30-9"><a id="__codelineno-30-9" name="__codelineno-30-9" href="#08-kustomization-__codelineno-30-9"></a><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-30-10"><a id="__codelineno-30-10" name="__codelineno-30-10" href="#08-kustomization-__codelineno-30-10"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deployment.yaml</span>
</span></code></pre></div>
<ul>
<li>Output:</li>
</ul>
<div class="admonition warning">
<p class="admonition-title"><strong>Note</strong></p>
<p>There is a bug with the <code>replicas</code> entries which return error for some reason.</p>
</div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#08-kustomization-__codelineno-31-1"></a><span class="w"> </span>kubectl<span class="w"> </span>kustomize<span class="w"> </span>.
</span></code></pre></div>
<h1 id="08-kustomization-for-some-reason-we-get-this-error">For some reason we get this error:<a class="headerlink" href="#08-kustomization-for-some-reason-we-get-this-error" title="Permanent link">&para;</a></h1>
<p>Error: json: unknown field &ldquo;replicas&rdquo;</p>
<h1 id="08-kustomization-workaround-for-this-error-for-now-is">Workaround for this error for now is:<a class="headerlink" href="#08-kustomization-workaround-for-this-error-for-now-is" title="Permanent link">&para;</a></h1>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#08-kustomization-__codelineno-32-1"></a><span class="w"> </span>kubectl<span class="w"> </span>kustomize<span class="w"> </span>.
</span></code></pre></div>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#08-kustomization-__codelineno-33-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#08-kustomization-__codelineno-33-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#08-kustomization-__codelineno-33-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#08-kustomization-__codelineno-33-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deployment</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#08-kustomization-__codelineno-33-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-33-6"><a id="__codelineno-33-6" name="__codelineno-33-6" href="#08-kustomization-__codelineno-33-6"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">10</span>
</span><span id="__span-33-7"><a id="__codelineno-33-7" name="__codelineno-33-7" href="#08-kustomization-__codelineno-33-7"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-33-8"><a id="__codelineno-33-8" name="__codelineno-33-8" href="#08-kustomization-__codelineno-33-8"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">deployment</span>
</span><span id="__span-33-9"><a id="__codelineno-33-9" name="__codelineno-33-9" href="#08-kustomization-__codelineno-33-9"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-33-10"><a id="__codelineno-33-10" name="__codelineno-33-10" href="#08-kustomization-__codelineno-33-10"></a><span class="w">    </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-33-11"><a id="__codelineno-33-11" name="__codelineno-33-11" href="#08-kustomization-__codelineno-33-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">registry/conatiner:latest</span>
</span><span id="__span-33-12"><a id="__codelineno-33-12" name="__codelineno-33-12" href="#08-kustomization-__codelineno-33-12"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">container</span>
</span></code></pre></div>
<hr />
<h2 id="08-kustomization-patches">Patches<a class="headerlink" href="#08-kustomization-patches" title="Permanent link">&para;</a></h2>
<ul>
<li>There are several types of patches like [<code>replace</code>, <code>delete</code>, <code>patchesStrategicMerge</code>]</li>
<li>For this demo we will demonstrate <code>patchesStrategicMerge</code></li>
</ul>
<h3 id="08-kustomization-patch-addupdate">Patch Add/Update<a class="headerlink" href="#08-kustomization-patch-addupdate" title="Permanent link">&para;</a></h3>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#08-kustomization-__codelineno-34-1"></a>kubectl<span class="w"> </span>kustomize<span class="w"> </span>samples/08-Patches/patch-add-update
</span></code></pre></div>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#08-kustomization-__codelineno-35-1"></a><span class="c1"># File: patch-memory.yaml</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#08-kustomization-__codelineno-35-2"></a><span class="c1"># -----------------------</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#08-kustomization-__codelineno-35-3"></a><span class="c1"># Patch limits.memory</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#08-kustomization-__codelineno-35-4"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-35-5"><a id="__codelineno-35-5" name="__codelineno-35-5" href="#08-kustomization-__codelineno-35-5"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-35-6"><a id="__codelineno-35-6" name="__codelineno-35-6" href="#08-kustomization-__codelineno-35-6"></a><span class="c1"># Set the desired deployment to patch</span>
</span><span id="__span-35-7"><a id="__codelineno-35-7" name="__codelineno-35-7" href="#08-kustomization-__codelineno-35-7"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-35-8"><a id="__codelineno-35-8" name="__codelineno-35-8" href="#08-kustomization-__codelineno-35-8"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-35-9"><a id="__codelineno-35-9" name="__codelineno-35-9" href="#08-kustomization-__codelineno-35-9"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-35-10"><a id="__codelineno-35-10" name="__codelineno-35-10" href="#08-kustomization-__codelineno-35-10"></a><span class="w">  </span><span class="c1"># patch the memory limit</span>
</span><span id="__span-35-11"><a id="__codelineno-35-11" name="__codelineno-35-11" href="#08-kustomization-__codelineno-35-11"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-35-12"><a id="__codelineno-35-12" name="__codelineno-35-12" href="#08-kustomization-__codelineno-35-12"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-35-13"><a id="__codelineno-35-13" name="__codelineno-35-13" href="#08-kustomization-__codelineno-35-13"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-35-14"><a id="__codelineno-35-14" name="__codelineno-35-14" href="#08-kustomization-__codelineno-35-14"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">patch-name</span>
</span><span id="__span-35-15"><a id="__codelineno-35-15" name="__codelineno-35-15" href="#08-kustomization-__codelineno-35-15"></a><span class="w">          </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-35-16"><a id="__codelineno-35-16" name="__codelineno-35-16" href="#08-kustomization-__codelineno-35-16"></a><span class="w">            </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-35-17"><a id="__codelineno-35-17" name="__codelineno-35-17" href="#08-kustomization-__codelineno-35-17"></a><span class="w">              </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512Mi</span>
</span></code></pre></div>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#08-kustomization-__codelineno-36-1"></a><span class="c1"># File: patch-replicas.yaml</span>
</span><span id="__span-36-2"><a id="__codelineno-36-2" name="__codelineno-36-2" href="#08-kustomization-__codelineno-36-2"></a><span class="c1"># -------------------------</span>
</span><span id="__span-36-3"><a id="__codelineno-36-3" name="__codelineno-36-3" href="#08-kustomization-__codelineno-36-3"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-36-4"><a id="__codelineno-36-4" name="__codelineno-36-4" href="#08-kustomization-__codelineno-36-4"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-36-5"><a id="__codelineno-36-5" name="__codelineno-36-5" href="#08-kustomization-__codelineno-36-5"></a><span class="c1"># Set the desired deployment to patch</span>
</span><span id="__span-36-6"><a id="__codelineno-36-6" name="__codelineno-36-6" href="#08-kustomization-__codelineno-36-6"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-36-7"><a id="__codelineno-36-7" name="__codelineno-36-7" href="#08-kustomization-__codelineno-36-7"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-36-8"><a id="__codelineno-36-8" name="__codelineno-36-8" href="#08-kustomization-__codelineno-36-8"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-36-9"><a id="__codelineno-36-9" name="__codelineno-36-9" href="#08-kustomization-__codelineno-36-9"></a><span class="w">  </span><span class="c1"># This is the patch for this demo</span>
</span><span id="__span-36-10"><a id="__codelineno-36-10" name="__codelineno-36-10" href="#08-kustomization-__codelineno-36-10"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span></code></pre></div>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#08-kustomization-__codelineno-37-1"></a><span class="c1"># kustomization.yaml</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#08-kustomization-__codelineno-37-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
</span><span id="__span-37-3"><a id="__codelineno-37-3" name="__codelineno-37-3" href="#08-kustomization-__codelineno-37-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
</span><span id="__span-37-4"><a id="__codelineno-37-4" name="__codelineno-37-4" href="#08-kustomization-__codelineno-37-4"></a>
</span><span id="__span-37-5"><a id="__codelineno-37-5" name="__codelineno-37-5" href="#08-kustomization-__codelineno-37-5"></a><span class="nt">bases</span><span class="p">:</span>
</span><span id="__span-37-6"><a id="__codelineno-37-6" name="__codelineno-37-6" href="#08-kustomization-__codelineno-37-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../_base</span>
</span><span id="__span-37-7"><a id="__codelineno-37-7" name="__codelineno-37-7" href="#08-kustomization-__codelineno-37-7"></a>
</span><span id="__span-37-8"><a id="__codelineno-37-8" name="__codelineno-37-8" href="#08-kustomization-__codelineno-37-8"></a><span class="nt">patchesStrategicMerge</span><span class="p">:</span>
</span><span id="__span-37-9"><a id="__codelineno-37-9" name="__codelineno-37-9" href="#08-kustomization-__codelineno-37-9"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">patch-memory.yaml</span>
</span><span id="__span-37-10"><a id="__codelineno-37-10" name="__codelineno-37-10" href="#08-kustomization-__codelineno-37-10"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">patch-replicas.yaml</span>
</span></code></pre></div>
<ul>
<li>Output:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#08-kustomization-__codelineno-38-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#08-kustomization-__codelineno-38-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#08-kustomization-__codelineno-38-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#08-kustomization-__codelineno-38-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#08-kustomization-__codelineno-38-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-38-6"><a id="__codelineno-38-6" name="__codelineno-38-6" href="#08-kustomization-__codelineno-38-6"></a><span class="w">  </span><span class="c1"># This is the first patch</span>
</span><span id="__span-38-7"><a id="__codelineno-38-7" name="__codelineno-38-7" href="#08-kustomization-__codelineno-38-7"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-38-8"><a id="__codelineno-38-8" name="__codelineno-38-8" href="#08-kustomization-__codelineno-38-8"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-38-9"><a id="__codelineno-38-9" name="__codelineno-38-9" href="#08-kustomization-__codelineno-38-9"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-38-10"><a id="__codelineno-38-10" name="__codelineno-38-10" href="#08-kustomization-__codelineno-38-10"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-38-11"><a id="__codelineno-38-11" name="__codelineno-38-11" href="#08-kustomization-__codelineno-38-11"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-38-12"><a id="__codelineno-38-12" name="__codelineno-38-12" href="#08-kustomization-__codelineno-38-12"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-38-13"><a id="__codelineno-38-13" name="__codelineno-38-13" href="#08-kustomization-__codelineno-38-13"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-38-14"><a id="__codelineno-38-14" name="__codelineno-38-14" href="#08-kustomization-__codelineno-38-14"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-38-15"><a id="__codelineno-38-15" name="__codelineno-38-15" href="#08-kustomization-__codelineno-38-15"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-38-16"><a id="__codelineno-38-16" name="__codelineno-38-16" href="#08-kustomization-__codelineno-38-16"></a><span class="w">      </span><span class="c1"># This is the second patch</span>
</span><span id="__span-38-17"><a id="__codelineno-38-17" name="__codelineno-38-17" href="#08-kustomization-__codelineno-38-17"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-38-18"><a id="__codelineno-38-18" name="__codelineno-38-18" href="#08-kustomization-__codelineno-38-18"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">patch-name</span>
</span><span id="__span-38-19"><a id="__codelineno-38-19" name="__codelineno-38-19" href="#08-kustomization-__codelineno-38-19"></a><span class="w">        </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-38-20"><a id="__codelineno-38-20" name="__codelineno-38-20" href="#08-kustomization-__codelineno-38-20"></a><span class="w">          </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-38-21"><a id="__codelineno-38-21" name="__codelineno-38-21" href="#08-kustomization-__codelineno-38-21"></a><span class="w">            </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">512Mi</span>
</span><span id="__span-38-22"><a id="__codelineno-38-22" name="__codelineno-38-22" href="#08-kustomization-__codelineno-38-22"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">__image__</span>
</span><span id="__span-38-23"><a id="__codelineno-38-23" name="__codelineno-38-23" href="#08-kustomization-__codelineno-38-23"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span></code></pre></div>
<hr />
<h3 id="08-kustomization-patch-delete">Patch-Delete<a class="headerlink" href="#08-kustomization-patch-delete" title="Permanent link">&para;</a></h3>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#08-kustomization-__codelineno-39-1"></a>kubectl<span class="w"> </span>kustomize<span class="w"> </span>samples/08-Patches/patch-delete
</span></code></pre></div>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#08-kustomization-__codelineno-40-1"></a><span class="c1"># kustomization.yaml</span>
</span><span id="__span-40-2"><a id="__codelineno-40-2" name="__codelineno-40-2" href="#08-kustomization-__codelineno-40-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
</span><span id="__span-40-3"><a id="__codelineno-40-3" name="__codelineno-40-3" href="#08-kustomization-__codelineno-40-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
</span><span id="__span-40-4"><a id="__codelineno-40-4" name="__codelineno-40-4" href="#08-kustomization-__codelineno-40-4"></a>
</span><span id="__span-40-5"><a id="__codelineno-40-5" name="__codelineno-40-5" href="#08-kustomization-__codelineno-40-5"></a><span class="nt">bases</span><span class="p">:</span>
</span><span id="__span-40-6"><a id="__codelineno-40-6" name="__codelineno-40-6" href="#08-kustomization-__codelineno-40-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../../_base</span>
</span><span id="__span-40-7"><a id="__codelineno-40-7" name="__codelineno-40-7" href="#08-kustomization-__codelineno-40-7"></a>
</span><span id="__span-40-8"><a id="__codelineno-40-8" name="__codelineno-40-8" href="#08-kustomization-__codelineno-40-8"></a><span class="nt">patchesStrategicMerge</span><span class="p">:</span>
</span><span id="__span-40-9"><a id="__codelineno-40-9" name="__codelineno-40-9" href="#08-kustomization-__codelineno-40-9"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">patch-delete.yaml</span>
</span></code></pre></div>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#08-kustomization-__codelineno-41-1"></a><span class="c1"># patch-delete.yaml</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#08-kustomization-__codelineno-41-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#08-kustomization-__codelineno-41-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#08-kustomization-__codelineno-41-4"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#08-kustomization-__codelineno-41-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-41-6"><a id="__codelineno-41-6" name="__codelineno-41-6" href="#08-kustomization-__codelineno-41-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-41-7"><a id="__codelineno-41-7" name="__codelineno-41-7" href="#08-kustomization-__codelineno-41-7"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-41-8"><a id="__codelineno-41-8" name="__codelineno-41-8" href="#08-kustomization-__codelineno-41-8"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-41-9"><a id="__codelineno-41-9" name="__codelineno-41-9" href="#08-kustomization-__codelineno-41-9"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-41-10"><a id="__codelineno-41-10" name="__codelineno-41-10" href="#08-kustomization-__codelineno-41-10"></a><span class="w">        </span><span class="c1"># Remove this section, in this demo it will remove the </span>
</span><span id="__span-41-11"><a id="__codelineno-41-11" name="__codelineno-41-11" href="#08-kustomization-__codelineno-41-11"></a><span class="w">        </span><span class="c1"># image with the `name: myapp` </span>
</span><span id="__span-41-12"><a id="__codelineno-41-12" name="__codelineno-41-12" href="#08-kustomization-__codelineno-41-12"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">$patch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">delete</span>
</span><span id="__span-41-13"><a id="__codelineno-41-13" name="__codelineno-41-13" href="#08-kustomization-__codelineno-41-13"></a><span class="w">          </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-41-14"><a id="__codelineno-41-14" name="__codelineno-41-14" href="#08-kustomization-__codelineno-41-14"></a><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">__image__</span>
</span></code></pre></div>
<ul>
<li>Output:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#08-kustomization-__codelineno-42-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-42-2"><a id="__codelineno-42-2" name="__codelineno-42-2" href="#08-kustomization-__codelineno-42-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-42-3"><a id="__codelineno-42-3" name="__codelineno-42-3" href="#08-kustomization-__codelineno-42-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-42-4"><a id="__codelineno-42-4" name="__codelineno-42-4" href="#08-kustomization-__codelineno-42-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-42-5"><a id="__codelineno-42-5" name="__codelineno-42-5" href="#08-kustomization-__codelineno-42-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-42-6"><a id="__codelineno-42-6" name="__codelineno-42-6" href="#08-kustomization-__codelineno-42-6"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-42-7"><a id="__codelineno-42-7" name="__codelineno-42-7" href="#08-kustomization-__codelineno-42-7"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-42-8"><a id="__codelineno-42-8" name="__codelineno-42-8" href="#08-kustomization-__codelineno-42-8"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-42-9"><a id="__codelineno-42-9" name="__codelineno-42-9" href="#08-kustomization-__codelineno-42-9"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-42-10"><a id="__codelineno-42-10" name="__codelineno-42-10" href="#08-kustomization-__codelineno-42-10"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-42-11"><a id="__codelineno-42-11" name="__codelineno-42-11" href="#08-kustomization-__codelineno-42-11"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-42-12"><a id="__codelineno-42-12" name="__codelineno-42-12" href="#08-kustomization-__codelineno-42-12"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-42-13"><a id="__codelineno-42-13" name="__codelineno-42-13" href="#08-kustomization-__codelineno-42-13"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-42-14"><a id="__codelineno-42-14" name="__codelineno-42-14" href="#08-kustomization-__codelineno-42-14"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-42-15"><a id="__codelineno-42-15" name="__codelineno-42-15" href="#08-kustomization-__codelineno-42-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-42-16"><a id="__codelineno-42-16" name="__codelineno-42-16" href="#08-kustomization-__codelineno-42-16"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span></code></pre></div>
<hr />
<h3 id="08-kustomization-patch-replace">Patch Replace<a class="headerlink" href="#08-kustomization-patch-replace" title="Permanent link">&para;</a></h3>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#08-kustomization-__codelineno-43-1"></a>kubectl<span class="w"> </span>kustomize<span class="w"> </span>samples/08-Patches/patch-replace/
</span></code></pre></div>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#08-kustomization-__codelineno-44-1"></a><span class="c1"># kustomization.yaml</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#08-kustomization-__codelineno-44-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kustomize.config.k8s.io/v1beta1</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#08-kustomization-__codelineno-44-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Kustomization</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#08-kustomization-__codelineno-44-4"></a>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#08-kustomization-__codelineno-44-5"></a><span class="nt">bases</span><span class="p">:</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#08-kustomization-__codelineno-44-6"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">../../_base</span>
</span><span id="__span-44-7"><a id="__codelineno-44-7" name="__codelineno-44-7" href="#08-kustomization-__codelineno-44-7"></a>
</span><span id="__span-44-8"><a id="__codelineno-44-8" name="__codelineno-44-8" href="#08-kustomization-__codelineno-44-8"></a><span class="nt">patchesStrategicMerge</span><span class="p">:</span>
</span><span id="__span-44-9"><a id="__codelineno-44-9" name="__codelineno-44-9" href="#08-kustomization-__codelineno-44-9"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">patch-replace.yaml</span>
</span></code></pre></div>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#08-kustomization-__codelineno-45-1"></a><span class="c1"># patch-replace.yaml</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#08-kustomization-__codelineno-45-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#08-kustomization-__codelineno-45-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#08-kustomization-__codelineno-45-4"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#08-kustomization-__codelineno-45-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#08-kustomization-__codelineno-45-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#08-kustomization-__codelineno-45-7"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#08-kustomization-__codelineno-45-8"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#08-kustomization-__codelineno-45-9"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#08-kustomization-__codelineno-45-10"></a><span class="w">        </span><span class="c1"># Remove this section, in this demo it will remove the </span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#08-kustomization-__codelineno-45-11"></a><span class="w">        </span><span class="c1"># image with the `name: myapp` </span>
</span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12" href="#08-kustomization-__codelineno-45-12"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">$patch</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">replace</span>
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13" href="#08-kustomization-__codelineno-45-13"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14" href="#08-kustomization-__codelineno-45-14"></a><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span><span id="__span-45-15"><a id="__codelineno-45-15" name="__codelineno-45-15" href="#08-kustomization-__codelineno-45-15"></a><span class="w">          </span><span class="nt">args</span><span class="p">:</span>
</span><span id="__span-45-16"><a id="__codelineno-45-16" name="__codelineno-45-16" href="#08-kustomization-__codelineno-45-16"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">one</span>
</span><span id="__span-45-17"><a id="__codelineno-45-17" name="__codelineno-45-17" href="#08-kustomization-__codelineno-45-17"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">two</span>
</span></code></pre></div>
<ul>
<li>Output:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#08-kustomization-__codelineno-46-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-46-2"><a id="__codelineno-46-2" name="__codelineno-46-2" href="#08-kustomization-__codelineno-46-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-46-3"><a id="__codelineno-46-3" name="__codelineno-46-3" href="#08-kustomization-__codelineno-46-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-46-4"><a id="__codelineno-46-4" name="__codelineno-46-4" href="#08-kustomization-__codelineno-46-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-46-5"><a id="__codelineno-46-5" name="__codelineno-46-5" href="#08-kustomization-__codelineno-46-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-46-6"><a id="__codelineno-46-6" name="__codelineno-46-6" href="#08-kustomization-__codelineno-46-6"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-46-7"><a id="__codelineno-46-7" name="__codelineno-46-7" href="#08-kustomization-__codelineno-46-7"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-46-8"><a id="__codelineno-46-8" name="__codelineno-46-8" href="#08-kustomization-__codelineno-46-8"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-46-9"><a id="__codelineno-46-9" name="__codelineno-46-9" href="#08-kustomization-__codelineno-46-9"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-46-10"><a id="__codelineno-46-10" name="__codelineno-46-10" href="#08-kustomization-__codelineno-46-10"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-46-11"><a id="__codelineno-46-11" name="__codelineno-46-11" href="#08-kustomization-__codelineno-46-11"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-46-12"><a id="__codelineno-46-12" name="__codelineno-46-12" href="#08-kustomization-__codelineno-46-12"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span><span id="__span-46-13"><a id="__codelineno-46-13" name="__codelineno-46-13" href="#08-kustomization-__codelineno-46-13"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-46-14"><a id="__codelineno-46-14" name="__codelineno-46-14" href="#08-kustomization-__codelineno-46-14"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-46-15"><a id="__codelineno-46-15" name="__codelineno-46-15" href="#08-kustomization-__codelineno-46-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">args</span><span class="p">:</span>
</span><span id="__span-46-16"><a id="__codelineno-46-16" name="__codelineno-46-16" href="#08-kustomization-__codelineno-46-16"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">one</span>
</span><span id="__span-46-17"><a id="__codelineno-46-17" name="__codelineno-46-17" href="#08-kustomization-__codelineno-46-17"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">two</span>
</span><span id="__span-46-18"><a id="__codelineno-46-18" name="__codelineno-46-18" href="#08-kustomization-__codelineno-46-18"></a><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span><span id="__span-46-19"><a id="__codelineno-46-19" name="__codelineno-46-19" href="#08-kustomization-__codelineno-46-19"></a><span class="w">        </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp</span>
</span></code></pre></div></section><section class="print-page" id="09-statefulset" heading-number="2.11"><h1 id="09-statefulset-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#09-statefulset-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="09-statefulset-statefulsets">StatefulSets<a class="headerlink" href="#09-statefulset-statefulsets" title="Permanent link">&para;</a></h2>
<p><img src="../assets/images/statefulSet.png" width=500></p>
<h2 id="09-statefulset-the-difference-between-a-statefulset-and-a-deployment">The Difference Between a <code>Statefulset</code> And a <code>Deployment</code><a class="headerlink" href="#09-statefulset-the-difference-between-a-statefulset-and-a-deployment" title="Permanent link">&para;</a></h2>
<h4 id="09-statefulset-stateless-application"><code>Stateless</code> application<a class="headerlink" href="#09-statefulset-stateless-application" title="Permanent link">&para;</a></h4>
<ul>
<li>A stateless application is one that does not care which network it is using, and it does not need permanent storage and can be scaled up and down without the need to re-use the same network or persistence.</li>
<li>Deployment is the suitable kind for Stateless applications.</li>
<li>The most trivial example of stateless app is a <code>Web Server</code>.</li>
</ul>
<h4 id="09-statefulset-stateful-application"><code>Stateful</code> application<a class="headerlink" href="#09-statefulset-stateful-application" title="Permanent link">&para;</a></h4>
<ul>
<li>Stateful applications are apps which in order to work properly need to use the same resources, such as network, storage etc.</li>
<li>Usually with <code>Stateful</code> applications you will need to ensure that pods can reach each other through a <strong>unique identity that does not change</strong> (e.g., hostnames, IP).</li>
<li>The most trivial example of Stateful app is a database of any kind.</li>
</ul>
<hr />
<div class="admonition warning">
<p class="admonition-title">Stateful Notes</p>
<ul>
<li>Like a Deployment, a <code>StatefulSet</code> manages Pods that are based on an <strong>identical container spec</strong>.</li>
<li>Unlike a Deployment, <strong>a <code>StatefulSet</code> maintains a sticky identity for each of their Pods</strong>.</li>
<li>These pods are created from the same spec, but are not interchangeable: each has a persistent identifier that it maintains across any rescheduling.</li>
<li>Deleting and/or scaling down a <code>StatefulSet</code> will not delete the volumes associated with the <code>StatefulSet</code>. This is done to ensure data safety.</li>
<li><code>StatefulSet</code> keeps a unique identity for each Pod and assign the same identity to those pods when they are rescheduled (update, restart etc).</li>
<li>The storage for a given Pod must either be provisioned by a <code>PersistentVolume</code> provisioner, based on the requested storage class, or pre-provisioned by an admin.</li>
<li><code>StatefulSet</code> manages the deployment and scaling of a set of Pods, and <strong>provides guarantees about the ordering and uniqueness of these Pods</strong>.</li>
<li>A <code>stateful</code> app needs to use a dedicated storage.</li>
</ul>
</div>
<hr />
<h3 id="09-statefulset-stable-network-identity">Stable Network Identity<a class="headerlink" href="#09-statefulset-stable-network-identity" title="Permanent link">&para;</a></h3>
<ul>
<li>A <code>Stateful</code> application node <strong>must</strong> have a unique hostname and IP address so that other nodes in the same application know how to reach it.</li>
<li>A <code>ReplicaSet</code> assign <strong>a random hostname and IP address</strong> to each Pod. In such a case, we must use a service which exposes those Pods for us.</li>
</ul>
<h3 id="09-statefulset-start-and-termination-order">Start and Termination Order<a class="headerlink" href="#09-statefulset-start-and-termination-order" title="Permanent link">&para;</a></h3>
<ul>
<li>Each <code>StatefulSet</code> follows this naming pattern: <code>$(statefulSet name)-$(ordinal)</code></li>
<li><code>Stateful</code> applications restarted or re-created, following the creation order.</li>
<li>A <code>ReplicaSet</code> does not follow a specific order when starting or killing its pods.</li>
</ul>
<h3 id="09-statefulset-statefulset-volumes">StatefulSet Volumes<a class="headerlink" href="#09-statefulset-statefulset-volumes" title="Permanent link">&para;</a></h3>
<ul>
<li><code>StatefulSet</code> <strong>does not create a volume for you</strong>.</li>
<li>When a <code>StatefulSet</code> is deleted, the respective volumes <strong>are not deleted with it</strong>.</li>
</ul>
<hr />
<h3 id="09-statefulset-to-address-all-these-requirements-kubernetes-offers-the-statefulset-primitive">To address all these requirements, Kubernetes offers the <code>StatefulSet primitive</code>.<a class="headerlink" href="#09-statefulset-to-address-all-these-requirements-kubernetes-offers-the-statefulset-primitive" title="Permanent link">&para;</a></h3>
<hr />
<h3 id="09-statefulset-prerequisites">Prerequisites<a class="headerlink" href="#09-statefulset-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>K8S cluster - <a href="#00-verifycluster">Setting up minikube cluster instruction</a></li>
</ul>
<p><a href="https://ide.cloud.google.com/?cloudshell_git_repo=https://github.com/nirgeier/KubernetesLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a><br />
<strong><kbd>CTRL</kbd> + <kbd>click</kbd> to open in new window</strong></p>
<hr />
<h3 id="09-statefulset-step-01-create-namespace-and-clear-previous-data-if-there-is-any">Step 01 - Create namespace and clear previous data if there is any<a class="headerlink" href="#09-statefulset-step-01-create-namespace-and-clear-previous-data-if-there-is-any" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#09-statefulset-__codelineno-0-1"></a><span class="c1"># If the namespace already exist and contains data form previous steps, lets clean it</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#09-statefulset-__codelineno-0-2"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>namespace<span class="w"> </span>codewizard
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#09-statefulset-__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#09-statefulset-__codelineno-0-4"></a><span class="c1"># Create the desired namespace [codewizard]</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#09-statefulset-__codelineno-0-5"></a>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>codewizard
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#09-statefulset-__codelineno-1-1"></a>namespace/codewizard created
</span></code></pre></div>
</div>
<h3 id="09-statefulset-step-02-create-and-test-the-stateful-application">Step 02 - Create and test the Stateful application<a class="headerlink" href="#09-statefulset-step-02-create-and-test-the-stateful-application" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>In order to deploy the Stateful set we will need the following resources:</p>
</li>
<li>
<p><code>ConfigMap</code></p>
</li>
<li><code>Service</code></li>
<li><code>StatefulSet</code></li>
<li>
<p><code>PersistentVolumeClaim</code> or <code>PersistentVolume</code></p>
</li>
<li>
<p>All the resources including <code>kustomization</code> script are defined inside the base folder</p>
</li>
</ul>
<hr />
<ul>
<li><a href="../09-StatefulSet/PostgreSQL/base/ConfigMap.yaml">ConfigMap.yaml</a></li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#09-statefulset-__codelineno-2-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#09-statefulset-__codelineno-2-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#09-statefulset-__codelineno-2-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#09-statefulset-__codelineno-2-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres-config</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#09-statefulset-__codelineno-2-5"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#09-statefulset-__codelineno-2-6"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#09-statefulset-__codelineno-2-7"></a><span class="nt">data</span><span class="p">:</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#09-statefulset-__codelineno-2-8"></a><span class="w">  </span><span class="c1"># The following names are the one defined in the official postgres docs</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#09-statefulset-__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#09-statefulset-__codelineno-2-10"></a><span class="w">  </span><span class="c1"># The name of the database we will use in this demo</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#09-statefulset-__codelineno-2-11"></a><span class="w">  </span><span class="nt">POSTGRES_DB</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codewizard</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#09-statefulset-__codelineno-2-12"></a><span class="w">  </span><span class="c1"># the user name for this demo</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#09-statefulset-__codelineno-2-13"></a><span class="w">  </span><span class="nt">POSTGRES_USER</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codewizard</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#09-statefulset-__codelineno-2-14"></a><span class="w">  </span><span class="c1"># The password for this demo</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#09-statefulset-__codelineno-2-15"></a><span class="w">  </span><span class="nt">POSTGRES_PASSWORD</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">admin123</span>
</span></code></pre></div>
<ul>
<li>
<p><a href="../09-StatefulSet/PostgreSQL/base/Service.yaml">Service.yaml</a>
  <div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#09-statefulset-__codelineno-3-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#09-statefulset-__codelineno-3-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Service</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#09-statefulset-__codelineno-3-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#09-statefulset-__codelineno-3-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#09-statefulset-__codelineno-3-5"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#09-statefulset-__codelineno-3-6"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
</span><span id="__span-3-7"><a id="__codelineno-3-7" name="__codelineno-3-7" href="#09-statefulset-__codelineno-3-7"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-3-8"><a id="__codelineno-3-8" name="__codelineno-3-8" href="#09-statefulset-__codelineno-3-8"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-3-9"><a id="__codelineno-3-9" name="__codelineno-3-9" href="#09-statefulset-__codelineno-3-9"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
</span><span id="__span-3-10"><a id="__codelineno-3-10" name="__codelineno-3-10" href="#09-statefulset-__codelineno-3-10"></a><span class="w">  </span><span class="c1"># Service of type nodeport</span>
</span><span id="__span-3-11"><a id="__codelineno-3-11" name="__codelineno-3-11" href="#09-statefulset-__codelineno-3-11"></a><span class="w">  </span><span class="nt">type</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">NodePort</span>
</span><span id="__span-3-12"><a id="__codelineno-3-12" name="__codelineno-3-12" href="#09-statefulset-__codelineno-3-12"></a><span class="w">  </span><span class="c1"># The default port for postgres</span>
</span><span id="__span-3-13"><a id="__codelineno-3-13" name="__codelineno-3-13" href="#09-statefulset-__codelineno-3-13"></a><span class="w">  </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-3-14"><a id="__codelineno-3-14" name="__codelineno-3-14" href="#09-statefulset-__codelineno-3-14"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
</span></code></pre></div></p>
</li>
<li>
<p><a href="../09-StatefulSet/PostgreSQL/base/PersistentVolumeClaim.yaml">PersistentVolumeClaim.yaml</a></p>
</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#09-statefulset-__codelineno-4-1"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PersistentVolumeClaim</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#09-statefulset-__codelineno-4-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#09-statefulset-__codelineno-4-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#09-statefulset-__codelineno-4-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres-pv-claim</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#09-statefulset-__codelineno-4-5"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#09-statefulset-__codelineno-4-6"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#09-statefulset-__codelineno-4-7"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#09-statefulset-__codelineno-4-8"></a><span class="w">  </span><span class="c1"># in this demo we use GCP so we are using the &#39;standard&#39; StorageClass</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#09-statefulset-__codelineno-4-9"></a><span class="w">  </span><span class="c1"># We can of course define our own StorageClass resource</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#09-statefulset-__codelineno-4-10"></a><span class="w">  </span><span class="nt">storageClassName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">standard</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#09-statefulset-__codelineno-4-11"></a>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#09-statefulset-__codelineno-4-12"></a><span class="w">  </span><span class="c1"># The access modes are:</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#09-statefulset-__codelineno-4-13"></a><span class="w">  </span><span class="c1">#   ReadWriteOnce - The volume can be mounted as read-write by a single node</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#09-statefulset-__codelineno-4-14"></a><span class="w">  </span><span class="c1">#   ReadWriteMany - The volume can be mounted as read-write by a many node</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#09-statefulset-__codelineno-4-15"></a><span class="w">  </span><span class="c1">#   ReadOnlyMany  - The volume can be mounted as read-only  by many nodes</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#09-statefulset-__codelineno-4-16"></a><span class="w">  </span><span class="nt">accessModes</span><span class="p">:</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#09-statefulset-__codelineno-4-17"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ReadWriteMany</span>
</span><span id="__span-4-18"><a id="__codelineno-4-18" name="__codelineno-4-18" href="#09-statefulset-__codelineno-4-18"></a><span class="w">  </span><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-4-19"><a id="__codelineno-4-19" name="__codelineno-4-19" href="#09-statefulset-__codelineno-4-19"></a><span class="w">    </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-4-20"><a id="__codelineno-4-20" name="__codelineno-4-20" href="#09-statefulset-__codelineno-4-20"></a><span class="w">      </span><span class="nt">storage</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1Gi</span>
</span></code></pre></div>
<ul>
<li><a href="../09-StatefulSet/PostgreSQL/base/StatefulSet.yaml">StatefulSet.yaml</a></li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#09-statefulset-__codelineno-5-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#09-statefulset-__codelineno-5-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">StatefulSet</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#09-statefulset-__codelineno-5-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#09-statefulset-__codelineno-5-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#09-statefulset-__codelineno-5-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#09-statefulset-__codelineno-5-6"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#09-statefulset-__codelineno-5-7"></a><span class="w">  </span><span class="c1"># StatefulSet must contain a serviceName</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#09-statefulset-__codelineno-5-8"></a><span class="w">  </span><span class="nt">serviceName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#09-statefulset-__codelineno-5-9"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#09-statefulset-__codelineno-5-10"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#09-statefulset-__codelineno-5-11"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span><span class="w"> </span><span class="c1"># has to match .spec.template.metadata.labels</span>
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#09-statefulset-__codelineno-5-12"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#09-statefulset-__codelineno-5-13"></a><span class="w">    </span><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#09-statefulset-__codelineno-5-14"></a><span class="w">      </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#09-statefulset-__codelineno-5-15"></a><span class="w">        </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span><span class="w"> </span><span class="c1"># has to match .spec.selector.matchLabels</span>
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#09-statefulset-__codelineno-5-16"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#09-statefulset-__codelineno-5-17"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#09-statefulset-__codelineno-5-18"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres</span>
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#09-statefulset-__codelineno-5-19"></a><span class="w">          </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres:10.4</span>
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#09-statefulset-__codelineno-5-20"></a><span class="w">          </span><span class="nt">imagePullPolicy</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;IfNotPresent&quot;</span>
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#09-statefulset-__codelineno-5-21"></a><span class="w">          </span><span class="c1"># The default DB port</span>
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#09-statefulset-__codelineno-5-22"></a><span class="w">          </span><span class="nt">ports</span><span class="p">:</span>
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#09-statefulset-__codelineno-5-23"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">containerPort</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">5432</span>
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#09-statefulset-__codelineno-5-24"></a><span class="w">          </span><span class="c1"># Load the required configuration env values form the configMap</span>
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#09-statefulset-__codelineno-5-25"></a><span class="w">          </span><span class="nt">envFrom</span><span class="p">:</span>
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#09-statefulset-__codelineno-5-26"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">configMapRef</span><span class="p">:</span>
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#09-statefulset-__codelineno-5-27"></a><span class="w">                </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres-config</span>
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#09-statefulset-__codelineno-5-28"></a><span class="w">          </span><span class="c1"># Use volume for storage</span>
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#09-statefulset-__codelineno-5-29"></a><span class="w">          </span><span class="nt">volumeMounts</span><span class="p">:</span>
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#09-statefulset-__codelineno-5-30"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">mountPath</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/var/lib/postgresql/data</span>
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#09-statefulset-__codelineno-5-31"></a><span class="w">              </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgredb</span>
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#09-statefulset-__codelineno-5-32"></a><span class="w">      </span><span class="c1"># We can use PersistentVolume or PersistentVolumeClaim.</span>
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#09-statefulset-__codelineno-5-33"></a><span class="w">      </span><span class="c1"># In this sample we are useing PersistentVolumeClaim</span>
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#09-statefulset-__codelineno-5-34"></a><span class="w">      </span><span class="nt">volumes</span><span class="p">:</span>
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#09-statefulset-__codelineno-5-35"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgredb</span>
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#09-statefulset-__codelineno-5-36"></a><span class="w">          </span><span class="nt">persistentVolumeClaim</span><span class="p">:</span>
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#09-statefulset-__codelineno-5-37"></a><span class="w">            </span><span class="c1"># reference to Pre-Define PVC</span>
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38" href="#09-statefulset-__codelineno-5-38"></a><span class="w">            </span><span class="nt">claimName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">postgres-pv-claim</span>
</span></code></pre></div>
<p><strong>Note</strong>: You can use the kustomization file to create or apply all the above resources</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#09-statefulset-__codelineno-6-1"></a><span class="c1"># Generate and apply the required resources using kustomization</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#09-statefulset-__codelineno-6-2"></a>kubectl<span class="w"> </span>kustomize<span class="w"> </span>PostgreSQL/<span class="w"> </span><span class="p">|</span><span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>-
</span></code></pre></div>
<hr />
<h3 id="09-statefulset-step-03-test-the-stateful-application">Step 03 - Test the Stateful application<a class="headerlink" href="#09-statefulset-step-03-test-the-stateful-application" title="Permanent link">&para;</a></h3>
<ul>
<li>Use the - <a href="../09-StatefulSet/PostgreSQL/testDB.sh">testDB.sh</a> to test the StatefulSet</li>
<li>Don&rsquo;t forget to set the execution flag <code>chmod +x testDb.sh</code> if required</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#09-statefulset-__codelineno-7-1"></a><span class="c1">### Test to see if the StatefulSet &quot;saves&quot; the state of the pods</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#09-statefulset-__codelineno-7-2"></a>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#09-statefulset-__codelineno-7-3"></a><span class="c1"># Programmatically get the port and the IP</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#09-statefulset-__codelineno-7-4"></a><span class="nb">export</span><span class="w"> </span><span class="nv">CLUSTER_IP</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>nodes<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#09-statefulset-__codelineno-7-5"></a><span class="w">            </span>--selector<span class="o">=</span>node-role.kubernetes.io/control-plane<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#09-statefulset-__codelineno-7-6"></a><span class="w">            </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{$.items[*].status.addresses[?(@.type==&quot;InternalIP&quot;)].address}&#39;</span><span class="k">)</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#09-statefulset-__codelineno-7-7"></a>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#09-statefulset-__codelineno-7-8"></a><span class="nb">export</span><span class="w"> </span><span class="nv">NODE_PORT</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-9"><a id="__codelineno-7-9" name="__codelineno-7-9" href="#09-statefulset-__codelineno-7-9"></a><span class="w">            </span>services<span class="w"> </span>postgres<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-10"><a id="__codelineno-7-10" name="__codelineno-7-10" href="#09-statefulset-__codelineno-7-10"></a><span class="w">            </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.spec.ports[0].nodePort}&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-11"><a id="__codelineno-7-11" name="__codelineno-7-11" href="#09-statefulset-__codelineno-7-11"></a><span class="w">            </span>-n<span class="w"> </span>codewizard<span class="k">)</span>
</span><span id="__span-7-12"><a id="__codelineno-7-12" name="__codelineno-7-12" href="#09-statefulset-__codelineno-7-12"></a>
</span><span id="__span-7-13"><a id="__codelineno-7-13" name="__codelineno-7-13" href="#09-statefulset-__codelineno-7-13"></a><span class="nb">export</span><span class="w"> </span><span class="nv">POSTGRES_DB</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-14"><a id="__codelineno-7-14" name="__codelineno-7-14" href="#09-statefulset-__codelineno-7-14"></a><span class="w">            </span>configmap<span class="w"> </span>postgres-config<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-15"><a id="__codelineno-7-15" name="__codelineno-7-15" href="#09-statefulset-__codelineno-7-15"></a><span class="w">            </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.POSTGRES_DB}&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-16"><a id="__codelineno-7-16" name="__codelineno-7-16" href="#09-statefulset-__codelineno-7-16"></a><span class="w">            </span>-n<span class="w"> </span>codewizard<span class="k">)</span>
</span><span id="__span-7-17"><a id="__codelineno-7-17" name="__codelineno-7-17" href="#09-statefulset-__codelineno-7-17"></a>
</span><span id="__span-7-18"><a id="__codelineno-7-18" name="__codelineno-7-18" href="#09-statefulset-__codelineno-7-18"></a><span class="nb">export</span><span class="w"> </span><span class="nv">POSTGRES_USER</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-19"><a id="__codelineno-7-19" name="__codelineno-7-19" href="#09-statefulset-__codelineno-7-19"></a><span class="w">            </span>configmap<span class="w"> </span>postgres-config<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-20"><a id="__codelineno-7-20" name="__codelineno-7-20" href="#09-statefulset-__codelineno-7-20"></a><span class="w">            </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.POSTGRES_USER}&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-21"><a id="__codelineno-7-21" name="__codelineno-7-21" href="#09-statefulset-__codelineno-7-21"></a><span class="w">            </span>-n<span class="w"> </span>codewizard<span class="k">)</span>
</span><span id="__span-7-22"><a id="__codelineno-7-22" name="__codelineno-7-22" href="#09-statefulset-__codelineno-7-22"></a>
</span><span id="__span-7-23"><a id="__codelineno-7-23" name="__codelineno-7-23" href="#09-statefulset-__codelineno-7-23"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PGPASSWORD</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-24"><a id="__codelineno-7-24" name="__codelineno-7-24" href="#09-statefulset-__codelineno-7-24"></a><span class="w">            </span>configmap<span class="w"> </span>postgres-config<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-25"><a id="__codelineno-7-25" name="__codelineno-7-25" href="#09-statefulset-__codelineno-7-25"></a><span class="w">            </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.POSTGRES_PASSWORD}&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-26"><a id="__codelineno-7-26" name="__codelineno-7-26" href="#09-statefulset-__codelineno-7-26"></a><span class="w">            </span>-n<span class="w"> </span>codewizard<span class="k">)</span>
</span><span id="__span-7-27"><a id="__codelineno-7-27" name="__codelineno-7-27" href="#09-statefulset-__codelineno-7-27"></a>
</span><span id="__span-7-28"><a id="__codelineno-7-28" name="__codelineno-7-28" href="#09-statefulset-__codelineno-7-28"></a><span class="c1"># Check to see if we have all the required variables</span>
</span><span id="__span-7-29"><a id="__codelineno-7-29" name="__codelineno-7-29" href="#09-statefulset-__codelineno-7-29"></a>printenv<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>POST*
</span><span id="__span-7-30"><a id="__codelineno-7-30" name="__codelineno-7-30" href="#09-statefulset-__codelineno-7-30"></a>
</span><span id="__span-7-31"><a id="__codelineno-7-31" name="__codelineno-7-31" href="#09-statefulset-__codelineno-7-31"></a><span class="c1"># Connect to postgres and create table if required.</span>
</span><span id="__span-7-32"><a id="__codelineno-7-32" name="__codelineno-7-32" href="#09-statefulset-__codelineno-7-32"></a><span class="c1"># Once the table exists - add row into the table</span>
</span><span id="__span-7-33"><a id="__codelineno-7-33" name="__codelineno-7-33" href="#09-statefulset-__codelineno-7-33"></a><span class="c1"># you can run this command as many times as you like</span>
</span><span id="__span-7-34"><a id="__codelineno-7-34" name="__codelineno-7-34" href="#09-statefulset-__codelineno-7-34"></a>psql<span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-35"><a id="__codelineno-7-35" name="__codelineno-7-35" href="#09-statefulset-__codelineno-7-35"></a><span class="w">    </span>-U<span class="w"> </span><span class="si">${</span><span class="nv">POSTGRES_USER</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-36"><a id="__codelineno-7-36" name="__codelineno-7-36" href="#09-statefulset-__codelineno-7-36"></a><span class="w">    </span>-h<span class="w"> </span><span class="si">${</span><span class="nv">CLUSTER_IP</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-37"><a id="__codelineno-7-37" name="__codelineno-7-37" href="#09-statefulset-__codelineno-7-37"></a><span class="w">    </span>-d<span class="w"> </span><span class="si">${</span><span class="nv">POSTGRES_DB</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-38"><a id="__codelineno-7-38" name="__codelineno-7-38" href="#09-statefulset-__codelineno-7-38"></a><span class="w">    </span>-p<span class="w"> </span><span class="si">${</span><span class="nv">NODE_PORT</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-7-39"><a id="__codelineno-7-39" name="__codelineno-7-39" href="#09-statefulset-__codelineno-7-39"></a><span class="w">    </span>-c<span class="w"> </span><span class="s2">&quot;CREATE TABLE IF NOT EXISTS stateful (str VARCHAR); INSERT INTO stateful values (1); SELECT count(*) FROM stateful&quot;</span>
</span></code></pre></div>
<h3 id="09-statefulset-step-04-scale-down-the-statefulset-and-check-that-its-down">Step 04 - Scale down the StatefulSet and check that its down<a class="headerlink" href="#09-statefulset-step-04-scale-down-the-statefulset-and-check-that-its-down" title="Permanent link">&para;</a></h3>
<h4 id="09-statefulset-0401-scale-down-the-statefulset-to-0">04.01. Scale down the <code>Statefulset</code> to 0<a class="headerlink" href="#09-statefulset-0401-scale-down-the-statefulset-to-0" title="Permanent link">&para;</a></h4>
<p><strong>Scale down the <code>Statefulset</code> to 0</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#09-statefulset-__codelineno-8-1"></a>kubectl<span class="w"> </span>scale<span class="w"> </span>statefulset<span class="w"> </span>postgres<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>--replicas<span class="o">=</span><span class="m">0</span>
</span></code></pre></div></p>
<h4 id="09-statefulset-0402-verify-that-the-pods-terminated">04.02. Verify that the pods Terminated<a class="headerlink" href="#09-statefulset-0402-verify-that-the-pods-terminated" title="Permanent link">&para;</a></h4>
<p><strong>Wait until the pods will be terminated</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#09-statefulset-__codelineno-9-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>--watch
</span></code></pre></div></p>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#09-statefulset-__codelineno-10-1"></a>NAME         READY   STATUS    RESTARTS   AGE
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#09-statefulset-__codelineno-10-2"></a>postgres-0   1/1     Running   0          32m
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#09-statefulset-__codelineno-10-3"></a>postgres-0   1/1     Terminating   0      32m
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#09-statefulset-__codelineno-10-4"></a>postgres-0   0/1     Terminating   0      32m
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#09-statefulset-__codelineno-10-5"></a>postgres-0   0/1     Terminating   0      33m
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#09-statefulset-__codelineno-10-6"></a>postgres-0   0/1     Terminating   0      33m
</span></code></pre></div>
</div>
<h3 id="09-statefulset-0403-verify-that-the-db-is-not-reachable">04.03. Verify that the DB is not reachable<a class="headerlink" href="#09-statefulset-0403-verify-that-the-db-is-not-reachable" title="Permanent link">&para;</a></h3>
<ul>
<li>If the DB is not reachable it mean that all the pods are down</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#09-statefulset-__codelineno-11-1"></a>psql<span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#09-statefulset-__codelineno-11-2"></a><span class="w">    </span>-U<span class="w"> </span><span class="si">${</span><span class="nv">POSTGRES_USER</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#09-statefulset-__codelineno-11-3"></a><span class="w">    </span>-h<span class="w"> </span><span class="si">${</span><span class="nv">CLUSTER_IP</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#09-statefulset-__codelineno-11-4"></a><span class="w">    </span>-d<span class="w"> </span><span class="si">${</span><span class="nv">POSTGRES_DB</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#09-statefulset-__codelineno-11-5"></a><span class="w">    </span>-p<span class="w"> </span><span class="si">${</span><span class="nv">NODE_PORT</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-11-6"><a id="__codelineno-11-6" name="__codelineno-11-6" href="#09-statefulset-__codelineno-11-6"></a><span class="w">    </span>-c<span class="w"> </span><span class="s2">&quot;SELECT count(*) FROM stateful&quot;</span>
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#09-statefulset-__codelineno-12-1"></a>psql: error: could not connect to server: Connection refused
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#09-statefulset-__codelineno-12-2"></a>        Is the server running on host &quot;192.168.49.2&quot; and accepting
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#09-statefulset-__codelineno-12-3"></a>        TCP/IP connections on port 32570?
</span></code></pre></div>
</div>
<h3 id="09-statefulset-step-05-scale-up-again-and-verify-that-we-still-have-the-previous-data">Step 05 - Scale up again and verify that we still have the previous data<a class="headerlink" href="#09-statefulset-step-05-scale-up-again-and-verify-that-we-still-have-the-previous-data" title="Permanent link">&para;</a></h3>
<h4 id="09-statefulset-0501-scale-up-the-statefulset-to-1-or-more">05.01. scale up the <code>Statefulset</code> to 1 or more<a class="headerlink" href="#09-statefulset-0501-scale-up-the-statefulset-to-1-or-more" title="Permanent link">&para;</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#09-statefulset-__codelineno-13-1"></a><span class="c1"># scale up the `Statefulset`</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#09-statefulset-__codelineno-13-2"></a>kubectl<span class="w"> </span>scale<span class="w"> </span>statefulset<span class="w"> </span>postgres<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>--replicas<span class="o">=</span><span class="m">1</span>
</span></code></pre></div>
<h4 id="09-statefulset-0502-verify-that-the-pods-is-in-running-status">05.02. Verify that the pods is in Running status<a class="headerlink" href="#09-statefulset-0502-verify-that-the-pods-is-in-running-status" title="Permanent link">&para;</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#09-statefulset-__codelineno-14-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span>--watch
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#09-statefulset-__codelineno-15-1"></a>NAME         READY   STATUS    RESTARTS   AGE
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#09-statefulset-__codelineno-15-2"></a>postgres-0   1/1     Running   0          5s
</span></code></pre></div>
</div>
<h4 id="09-statefulset-0503-verify-that-the-pods-is-using-the-previous-data">05.03. Verify that the pods is using the previous data<a class="headerlink" href="#09-statefulset-0503-verify-that-the-pods-is-using-the-previous-data" title="Permanent link">&para;</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#09-statefulset-__codelineno-16-1"></a>psql<span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#09-statefulset-__codelineno-16-2"></a><span class="w">    </span>-U<span class="w"> </span><span class="si">${</span><span class="nv">POSTGRES_USER</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#09-statefulset-__codelineno-16-3"></a><span class="w">    </span>-h<span class="w"> </span><span class="si">${</span><span class="nv">CLUSTER_IP</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#09-statefulset-__codelineno-16-4"></a><span class="w">    </span>-d<span class="w"> </span><span class="si">${</span><span class="nv">POSTGRES_DB</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#09-statefulset-__codelineno-16-5"></a><span class="w">    </span>-p<span class="w"> </span><span class="si">${</span><span class="nv">NODE_PORT</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#09-statefulset-__codelineno-16-6"></a><span class="w">    </span>-c<span class="w"> </span><span class="s2">&quot;SELECT count(*) FROM stateful&quot;</span>
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#09-statefulset-__codelineno-17-1"></a> count
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#09-statefulset-__codelineno-17-2"></a>-------
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#09-statefulset-__codelineno-17-3"></a>     2
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#09-statefulset-__codelineno-17-4"></a>(1 row)
</span></code></pre></div>
</div></section><section class="print-page" id="10-istio" heading-number="2.12"><h1 id="10-istio-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#10-istio-k8s-hands-on" title="Permanent link">&para;</a></h1>
<h1 id="10-istio-k8s-hands-on_1">K8S Hands-on<a class="headerlink" href="#10-istio-k8s-hands-on_1" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="10-istio-istio">Istio<a class="headerlink" href="#10-istio-istio" title="Permanent link">&para;</a></h2>
<p>Istio is an open-source service mesh that provides a way to manage microservices traffic, security, and observability in a Kubernetes cluster.</p>
<hr />
<h3 id="10-istio-prerequisites">Prerequisites<a class="headerlink" href="#10-istio-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://helm.sh/docs/intro/install/">Helm</a> installed</li>
<li>K8S cluster - <a href="#00-verifycluster">Setting up minikube cluster instruction</a></li>
<li><a href="https://kubernetes.io/docs/tasks/tools/"><strong>kubectl</strong></a> configured to interact with your cluster</li>
</ul>
<p><a href="https://ide.cloud.google.com/?cloudshell_git_repo=https://github.com/nirgeier/KubernetesLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a></p>
<h3 id="10-istio-ctrl-click-to-open-in-new-window"><strong><kbd>CTRL</kbd> + <kbd>click</kbd> to open in new window</strong><a class="headerlink" href="#10-istio-ctrl-click-to-open-in-new-window" title="Permanent link">&para;</a></h3>
<hr />
<h2 id="10-istio-istio-and-kiali">Istio and Kiali<a class="headerlink" href="#10-istio-istio-and-kiali" title="Permanent link">&para;</a></h2>
<ul>
<li>This guide provides a detailed walkthrough on installing and configuring <strong>Istio</strong>  and <strong>Kiali</strong>  on a Kubernetes cluster. </li>
<li>We will also learn how to visualize your service mesh with Istio and Kiali and create a demo <strong>Istio VirtualService</strong>.</li>
</ul>
<hr />
<h3 id="10-istio-introduction">Introduction<a class="headerlink" href="#10-istio-introduction" title="Permanent link">&para;</a></h3>
<h3 id="10-istio-istio_1"><code>Istio</code><a class="headerlink" href="#10-istio-istio_1" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Istio</strong>  is an open-source <strong>service mesh</strong> that provides a way to manage microservices traffic, security, and observability in a Kubernetes cluster. </li>
<li>It acts as a layer of infrastructure that sits between your services, <strong>intercepting and controlling the traffic</strong> between them. </li>
<li>Istio key features: </li>
</ul>
<table>
<thead>
<tr>
<th><strong>Feature</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Traffic Management</strong></td>
<td>Istio enables sophisticated traffic control capabilities, such as routing, load balancing, retries, timeouts, and circuit breakers for microservices.</td>
</tr>
<tr>
<td><strong>Service Discovery</strong></td>
<td>Automatically discovers services in the mesh, enabling dynamic routing and management of microservices without the need for manual configuration.</td>
</tr>
<tr>
<td><strong>Load Balancing</strong></td>
<td>Istio provides various load balancing algorithms (round-robin, weighted, etc.) to distribute traffic between microservices, ensuring optimal performance.</td>
</tr>
<tr>
<td><strong>Traffic Shaping</strong></td>
<td>Allows fine-grained control of traffic between services, such as A/B testing, canary releases, or blue/green deployments by defining routing rules.</td>
</tr>
<tr>
<td><strong>Fault Injection</strong></td>
<td>Supports fault injection to simulate network failures, latency, or errors in microservices to test resilience and robustness of the application.</td>
</tr>
<tr>
<td><strong>Mutual TLS (mTLS)</strong></td>
<td>Istio can automatically encrypt traffic between services using mutual TLS (mTLS) to ensure secure communication and provide strong identity-based access control.</td>
</tr>
<tr>
<td><strong>Authentication &amp; Authorization</strong></td>
<td>Provides identity and access management through role-based access control (RBAC) and integration with external identity providers (e.g., OAuth, JWT).</td>
</tr>
<tr>
<td><strong>Telemetry &amp; Observability</strong></td>
<td>Istio collects metrics, logs, and traces for monitoring service&rsquo;s performance and behavior. It integrates with tools like Prometheus, Grafana, and Jaeger.</td>
</tr>
<tr>
<td><strong>Distributed Tracing</strong></td>
<td>Istio integrates with tracing systems like <strong>Jaeger</strong> and <strong>Zipkin</strong> to provide end-to-end tracing for debugging and monitoring service interactions.</td>
</tr>
<tr>
<td><strong>Policy Enforcement</strong></td>
<td>Istio provides fine-grained control over traffic policies, such as rate limiting, quotas, and security policies, using its Policy and Telemetry components.</td>
</tr>
<tr>
<td><strong>Resilience &amp; Retries</strong></td>
<td>Istio can retry failed requests, set timeouts, and apply circuit breakers to prevent cascading failures and enhance the reliability of services.</td>
</tr>
<tr>
<td><strong>Sidecar Proxy (Envoy)</strong></td>
<td>Istio uses <strong>Envoy</strong> as a sidecar proxy to intercept and manage network traffic, providing a transparent proxy between microservices.</td>
</tr>
<tr>
<td><strong>Automatic Sidecar Injection</strong></td>
<td>Istio automatically injects the <strong>Envoy proxy</strong> into application pods via Kubernetes annotations, simplifying the management of service communication.</td>
</tr>
<tr>
<td><strong>Service Mesh Topology</strong></td>
<td>Visualizes and manages the network of microservices, allowing users to monitor how services interact with each other and troubleshoot issues.</td>
</tr>
<tr>
<td><strong>Canary Deployments</strong></td>
<td>Supports <strong>canary releases</strong> and traffic splitting, which allows gradual rollout of new versions of services for safe deployments and testing.</td>
</tr>
<tr>
<td><strong>Multi-cluster Support</strong></td>
<td>Istio supports a multi-cluster environment, allowing you to deploy services across different Kubernetes clusters while maintaining a unified service mesh.</td>
</tr>
<tr>
<td><strong>Integration with Existing Tools</strong></td>
<td>Istio integrates seamlessly with other tools such as <strong>Prometheus</strong>, <strong>Grafana</strong>, <strong>Jaeger</strong>, and <strong>Kiali</strong> for observability, monitoring, and tracing.</td>
</tr>
<tr>
<td><strong>Service-Level Agreements (SLAs)</strong></td>
<td>Provides mechanisms to define service-level objectives (SLOs) and monitor them, ensuring services meet expected performance and reliability standards.</td>
</tr>
</tbody>
</table>
<ul>
<li>Istio core components: </li>
</ul>
<table>
<thead>
<tr>
<th><strong>Components</strong></th>
<th><strong>Description</strong></th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>Envoy Proxy</strong></td>
<td>A sidecar proxy that intercepts traffic to and from microservices.</td>
</tr>
<tr>
<td><strong>Pilot</strong></td>
<td>Manages configuration and distributes traffic management rules.</td>
</tr>
<tr>
<td><strong>Mixer</strong></td>
<td>Provides policy enforcement and telemetry data collection.</td>
</tr>
<tr>
<td><strong>Citadel</strong></td>
<td>Handles security-related tasks like identity and certificate management.</td>
</tr>
</tbody>
</table>
<hr />
<h3 id="10-istio-kiali"><code>Kiali</code><a class="headerlink" href="#10-istio-kiali" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>Kiali</strong>  is a graphical user interface (GUI) for <code>Istio</code>. </li>
<li>It helps you visualize the service mesh and provides insights on how microservices are interacting with each other. </li>
<li>
<p><code>Kiali</code> integrates deeply with Istio, allowing you to view:</p>
<ul>
<li>The <strong>service mesh topology</strong>, showing services, traffic flow, and dependencies.</li>
<li>Metrics like request rates, latencies, and error rates.</li>
<li><strong>Distributed tracing</strong>  (if enabled) for better debugging and troubleshooting.</li>
<li><strong>Istio configuration</strong>  to visualize resources like VirtualServices, DestinationRules, and more.</li>
</ul>
</li>
<li>
<p><code>Kiali</code> simplifies the operation of <code>Istio</code> by offering an intuitive way to manage and visualize your service mesh.</p>
</li>
</ul>
<hr />
<h2 id="10-istio-part-01-installing-istio-and-kiali">Part 01 - Installing Istio and Kiali<a class="headerlink" href="#10-istio-part-01-installing-istio-and-kiali" title="Permanent link">&para;</a></h2>
<h3 id="10-istio-step-01-install-istio-using-istioctl">Step 01: Install Istio Using Istioctl<a class="headerlink" href="#10-istio-step-01-install-istio-using-istioctl" title="Permanent link">&para;</a></h3>
<ul>
<li>Istio supplies an installer</li>
<li>Go to the <a href="https://github.com/istio/istio/releases">Istio releases page</a> and download the latest version of Istio. </li>
<li>Alternatively, use <code>istioctl</code> to install Istio, as follows:</li>
</ul>
<p><strong>Install Istio using istioctl</strong>
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#10-istio-__codelineno-0-1"></a><span class="nb">echo</span><span class="w">  </span><span class="s2">&quot;Installing Istio...&quot;</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#10-istio-__codelineno-0-2"></a>curl<span class="w">  </span>-L<span class="w"> </span>https://istio.io/downloadIstio<span class="w"> </span><span class="p">|</span><span class="w"> </span>sh<span class="w"> </span>-
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#10-istio-__codelineno-0-3"></a><span class="nb">cd</span><span class="w">    </span>istio-*
</span></code></pre></div></p>
<p><strong>Add bin directory to your $PATH</strong>
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#10-istio-__codelineno-1-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">PATH</span><span class="o">=</span><span class="nv">$PWD</span>/bin:<span class="nv">$PATH</span>
</span></code></pre></div></p>
<p><strong>Install istio with all features enabled (demo profile)</strong>
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#10-istio-__codelineno-2-1"></a>istioctl<span class="w"> </span>install<span class="w"> </span>--set<span class="w"> </span><span class="nv">profile</span><span class="o">=</span>demo<span class="w"> </span>-y
</span></code></pre></div></p>
<h3 id="10-istio-step-02-verify-istio-installation">Step 02: Verify Istio installation<a class="headerlink" href="#10-istio-step-02-verify-istio-installation" title="Permanent link">&para;</a></h3>
<ul>
<li>Check the Istio system components in the <code>istio-system</code> namespace:</li>
</ul>
<p><strong>Verify Istio installation</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#10-istio-__codelineno-3-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>istio-system
</span></code></pre></div></p>
<ul>
<li>You should see several pods, including the Istio control plane components like: <ul>
<li><code>istiod</code></li>
<li><code>istio-ingressgateway</code></li>
<li><code>istio-egressgateway</code></li>
</ul>
</li>
</ul>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#10-istio-__codelineno-4-1"></a>NAME                                    READY   STATUS    RESTARTS   AGE
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#10-istio-__codelineno-4-2"></a>istio-egressgateway-684f5dc857-bzww6    1/1     Running   0          21m
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#10-istio-__codelineno-4-3"></a>istio-ingressgateway-6b5bd79c5c-9n8tg   1/1     Running   0          21m
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#10-istio-__codelineno-4-4"></a>istiod-68885d595-vv2ft                  1/1     Running   0          22m
</span></code></pre></div>
</div>
<h3 id="10-istio-step-03-install-kiali">Step 03: Install Kiali<a class="headerlink" href="#10-istio-step-03-install-kiali" title="Permanent link">&para;</a></h3>
<ul>
<li>We will install Kiali using Helm:</li>
</ul>
<p><strong>Add the Kiali Helm chart repository</strong>
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#10-istio-__codelineno-5-1"></a>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>kiali<span class="w"> </span>https://kiali.org/helm-charts
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#10-istio-__codelineno-5-2"></a>helm<span class="w"> </span>repo<span class="w"> </span>update
</span></code></pre></div></p>
<ul>
<li><strong>Install Kiali:</strong> </li>
</ul>
<p><strong>Install Kiali into the <code>istio-system</code> namespace</strong>
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#10-istio-__codelineno-6-1"></a><span class="c1"># this is the default namespace for Istio components</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#10-istio-__codelineno-6-2"></a><span class="c1"># Install Kiali with anonymous authentication</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#10-istio-__codelineno-6-3"></a>helm<span class="w"> </span>install<span class="w">  </span>kiali-server<span class="w">              </span><span class="se">\</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#10-istio-__codelineno-6-4"></a><span class="w">              </span>kiali/kiali-server<span class="w">        </span><span class="se">\</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#10-istio-__codelineno-6-5"></a><span class="w">              </span>--namespace<span class="w"> </span>istio-system<span class="w">  </span><span class="se">\</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#10-istio-__codelineno-6-6"></a><span class="w">              </span>--set<span class="w"> </span>auth.strategy<span class="o">=</span><span class="s2">&quot;anonymous&quot;</span>
</span></code></pre></div></p>
<h3 id="10-istio-step-04-verify-kiali-installation">Step 04: Verify Kiali installation<a class="headerlink" href="#10-istio-step-04-verify-kiali-installation" title="Permanent link">&para;</a></h3>
<ul>
<li>Once installed, check the status of <code>Kiali</code>:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#10-istio-__codelineno-7-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>istio-system
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#10-istio-__codelineno-8-1"></a>NAME                                    READY   STATUS    RESTARTS   AGE
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#10-istio-__codelineno-8-2"></a>istio-egressgateway-684f5dc857-bzww6    1/1     Running   0          28m
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#10-istio-__codelineno-8-3"></a>istio-ingressgateway-6b5bd79c5c-9n8tg   1/1     Running   0          28m
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#10-istio-__codelineno-8-4"></a>istiod-68885d595-vv2ft                  1/1     Running   0          28m
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#10-istio-__codelineno-8-5"></a>kiali-68ccc848b6-j4q28                  1/1     Running   0          27m
</span></code></pre></div>
</div>
<hr />
<h2 id="10-istio-part-02-viewing-the-network-with-istio">Part 02 - Viewing the Network with Istio<a class="headerlink" href="#10-istio-part-02-viewing-the-network-with-istio" title="Permanent link">&para;</a></h2>
<ul>
<li><code>Istio</code> uses a sidecar proxy model, where an envoy proxy is deployed alongside each microservice pod. </li>
<li>This proxy intercepts and manages traffic between the services.</li>
</ul>
<h3 id="10-istio-step-01-enable-istio-injection">Step 01: Enable Istio Injection<a class="headerlink" href="#10-istio-step-01-enable-istio-injection" title="Permanent link">&para;</a></h3>
<ul>
<li>You need to enable <strong>Istio sidecar injection</strong> for your Kubernetes namespace. </li>
<li>This will ensure that new pods in the <code>default</code> namespace will automatically have the envoy proxy sidecar injected.</li>
<li>For example, to enable injection in the <code>default</code> namespace:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#10-istio-__codelineno-9-1"></a>kubectl<span class="w"> </span>label<span class="w"> </span>namespace<span class="w"> </span>default<span class="w"> </span>istio-injection<span class="o">=</span>enabled
</span></code></pre></div>
<h3 id="10-istio-step-02-deploy-sample-application">Step 02: Deploy Sample Application<a class="headerlink" href="#10-istio-step-02-deploy-sample-application" title="Permanent link">&para;</a></h3>
<ul>
<li>To see <code>Istio</code> in action, deploy a sample application, such as <strong>Bookinfo</strong>, which is available in <code>Istio</code>&rsquo;s demo repository.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#10-istio-__codelineno-10-1"></a><span class="c1"># Deploy the sample application supplied by istio</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#10-istio-__codelineno-10-2"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>samples/bookinfo/platform/kube/bookinfo.yaml
</span></code></pre></div>
<h3 id="10-istio-step-03-verify-the-sample-application">Step 03: Verify the Sample Application<a class="headerlink" href="#10-istio-step-03-verify-the-sample-application" title="Permanent link">&para;</a></h3>
<ul>
<li>To check that the application pods are running, execute the following command:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#10-istio-__codelineno-11-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods
</span></code></pre></div>
<h3 id="10-istio-step-04-expose-the-application">Step 04: Expose the Application<a class="headerlink" href="#10-istio-step-04-expose-the-application" title="Permanent link">&para;</a></h3>
<ul>
<li>To expose the application via <code>Istio's</code> ingress gateway, create an <code>Istio</code> <strong>Gateway</strong>  and <strong>VirtualService</strong> .</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#10-istio-__codelineno-12-1"></a><span class="c1"># This will expose the &#39;Bookinfo&#39; application to the external world via Istio ingress gateway.</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#10-istio-__codelineno-12-2"></a>kubectl<span class="w">   </span>apply<span class="w"> </span>-f<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#10-istio-__codelineno-12-3"></a><span class="w">          </span>samples/bookinfo/networking/bookinfo-gateway.yaml
</span></code></pre></div>
<hr />
<h2 id="10-istio-part-03-visualizing-the-network-with-kiali">Part 03 - Visualizing the Network with Kiali<a class="headerlink" href="#10-istio-part-03-visualizing-the-network-with-kiali" title="Permanent link">&para;</a></h2>
<h3 id="10-istio-step-01-access-kiali-dashboard">Step 01: Access Kiali Dashboard<a class="headerlink" href="#10-istio-step-01-access-kiali-dashboard" title="Permanent link">&para;</a></h3>
<ul>
<li>Once <code>Kiali</code> is installed, you can access it&rsquo;s dashboard. </li>
<li>First, port-forward to the <code>Kiali</code> service:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#10-istio-__codelineno-13-1"></a>kubectl<span class="w">   </span>port-forward<span class="w">        </span><span class="se">\</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#10-istio-__codelineno-13-2"></a><span class="w">          </span>-n<span class="w"> </span>istio-system<span class="w">     </span><span class="se">\</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#10-istio-__codelineno-13-3"></a><span class="w">          </span>svc/kiali<span class="w"> </span><span class="m">20001</span>:20001
</span></code></pre></div>
<ul>
<li>Now, open your browser and go to <a href="http://localhost:20001">http://localhost:20001</a></li>
<li><strong>Username</strong> : <code>admin</code></li>
<li><strong>Password</strong> : (Leave blank if anonymous access is enabled)</li>
</ul>
<h3 id="10-istio-step-02-explore-the-service-mesh-topology">Step 02: Explore the Service Mesh Topology<a class="headerlink" href="#10-istio-step-02-explore-the-service-mesh-topology" title="Permanent link">&para;</a></h3>
<ul>
<li>Once inside the <code>Kiali</code> dashboard, open the <code>Mesh</code> View</li>
<li>You will see a <strong>graph</strong>  of your services in the mesh.</li>
<li>The graph shows the interactions between microservices, along with traffic flows, success/error rates, and latency.</li>
<li>You can use the <code>Kiali</code> interface to:<ul>
<li><strong>Zoom in/out</strong>  of the topology.</li>
<li>View detailed metrics for each service.</li>
<li>Understand the traffic flow, including retries, timeouts, and error rates.</li>
</ul>
</li>
</ul>
<hr />
<h2 id="10-istio-part-04-creating-a-demo-istio-virtualservice">Part 04: Creating a Demo Istio VirtualService<a class="headerlink" href="#10-istio-part-04-creating-a-demo-istio-virtualservice" title="Permanent link">&para;</a></h2>
<ul>
<li>In <code>Istio</code>, <strong>VirtualServices</strong>  are used to define the routing rules for your services.</li>
</ul>
<h3 id="10-istio-step-01-define-a-virtualservice">Step 01: Define a VirtualService<a class="headerlink" href="#10-istio-step-01-define-a-virtualservice" title="Permanent link">&para;</a></h3>
<ul>
<li>Create a <code>VirtualService</code> resource to route traffic to the <code>ratings</code> service in the <strong>Bookinfo</strong> demo app.</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#10-istio-__codelineno-14-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">networking.istio.io/v1alpha3</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#10-istio-__codelineno-14-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">VirtualService</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#10-istio-__codelineno-14-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#10-istio-__codelineno-14-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ratings-vs</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#10-istio-__codelineno-14-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#10-istio-__codelineno-14-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#10-istio-__codelineno-14-7"></a><span class="w">  </span><span class="nt">hosts</span><span class="p">:</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#10-istio-__codelineno-14-8"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ratings</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#10-istio-__codelineno-14-9"></a><span class="w">  </span><span class="nt">http</span><span class="p">:</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#10-istio-__codelineno-14-10"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">route</span><span class="p">:</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#10-istio-__codelineno-14-11"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">destination</span><span class="p">:</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#10-istio-__codelineno-14-12"></a><span class="w">            </span><span class="nt">host</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ratings</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#10-istio-__codelineno-14-13"></a><span class="w">            </span><span class="nt">subset</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v2</span>
</span></code></pre></div>
<h3 id="10-istio-step-02-apply-the-virtualservice">Step 02: Apply the VirtualService<a class="headerlink" href="#10-istio-step-02-apply-the-virtualservice" title="Permanent link">&para;</a></h3>
<ul>
<li>Apply the <code>VirtualService</code>.</li>
<li>This will route all traffic for the <code>ratings</code> service to version <code>v2</code>.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#10-istio-__codelineno-15-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>ratings-virtualservice.yaml
</span></code></pre></div>
<h3 id="10-istio-step-03-verify-the-routing">Step 03: Verify the Routing<a class="headerlink" href="#10-istio-step-03-verify-the-routing" title="Permanent link">&para;</a></h3>
<ul>
<li>You can use <code>Kiali</code> to visualize the traffic flow and verify that routing is happening as expected.</li>
<li>The <code>Kiali</code> dashboard should reflect the new route configuration for <code>ratings</code>.</li>
</ul>
<hr />
<h2 id="10-istio-conclusion">Conclusion<a class="headerlink" href="#10-istio-conclusion" title="Permanent link">&para;</a></h2>
<ul>
<li>You have now successfully installed <code>Istio</code> and <code>Kiali</code>, set up a service mesh, and visualized your network&rsquo;s behavior. </li>
<li>The combination of <code>Istio's</code> powerful traffic management features and <code>Kiali's</code> intuitive visualization interface makes it easier to manage and monitor microservices in a Kubernetes cluster.</li>
</ul></section><section class="print-page" id="11-crd-custom-resource-definition" heading-number="2.13"><h1 id="11-crd-custom-resource-definition-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#11-crd-custom-resource-definition-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="11-crd-custom-resource-definition-custom-resources-definition-crd">Custom resources definition (CRD)<a class="headerlink" href="#11-crd-custom-resource-definition-custom-resources-definition-crd" title="Permanent link">&para;</a></h2>
<h3 id="11-crd-custom-resource-definition-intro">Intro<a class="headerlink" href="#11-crd-custom-resource-definition-intro" title="Permanent link">&para;</a></h3>
<ul>
<li><code>Custom resources definition</code> (<strong>CRD</strong>) was added to Kubernetes 1.7.</li>
<li><code>CRD</code> added the ability to define custom objects/resources.</li>
</ul>
<hr />
<h4 id="11-crd-custom-resource-definition-what-is-a-custom-resource-definitioncrd">What is a Custom Resource Definition(CRD)<a class="headerlink" href="#11-crd-custom-resource-definition-what-is-a-custom-resource-definitioncrd" title="Permanent link">&para;</a></h4>
<ul>
<li>
<p>A resource is an endpoint in the Kubernetes API that stores a collection of API objects of a certain kind; for example, the builtin pods resource contains a collection of Pod objects.</p>
</li>
<li>
<p>A custom resource is an <strong>extension of the Kubernetes API</strong> that is not necessarily available in a default Kubernetes installation. It represents a customization of a particular Kubernetes installation. However, many core Kubernetes functions are now built using custom resources, making Kubernetes more modular.</p>
</li>
<li>
<p>Custom resources can appear and disappear in a running cluster through <strong>dynamic registration</strong>, and cluster admins can update custom resources independently of the cluster itself. </p>
</li>
<li>
<p>Once a custom resource is installed, users can create and access its objects using <code>kubectl</code>, just as they do for built-in resources like Pods.</p>
</li>
<li>
<p>The custom resource created is also stored in the <code>etcd</code> cluster with proper replication and lifecycle management.</p>
</li>
</ul></section><section class="print-page" id="12-wordpress-mysql-pvc" heading-number="2.14"><h1 id="12-wordpress-mysql-pvc-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#12-wordpress-mysql-pvc-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="12-wordpress-mysql-pvc-wordpress-mysql-pvc">WordPress, MySQL, PVC<a class="headerlink" href="#12-wordpress-mysql-pvc-wordpress-mysql-pvc" title="Permanent link">&para;</a></h2>
<ul>
<li>In this tutorial you will deploy a WordPress site and a MySQL database.</li>
<li>You will use <code>PersistentVolumes</code> and <code>PersistentVolumeClaims</code> as storage.</li>
</ul>
<hr />
<h3 id="12-wordpress-mysql-pvc-walkthrough">Walkthrough<a class="headerlink" href="#12-wordpress-mysql-pvc-walkthrough" title="Permanent link">&para;</a></h3>
<ul>
<li>Patch <code>minikube</code> so we can use <code>Service: LoadBalancer</code></li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#12-wordpress-mysql-pvc-__codelineno-0-1"></a><span class="c1"># Source:</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#12-wordpress-mysql-pvc-__codelineno-0-2"></a><span class="c1"># https://github.com/knative/serving/blob/b31d96e03bfa1752031d0bc4ae2a3a00744d6cd5/docs/creating-a-kubernetes-cluster.md#loadbalancer-support-in-minikube</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#12-wordpress-mysql-pvc-__codelineno-0-3"></a>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#12-wordpress-mysql-pvc-__codelineno-0-4"></a>sudo<span class="w"> </span>ip<span class="w"> </span>route<span class="w"> </span>add<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#12-wordpress-mysql-pvc-__codelineno-0-5"></a><span class="w">    </span><span class="k">$(</span>cat<span class="w"> </span>~/.minikube/profiles/minikube/config.json<span class="w"> </span><span class="p">|</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#12-wordpress-mysql-pvc-__codelineno-0-6"></a><span class="w">    </span>jq<span class="w"> </span>-r<span class="w"> </span><span class="s2">&quot;.KubernetesConfig.ServiceCIDR&quot;</span><span class="k">)</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#12-wordpress-mysql-pvc-__codelineno-0-7"></a><span class="w">    </span>via<span class="w"> </span><span class="k">$(</span>minikube<span class="w"> </span>ip<span class="k">)</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#12-wordpress-mysql-pvc-__codelineno-0-8"></a>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#12-wordpress-mysql-pvc-__codelineno-0-9"></a>kubectl<span class="w"> </span>run<span class="w"> </span>minikube-lb-patch<span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#12-wordpress-mysql-pvc-__codelineno-0-10"></a><span class="w">    </span>--replicas<span class="o">=</span><span class="m">1</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#12-wordpress-mysql-pvc-__codelineno-0-11"></a><span class="w">    </span>--image<span class="o">=</span>elsonrodriguez/minikube-lb-patch:0.1<span class="w"> </span><span class="se">\-</span>-namespace<span class="o">=</span>kube-system
</span></code></pre></div>
<ul>
<li>Create the desired <code>Namespace</code></li>
<li>Create the <code>MySQL</code> resources:<ul>
<li>Create <code>Service</code></li>
<li>Create <code>PersistentVolumeClaims</code></li>
<li>Create <code>Deployment</code></li>
<li>Create <code>password file</code></li>
</ul>
</li>
<li>Create the WordPress resources:<ul>
<li>Create <code>Service</code></li>
<li>Create <code>PersistentVolumeClaims</code></li>
<li>Create <code>Deployment</code></li>
</ul>
</li>
<li>Create a <code>kustomization.yaml</code> with:<ul>
<li><code>Secret generator</code></li>
<li><code>MySQL</code> resources</li>
<li><code>WordPress</code> resources</li>
</ul>
</li>
<li>Deploy the stack</li>
<li>Port forward from the host to the application</li>
<li>We use a port forward so we will be able to test and verify if the WordPress is actually running:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#12-wordpress-mysql-pvc-__codelineno-1-1"></a>kubectl<span class="w"> </span>port-forward<span class="w"> </span>service/wordpress<span class="w"> </span><span class="m">8080</span>:32267<span class="w"> </span>-n<span class="w"> </span>wp-demo
</span></code></pre></div></section><section class="print-page" id="13-helmchart" heading-number="2.15"><h1 id="13-helmchart-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#13-helmchart-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="13-helmchart-helm-chart">Helm Chart<a class="headerlink" href="#13-helmchart-helm-chart" title="Permanent link">&para;</a></h2>
<ul>
<li>Welcome to the <code>Helm</code> Chart hands-on lab! In this tutorial, you&rsquo;ll learn the essentials of <code>Helm</code> (version 3), the package manager for Kubernetes. </li>
<li>You&rsquo;ll build, package, install, and manage applications using <code>Helm</code> charts, gaining practical experience with real Kubernetes resources.</li>
</ul>
<hr />
<!-- omit in toc -->
<h3 id="13-helmchart-prerequisites">Prerequisites<a class="headerlink" href="#13-helmchart-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://helm.sh/docs/intro/install/"><code>Helm</code></a> installed</li>
<li>K8S cluster - <a href="#00-verifycluster">Setting up minikube cluster instruction</a></li>
<li><a href="https://kubernetes.io/docs/tasks/tools/"><strong>kubectl</strong></a> configured to interact with your cluster</li>
</ul>
<p><a href="https://ide.cloud.google.com/?cloudshell_git_repo=https://github.com/nirgeier/KubernetesLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a></p>
<h3 id="13-helmchart-ctrl-click-to-open-in-new-window"><strong><kbd>CTRL</kbd> + <kbd>click</kbd> to open in new window</strong><a class="headerlink" href="#13-helmchart-ctrl-click-to-open-in-new-window" title="Permanent link">&para;</a></h3>
<!-- omit in toc -->
<hr />
<h2 id="13-helmchart-what-will-you-learn">What will you learn<a class="headerlink" href="#13-helmchart-what-will-you-learn" title="Permanent link">&para;</a></h2>
<ul>
<li>What <code>Helm</code> is and why is it useful</li>
<li><code>Helm</code> chart structure and key files</li>
<li>Common <code>Helm</code> commands for managing releases</li>
<li>How to create, pack, install, upgrade, and rollback a <code>Helm</code> chart</li>
<li>Troubleshooting and best practices</li>
</ul>
<hr />
<h2 id="13-helmchart-introduction">Introduction<a class="headerlink" href="#13-helmchart-introduction" title="Permanent link">&para;</a></h2>
<ul>
<li><code>Helm</code> is the <strong>package manager</strong> for Kubernetes. </li>
<li>It simplifies the deployment, management, and upgrade of applications on your Kubernetes cluster. </li>
<li><code>Helm</code> helps you manage Kubernetes applications by providing a way to define, install, and upgrade complex Kubernetes applications.</li>
<li>
<p>When packing applications as <code>Helm</code> charts, you gain a standardized and reusable approach for deploying and managing your services.</p>
</li>
<li>
<p>A <code>Helm</code> chart consists of a few files that define the Kubernetes resources that will be <strong>created</strong> when the chart is installed. </p>
</li>
<li>These files include the:<ul>
<li><code>Chart.yaml</code> file, which contains metadata about the chart, such as its name and version, and the chart&rsquo;s dependencies and maintainers.</li>
<li><code>values.yaml</code> file, which contains the configuration values for the chart. </li>
<li>The <code>templates</code> directory which contains the Kubernetes resource templates to be used to create the actual resources in the cluster.</li>
</ul>
</li>
</ul>
<h3 id="13-helmchart-terminology">Terminology<a class="headerlink" href="#13-helmchart-terminology" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><code>Chart</code></p>
<ul>
<li>A <code>Helm</code> package is called a <strong>chart</strong>.</li>
<li>Charts are versioned, shareable packages that contain all the Kubernetes resources needed to run an application.</li>
</ul>
</li>
<li>
<p><code>Release</code></p>
<ul>
<li>A specific instance of a chart is called a <strong>release</strong>.</li>
<li>Each release is a deployed <em>version of a chart</em>, with its own configuration, resources, and revision history.</li>
</ul>
</li>
<li>
<p><code>Repository</code></p>
<ul>
<li>A collection of charts is stored in a <code>Helm</code> repository.</li>
<li><code>Helm</code> charts can be hosted in public or private repositories for easy sharing and distribution.</li>
</ul>
</li>
</ul>
<h3 id="13-helmchart-chart-files-and-folders">Chart files and folders<a class="headerlink" href="#13-helmchart-chart-files-and-folders" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Filename/Folder</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>Chart.yaml</code></td>
<td>Contains metadata about the chart, including its name, version, dependencies, and maintainers.</td>
</tr>
<tr>
<td><code>values.yaml</code></td>
<td>Defines <strong>default configuration</strong> values for the chart. Users can override these values during installation.</td>
</tr>
<tr>
<td><code>templates/</code></td>
<td>Directory containing Kubernetes manifest templates written in the Go template language.</td>
</tr>
<tr>
<td><code>charts/</code></td>
<td>Directory containing dependencies of the chart.</td>
</tr>
<tr>
<td><code>README.md</code></td>
<td>Documentation for the chart, explaining how to use and configure it.</td>
</tr>
</tbody>
</table>
<h5 id="13-helmchart-codewizard-helm-demo-helm-chart-structure">codewizard-helm-demo Helm Chart Structure<a class="headerlink" href="#13-helmchart-codewizard-helm-demo-helm-chart-structure" title="Permanent link">&para;</a></h5>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#13-helmchart-__codelineno-0-1"></a>-<span class="w"> </span>Chart.yaml<span class="w">        </span><span class="c1"># Defines chart metadata and values schema</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#13-helmchart-__codelineno-0-2"></a>-<span class="w"> </span>values.yaml<span class="w">       </span><span class="c1"># Default configuration values</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#13-helmchart-__codelineno-0-3"></a>-<span class="w"> </span>templates/<span class="w">        </span><span class="c1"># Deployment templates using Go templating language</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#13-helmchart-__codelineno-0-4"></a><span class="w">  </span>-<span class="w"> </span>deployment.yaml<span class="w"> </span><span class="c1"># Deployment manifest template</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#13-helmchart-__codelineno-0-5"></a><span class="w">  </span>-<span class="w"> </span>service.yaml<span class="w">    </span><span class="c1"># Service manifest template</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#13-helmchart-__codelineno-0-6"></a>-<span class="w"> </span>README.md<span class="w">         </span><span class="c1"># Documentation for your chart </span>
</span></code></pre></div>
<h3 id="13-helmchart-common-helm-commands">Common <code>Helm</code> Commands<a class="headerlink" href="#13-helmchart-common-helm-commands" title="Permanent link">&para;</a></h3>
<p>Here are some of the most common <code>Helm</code> commands you&rsquo;ll use when working with <code>Helm</code> charts:</p>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>helm</code> <strong>create</strong>      <code>chart-name</code></td>
<td>Create a new <code>Helm</code> chart with the specified name.</td>
</tr>
<tr>
<td><code>helm</code> <strong>install</strong>     <code>release-name</code> <code>chart-path</code></td>
<td>Install a <code>Helm</code> chart to your Kubernetes cluster.</td>
</tr>
<tr>
<td><code>helm</code> <strong>upgrade</strong>     <code>release-name</code> <code>chart-path</code></td>
<td>Upgrade an installed release with a new version of a chart.</td>
</tr>
<tr>
<td><code>helm</code> <strong>uninstall</strong>   <code>release-name</code></td>
<td>Uninstall a release from the Kubernetes cluster.</td>
</tr>
<tr>
<td><code>helm</code> <strong>list</strong></td>
<td>List all installed <code>Helm</code> releases in the cluster.</td>
</tr>
<tr>
<td><code>helm</code> <strong>status</strong>      <code>release-name</code></td>
<td>Show the status of a deployed <code>Helm</code> release.</td>
</tr>
<tr>
<td><code>helm</code> <strong>rollback</strong>    <code>release-name</code> <code>revision</code></td>
<td>Rollback a release to a previous revision.</td>
</tr>
<tr>
<td><code>helm</code> <strong>get all</strong>     <code>release-name</code></td>
<td>Retrieve all information about a deployed release (e.g., templates, values).</td>
</tr>
<tr>
<td><code>helm</code> <strong>show values</strong> <code>chart-name</code></td>
<td>Show the default values of a <code>Helm</code> chart.</td>
</tr>
<tr>
<td><code>helm</code> <strong>template</strong>    <code>chart-name</code></td>
<td>Generate the output of the <code>Helm</code> chart.</td>
</tr>
<tr>
<td><code>helm</code> <strong>lint</strong>        <code>chart-path</code></td>
<td>This command takes a path to a chart and runs a series of tests to verify that the chart is well-formed.</td>
</tr>
<tr>
<td><code>helm</code> <strong>history</strong>     <code>chart-name</code></td>
<td>Show release history.</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="13-helmchart-lab-exercises">Lab Exercises<a class="headerlink" href="#13-helmchart-lab-exercises" title="Permanent link">&para;</a></h2>
<h3 id="13-helmchart-step-01-installing-helm">Step 01 - Installing <code>Helm</code><a class="headerlink" href="#13-helmchart-step-01-installing-helm" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Before you can use the <code>codewizard-helm-demo</code> chart, you&rsquo;ll need to <strong>install</strong> <code>Helm</code> on your local machine. </p>
</li>
<li>
<p><code>Helm</code> install methods by OS:</p>
</li>
</ul>
<table>
<thead>
<tr>
<th>OS</th>
<th>Command</th>
</tr>
</thead>
<tbody>
<tr>
<td>Linux</td>
<td><code>curl https://raw.githubusercontent.com/helm/helm/main/scripts/get-helm-3 \| bash</code></td>
</tr>
<tr>
<td>MacOS</td>
<td><code>brew install helm</code></td>
</tr>
<tr>
<td>Windows (via Chocolatey)</td>
<td><code>choco install kubernetes-helm</code></td>
</tr>
</tbody>
</table>
<h4 id="13-helmchart-verify-installation">Verify Installation<a class="headerlink" href="#13-helmchart-verify-installation" title="Permanent link">&para;</a></h4>
<ul>
<li>To confirm that <code>Helm</code> is installed correctly, run:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#13-helmchart-__codelineno-1-1"></a>helm<span class="w"> </span>version
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#13-helmchart-__codelineno-2-1"></a>version.BuildInfo{Version:&quot;xx&quot;, GitCommit:&quot;xx&quot;, GitTreeState:&quot;clean&quot;, GoVersion:&quot;xx&quot;}
</span></code></pre></div>
</div>
<hr />
<h3 id="13-helmchart-step-02-creating-our-helm-chart">Step 02 - Creating our <code>Helm</code> chart<a class="headerlink" href="#13-helmchart-step-02-creating-our-helm-chart" title="Permanent link">&para;</a></h3>
<ul>
<li>Creating our custom <code>codewizard-helm-demo</code> <code>Helm</code> chart</li>
<li>
<p>The custom <code>codewizard-helm-demo</code> <code>Helm</code> chart is build upon the following K8S resources:</p>
<ul>
<li>ConfigMap</li>
<li>Deployment</li>
<li>Service</li>
</ul>
</li>
<li>
<p>As mentioned above, we will also have the following <code>Helm</code> resources:</p>
<ul>
<li>Chart.yaml</li>
<li>values.yaml</li>
<li>templates/_helpers.tpl</li>
</ul>
</li>
</ul>
<h4 id="13-helmchart-create-a-new-chart">Create a New Chart<a class="headerlink" href="#13-helmchart-create-a-new-chart" title="Permanent link">&para;</a></h4>
<ul>
<li>First, we need to create a <code>Helm</code> chart using the <code>helm create</code> command. </li>
<li>This command will generate the necessary file structure for your new chart.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#13-helmchart-__codelineno-3-1"></a>helm<span class="w"> </span>create<span class="w"> </span>codewizard-helm-demo
</span></code></pre></div>
<details class="question">
<summary>What is the result of this command?</summary>
<p>Examine the chart structure!</p>
</details>
<h4 id="13-helmchart-navigate-to-the-chart-directory">Navigate to the Chart Directory<a class="headerlink" href="#13-helmchart-navigate-to-the-chart-directory" title="Permanent link">&para;</a></h4>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#13-helmchart-__codelineno-4-1"></a><span class="nb">cd</span><span class="w"> </span>codewizard-helm-demo
</span></code></pre></div>
<h4 id="13-helmchart-write-the-chart-content">Write the chart content<a class="headerlink" href="#13-helmchart-write-the-chart-content" title="Permanent link">&para;</a></h4>
<ul>
<li>Copy the content of the chart folder (in this lab) to the chart directory (overwriting the files).</li>
</ul>
<h3 id="13-helmchart-step-03-pack-the-chart">Step 03 - Pack the chart<a class="headerlink" href="#13-helmchart-step-03-pack-the-chart" title="Permanent link">&para;</a></h3>
<ul>
<li>After we have created or customized our chart, we need to pack it as <code>.tgz</code> file, which can then be shared or installed.</li>
</ul>
<h4 id="13-helmchart-helm-package">helm package<a class="headerlink" href="#13-helmchart-helm-package" title="Permanent link">&para;</a></h4>
<div class="admonition warning">
<p class="admonition-title">Helm Package</p>
<p><code>helm package</code> packages a chart into a <strong>versioned chart archive file</strong>.<br />
If a path is given, this will &ldquo;look&rdquo; at that path for a chart which must contain a <code>Chart.yaml</code> file and then pack that directory.</p>
</div>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#13-helmchart-__codelineno-5-1"></a>helm<span class="w"> </span>package<span class="w"> </span>codewizard-helm-demo
</span></code></pre></div>
<ul>
<li>This command will create a file called <code>codewizard-helm-demo-&lt;version&gt;.tgz</code> inside your current directory.</li>
</ul>
<h3 id="13-helmchart-step-04-validate-the-chart-content">Step 04 - Validate the chart content<a class="headerlink" href="#13-helmchart-step-04-validate-the-chart-content" title="Permanent link">&para;</a></h3>
<h4 id="13-helmchart-helm-template"><code>helm template</code><a class="headerlink" href="#13-helmchart-helm-template" title="Permanent link">&para;</a></h4>
<ul>
<li><code>Helm</code> allows you to <strong>generate</strong> the Kubernetes manifests based on the templates and values files without actually installing the chart. </li>
<li>This is useful to preview what the generated resources will look like:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#13-helmchart-__codelineno-6-1"></a>helm<span class="w"> </span>template<span class="w"> </span>codewizard-helm-demo
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#13-helmchart-__codelineno-6-2"></a>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#13-helmchart-__codelineno-6-3"></a><span class="c1">## This will output the rendered Kubernetes manifests to your terminal</span>
</span></code></pre></div>
<h3 id="13-helmchart-step-05-install-the-chart">Step 05 - Install the chart<a class="headerlink" href="#13-helmchart-step-05-install-the-chart" title="Permanent link">&para;</a></h3>
<ul>
<li>Install the <code>codewizard-helm-demo</code> chart into Kubernetes cluster</li>
</ul>
<h4 id="13-helmchart-the-helm-install-command">The <code>helm install</code> command<a class="headerlink" href="#13-helmchart-the-helm-install-command" title="Permanent link">&para;</a></h4>
<ul>
<li>This command installs a chart archive.</li>
<li>The install argument must be a chart reference, a path to a packed chart, a path to an unpacked chart directory or a URL.</li>
<li>To override values in a chart, use:<ul>
<li><code>--values</code> - pass in a file </li>
<li><code>--set</code> - pass configuration from the command line</li>
</ul>
</li>
</ul>
<p><strong>Install the packed helm chart</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#13-helmchart-__codelineno-7-1"></a>helm<span class="w"> </span>install<span class="w"> </span>codewizard-helm-demo<span class="w"> </span>codewizard-helm-demo-0.1.0.tgz
</span></code></pre></div></p>
<h3 id="13-helmchart-step-06-verify-the-installation">Step 06 - Verify the installation<a class="headerlink" href="#13-helmchart-step-06-verify-the-installation" title="Permanent link">&para;</a></h3>
<ul>
<li>Examine newly created <code>Helm</code> chart release, and all cluster created resources:</li>
</ul>
<p><strong>List the installed helms</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#13-helmchart-__codelineno-8-1"></a>helm<span class="w"> </span>ls
</span></code></pre></div></p>
<p><strong>Check the resources</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#13-helmchart-__codelineno-9-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>codewizard
</span></code></pre></div></p>
<h3 id="13-helmchart-step-07-test-the-service">Step 07 - Test the service<a class="headerlink" href="#13-helmchart-step-07-test-the-service" title="Permanent link">&para;</a></h3>
<ul>
<li>Perform an <code>HTTP GET</code> request, send it to the newly created cluster service.</li>
<li>Confirm that the response contains the <code>CodeWizard Helm Demo</code> message passed from the <code>values.yaml</code> file.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#13-helmchart-__codelineno-10-1"></a>kubectl<span class="w"> </span>run<span class="w"> </span>busybox<span class="w">         </span><span class="se">\</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#13-helmchart-__codelineno-10-2"></a><span class="w">        </span>--image<span class="o">=</span>busybox<span class="w">     </span><span class="se">\</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#13-helmchart-__codelineno-10-3"></a><span class="w">        </span>--rm<span class="w">                </span><span class="se">\</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#13-helmchart-__codelineno-10-4"></a><span class="w">        </span>-it<span class="w">                 </span><span class="se">\</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#13-helmchart-__codelineno-10-5"></a><span class="w">        </span>--restart<span class="o">=</span>Never<span class="w">     </span><span class="se">\</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#13-helmchart-__codelineno-10-6"></a><span class="w">        </span>--<span class="w"> </span>/bin/sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;wget -qO- http://codewizard-helm-demo.codewizard.svc.cluster.local&quot;</span>
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#13-helmchart-__codelineno-11-1"></a>CodeWizard Helm Demo
</span></code></pre></div>
</div>
<h3 id="13-helmchart-step-08-upgrade-the-release-to-newer-version">Step 08 - Upgrade the release to newer version<a class="headerlink" href="#13-helmchart-step-08-upgrade-the-release-to-newer-version" title="Permanent link">&para;</a></h3>
<ul>
<li>Perform a Helm upgrade on the <code>codewizard-helm-demo</code> release:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#13-helmchart-__codelineno-12-1"></a><span class="c1"># upgrade and pass a different message than the one from the default values</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#13-helmchart-__codelineno-12-2"></a><span class="c1"># Use the --set to pass the desired value</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#13-helmchart-__codelineno-12-3"></a>helm<span class="w">  </span>upgrade<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#13-helmchart-__codelineno-12-4"></a><span class="w">  </span>codewizard-helm-demo<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#13-helmchart-__codelineno-12-5"></a><span class="w">  </span>codewizard-helm-demo-0.1.0.tgz<span class="w"> </span><span class="se">\</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#13-helmchart-__codelineno-12-6"></a><span class="w">  </span>--set<span class="w"> </span>nginx.conf.message<span class="o">=</span><span class="s2">&quot;Helm Rocks&quot;</span>
</span></code></pre></div>
<h3 id="13-helmchart-step-09-check-the-upgrade">Step 09 - Check the upgrade<a class="headerlink" href="#13-helmchart-step-09-check-the-upgrade" title="Permanent link">&para;</a></h3>
<ul>
<li>Perform another <code>HTTP GET</code> request.</li>
<li>Confirm that the response now has the updated message <code>Helm Rocks</code>:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#13-helmchart-__codelineno-13-1"></a>kubectl<span class="w"> </span>run<span class="w"> </span>busybox<span class="w">         </span><span class="se">\</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#13-helmchart-__codelineno-13-2"></a><span class="w">        </span>--image<span class="o">=</span>busybox<span class="w">     </span><span class="se">\</span>
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#13-helmchart-__codelineno-13-3"></a><span class="w">        </span>--rm<span class="w">                </span><span class="se">\</span>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#13-helmchart-__codelineno-13-4"></a><span class="w">        </span>-it<span class="w">                 </span><span class="se">\</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#13-helmchart-__codelineno-13-5"></a><span class="w">        </span>--restart<span class="o">=</span>Never<span class="w">     </span><span class="se">\</span>
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#13-helmchart-__codelineno-13-6"></a><span class="w">        </span>--<span class="w"> </span>/bin/sh<span class="w"> </span>-c<span class="w"> </span><span class="s2">&quot;wget -qO- http://codewizard-helm-demo.codewizard.svc.cluster.local&quot;</span>
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#13-helmchart-__codelineno-14-1"></a>Helm Rocks
</span></code></pre></div>
</div>
<h3 id="13-helmchart-step-10-history">Step 10 - History<a class="headerlink" href="#13-helmchart-step-10-history" title="Permanent link">&para;</a></h3>
<ul>
<li>Examine the <code>codewizard-helm-demo</code> release history</li>
</ul>
<h4 id="13-helmchart-helm-history"><code>helm history</code><a class="headerlink" href="#13-helmchart-helm-history" title="Permanent link">&para;</a></h4>
<ul>
<li><code>helm history</code> prints historical revisions for a given release.</li>
<li>A default maximum of 256 revisions will be returned.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#13-helmchart-__codelineno-15-1"></a>helm<span class="w"> </span><span class="nb">history</span><span class="w"> </span>codewizard-helm-demo
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#13-helmchart-__codelineno-16-1"></a>REVISION        UPDATED    STATUS          CHART                           APP VERSION     DESCRIPTION     
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#13-helmchart-__codelineno-16-2"></a>1               ...        superseded      codewizard-helm-demo-0.1.0      1.19.7          Install complete
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#13-helmchart-__codelineno-16-3"></a>2               ...        deployed        codewizard-helm-demo-0.1.0      1.19.7          Upgrade complete
</span></code></pre></div>
</div>
<h3 id="13-helmchart-step-11-rollback">Step 11 - Rollback<a class="headerlink" href="#13-helmchart-step-11-rollback" title="Permanent link">&para;</a></h3>
<h4 id="13-helmchart-helm-rollback"><code>helm rollback</code><a class="headerlink" href="#13-helmchart-helm-rollback" title="Permanent link">&para;</a></h4>
<ul>
<li>Rollback the <code>codewizard-helm-demo</code> release to previous version:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#13-helmchart-__codelineno-17-1"></a>helm<span class="w"> </span>rollback<span class="w"> </span>codewizard-helm-demo
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#13-helmchart-__codelineno-18-1"></a>Rollback was a success! Happy Helming!
</span></code></pre></div>
</div>
<ul>
<li>Check again to verify that you get the original message!</li>
</ul>
<hr />
<h2 id="13-helmchart-finalize-cleanup">Finalize &amp; Cleanup<a class="headerlink" href="#13-helmchart-finalize-cleanup" title="Permanent link">&para;</a></h2>
<ul>
<li>To remove all resources created by this lab, uninstall the <code>codewizard-helm-demo</code> release:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#13-helmchart-__codelineno-19-1"></a>helm<span class="w"> </span>uninstall<span class="w"> </span>codewizard-helm-demo
</span></code></pre></div>
<ul>
<li>(Optional) If you have created a dedicated namespace for this lab, you can delete it by runniung:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#13-helmchart-__codelineno-20-1"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>namespace<span class="w"> </span>codewizard
</span></code></pre></div>
<hr />
<h2 id="13-helmchart-troubleshooting">Troubleshooting<a class="headerlink" href="#13-helmchart-troubleshooting" title="Permanent link">&para;</a></h2>
<ul>
<li><strong>Helm not found:</strong></li>
</ul>
<p>Make sure <code>Helm</code> is installed and available in your <code>PATH</code>. 
Run the following to verify:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#13-helmchart-__codelineno-21-1"></a>helm<span class="w"> </span>version
</span></code></pre></div>
<p><br></p>
<ul>
<li><strong>Pods not starting:</strong></li>
</ul>
<p>Check pod status and logs by running the following commands:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#13-helmchart-__codelineno-22-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>codewizard
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#13-helmchart-__codelineno-22-2"></a>kubectl<span class="w"> </span>describe<span class="w"> </span>pod<span class="w"> </span>&lt;pod-name&gt;<span class="w"> </span>-n<span class="w"> </span>codewizard
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#13-helmchart-__codelineno-22-3"></a>kubectl<span class="w"> </span>logs<span class="w"> </span>&lt;pod-name&gt;<span class="w"> </span>-n<span class="w"> </span>codewizard
</span></code></pre></div>
<p><br></p>
<ul>
<li><strong>Service not reachable:</strong></li>
</ul>
<p>Ensure the service and pods are running by running the following commands:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#13-helmchart-__codelineno-23-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>codewizard
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#13-helmchart-__codelineno-23-2"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>codewizard
</span></code></pre></div>
<p><br></p>
<ul>
<li><strong>Values not updated after upgrade:</strong></li>
</ul>
<p>Double-check your <code>--set</code> or <code>--values</code> flags and confirm the upgrade by running:</p>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#13-helmchart-__codelineno-24-1"></a>helm<span class="w"> </span>get<span class="w"> </span>values<span class="w"> </span>codewizard-helm-demo
</span></code></pre></div>
<hr />
<h2 id="13-helmchart-next-steps">Next Steps<a class="headerlink" href="#13-helmchart-next-steps" title="Permanent link">&para;</a></h2>
<ul>
<li>Try creating your own <code>Helm</code> chart for a different application.</li>
<li>Explore <code>Helm</code> chart repositories like <a href="https://artifacthub.io/">Artifact Hub</a>.</li>
<li>Learn about advanced <code>Helm</code> features, such as: dependencies, hooks, and chart testing.</li>
<li>Integrate <code>Helm</code> with CI/CD pipelines for automated deployments.</li>
<li>Read more in the <a href="https://helm.sh/docs/">official Helm documentation</a>.</li>
</ul></section><section class="print-page" id="14-logging" heading-number="2.16"><h1 id="14-logging-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#14-logging-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="14-logging-logging">Logging<a class="headerlink" href="#14-logging-logging" title="Permanent link">&para;</a></h2>
<ul>
<li>Welcome to the <code>Logging</code> hands-on lab! In this tutorial, we will learn the essentials of <code>Logging</code> in Kubernetes clusters.</li>
<li>We will deploy a sample application, configure log collection, and explore logs using popular tools like <code>Fluentd</code>, <code>Elasticsearch</code>, and <code>Kibana</code> (EFK stack).</li>
</ul>
<hr />
<!-- omit in toc -->
<h3 id="14-logging-prerequisites">Prerequisites<a class="headerlink" href="#14-logging-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>Kubernetes cluster - <a href="#00-verifycluster">Setting up minikube cluster instruction</a></li>
<li><a href="https://kubernetes.io/docs/tasks/tools/"><strong>kubectl</strong></a> configured to interact with your cluster</li>
<li><a href="https://helm.sh/docs/intro/install/">Helm</a> installed for easier deployment</li>
</ul>
<p><a href="https://ide.cloud.google.com/?cloudshell_git_repo=https://github.com/nirgeier/KubernetesLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a></p>
<h3 id="14-logging-ctrl-click-to-open-in-new-window"><strong><kbd>CTRL</kbd> + <kbd>click</kbd> to open in new window</strong><a class="headerlink" href="#14-logging-ctrl-click-to-open-in-new-window" title="Permanent link">&para;</a></h3>
<!-- omit in toc -->
<hr />
<h2 id="14-logging-what-will-we-learn">What will we learn?<a class="headerlink" href="#14-logging-what-will-we-learn" title="Permanent link">&para;</a></h2>
<ul>
<li>Why <code>Logging</code> is important in Kubernetes</li>
<li>How to deploy a sample app that generates logs</li>
<li>How to collect logs using Fluentd</li>
<li>How to store and search logs with <code>Elasticsearch</code></li>
<li>How to visualize logs with <code>Kibana</code></li>
<li>Troubleshooting and best practices</li>
</ul>
<hr />
<h2 id="14-logging-introduction">Introduction<a class="headerlink" href="#14-logging-introduction" title="Permanent link">&para;</a></h2>
<ul>
<li><code>Logging</code> is critical for monitoring, debugging, and auditing applications in Kubernetes.</li>
<li>Kubernetes does not provide a built-in, centralized <code>Logging</code> solution, but it allows us to integrate with many <code>Logging</code> stacks.</li>
<li>We will set up the EFK stack (<code>Elasticsearch</code>, <code>Fluentd</code>, <code>Kibana</code>) to collect, store, and visualize logs from our cluster.</li>
</ul>
<hr />
<h2 id="14-logging-lab-exercises">Lab Exercises<a class="headerlink" href="#14-logging-lab-exercises" title="Permanent link">&para;</a></h2>
<h3 id="14-logging-step-01-deploy-a-sample-application">Step 01 - Deploy a Sample Application<a class="headerlink" href="#14-logging-step-01-deploy-a-sample-application" title="Permanent link">&para;</a></h3>
<ul>
<li>Deploy a simple <code>Nginx</code> application that generates access logs.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#14-logging-__codelineno-0-1"></a>kubectl<span class="w"> </span>create<span class="w"> </span>deployment<span class="w"> </span>nginx<span class="w"> </span>--image<span class="o">=</span>nginx
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#14-logging-__codelineno-0-2"></a>kubectl<span class="w"> </span>expose<span class="w"> </span>deployment<span class="w"> </span>nginx<span class="w"> </span>--port<span class="o">=</span><span class="m">80</span><span class="w"> </span>--type<span class="o">=</span>NodePort
</span></code></pre></div>
<ul>
<li>Check that the pod is running:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#14-logging-__codelineno-1-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods
</span></code></pre></div>
<h3 id="14-logging-step-02-deploy-elasticsearch">Step 02 - Deploy <code>Elasticsearch</code><a class="headerlink" href="#14-logging-step-02-deploy-elasticsearch" title="Permanent link">&para;</a></h3>
<ul>
<li>Deploy <code>Elasticsearch</code> using <code>Helm</code>:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#14-logging-__codelineno-2-1"></a>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>elastic<span class="w"> </span>https://helm.elastic.co
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#14-logging-__codelineno-2-2"></a>helm<span class="w"> </span>repo<span class="w"> </span>update
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#14-logging-__codelineno-2-3"></a>helm<span class="w"> </span>install<span class="w"> </span>elasticsearch<span class="w"> </span>elastic/elasticsearch<span class="w"> </span>--set<span class="w"> </span><span class="nv">replicas</span><span class="o">=</span><span class="m">1</span><span class="w"> </span>--set<span class="w"> </span><span class="nv">minimumMasterNodes</span><span class="o">=</span><span class="m">1</span>
</span></code></pre></div>
<ul>
<li>Wait for the pod to be ready and check its status:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#14-logging-__codelineno-3-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods
</span></code></pre></div>
<h3 id="14-logging-step-03-deploy-kibana">Step 03 - Deploy <code>Kibana</code><a class="headerlink" href="#14-logging-step-03-deploy-kibana" title="Permanent link">&para;</a></h3>
<ul>
<li>Deploy <code>Kibana</code> using <code>Helm</code>:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#14-logging-__codelineno-4-1"></a>helm<span class="w"> </span>install<span class="w"> </span>kibana<span class="w"> </span>elastic/kibana
</span></code></pre></div>
<ul>
<li>Forward the <code>Kibana</code> port:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#14-logging-__codelineno-5-1"></a>kubectl<span class="w"> </span>port-forward<span class="w"> </span>svc/kibana-kibana<span class="w"> </span><span class="m">5601</span>:5601<span class="w"> </span><span class="p">&amp;</span>
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">If you are running this lab in Google Cloud Shell:</p>
<ol>
<li>After running the port-forward command above, click the <strong>Web Preview</strong> button in the Cloud Shell toolbar (usually at the top right).</li>
<li>Enter port <code>5601</code> when prompted.</li>
<li>This will open <code>Kibana</code> in a new browser tab at a URL like <code>https://&lt;cloudshell-id&gt;.shell.cloud.google.com/?port=5601</code>.</li>
<li>If you see a warning about an untrusted connection, you can safely proceed.</li>
</ol>
</div>
<ul>
<li>Access <code>Kibana</code> at <a href="http://localhost:5601">http://localhost:5601</a> (if running locally) or via the Cloud Shell Web Preview, as explained above.</li>
</ul>
<h3 id="14-logging-step-04-deploy-fluentd">Step 04 - Deploy <code>Fluentd</code><a class="headerlink" href="#14-logging-step-04-deploy-fluentd" title="Permanent link">&para;</a></h3>
<ul>
<li>Deploy <code>Fluentd</code> as a <code>DaemonSet</code> to collect logs from all nodes and forward them to <code>Elasticsearch</code>.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#14-logging-__codelineno-6-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/fluent/fluentd-kubernetes-daemonset/master/fluentd-daemonset-elasticsearch-rbac.yaml
</span></code></pre></div>
<ul>
<li>Check that <code>Fluentd</code> pods are running:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#14-logging-__codelineno-7-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-l<span class="w"> </span><span class="nv">app</span><span class="o">=</span>fluentd
</span></code></pre></div>
<h3 id="14-logging-step-05-generate-and-view-logs">Step 05 - Generate and View Logs<a class="headerlink" href="#14-logging-step-05-generate-and-view-logs" title="Permanent link">&para;</a></h3>
<ul>
<li>Access the <code>Nginx</code> service to generate logs:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#14-logging-__codelineno-8-1"></a>minikube<span class="w"> </span>service<span class="w"> </span>nginx
</span></code></pre></div>
<p>In <code>Kibana</code>, configure an index pattern to view logs:</p>
<ol>
<li>Open Kibana in your browser (using the Cloud Shell Web Preview as described above).</li>
<li>In the left menu, click <strong>Stack Management</strong> &gt; <strong>Kibana</strong> &gt; <strong>Index Patterns</strong>.</li>
<li>Click <strong>Create index pattern</strong>.</li>
<li>In the &ldquo;Index pattern&rdquo; field, enter <code>fluentd-*</code> (or <code>logstash-*</code> if your logs use that prefix).</li>
<li>Click <strong>Next step</strong>.</li>
<li>For the time field, select <code>@timestamp</code> and click <strong>Create index pattern</strong>.</li>
<li>Go to <strong>Discover</strong> in the left menu to view and search your logs.</li>
</ol>
<p>Explore the logs, search, and visualize traffic.</p>
<hr />
<h2 id="14-logging-troubleshooting">Troubleshooting<a class="headerlink" href="#14-logging-troubleshooting" title="Permanent link">&para;</a></h2>
<h5 id="14-logging-pods-not-starting"><strong>Pods not starting:</strong><a class="headerlink" href="#14-logging-pods-not-starting" title="Permanent link">&para;</a></h5>
<ul>
<li>Check pod status and logs:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#14-logging-__codelineno-9-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#14-logging-__codelineno-9-2"></a>kubectl<span class="w"> </span>describe<span class="w"> </span>pod<span class="w"> </span>&lt;pod-name&gt;
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#14-logging-__codelineno-9-3"></a>kubectl<span class="w"> </span>logs<span class="w"> </span>&lt;pod-name&gt;
</span></code></pre></div>
<p><br></p>
<h5 id="14-logging-kibana-not-reachable"><strong>Kibana not reachable:</strong><a class="headerlink" href="#14-logging-kibana-not-reachable" title="Permanent link">&para;</a></h5>
<ul>
<li>Ensure port-forward is running and no firewall is blocking port 5601.</li>
</ul>
<p><br></p>
<h5 id="14-logging-no-logs-in-kibana"><strong>No logs in Kibana:</strong><a class="headerlink" href="#14-logging-no-logs-in-kibana" title="Permanent link">&para;</a></h5>
<ul>
<li>Check Fluentd and Elasticsearch pod logs for errors.</li>
<li>Ensure index pattern is set up correctly in Kibana.</li>
</ul>
<hr />
<h2 id="14-logging-cleanup">Cleanup<a class="headerlink" href="#14-logging-cleanup" title="Permanent link">&para;</a></h2>
<ul>
<li>To remove all resources created by this lab:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#14-logging-__codelineno-10-1"></a>helm<span class="w"> </span>uninstall<span class="w"> </span>elasticsearch
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#14-logging-__codelineno-10-2"></a>helm<span class="w"> </span>uninstall<span class="w"> </span>kibana
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#14-logging-__codelineno-10-3"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>deployment<span class="w"> </span>nginx
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#14-logging-__codelineno-10-4"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>service<span class="w"> </span>nginx
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#14-logging-__codelineno-10-5"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/fluent/fluentd-kubernetes-daemonset/master/fluentd-daemonset-elasticsearch-rbac.yaml
</span></code></pre></div>
<hr />
<h2 id="14-logging-next-steps">Next Steps<a class="headerlink" href="#14-logging-next-steps" title="Permanent link">&para;</a></h2>
<ul>
<li>Try deploying other logging stacks like <code>Loki</code> + <code>Grafana</code>.</li>
<li>Explore log aggregation, alerting, and retention policies.</li>
<li>Integrate logging with monitoring and alerting tools.</li>
<li>Read more in the <a href="https://kubernetes.io/docs/concepts/cluster-administration/logging/">Kubernetes logging documentation</a>.</li>
</ul></section><section class="print-page" id="15-prometheus-grafana" heading-number="2.17"><!-- omit in toc -->
<h1 id="15-prometheus-grafana-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#15-prometheus-grafana-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="15-prometheus-grafana-prometheus-and-grafana-monitoring-lab">Prometheus and Grafana Monitoring Lab<a class="headerlink" href="#15-prometheus-grafana-prometheus-and-grafana-monitoring-lab" title="Permanent link">&para;</a></h2>
<ul>
<li>In this lab, we will learn how to set up and configure <code>Prometheus</code> and <code>Grafana</code> for monitoring a Kubernetes cluster.</li>
<li>You will install <code>Prometheus</code> to collect metrics from the cluster and <code>Grafana</code> to visualize those metrics.</li>
<li>By the end of this lab, you will have a functional monitoring stack that provides insights into the health and performance of your Kubernetes environment.</li>
</ul>
<hr />
<!-- omit in toc -->
<h3 id="15-prometheus-grafana-prerequisites">Prerequisites<a class="headerlink" href="#15-prometheus-grafana-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li><a href="https://helm.sh/docs/intro/install/"><code>Helm</code></a> installed</li>
<li>K8S cluster - <a href="#00-verifycluster">Setting up minikube cluster instruction</a></li>
<li><a href="https://kubernetes.io/docs/tasks/tools/"><strong>kubectl</strong></a> configured to interact with your cluster</li>
</ul>
<p><a href="https://ide.cloud.google.com/?cloudshell_git_repo=https://github.com/nirgeier/KubernetesLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a></p>
<h3 id="15-prometheus-grafana-ctrl-click-to-open-in-new-window"><strong><kbd>CTRL</kbd> + <kbd>click</kbd> to open in new window</strong><a class="headerlink" href="#15-prometheus-grafana-ctrl-click-to-open-in-new-window" title="Permanent link">&para;</a></h3>
<!-- omit in toc -->
<hr />
<!-- omit in toc -->
<h2 id="15-prometheus-grafana-prometheus-and-grafana-setup-and-configuration-guide">Prometheus and Grafana Setup and Configuration Guide<a class="headerlink" href="#15-prometheus-grafana-prometheus-and-grafana-setup-and-configuration-guide" title="Permanent link">&para;</a></h2>
<ul>
<li>This guide serves as a comprehensive walkthrough of the steps to set up <code>Prometheus</code> and <code>Grafana</code> on your Kubernetes cluster. </li>
<li>It includes hands-on steps for installing <code>Prometheus</code> using <code>Helm</code>, configuring <code>Prometheus</code> to collect metrics, setting up <code>Grafana</code> to visualize key metrics, and automating the setup using a bash script.</li>
</ul>
<hr />
<h2 id="15-prometheus-grafana-introduction-to-prometheus-and-grafana">Introduction to Prometheus and Grafana<a class="headerlink" href="#15-prometheus-grafana-introduction-to-prometheus-and-grafana" title="Permanent link">&para;</a></h2>
<h3 id="15-prometheus-grafana-prometheus"><code>Prometheus</code><a class="headerlink" href="#15-prometheus-grafana-prometheus" title="Permanent link">&para;</a></h3>
<ul>
<li><code>Prometheus</code> is an open-source systems monitoring and alerting toolkit designed for reliability and scalability. </li>
<li>It collects and stores metrics as time-series data, providing powerful querying capabilities. </li>
<li>It is commonly used in Kubernetes environments for monitoring cluster health, application performance, and infrastructure.</li>
</ul>
<h3 id="15-prometheus-grafana-grafana"><code>Grafana</code><a class="headerlink" href="#15-prometheus-grafana-grafana" title="Permanent link">&para;</a></h3>
<ul>
<li><code>Grafana</code> is a popular open-source data visualization tool that works well with <code>Prometheus</code>. </li>
<li>It allows you to create dashboards and visualize metrics in real-time, providing insights into system performance and application health. </li>
<li><code>Grafana</code> supports a wide range of visualization options, including <code>graphs</code>, <code>heatmaps</code>, <code>tables</code>, and more.</li>
<li>Together, <code>Prometheus</code> and <code>Grafana</code> provide a powerful stack for monitoring and alerting in Kubernetes.</li>
</ul>
<hr />
<h2 id="15-prometheus-grafana-part-01-installing-prometheus-and-grafana">Part 01 - Installing Prometheus and Grafana<a class="headerlink" href="#15-prometheus-grafana-part-01-installing-prometheus-and-grafana" title="Permanent link">&para;</a></h2>
<div class="admonition warning">
<p class="admonition-title">Helm Charts</p>
<p>We will use <a href="#13-helmchart">Helm</a>, to deploy Prometheus and Grafana.</p>
</div>
<h3 id="15-prometheus-grafana-step-01-add-prometheus-and-grafana-helm-repositories">Step 01 - Add Prometheus and Grafana Helm Repositories<a class="headerlink" href="#15-prometheus-grafana-step-01-add-prometheus-and-grafana-helm-repositories" title="Permanent link">&para;</a></h3>
<ul>
<li>Let&rsquo;s add the official <code>Helm</code> charts for <code>Prometheus</code> and <code>Grafana</code>:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#15-prometheus-grafana-__codelineno-0-1"></a><span class="c1"># Add Prometheus community Helm repository</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#15-prometheus-grafana-__codelineno-0-2"></a>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>prometheus-community<span class="w"> </span>https://prometheus-community.github.io/helm-charts
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#15-prometheus-grafana-__codelineno-0-3"></a><span class="c1"># Add Grafana Helm repository</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#15-prometheus-grafana-__codelineno-0-4"></a>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>grafana<span class="w"> </span>https://grafana.github.io/helm-charts
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#15-prometheus-grafana-__codelineno-0-5"></a><span class="c1"># Update your Helm repositories to make sure they are up-to-date</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#15-prometheus-grafana-__codelineno-0-6"></a>helm<span class="w"> </span>repo<span class="w"> </span>update
</span></code></pre></div>
<h3 id="15-prometheus-grafana-step-02-install-prometheus-stack">Step 02 - Install Prometheus Stack<a class="headerlink" href="#15-prometheus-grafana-step-02-install-prometheus-stack" title="Permanent link">&para;</a></h3>
<ul>
<li><code>Prometheus</code> is installed using the <code>prometheus-stack</code> <code>Helm</code> chart.</li>
</ul>
<p><strong>Install Prometheus, Alertmanager, and Node Exporter</strong>
  Create the <code>monitoring</code> namespace if it does not exist.
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#15-prometheus-grafana-__codelineno-1-1"></a>helm<span class="w"> </span>install<span class="w">  </span>prometheus<span class="w">                                  </span><span class="se">\</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#15-prometheus-grafana-__codelineno-1-2"></a><span class="w">              </span>--namespace<span class="w"> </span>monitoring<span class="w">                      </span><span class="se">\</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#15-prometheus-grafana-__codelineno-1-3"></a><span class="w">              </span>--create-namespace<span class="w">                          </span><span class="se">\</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#15-prometheus-grafana-__codelineno-1-4"></a><span class="w">              </span>prometheus-community/kube-prometheus-stack<span class="w">  </span>
</span></code></pre></div></p>
<p><strong>Verify the status of the release using the following:</strong>
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#15-prometheus-grafana-__codelineno-2-1"></a>helm<span class="w"> </span>status<span class="w"> </span>prometheus<span class="w"> </span>-n<span class="w"> </span>monitoring
</span></code></pre></div></p>
<h3 id="15-prometheus-grafana-step-03-install-grafana">Step 03 - Install Grafana<a class="headerlink" href="#15-prometheus-grafana-step-03-install-grafana" title="Permanent link">&para;</a></h3>
<ul>
<li>Now, let&rsquo;s install <code>Grafana</code>.</li>
<li><code>Grafana</code> will be deployed in the same <code>monitoring</code> namespace.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#15-prometheus-grafana-__codelineno-3-1"></a>helm<span class="w"> </span>install<span class="w"> </span>grafana<span class="w"> </span>grafana/grafana<span class="w"> </span>--namespace<span class="w"> </span>monitoring
</span></code></pre></div>
<p><strong>Verify the status of the release using the following:</strong>
  <div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#15-prometheus-grafana-__codelineno-4-1"></a>helm<span class="w"> </span>status<span class="w"> </span>grafana<span class="w"> </span>-n<span class="w"> </span>monitoring
</span></code></pre></div></p>
<h3 id="15-prometheus-grafana-step-04-access-grafana">Step 04 - Access Grafana<a class="headerlink" href="#15-prometheus-grafana-step-04-access-grafana" title="Permanent link">&para;</a></h3>
<ul>
<li><code>Grafana</code> will expose a service in your Kubernetes cluster.</li>
<li>To access it, you need a password and port forwarding.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#15-prometheus-grafana-__codelineno-5-1"></a><span class="c1"># In order to get the Grafana admin password, run the following command:</span>
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#15-prometheus-grafana-__codelineno-5-2"></a>kubectl<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>grafana<span class="w">          </span><span class="se">\</span>
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#15-prometheus-grafana-__codelineno-5-3"></a><span class="w">            </span>--namespace<span class="w"> </span>monitoring<span class="w">  </span><span class="se">\</span>
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#15-prometheus-grafana-__codelineno-5-4"></a><span class="w">            </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.data.admin-password}&#39;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>--decode<span class="w"> </span><span class="p">;</span><span class="w"> </span><span class="nb">echo</span>
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#15-prometheus-grafana-__codelineno-5-5"></a>
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#15-prometheus-grafana-__codelineno-5-6"></a><span class="c1"># Set the port forwarding so you can access the service using your browser</span>
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#15-prometheus-grafana-__codelineno-5-7"></a>kubectl<span class="w"> </span>port-forward<span class="w">            </span><span class="se">\</span>
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#15-prometheus-grafana-__codelineno-5-8"></a><span class="w">        </span>--namespace<span class="w"> </span>monitoring<span class="w">  </span><span class="se">\</span>
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#15-prometheus-grafana-__codelineno-5-9"></a><span class="w">        </span>service/grafana<span class="w"> </span><span class="m">3000</span>:80
</span></code></pre></div>
<ul>
<li>Verify that you can access <strong>Grafana</strong></li>
<li>Open your browser and navigate to <a href="http://localhost:3000">http://localhost:3000</a></li>
<li>The default login credentials are: <ul>
<li><strong>Username</strong>: <code>admin</code></li>
<li><strong>Password</strong>: (the password you retrieved earlier)</li>
</ul>
</li>
</ul>
<div class="admonition warning">
<p class="admonition-title">Accessing Grafana on Google Cloud Shell</p>
<p>If you are running your cluster in Google Cloud Shell, you cannot use <code>localhost</code> for port forwarding. Instead, use the Cloud Shell Web Preview:</p>
<ol>
<li>Run the port-forward command as usual:
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#15-prometheus-grafana-__codelineno-6-1"></a>kubectl<span class="w"> </span>port-forward<span class="w"> </span>--namespace<span class="w"> </span>monitoring<span class="w"> </span>service/grafana<span class="w"> </span><span class="m">3000</span>:80
</span></code></pre></div></li>
<li>In Google Cloud Shell, click the &ldquo;Web Preview&rdquo; button (top right) and select &ldquo;Preview on port 3000&rdquo;.</li>
<li>Grafana will open in a new browser tab.  </li>
<li><strong>Username</strong>: <code>admin</code></li>
<li><strong>Password</strong>: (the password you retrieved earlier)</li>
</ol>
<p><strong>Note:</strong> You can use any available port (e.g., 3000, 3001) in the port-forward command, just match it in the Web Preview.</p>
</div>
<hr />
<h2 id="15-prometheus-grafana-part-02-configuring-prometheus">Part 02 - Configuring Prometheus<a class="headerlink" href="#15-prometheus-grafana-part-02-configuring-prometheus" title="Permanent link">&para;</a></h2>
<ul>
<li><code>Prometheus</code> can collect various metrics from your Kubernetes cluster <strong>automatically</strong> if the right <strong>exporters</strong> are enabled. </li>
<li>The <strong>kube-prometheus-stack</strong> chart that you installed earlier automatically configures <code>Prometheus</code> to scrape a number of Kubernetes components (like <code>kubelet</code>, <code>node-exporter</code>, and <code>kube-state-metrics</code>) for various metrics.</li>
</ul>
<h3 id="15-prometheus-grafana-step-01-verify-prometheus-metrics-collection">Step 01 - Verify Prometheus Metrics Collection<a class="headerlink" href="#15-prometheus-grafana-step-01-verify-prometheus-metrics-collection" title="Permanent link">&para;</a></h3>
<ul>
<li>You can check if <code>Prometheus</code> is correctly scraping metrics by navigating to <code>Prometheus</code>&rsquo; web UI.</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#15-prometheus-grafana-__codelineno-7-1"></a><span class="c1"># Port-forward the Prometheus service:</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#15-prometheus-grafana-__codelineno-7-2"></a>kubectl<span class="w"> </span>port-forward<span class="w">            </span><span class="se">\</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#15-prometheus-grafana-__codelineno-7-3"></a><span class="w">        </span>--namespace<span class="w"> </span>monitoring<span class="w">  </span><span class="se">\</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#15-prometheus-grafana-__codelineno-7-4"></a><span class="w">        </span>svc/prometheus-operated<span class="w"> </span><span class="m">9090</span>:9090
</span></code></pre></div>
<ul>
<li>Verify that you can access <code>Prometheus</code></li>
<li>Open <a href="http://localhost:9090">http://localhost:9090</a></li>
<li>In the expression field paste the following:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#15-prometheus-grafana-__codelineno-8-1"></a><span class="c1"># This query will show the current status of the `kube-state-metrics` job</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#15-prometheus-grafana-__codelineno-8-2"></a>up<span class="o">{</span><span class="nv">job</span><span class="o">=</span><span class="s2">&quot;kube-state-metrics&quot;</span><span class="o">}</span>
</span></code></pre></div>
<div class="admonition warning">
<p class="admonition-title">Accessing Prometheus on Google Cloud Shell</p>
<p>If you are running your cluster in Google Cloud Shell, you cannot use <code>localhost</code> for port forwarding. Instead, use the Cloud Shell Web Preview:</p>
<ol>
<li>Run the port-forward command as usual:
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#15-prometheus-grafana-__codelineno-9-1"></a>kubectl<span class="w"> </span>port-forward<span class="w"> </span>--namespace<span class="w"> </span>monitoring<span class="w"> </span>svc/prometheus-operated<span class="w"> </span><span class="m">9090</span>:9090
</span></code></pre></div></li>
<li>In Google Cloud Shell, click the &ldquo;Web Preview&rdquo; button (top right) and select &ldquo;Preview on port 9090&rdquo;.</li>
<li>Prometheus will open in a new browser tab.</li>
</ol>
<p><strong>Note:</strong> You can use any available port (e.g., 9090, 9091) in the port-forward command, just match it in the Web Preview.</p>
</div>
<hr />
<h2 id="15-prometheus-grafana-part-03-configuring-grafana">Part 03 - Configuring Grafana<a class="headerlink" href="#15-prometheus-grafana-part-03-configuring-grafana" title="Permanent link">&para;</a></h2>
<ul>
<li>In this part we will set <code>Grafana</code> to display the Cluster&rsquo;s CPUs, Memory, and Requests.</li>
<li><code>Grafana</code> dashboards can be configured to display <strong>real-time metrics</strong> for CPU, memory, and requests.</li>
<li><code>Prometheus</code> stores these metrics and <code>Grafana</code> will query <code>Prometheus</code> to display them.</li>
</ul>
<h3 id="15-prometheus-grafana-step-01-add-prometheus-as-a-data-source-in-grafana">Step 01 - Add Prometheus as a Data Source in Grafana<a class="headerlink" href="#15-prometheus-grafana-step-01-add-prometheus-as-a-data-source-in-grafana" title="Permanent link">&para;</a></h3>
<ol>
<li>Log into <code>Grafana</code> at: <a href="http://localhost:3000">http://localhost:3000</a>, or use the <strong>Cloud Shell Web Preview</strong>.</li>
<li>Click on the hamburger icon on the left sidebar to open the <strong>Configuration</strong> menu.</li>
<li>Click on <strong>Data Sources</strong>.</li>
<li>Click <strong>Add data source</strong> and choose <strong>Prometheus</strong>.</li>
<li>In the <strong>URL</strong> field, enter the Prometheus server URL: <code>http://prometheus-operated:9090</code>.</li>
<li>Click <strong>Save &amp; Test</strong> to confirm that the connection is working.</li>
</ol>
<h3 id="15-prometheus-grafana-step-02-create-a-dashboard-to-display-metrics">Step 02 - Create a Dashboard to Display Metrics<a class="headerlink" href="#15-prometheus-grafana-step-02-create-a-dashboard-to-display-metrics" title="Permanent link">&para;</a></h3>
<ul>
<li>Next step is to create a dashboard and panels to display the desired metrics.</li>
<li>
<p>To create a dashboard in <code>Grafana</code> for CPU, memory, and requests do the following:</p>
</li>
<li>
<p>In <code>Grafana</code>, open the left sidebar menu and select <strong>Dashboard</strong>.</p>
</li>
<li>Click <strong>Add visualization</strong>.</li>
<li>Choose the <code>Data Source</code> (as we defined it previously).</li>
<li>In the panel editor, click on the <strong>Code</strong> option (right side of the query builder).</li>
<li>Use the queries below to visualize the metrics: 
     Note: To add a new query, click on <strong>+ Add query</strong>.</li>
<li>Save the dashboard.</li>
</ul>
<p><br></p>
<ul>
<li><strong>CPU Usage</strong></li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#15-prometheus-grafana-__codelineno-10-1"></a>sum(rate(container_cpu_usage_seconds_total{namespace=&quot;default&quot;, container!=&quot;&quot;, container!=&quot;POD&quot;}[5m])) by (pod, namespace)
</span></code></pre></div>
<ul>
<li><strong>Memory Usage</strong> :</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#15-prometheus-grafana-__codelineno-11-1"></a>sum(container_memory_usage_bytes{namespace=&quot;default&quot;, container!=&quot;&quot;, container!=&quot;POD&quot;}) by (pod, namespace)
</span></code></pre></div>
<ul>
<li><strong>Request Count</strong> :</li>
</ul>
<div class="language-text highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#15-prometheus-grafana-__codelineno-12-1"></a>sum(rate(http_requests_total{job=&quot;kubelet&quot;, cluster=&quot;&quot;, namespace=&quot;default&quot;}[5m])) by (pod, namespace)
</span></code></pre></div>
<h3 id="15-prometheus-grafana-step-03-get-number-of-pods-in-the-cluster">Step 03 - Get Number of Pods in the Cluster<a class="headerlink" href="#15-prometheus-grafana-step-03-get-number-of-pods-in-the-cluster" title="Permanent link">&para;</a></h3>
<ul>
<li>To track the number of pods running in the cluster, add new panel with the following query:</li>
</ul>
<p><strong>This query counts the number of pods running in all the namespaces</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#15-prometheus-grafana-__codelineno-13-1"></a>count<span class="o">(</span>kube_pod_info<span class="o">{})</span><span class="w"> </span>by<span class="w"> </span><span class="o">(</span>namespace<span class="o">)</span>
</span></code></pre></div></p>
<ul>
<li>Add another query that counts the number of pods in the <code>monitoring</code> namespace:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#15-prometheus-grafana-__codelineno-14-1"></a>count<span class="o">(</span>kube_pod_info<span class="o">{</span><span class="nv">namespace</span><span class="o">=</span><span class="s2">&quot;monitoring&quot;</span><span class="o">})</span><span class="w"> </span>by<span class="w"> </span><span class="o">(</span>namespace<span class="o">)</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Tip</p>
<p>We have already defined queries based on namespaces before&hellip;
You can use the same approach to filter by other labels as well.</p>
</div>
<h3 id="15-prometheus-grafana-step-04-customize-the-panel">Step 04: Customize the Panel<a class="headerlink" href="#15-prometheus-grafana-step-04-customize-the-panel" title="Permanent link">&para;</a></h3>
<ul>
<li>Change the visualization by changing the <strong>Graph Style</strong></li>
</ul></section><section class="print-page" id="16-affinity-taint-toleration" heading-number="2.18"><!-- omit in toc -->
<h1 id="16-affinity-taint-toleration-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#16-affinity-taint-toleration-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="16-affinity-taint-toleration-node-affinity-taints-and-tolerations-lab">Node Affinity, Taints, and Tolerations Lab<a class="headerlink" href="#16-affinity-taint-toleration-node-affinity-taints-and-tolerations-lab" title="Permanent link">&para;</a></h2>
<ul>
<li>In this lab, we will explore Kubernetes mechanisms for controlling Pod placement on Nodes.</li>
<li>We will learn how to use <code>Node Affinity</code>, <code>Taints</code>, and <code>Tolerations</code> to schedule Pods on specific Nodes based on labels, constraints, and preferences.</li>
<li>By the end of this lab, you will understand how to control where Pods run in your cluster and how to reserve Nodes for specific workloads.</li>
</ul>
<hr />
<!-- omit in toc -->
<h3 id="16-affinity-taint-toleration-prerequisites">Prerequisites<a class="headerlink" href="#16-affinity-taint-toleration-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>K8S cluster - <a href="#00-verifycluster">Setting up minikube cluster instruction</a></li>
<li><a href="https://kubernetes.io/docs/tasks/tools/"><strong>kubectl</strong></a> configured to interact with your cluster</li>
</ul>
<p><a href="https://ide.cloud.google.com/?cloudshell_git_repo=https://github.com/nirgeier/KubernetesLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a></p>
<h3 id="16-affinity-taint-toleration-ctrl-click-to-open-in-new-window"><strong><kbd>CTRL</kbd> + <kbd>click</kbd> to open in new window</strong><a class="headerlink" href="#16-affinity-taint-toleration-ctrl-click-to-open-in-new-window" title="Permanent link">&para;</a></h3>
<!-- omit in toc -->
<hr />
<h2 id="16-affinity-taint-toleration-introduction-to-pod-scheduling">Introduction to Pod Scheduling<a class="headerlink" href="#16-affinity-taint-toleration-introduction-to-pod-scheduling" title="Permanent link">&para;</a></h2>
<p>Kubernetes provides several mechanisms to control which Nodes your Pods run on:</p>
<h3 id="16-affinity-taint-toleration-node-affinity">Node Affinity<a class="headerlink" href="#16-affinity-taint-toleration-node-affinity" title="Permanent link">&para;</a></h3>
<ul>
<li><code>Node Affinity</code> allows us to constrain which Nodes our Pods can be scheduled on based on Node labels.</li>
<li>It&rsquo;s a more expressive and flexible version of <code>nodeSelector</code>.</li>
<li>There are two types:</li>
<li><strong><code>requiredDuringSchedulingIgnoredDuringExecution</code></strong>: Hard requirement - Pod will not be scheduled unless the rule is met.</li>
<li><strong><code>preferredDuringSchedulingIgnoredDuringExecution</code></strong>: Soft preference - Scheduler will try to enforce but will still schedule the Pod if it can&rsquo;t.</li>
</ul>
<h3 id="16-affinity-taint-toleration-taints-and-tolerations">Taints and Tolerations<a class="headerlink" href="#16-affinity-taint-toleration-taints-and-tolerations" title="Permanent link">&para;</a></h3>
<ul>
<li><code>Taints</code> are applied to Nodes and allow a Node to repel a set of Pods.</li>
<li><code>Tolerations</code> are applied to Pods and allow (but do not require) Pods to schedule onto Nodes with matching <code>Taints</code>.</li>
<li><code>Taints</code> and <code>Tolerations</code> work together to ensure that Pods are not scheduled onto inappropriate Nodes.</li>
<li>Use cases include:<ul>
<li>Dedicating Nodes to specific workloads</li>
<li>Reserving Nodes with special hardware (GPUs, SSDs)</li>
<li>Isolating problematic Pods</li>
</ul>
</li>
</ul>
<hr />
<h2 id="16-affinity-taint-toleration-part-01-node-affinity">Part 01 - Node Affinity<a class="headerlink" href="#16-affinity-taint-toleration-part-01-node-affinity" title="Permanent link">&para;</a></h2>
<ul>
<li>In this section, we will learn how to use Node <code>Affinity</code> to schedule Pods on specific Nodes.</li>
</ul>
<h3 id="16-affinity-taint-toleration-step-01-label-your-nodes">Step 01 - Label Your Nodes<a class="headerlink" href="#16-affinity-taint-toleration-step-01-label-your-nodes" title="Permanent link">&para;</a></h3>
<ul>
<li>First, let&rsquo;s label some Nodes to use with Node <code>Affinity</code>:</li>
</ul>
<p><strong>Get list of nodes</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#16-affinity-taint-toleration-__codelineno-0-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>nodes
</span></code></pre></div></p>
<p><strong>Label a node with environment=production</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#16-affinity-taint-toleration-__codelineno-1-1"></a>kubectl<span class="w"> </span>label<span class="w"> </span>nodes<span class="w"> </span>&lt;node-name&gt;<span class="w"> </span><span class="nv">environment</span><span class="o">=</span>production
</span></code></pre></div></p>
<p><strong>Label another node with environment=development</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#16-affinity-taint-toleration-__codelineno-2-1"></a>kubectl<span class="w"> </span>label<span class="w"> </span>nodes<span class="w"> </span>&lt;node-name&gt;<span class="w"> </span><span class="nv">environment</span><span class="o">=</span>development
</span></code></pre></div></p>
<p><strong>Verify the labels</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#16-affinity-taint-toleration-__codelineno-3-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>nodes<span class="w"> </span>--show-labels
</span></code></pre></div></p>
<h3 id="16-affinity-taint-toleration-step-02-create-a-pod-with-required-node-affinity">Step 02 - Create a Pod with Required Node Affinity<a class="headerlink" href="#16-affinity-taint-toleration-step-02-create-a-pod-with-required-node-affinity" title="Permanent link">&para;</a></h3>
<ul>
<li>Create a Pod that <strong>must</strong> run on a Node with <code>environment=production</code>:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#16-affinity-taint-toleration-__codelineno-4-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#16-affinity-taint-toleration-__codelineno-4-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#16-affinity-taint-toleration-__codelineno-4-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#16-affinity-taint-toleration-__codelineno-4-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">affinity-required-pod</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#16-affinity-taint-toleration-__codelineno-4-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#16-affinity-taint-toleration-__codelineno-4-6"></a><span class="w">  </span><span class="nt">affinity</span><span class="p">:</span>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#16-affinity-taint-toleration-__codelineno-4-7"></a><span class="w">    </span><span class="nt">nodeAffinity</span><span class="p">:</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#16-affinity-taint-toleration-__codelineno-4-8"></a><span class="w">      </span><span class="nt">requiredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#16-affinity-taint-toleration-__codelineno-4-9"></a><span class="w">        </span><span class="nt">nodeSelectorTerms</span><span class="p">:</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#16-affinity-taint-toleration-__codelineno-4-10"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">matchExpressions</span><span class="p">:</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#16-affinity-taint-toleration-__codelineno-4-11"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">environment</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#16-affinity-taint-toleration-__codelineno-4-12"></a><span class="w">            </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">In</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#16-affinity-taint-toleration-__codelineno-4-13"></a><span class="w">            </span><span class="nt">values</span><span class="p">:</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#16-affinity-taint-toleration-__codelineno-4-14"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-4-15"><a id="__codelineno-4-15" name="__codelineno-4-15" href="#16-affinity-taint-toleration-__codelineno-4-15"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-4-16"><a id="__codelineno-4-16" name="__codelineno-4-16" href="#16-affinity-taint-toleration-__codelineno-4-16"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-4-17"><a id="__codelineno-4-17" name="__codelineno-4-17" href="#16-affinity-taint-toleration-__codelineno-4-17"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span></code></pre></div>
<ul>
<li>Apply the Pod:</li>
</ul>
<p><strong>Create the Pod</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#16-affinity-taint-toleration-__codelineno-5-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>affinity-required-pod.yaml
</span></code></pre></div></p>
<p><strong>Check which Node the Pod is running on</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#16-affinity-taint-toleration-__codelineno-6-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>affinity-required-pod<span class="w"> </span>-o<span class="w"> </span>wide
</span></code></pre></div></p>
<p><strong>Verify it&rsquo;s running on the production Node</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#16-affinity-taint-toleration-__codelineno-7-1"></a>kubectl<span class="w"> </span>describe<span class="w"> </span>pod<span class="w"> </span>affinity-required-pod<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>Node:
</span></code></pre></div></p>
<h3 id="16-affinity-taint-toleration-step-03-create-a-pod-with-preferred-node-affinity">Step 03 - Create a Pod with Preferred Node Affinity<a class="headerlink" href="#16-affinity-taint-toleration-step-03-create-a-pod-with-preferred-node-affinity" title="Permanent link">&para;</a></h3>
<ul>
<li>Create a Pod that <strong>prefers</strong> to run on a Node with <code>environment=development</code>:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#16-affinity-taint-toleration-__codelineno-8-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#16-affinity-taint-toleration-__codelineno-8-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#16-affinity-taint-toleration-__codelineno-8-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#16-affinity-taint-toleration-__codelineno-8-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">affinity-preferred-pod</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#16-affinity-taint-toleration-__codelineno-8-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#16-affinity-taint-toleration-__codelineno-8-6"></a><span class="w">  </span><span class="nt">affinity</span><span class="p">:</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#16-affinity-taint-toleration-__codelineno-8-7"></a><span class="w">    </span><span class="nt">nodeAffinity</span><span class="p">:</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#16-affinity-taint-toleration-__codelineno-8-8"></a><span class="w">      </span><span class="nt">preferredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#16-affinity-taint-toleration-__codelineno-8-9"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">weight</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span>
</span><span id="__span-8-10"><a id="__codelineno-8-10" name="__codelineno-8-10" href="#16-affinity-taint-toleration-__codelineno-8-10"></a><span class="w">        </span><span class="nt">preference</span><span class="p">:</span>
</span><span id="__span-8-11"><a id="__codelineno-8-11" name="__codelineno-8-11" href="#16-affinity-taint-toleration-__codelineno-8-11"></a><span class="w">          </span><span class="nt">matchExpressions</span><span class="p">:</span>
</span><span id="__span-8-12"><a id="__codelineno-8-12" name="__codelineno-8-12" href="#16-affinity-taint-toleration-__codelineno-8-12"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">environment</span>
</span><span id="__span-8-13"><a id="__codelineno-8-13" name="__codelineno-8-13" href="#16-affinity-taint-toleration-__codelineno-8-13"></a><span class="w">            </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">In</span>
</span><span id="__span-8-14"><a id="__codelineno-8-14" name="__codelineno-8-14" href="#16-affinity-taint-toleration-__codelineno-8-14"></a><span class="w">            </span><span class="nt">values</span><span class="p">:</span>
</span><span id="__span-8-15"><a id="__codelineno-8-15" name="__codelineno-8-15" href="#16-affinity-taint-toleration-__codelineno-8-15"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">development</span>
</span><span id="__span-8-16"><a id="__codelineno-8-16" name="__codelineno-8-16" href="#16-affinity-taint-toleration-__codelineno-8-16"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-8-17"><a id="__codelineno-8-17" name="__codelineno-8-17" href="#16-affinity-taint-toleration-__codelineno-8-17"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-8-18"><a id="__codelineno-8-18" name="__codelineno-8-18" href="#16-affinity-taint-toleration-__codelineno-8-18"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span></code></pre></div>
<ul>
<li>Apply the Pod:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#16-affinity-taint-toleration-__codelineno-9-1"></a><span class="c1"># Create the Pod</span>
</span><span id="__span-9-2"><a id="__codelineno-9-2" name="__codelineno-9-2" href="#16-affinity-taint-toleration-__codelineno-9-2"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>affinity-preferred-pod.yaml
</span><span id="__span-9-3"><a id="__codelineno-9-3" name="__codelineno-9-3" href="#16-affinity-taint-toleration-__codelineno-9-3"></a>
</span><span id="__span-9-4"><a id="__codelineno-9-4" name="__codelineno-9-4" href="#16-affinity-taint-toleration-__codelineno-9-4"></a><span class="c1"># Check which Node the Pod is running on</span>
</span><span id="__span-9-5"><a id="__codelineno-9-5" name="__codelineno-9-5" href="#16-affinity-taint-toleration-__codelineno-9-5"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>affinity-preferred-pod<span class="w"> </span>-o<span class="w"> </span>wide
</span><span id="__span-9-6"><a id="__codelineno-9-6" name="__codelineno-9-6" href="#16-affinity-taint-toleration-__codelineno-9-6"></a>
</span><span id="__span-9-7"><a id="__codelineno-9-7" name="__codelineno-9-7" href="#16-affinity-taint-toleration-__codelineno-9-7"></a><span class="c1"># This Pod will prefer the development Node but can run elsewhere if needed</span>
</span></code></pre></div>
<h3 id="16-affinity-taint-toleration-step-04-experiment-with-node-affinity-operators">Step 04 - Experiment with Node Affinity Operators<a class="headerlink" href="#16-affinity-taint-toleration-step-04-experiment-with-node-affinity-operators" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><code>Node Affinity</code> supports several operators:</p>
<ul>
<li><strong><code>In</code></strong>: Label value is in the list of values</li>
<li><strong><code>NotIn</code></strong>: Label value is not in the list of values</li>
<li><strong><code>Exists</code></strong>: Label key exists (value does not matter)</li>
<li><strong><code>DoesNotExist</code></strong>: Label key does not exist</li>
<li><strong><code>Gt</code></strong>: Label value is greater than the specified value (numeric comparison)</li>
<li><strong><code>Lt</code></strong>: Label value is less than the specified value (numeric comparison)</li>
</ul>
</li>
<li>
<p>Example with multiple conditions:</p>
</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#16-affinity-taint-toleration-__codelineno-10-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#16-affinity-taint-toleration-__codelineno-10-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
</span><span id="__span-10-3"><a id="__codelineno-10-3" name="__codelineno-10-3" href="#16-affinity-taint-toleration-__codelineno-10-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-10-4"><a id="__codelineno-10-4" name="__codelineno-10-4" href="#16-affinity-taint-toleration-__codelineno-10-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">affinity-multiple-conditions</span>
</span><span id="__span-10-5"><a id="__codelineno-10-5" name="__codelineno-10-5" href="#16-affinity-taint-toleration-__codelineno-10-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-10-6"><a id="__codelineno-10-6" name="__codelineno-10-6" href="#16-affinity-taint-toleration-__codelineno-10-6"></a><span class="w">  </span><span class="nt">affinity</span><span class="p">:</span>
</span><span id="__span-10-7"><a id="__codelineno-10-7" name="__codelineno-10-7" href="#16-affinity-taint-toleration-__codelineno-10-7"></a><span class="w">    </span><span class="nt">nodeAffinity</span><span class="p">:</span>
</span><span id="__span-10-8"><a id="__codelineno-10-8" name="__codelineno-10-8" href="#16-affinity-taint-toleration-__codelineno-10-8"></a><span class="w">      </span><span class="nt">requiredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span>
</span><span id="__span-10-9"><a id="__codelineno-10-9" name="__codelineno-10-9" href="#16-affinity-taint-toleration-__codelineno-10-9"></a><span class="w">        </span><span class="nt">nodeSelectorTerms</span><span class="p">:</span>
</span><span id="__span-10-10"><a id="__codelineno-10-10" name="__codelineno-10-10" href="#16-affinity-taint-toleration-__codelineno-10-10"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">matchExpressions</span><span class="p">:</span>
</span><span id="__span-10-11"><a id="__codelineno-10-11" name="__codelineno-10-11" href="#16-affinity-taint-toleration-__codelineno-10-11"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">environment</span>
</span><span id="__span-10-12"><a id="__codelineno-10-12" name="__codelineno-10-12" href="#16-affinity-taint-toleration-__codelineno-10-12"></a><span class="w">            </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">In</span>
</span><span id="__span-10-13"><a id="__codelineno-10-13" name="__codelineno-10-13" href="#16-affinity-taint-toleration-__codelineno-10-13"></a><span class="w">            </span><span class="nt">values</span><span class="p">:</span>
</span><span id="__span-10-14"><a id="__codelineno-10-14" name="__codelineno-10-14" href="#16-affinity-taint-toleration-__codelineno-10-14"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">production</span>
</span><span id="__span-10-15"><a id="__codelineno-10-15" name="__codelineno-10-15" href="#16-affinity-taint-toleration-__codelineno-10-15"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">staging</span>
</span><span id="__span-10-16"><a id="__codelineno-10-16" name="__codelineno-10-16" href="#16-affinity-taint-toleration-__codelineno-10-16"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">disk-type</span>
</span><span id="__span-10-17"><a id="__codelineno-10-17" name="__codelineno-10-17" href="#16-affinity-taint-toleration-__codelineno-10-17"></a><span class="w">            </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Exists</span>
</span><span id="__span-10-18"><a id="__codelineno-10-18" name="__codelineno-10-18" href="#16-affinity-taint-toleration-__codelineno-10-18"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-10-19"><a id="__codelineno-10-19" name="__codelineno-10-19" href="#16-affinity-taint-toleration-__codelineno-10-19"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-10-20"><a id="__codelineno-10-20" name="__codelineno-10-20" href="#16-affinity-taint-toleration-__codelineno-10-20"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span></code></pre></div>
<hr />
<h2 id="16-affinity-taint-toleration-part-02-taints-and-tolerations">Part 02 - Taints and Tolerations<a class="headerlink" href="#16-affinity-taint-toleration-part-02-taints-and-tolerations" title="Permanent link">&para;</a></h2>
<ul>
<li>In this section, we will learn how to use <code>Taints</code> and <code>Tolerations</code> to control Pod scheduling.</li>
</ul>
<h3 id="16-affinity-taint-toleration-step-01-understanding-taint-effects">Step 01 - Understanding Taint Effects<a class="headerlink" href="#16-affinity-taint-toleration-step-01-understanding-taint-effects" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><code>Taints</code> have three effects:</p>
<ul>
<li><strong><code>NoSchedule</code></strong>: Pods without matching <code>tolerations</code> will not be scheduled on the Node.</li>
<li><strong><code>PreferNoSchedule</code></strong>: Scheduler will try to avoid placing Pods without <code>tolerations</code>, but it&rsquo;s not guaranteed.</li>
<li><strong><code>NoExecute</code></strong>: Existing Pods without <code>tolerations</code> will be evicted, and new ones won&rsquo;t be scheduled.</li>
</ul>
</li>
</ul>
<h3 id="16-affinity-taint-toleration-step-02-apply-a-taint-to-a-node">Step 02 - Apply a Taint to a Node<a class="headerlink" href="#16-affinity-taint-toleration-step-02-apply-a-taint-to-a-node" title="Permanent link">&para;</a></h3>
<ul>
<li>Let&rsquo;s <code>taint</code> a Node to dedicate it for special workloads:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#16-affinity-taint-toleration-__codelineno-11-1"></a><span class="c1"># Apply a taint to a Node</span>
</span><span id="__span-11-2"><a id="__codelineno-11-2" name="__codelineno-11-2" href="#16-affinity-taint-toleration-__codelineno-11-2"></a>kubectl<span class="w"> </span>taint<span class="w"> </span>nodes<span class="w"> </span>&lt;node-name&gt;<span class="w"> </span><span class="nv">dedicated</span><span class="o">=</span>special-workload:NoSchedule
</span><span id="__span-11-3"><a id="__codelineno-11-3" name="__codelineno-11-3" href="#16-affinity-taint-toleration-__codelineno-11-3"></a>
</span><span id="__span-11-4"><a id="__codelineno-11-4" name="__codelineno-11-4" href="#16-affinity-taint-toleration-__codelineno-11-4"></a><span class="c1"># Verify the taint</span>
</span><span id="__span-11-5"><a id="__codelineno-11-5" name="__codelineno-11-5" href="#16-affinity-taint-toleration-__codelineno-11-5"></a>kubectl<span class="w"> </span>describe<span class="w"> </span>node<span class="w"> </span>&lt;node-name&gt;<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>Taints
</span></code></pre></div>
<h3 id="16-affinity-taint-toleration-step-03-create-a-pod-without-toleration">Step 03 - Create a Pod Without Toleration<a class="headerlink" href="#16-affinity-taint-toleration-step-03-create-a-pod-without-toleration" title="Permanent link">&para;</a></h3>
<ul>
<li>Let&rsquo;s try to create a Pod without a <code>toleration</code>:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#16-affinity-taint-toleration-__codelineno-12-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#16-affinity-taint-toleration-__codelineno-12-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#16-affinity-taint-toleration-__codelineno-12-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#16-affinity-taint-toleration-__codelineno-12-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod-without-toleration</span>
</span><span id="__span-12-5"><a id="__codelineno-12-5" name="__codelineno-12-5" href="#16-affinity-taint-toleration-__codelineno-12-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-12-6"><a id="__codelineno-12-6" name="__codelineno-12-6" href="#16-affinity-taint-toleration-__codelineno-12-6"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-12-7"><a id="__codelineno-12-7" name="__codelineno-12-7" href="#16-affinity-taint-toleration-__codelineno-12-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-12-8"><a id="__codelineno-12-8" name="__codelineno-12-8" href="#16-affinity-taint-toleration-__codelineno-12-8"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#16-affinity-taint-toleration-__codelineno-13-1"></a><span class="c1"># Create the Pod</span>
</span><span id="__span-13-2"><a id="__codelineno-13-2" name="__codelineno-13-2" href="#16-affinity-taint-toleration-__codelineno-13-2"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>pod-without-toleration.yaml
</span><span id="__span-13-3"><a id="__codelineno-13-3" name="__codelineno-13-3" href="#16-affinity-taint-toleration-__codelineno-13-3"></a>
</span><span id="__span-13-4"><a id="__codelineno-13-4" name="__codelineno-13-4" href="#16-affinity-taint-toleration-__codelineno-13-4"></a><span class="c1"># Check the Pod status - it should not be scheduled on the tainted Node</span>
</span><span id="__span-13-5"><a id="__codelineno-13-5" name="__codelineno-13-5" href="#16-affinity-taint-toleration-__codelineno-13-5"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>pod-without-toleration<span class="w"> </span>-o<span class="w"> </span>wide
</span><span id="__span-13-6"><a id="__codelineno-13-6" name="__codelineno-13-6" href="#16-affinity-taint-toleration-__codelineno-13-6"></a>
</span><span id="__span-13-7"><a id="__codelineno-13-7" name="__codelineno-13-7" href="#16-affinity-taint-toleration-__codelineno-13-7"></a><span class="c1"># If all your Nodes are tainted, the Pod will remain Pending</span>
</span><span id="__span-13-8"><a id="__codelineno-13-8" name="__codelineno-13-8" href="#16-affinity-taint-toleration-__codelineno-13-8"></a>kubectl<span class="w"> </span>describe<span class="w"> </span>pod<span class="w"> </span>pod-without-toleration
</span></code></pre></div>
<h3 id="16-affinity-taint-toleration-step-04-create-a-pod-with-toleration">Step 04 - Create a Pod With Toleration<a class="headerlink" href="#16-affinity-taint-toleration-step-04-create-a-pod-with-toleration" title="Permanent link">&para;</a></h3>
<ul>
<li>Now let&rsquo;s create a Pod that tolerates the <code>taint</code>:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#16-affinity-taint-toleration-__codelineno-14-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#16-affinity-taint-toleration-__codelineno-14-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
</span><span id="__span-14-3"><a id="__codelineno-14-3" name="__codelineno-14-3" href="#16-affinity-taint-toleration-__codelineno-14-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-14-4"><a id="__codelineno-14-4" name="__codelineno-14-4" href="#16-affinity-taint-toleration-__codelineno-14-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod-with-toleration</span>
</span><span id="__span-14-5"><a id="__codelineno-14-5" name="__codelineno-14-5" href="#16-affinity-taint-toleration-__codelineno-14-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-14-6"><a id="__codelineno-14-6" name="__codelineno-14-6" href="#16-affinity-taint-toleration-__codelineno-14-6"></a><span class="w">  </span><span class="nt">tolerations</span><span class="p">:</span>
</span><span id="__span-14-7"><a id="__codelineno-14-7" name="__codelineno-14-7" href="#16-affinity-taint-toleration-__codelineno-14-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dedicated&quot;</span>
</span><span id="__span-14-8"><a id="__codelineno-14-8" name="__codelineno-14-8" href="#16-affinity-taint-toleration-__codelineno-14-8"></a><span class="w">    </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Equal&quot;</span>
</span><span id="__span-14-9"><a id="__codelineno-14-9" name="__codelineno-14-9" href="#16-affinity-taint-toleration-__codelineno-14-9"></a><span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;special-workload&quot;</span>
</span><span id="__span-14-10"><a id="__codelineno-14-10" name="__codelineno-14-10" href="#16-affinity-taint-toleration-__codelineno-14-10"></a><span class="w">    </span><span class="nt">effect</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;NoSchedule&quot;</span>
</span><span id="__span-14-11"><a id="__codelineno-14-11" name="__codelineno-14-11" href="#16-affinity-taint-toleration-__codelineno-14-11"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-14-12"><a id="__codelineno-14-12" name="__codelineno-14-12" href="#16-affinity-taint-toleration-__codelineno-14-12"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-14-13"><a id="__codelineno-14-13" name="__codelineno-14-13" href="#16-affinity-taint-toleration-__codelineno-14-13"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#16-affinity-taint-toleration-__codelineno-15-1"></a><span class="c1"># Create the Pod</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#16-affinity-taint-toleration-__codelineno-15-2"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>pod-with-toleration.yaml
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#16-affinity-taint-toleration-__codelineno-15-3"></a>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#16-affinity-taint-toleration-__codelineno-15-4"></a><span class="c1"># This Pod can now be scheduled on the tainted Node</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#16-affinity-taint-toleration-__codelineno-15-5"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>pod-with-toleration<span class="w"> </span>-o<span class="w"> </span>wide
</span></code></pre></div>
<h3 id="16-affinity-taint-toleration-step-05-understanding-toleration-operators">Step 05 - Understanding Toleration Operators<a class="headerlink" href="#16-affinity-taint-toleration-step-05-understanding-toleration-operators" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Tolerations support two operators:</p>
<ul>
<li><strong><code>Equal</code></strong>: Requires exact match of key, value, and effect</li>
<li><strong><code>Exists</code></strong>: Only checks for key existence (value is ignored)</li>
</ul>
</li>
<li>
<p>Example with <code>Exists</code> operator:</p>
</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#16-affinity-taint-toleration-__codelineno-16-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#16-affinity-taint-toleration-__codelineno-16-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#16-affinity-taint-toleration-__codelineno-16-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#16-affinity-taint-toleration-__codelineno-16-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod-with-exists-toleration</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#16-affinity-taint-toleration-__codelineno-16-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#16-affinity-taint-toleration-__codelineno-16-6"></a><span class="w">  </span><span class="nt">tolerations</span><span class="p">:</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#16-affinity-taint-toleration-__codelineno-16-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;dedicated&quot;</span>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#16-affinity-taint-toleration-__codelineno-16-8"></a><span class="w">    </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Exists&quot;</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#16-affinity-taint-toleration-__codelineno-16-9"></a><span class="w">    </span><span class="nt">effect</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;NoSchedule&quot;</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#16-affinity-taint-toleration-__codelineno-16-10"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#16-affinity-taint-toleration-__codelineno-16-11"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#16-affinity-taint-toleration-__codelineno-16-12"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span></code></pre></div>
<h3 id="16-affinity-taint-toleration-step-06-noexecute-effect">Step 06 - NoExecute Effect<a class="headerlink" href="#16-affinity-taint-toleration-step-06-noexecute-effect" title="Permanent link">&para;</a></h3>
<ul>
<li>The <code>NoExecute</code> effect is special - it evicts running Pods:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#16-affinity-taint-toleration-__codelineno-17-1"></a><span class="c1"># Apply a NoExecute taint</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#16-affinity-taint-toleration-__codelineno-17-2"></a>kubectl<span class="w"> </span>taint<span class="w"> </span>nodes<span class="w"> </span>&lt;node-name&gt;<span class="w"> </span><span class="nv">maintenance</span><span class="o">=</span>true:NoExecute
</span><span id="__span-17-3"><a id="__codelineno-17-3" name="__codelineno-17-3" href="#16-affinity-taint-toleration-__codelineno-17-3"></a>
</span><span id="__span-17-4"><a id="__codelineno-17-4" name="__codelineno-17-4" href="#16-affinity-taint-toleration-__codelineno-17-4"></a><span class="c1"># Any Pods on this Node without matching toleration will be evicted</span>
</span><span id="__span-17-5"><a id="__codelineno-17-5" name="__codelineno-17-5" href="#16-affinity-taint-toleration-__codelineno-17-5"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-o<span class="w"> </span>wide<span class="w"> </span>--watch
</span></code></pre></div>
<ul>
<li>Let&rsquo;s add a toleration with <code>tolerationSeconds</code> to delay eviction:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#16-affinity-taint-toleration-__codelineno-18-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#16-affinity-taint-toleration-__codelineno-18-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#16-affinity-taint-toleration-__codelineno-18-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#16-affinity-taint-toleration-__codelineno-18-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pod-with-delayed-eviction</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#16-affinity-taint-toleration-__codelineno-18-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#16-affinity-taint-toleration-__codelineno-18-6"></a><span class="w">  </span><span class="nt">tolerations</span><span class="p">:</span>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#16-affinity-taint-toleration-__codelineno-18-7"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;maintenance&quot;</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#16-affinity-taint-toleration-__codelineno-18-8"></a><span class="w">    </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Equal&quot;</span>
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#16-affinity-taint-toleration-__codelineno-18-9"></a><span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#16-affinity-taint-toleration-__codelineno-18-10"></a><span class="w">    </span><span class="nt">effect</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;NoExecute&quot;</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#16-affinity-taint-toleration-__codelineno-18-11"></a><span class="w">    </span><span class="nt">tolerationSeconds</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">300</span><span class="w">  </span><span class="c1"># Pod will be evicted after 5 minutes</span>
</span><span id="__span-18-12"><a id="__codelineno-18-12" name="__codelineno-18-12" href="#16-affinity-taint-toleration-__codelineno-18-12"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-18-13"><a id="__codelineno-18-13" name="__codelineno-18-13" href="#16-affinity-taint-toleration-__codelineno-18-13"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-18-14"><a id="__codelineno-18-14" name="__codelineno-18-14" href="#16-affinity-taint-toleration-__codelineno-18-14"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx:latest</span>
</span></code></pre></div>
<hr />
<h2 id="16-affinity-taint-toleration-part-03-combining-affinity-taints-and-tolerations">Part 03 - Combining Affinity, Taints, and Tolerations<a class="headerlink" href="#16-affinity-taint-toleration-part-03-combining-affinity-taints-and-tolerations" title="Permanent link">&para;</a></h2>
<ul>
<li>We can combine <code>Node Affinity</code> with <code>Taints</code> and <code>Tolerations</code> for fine-grained control.</li>
</ul>
<h3 id="16-affinity-taint-toleration-step-01-create-a-dedicated-node-pool">Step 01 - Create a Dedicated Node Pool<a class="headerlink" href="#16-affinity-taint-toleration-step-01-create-a-dedicated-node-pool" title="Permanent link">&para;</a></h3>
<ul>
<li>Let&rsquo;s simulate a dedicated Node pool for GPU workloads:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#16-affinity-taint-toleration-__codelineno-19-1"></a><span class="c1"># Label a Node for GPU workload</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#16-affinity-taint-toleration-__codelineno-19-2"></a>kubectl<span class="w"> </span>label<span class="w"> </span>nodes<span class="w"> </span>&lt;node-name&gt;<span class="w"> </span><span class="nv">hardware</span><span class="o">=</span>gpu
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#16-affinity-taint-toleration-__codelineno-19-3"></a>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#16-affinity-taint-toleration-__codelineno-19-4"></a><span class="c1"># Taint the Node to prevent non-GPU Pods</span>
</span><span id="__span-19-5"><a id="__codelineno-19-5" name="__codelineno-19-5" href="#16-affinity-taint-toleration-__codelineno-19-5"></a>kubectl<span class="w"> </span>taint<span class="w"> </span>nodes<span class="w"> </span>&lt;node-name&gt;<span class="w"> </span>nvidia.com/gpu<span class="o">=</span>true:NoSchedule
</span></code></pre></div>
<h3 id="16-affinity-taint-toleration-step-02-deploy-a-gpu-workload">Step 02 - Deploy a GPU Workload<a class="headerlink" href="#16-affinity-taint-toleration-step-02-deploy-a-gpu-workload" title="Permanent link">&para;</a></h3>
<ul>
<li>Let&rsquo;s create a Pod that requires GPU Nodes:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#16-affinity-taint-toleration-__codelineno-20-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#16-affinity-taint-toleration-__codelineno-20-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Pod</span>
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#16-affinity-taint-toleration-__codelineno-20-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#16-affinity-taint-toleration-__codelineno-20-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpu-workload</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#16-affinity-taint-toleration-__codelineno-20-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-20-6"><a id="__codelineno-20-6" name="__codelineno-20-6" href="#16-affinity-taint-toleration-__codelineno-20-6"></a><span class="w">  </span><span class="nt">affinity</span><span class="p">:</span>
</span><span id="__span-20-7"><a id="__codelineno-20-7" name="__codelineno-20-7" href="#16-affinity-taint-toleration-__codelineno-20-7"></a><span class="w">    </span><span class="nt">nodeAffinity</span><span class="p">:</span>
</span><span id="__span-20-8"><a id="__codelineno-20-8" name="__codelineno-20-8" href="#16-affinity-taint-toleration-__codelineno-20-8"></a><span class="w">      </span><span class="nt">requiredDuringSchedulingIgnoredDuringExecution</span><span class="p">:</span>
</span><span id="__span-20-9"><a id="__codelineno-20-9" name="__codelineno-20-9" href="#16-affinity-taint-toleration-__codelineno-20-9"></a><span class="w">        </span><span class="nt">nodeSelectorTerms</span><span class="p">:</span>
</span><span id="__span-20-10"><a id="__codelineno-20-10" name="__codelineno-20-10" href="#16-affinity-taint-toleration-__codelineno-20-10"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">matchExpressions</span><span class="p">:</span>
</span><span id="__span-20-11"><a id="__codelineno-20-11" name="__codelineno-20-11" href="#16-affinity-taint-toleration-__codelineno-20-11"></a><span class="w">          </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hardware</span>
</span><span id="__span-20-12"><a id="__codelineno-20-12" name="__codelineno-20-12" href="#16-affinity-taint-toleration-__codelineno-20-12"></a><span class="w">            </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">In</span>
</span><span id="__span-20-13"><a id="__codelineno-20-13" name="__codelineno-20-13" href="#16-affinity-taint-toleration-__codelineno-20-13"></a><span class="w">            </span><span class="nt">values</span><span class="p">:</span>
</span><span id="__span-20-14"><a id="__codelineno-20-14" name="__codelineno-20-14" href="#16-affinity-taint-toleration-__codelineno-20-14"></a><span class="w">            </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpu</span>
</span><span id="__span-20-15"><a id="__codelineno-20-15" name="__codelineno-20-15" href="#16-affinity-taint-toleration-__codelineno-20-15"></a><span class="w">  </span><span class="nt">tolerations</span><span class="p">:</span>
</span><span id="__span-20-16"><a id="__codelineno-20-16" name="__codelineno-20-16" href="#16-affinity-taint-toleration-__codelineno-20-16"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">key</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;nvidia.com/gpu&quot;</span>
</span><span id="__span-20-17"><a id="__codelineno-20-17" name="__codelineno-20-17" href="#16-affinity-taint-toleration-__codelineno-20-17"></a><span class="w">    </span><span class="nt">operator</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;Equal&quot;</span>
</span><span id="__span-20-18"><a id="__codelineno-20-18" name="__codelineno-20-18" href="#16-affinity-taint-toleration-__codelineno-20-18"></a><span class="w">    </span><span class="nt">value</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;true&quot;</span>
</span><span id="__span-20-19"><a id="__codelineno-20-19" name="__codelineno-20-19" href="#16-affinity-taint-toleration-__codelineno-20-19"></a><span class="w">    </span><span class="nt">effect</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;NoSchedule&quot;</span>
</span><span id="__span-20-20"><a id="__codelineno-20-20" name="__codelineno-20-20" href="#16-affinity-taint-toleration-__codelineno-20-20"></a><span class="w">  </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-20-21"><a id="__codelineno-20-21" name="__codelineno-20-21" href="#16-affinity-taint-toleration-__codelineno-20-21"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">gpu-app</span>
</span><span id="__span-20-22"><a id="__codelineno-20-22" name="__codelineno-20-22" href="#16-affinity-taint-toleration-__codelineno-20-22"></a><span class="w">    </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nvidia/cuda:11.0-base</span>
</span><span id="__span-20-23"><a id="__codelineno-20-23" name="__codelineno-20-23" href="#16-affinity-taint-toleration-__codelineno-20-23"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;nvidia-smi&quot;</span><span class="p p-Indicator">]</span>
</span></code></pre></div>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#16-affinity-taint-toleration-__codelineno-21-1"></a><span class="c1"># Apply the Pod</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#16-affinity-taint-toleration-__codelineno-21-2"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>gpu-workload.yaml
</span><span id="__span-21-3"><a id="__codelineno-21-3" name="__codelineno-21-3" href="#16-affinity-taint-toleration-__codelineno-21-3"></a>
</span><span id="__span-21-4"><a id="__codelineno-21-4" name="__codelineno-21-4" href="#16-affinity-taint-toleration-__codelineno-21-4"></a><span class="c1"># Verify it&#39;s scheduled on the GPU Node</span>
</span><span id="__span-21-5"><a id="__codelineno-21-5" name="__codelineno-21-5" href="#16-affinity-taint-toleration-__codelineno-21-5"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>gpu-workload<span class="w"> </span>-o<span class="w"> </span>wide
</span></code></pre></div>
<hr />
<h2 id="16-affinity-taint-toleration-part-04-cleanup-and-best-practices">Part 04 - Cleanup and Best Practices<a class="headerlink" href="#16-affinity-taint-toleration-part-04-cleanup-and-best-practices" title="Permanent link">&para;</a></h2>
<h3 id="16-affinity-taint-toleration-step-01-remove-taints">Step 01 - Remove Taints<a class="headerlink" href="#16-affinity-taint-toleration-step-01-remove-taints" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#16-affinity-taint-toleration-__codelineno-22-1"></a><span class="c1"># Remove a taint from a Node (add a minus sign at the end)</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#16-affinity-taint-toleration-__codelineno-22-2"></a>kubectl<span class="w"> </span>taint<span class="w"> </span>nodes<span class="w"> </span>&lt;node-name&gt;<span class="w"> </span><span class="nv">dedicated</span><span class="o">=</span>special-workload:NoSchedule-
</span><span id="__span-22-3"><a id="__codelineno-22-3" name="__codelineno-22-3" href="#16-affinity-taint-toleration-__codelineno-22-3"></a>
</span><span id="__span-22-4"><a id="__codelineno-22-4" name="__codelineno-22-4" href="#16-affinity-taint-toleration-__codelineno-22-4"></a><span class="c1"># Remove all taints with a specific key</span>
</span><span id="__span-22-5"><a id="__codelineno-22-5" name="__codelineno-22-5" href="#16-affinity-taint-toleration-__codelineno-22-5"></a>kubectl<span class="w"> </span>taint<span class="w"> </span>nodes<span class="w"> </span>&lt;node-name&gt;<span class="w"> </span>nvidia.com/gpu-
</span></code></pre></div>
<h3 id="16-affinity-taint-toleration-step-02-remove-labels">Step 02 - Remove Labels<a class="headerlink" href="#16-affinity-taint-toleration-step-02-remove-labels" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#16-affinity-taint-toleration-__codelineno-23-1"></a><span class="c1"># Remove a label from a Node (add a minus sign at the end)</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#16-affinity-taint-toleration-__codelineno-23-2"></a>kubectl<span class="w"> </span>label<span class="w"> </span>nodes<span class="w"> </span>&lt;node-name&gt;<span class="w"> </span>environment-
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#16-affinity-taint-toleration-__codelineno-23-3"></a>kubectl<span class="w"> </span>label<span class="w"> </span>nodes<span class="w"> </span>&lt;node-name&gt;<span class="w"> </span>hardware-
</span></code></pre></div>
<h3 id="16-affinity-taint-toleration-step-03-delete-test-pods">Step 03 - Delete Test Pods<a class="headerlink" href="#16-affinity-taint-toleration-step-03-delete-test-pods" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#16-affinity-taint-toleration-__codelineno-24-1"></a><span class="c1"># Delete all test Pods</span>
</span><span id="__span-24-2"><a id="__codelineno-24-2" name="__codelineno-24-2" href="#16-affinity-taint-toleration-__codelineno-24-2"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>pod<span class="w"> </span>affinity-required-pod<span class="w"> </span>affinity-preferred-pod
</span><span id="__span-24-3"><a id="__codelineno-24-3" name="__codelineno-24-3" href="#16-affinity-taint-toleration-__codelineno-24-3"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>pod<span class="w"> </span>pod-with-toleration<span class="w"> </span>pod-without-toleration
</span><span id="__span-24-4"><a id="__codelineno-24-4" name="__codelineno-24-4" href="#16-affinity-taint-toleration-__codelineno-24-4"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>pod<span class="w"> </span>gpu-workload
</span></code></pre></div>
<hr />
<h3 id="16-affinity-taint-toleration-best-practices">Best Practices<a class="headerlink" href="#16-affinity-taint-toleration-best-practices" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Use Node Affinity for preferences</strong>, <code>Taints/Tolerations</code> for hard requirements.</li>
<li><strong>Label Nodes consistently</strong> across your cluster (e.g., <code>node-role</code>, <code>hardware-type</code>, <code>environment</code>).</li>
<li><strong>Document your taints</strong> - team members need to know why Nodes are tainted.</li>
<li><strong>Use <code>PreferNoSchedule</code></strong> for soft isolation instead of <code>NoSchedule</code> when appropriate.</li>
<li><strong>Combine with Pod Priority</strong> for more sophisticated scheduling strategies.</li>
<li><strong>Test eviction behavior</strong> before using <code>NoExecute</code> in production.</li>
<li><strong>Use tolerationSeconds</strong> to gracefully handle Node maintenance.</li>
<li><strong>Monitor unschedulable Pods</strong> - they indicate scheduling constraint conflicts.</li>
</ol>
<hr />
<h2 id="16-affinity-taint-toleration-summary">Summary<a class="headerlink" href="#16-affinity-taint-toleration-summary" title="Permanent link">&para;</a></h2>
<p>In this lab, you learned:</p>
<ul>
<li>How to use <strong>Node Affinity</strong> to schedule Pods on specific Nodes based on labels.</li>
<li>The difference between <code>required</code> and <code>preferred</code> affinity rules.</li>
<li>How to use <strong>Taints</strong> to repel Pods from Nodes.</li>
<li>How to use <strong>Tolerations</strong> to allow Pods on tainted Nodes.</li>
<li>The three taint effects: <code>NoSchedule</code>, <code>PreferNoSchedule</code>, and <code>NoExecute</code>.</li>
<li>How to combine affinity, taints, and tolerations for complex scheduling scenarios.</li>
<li>Best practices for Pod placement in production clusters.</li>
</ul>
<hr />
<h2 id="16-affinity-taint-toleration-additional-resources">Additional Resources<a class="headerlink" href="#16-affinity-taint-toleration-additional-resources" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://kubernetes.io/docs/concepts/scheduling-eviction/assign-pod-node/#affinity-and-anti-affinity">Kubernetes Node Affinity Documentation</a></li>
<li><a href="https://kubernetes.io/docs/concepts/scheduling-eviction/taint-and-toleration/">Kubernetes Taints and Tolerations Documentation</a></li>
<li><a href="https://kubernetes.io/docs/concepts/scheduling-eviction/pod-priority-preemption/">Pod Priority and Preemption</a></li>
</ul></section><section class="print-page" id="17-poddisruptionbudgets-pdb" heading-number="2.19"><h1 id="17-poddisruptionbudgets-pdb-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#17-poddisruptionbudgets-pdb-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="17-poddisruptionbudgets-pdb-pod-disruption-budgets-pdb">Pod Disruption Budgets (PDB)<a class="headerlink" href="#17-poddisruptionbudgets-pdb-pod-disruption-budgets-pdb" title="Permanent link">&para;</a></h2>
<ul>
<li>In this lab, we will learn about <code>Pod Disruption Budgets (PDB)</code> in Kubernetes.</li>
<li>We will explore how to define and implement PDBs to ensure application availability during voluntary disruptions, such as node maintenance or cluster upgrades.</li>
<li>By the end of this lab, you will understand how to create and manage Pod Disruption Budgets to maintain the desired level of service availability in your Kubernetes cluster.</li>
</ul>
<hr />
<!-- omit in toc -->
<h3 id="17-poddisruptionbudgets-pdb-prerequisites">Prerequisites<a class="headerlink" href="#17-poddisruptionbudgets-pdb-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>K8S cluster - <a href="#00-verifycluster">Setting up minikube cluster instruction</a></li>
<li><a href="https://kubernetes.io/docs/tasks/tools/"><strong>kubectl</strong></a> configured to interact with your cluster</li>
</ul>
<p><a href="https://ide.cloud.google.com/?cloudshell_git_repo=https://github.com/nirgeier/KubernetesLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a></p>
<h3 id="17-poddisruptionbudgets-pdb-ctrl-click-to-open-in-new-window"><strong><kbd>CTRL</kbd> + <kbd>click</kbd> to open in new window</strong><a class="headerlink" href="#17-poddisruptionbudgets-pdb-ctrl-click-to-open-in-new-window" title="Permanent link">&para;</a></h3>
<!-- omit in toc -->
<hr />
<h2 id="17-poddisruptionbudgets-pdb-poddisruptionbudgets-budgeting-the-number-of-faults-to-tolerate"><code>PodDisruptionBudgets</code>: Budgeting the Number of Faults to Tolerate<a class="headerlink" href="#17-poddisruptionbudgets-pdb-poddisruptionbudgets-budgeting-the-number-of-faults-to-tolerate" title="Permanent link">&para;</a></h2>
<ul>
<li>
<p>A <code>pod disruption budget</code> is an <strong>indicator of the number of disruptions that can be tolerated at a given time for a class of pods</strong> (a budget of faults).</p>
</li>
<li>
<p>Disruptions may be caused by <strong>deliberate</strong> or <strong>accidental</strong> Pod deletion.</p>
</li>
<li>
<p>Whenever a disruption to the pods in a service is calculated to cause the service to <strong>drop below the budget</strong>, the operation is paused until it can maintain the budget. This means that the <code>drain event</code> could be temporarily halted while it waits for more pods to become available such that the budget isn&rsquo;t crossed by evicting the pods.</p>
</li>
<li>
<p>You can specify Pod Disruption Budgets for Pods managed by these built-in Kubernetes controllers:</p>
<ul>
<li><code>Deployment</code></li>
<li><code>ReplicationController</code></li>
<li><code>ReplicaSet</code></li>
<li><code>StatefulSet</code></li>
</ul>
</li>
<li>
<p>For this tutorial you should get familiar with <a href="https://kubernetes.io/docs/concepts/scheduling-eviction/"><strong>Kubernetes Eviction Policies</strong></a>, as it demonstrates how <code>Pod Disruption Budgets</code> handle evictions.</p>
</li>
<li>
<p>As in the <code>Kubernetes Eviction Policies</code> tutorial, we start with 
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#17-poddisruptionbudgets-pdb-__codelineno-0-1"></a>eviction-hard<span class="o">=</span><span class="s2">&quot;memory.available&lt;480M&quot;</span>
</span></code></pre></div></p>
</li>
</ul>
<hr />
<h3 id="17-poddisruptionbudgets-pdb-sample">Sample<a class="headerlink" href="#17-poddisruptionbudgets-pdb-sample" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>In the below sample we will configure a <code>Pod Disruption Budget</code> which ensure that we will always have <strong>at least</strong> 1 Nginx instance.</p>
</li>
<li>
<p>First we need an <a href="../17-PodDisruptionBudgets-PDB/resources/Deployment.yaml">Nginx Deployment</a>:</p>
</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#17-poddisruptionbudgets-pdb-__codelineno-1-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#17-poddisruptionbudgets-pdb-__codelineno-1-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#17-poddisruptionbudgets-pdb-__codelineno-1-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#17-poddisruptionbudgets-pdb-__codelineno-1-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-deployment</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#17-poddisruptionbudgets-pdb-__codelineno-1-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">codewizard</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#17-poddisruptionbudgets-pdb-__codelineno-1-6"></a><span class="w">  </span><span class="nt">labels</span><span class="p">:</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#17-poddisruptionbudgets-pdb-__codelineno-1-7"></a><span class="w">    </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span><span class="w"> </span><span class="c1"># &lt;- We will use this name below</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#17-poddisruptionbudgets-pdb-__codelineno-1-8"></a><span class="nn">...</span>
</span></code></pre></div>
<ul>
<li>Now we can create the <code>Pod Disruption Budget</code>:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#17-poddisruptionbudgets-pdb-__codelineno-2-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">policy/v1beta1</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#17-poddisruptionbudgets-pdb-__codelineno-2-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PodDisruptionBudget</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#17-poddisruptionbudgets-pdb-__codelineno-2-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#17-poddisruptionbudgets-pdb-__codelineno-2-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-pdb</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#17-poddisruptionbudgets-pdb-__codelineno-2-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#17-poddisruptionbudgets-pdb-__codelineno-2-6"></a><span class="w">  </span><span class="nt">minAvailable</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">1</span><span class="w"> </span><span class="c1"># &lt;--- This will ensure that we will have at least 1</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#17-poddisruptionbudgets-pdb-__codelineno-2-7"></a><span class="w">  </span><span class="nt">selector</span><span class="p">:</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#17-poddisruptionbudgets-pdb-__codelineno-2-8"></a><span class="w">    </span><span class="nt">matchLabels</span><span class="p">:</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#17-poddisruptionbudgets-pdb-__codelineno-2-9"></a><span class="w">      </span><span class="nt">app</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span><span class="w"> </span><span class="c1"># &lt;- The deployment app label </span>
</span></code></pre></div>
<hr />
<h2 id="17-poddisruptionbudgets-pdb-walkthrough">Walkthrough<a class="headerlink" href="#17-poddisruptionbudgets-pdb-walkthrough" title="Permanent link">&para;</a></h2>
<p><a href="#17-poddisruptionbudgets-pdb-step-01-start-minikube-with-feature-gates">01. start minikube with Feature Gates</a>
<a href="#17-poddisruptionbudgets-pdb-step-02-check-node-pressures">02. Check Node Pressure(s)</a></p>
<hr />
<h3 id="17-poddisruptionbudgets-pdb-step-01-start-minikube-with-feature-gates">Step 01 - Start minikube with Feature Gates<a class="headerlink" href="#17-poddisruptionbudgets-pdb-step-01-start-minikube-with-feature-gates" title="Permanent link">&para;</a></h3>
<ul>
<li>Run the following command to start minikube with the required <code>Feature Gates</code> and <code>Eviction Signals</code>:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#17-poddisruptionbudgets-pdb-__codelineno-3-1"></a>minikube<span class="w"> </span>start<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#17-poddisruptionbudgets-pdb-__codelineno-3-2"></a><span class="w">    </span>--extra-config<span class="o">=</span>kubelet.eviction-hard<span class="o">=</span><span class="s2">&quot;memory.available&lt;480M&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#17-poddisruptionbudgets-pdb-__codelineno-3-3"></a><span class="w">    </span>--extra-config<span class="o">=</span>kubelet.eviction-pressure-transition-period<span class="o">=</span><span class="s2">&quot;30s&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#17-poddisruptionbudgets-pdb-__codelineno-3-4"></a><span class="w">    </span>--extra-config<span class="o">=</span>kubelet.feature-gates<span class="o">=</span><span class="s2">&quot;ExperimentalCriticalPodAnnotation=true&quot;</span>
</span></code></pre></div>
<ul>
<li>
<p>For more details about <code>Feature Gates</code>, read <a href="https://kubernetes.io/docs/reference/command-line-tools-reference/feature-gates/#feature-stages">here</a>.</p>
</li>
<li>
<p>For more details about <code>eviction-signals</code>, read <a href="https://kubernetes.io/docs/tasks/administer-cluster/out-of-resource/#eviction-signals">here</a>.</p>
</li>
</ul>
<h3 id="17-poddisruptionbudgets-pdb-step-02-check-node-pressures">Step 02 - Check Node Pressure(s)<a class="headerlink" href="#17-poddisruptionbudgets-pdb-step-02-check-node-pressures" title="Permanent link">&para;</a></h3>
<ul>
<li>Check to see the Node conditions, if we have any kind of &ldquo;Pressure&rdquo;, by running the following:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#17-poddisruptionbudgets-pdb-__codelineno-4-1"></a>kubectl<span class="w"> </span>describe<span class="w"> </span>node<span class="w"> </span>minikube<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>MemoryPressure
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#17-poddisruptionbudgets-pdb-__codelineno-5-1"></a>Conditions:
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#17-poddisruptionbudgets-pdb-__codelineno-5-2"></a>  Type             Status  Reason                       Message
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#17-poddisruptionbudgets-pdb-__codelineno-5-3"></a>  ----             ------  ------                       -------
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#17-poddisruptionbudgets-pdb-__codelineno-5-4"></a>  MemoryPressure   False   KubeletHasSufficientMemory   kubelet has sufficient memory available
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#17-poddisruptionbudgets-pdb-__codelineno-5-5"></a>  DiskPressure     False   KubeletHasNoDiskPressure     kubelet has no disk pressure
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#17-poddisruptionbudgets-pdb-__codelineno-5-6"></a>  PIDPressure      False   KubeletHasSufficientPID      kubelet has sufficient PID available
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#17-poddisruptionbudgets-pdb-__codelineno-5-7"></a>  Ready            True    KubeletReady                 kubelet is posting ready status. AppArmor enabled
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#17-poddisruptionbudgets-pdb-__codelineno-5-8"></a>  ...
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#17-poddisruptionbudgets-pdb-__codelineno-5-9"></a>Allocated resources:
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#17-poddisruptionbudgets-pdb-__codelineno-5-10"></a>  (Total limits may be over 100 percent, i.e., overcommitted.)
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#17-poddisruptionbudgets-pdb-__codelineno-5-11"></a>  Resource           Requests    Limits
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#17-poddisruptionbudgets-pdb-__codelineno-5-12"></a>  --------           --------    ------
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#17-poddisruptionbudgets-pdb-__codelineno-5-13"></a>  cpu                750m (37%)  0 (0%)
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#17-poddisruptionbudgets-pdb-__codelineno-5-14"></a>  memory             140Mi (6%)  340Mi (16%)
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#17-poddisruptionbudgets-pdb-__codelineno-5-15"></a>  ephemeral-storage  0 (0%)      0 (0%)  
</span></code></pre></div>
</div>
<h3 id="17-poddisruptionbudgets-pdb-step-03-create-3-pods-using-50-mb-each">Step 03 - Create 3 Pods using 50 MB each<a class="headerlink" href="#17-poddisruptionbudgets-pdb-step-03-create-3-pods-using-50-mb-each" title="Permanent link">&para;</a></h3>
<ul>
<li>Create a file named <code>50MB-ram.yaml</code> with the following content:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#17-poddisruptionbudgets-pdb-__codelineno-6-1"></a><span class="c1"># ./resources/50MB-ram.yaml</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#17-poddisruptionbudgets-pdb-__codelineno-6-2"></a><span class="nn">...</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#17-poddisruptionbudgets-pdb-__codelineno-6-3"></a>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#17-poddisruptionbudgets-pdb-__codelineno-6-4"></a><span class="c1"># 3 replicas</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#17-poddisruptionbudgets-pdb-__codelineno-6-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-6-6"><a id="__codelineno-6-6" name="__codelineno-6-6" href="#17-poddisruptionbudgets-pdb-__codelineno-6-6"></a><span class="w">  </span><span class="nt">replicas</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span>
</span><span id="__span-6-7"><a id="__codelineno-6-7" name="__codelineno-6-7" href="#17-poddisruptionbudgets-pdb-__codelineno-6-7"></a>
</span><span id="__span-6-8"><a id="__codelineno-6-8" name="__codelineno-6-8" href="#17-poddisruptionbudgets-pdb-__codelineno-6-8"></a><span class="c1"># resources request and limits</span>
</span><span id="__span-6-9"><a id="__codelineno-6-9" name="__codelineno-6-9" href="#17-poddisruptionbudgets-pdb-__codelineno-6-9"></a><span class="nt">resources</span><span class="p">:</span>
</span><span id="__span-6-10"><a id="__codelineno-6-10" name="__codelineno-6-10" href="#17-poddisruptionbudgets-pdb-__codelineno-6-10"></a><span class="w">  </span><span class="nt">requests</span><span class="p">:</span>
</span><span id="__span-6-11"><a id="__codelineno-6-11" name="__codelineno-6-11" href="#17-poddisruptionbudgets-pdb-__codelineno-6-11"></a><span class="w">    </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;50Mi&quot;</span>
</span><span id="__span-6-12"><a id="__codelineno-6-12" name="__codelineno-6-12" href="#17-poddisruptionbudgets-pdb-__codelineno-6-12"></a><span class="w">    </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;250m&quot;</span>
</span><span id="__span-6-13"><a id="__codelineno-6-13" name="__codelineno-6-13" href="#17-poddisruptionbudgets-pdb-__codelineno-6-13"></a><span class="w">  </span><span class="nt">limits</span><span class="p">:</span>
</span><span id="__span-6-14"><a id="__codelineno-6-14" name="__codelineno-6-14" href="#17-poddisruptionbudgets-pdb-__codelineno-6-14"></a><span class="w">    </span><span class="nt">memory</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;128Mi&quot;</span>
</span><span id="__span-6-15"><a id="__codelineno-6-15" name="__codelineno-6-15" href="#17-poddisruptionbudgets-pdb-__codelineno-6-15"></a><span class="w">    </span><span class="nt">cpu</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;500m&quot;</span>
</span></code></pre></div>
<ul>
<li>Create the pods with the following command:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#17-poddisruptionbudgets-pdb-__codelineno-7-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>resources/50MB-ram.yaml
</span></code></pre></div>
<h3 id="17-poddisruptionbudgets-pdb-step-04-check-memory-pressure">Step 04 - Check Memory Pressure<a class="headerlink" href="#17-poddisruptionbudgets-pdb-step-04-check-memory-pressure" title="Permanent link">&para;</a></h3>
<ul>
<li>Now let&rsquo;s check the Node conditions again to see if we have <code>MemoryPressure</code>:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#17-poddisruptionbudgets-pdb-__codelineno-8-1"></a>kubectl<span class="w"> </span>describe<span class="w"> </span>node<span class="w"> </span>minikube<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>MemoryPressure
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#17-poddisruptionbudgets-pdb-__codelineno-9-1"></a>MemoryPressure   False   ...   KubeletHasSufficientMemory   kubelet has sufficient memory available
</span></code></pre></div>
</div>
<ul>
<li>As we can see, we still have <code>sufficient memory available</code>.</li>
</ul></section><section class="print-page" id="18-argocd" heading-number="2.20"><h1 id="18-argocd-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#18-argocd-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="18-argocd-argocd">ArgoCD<a class="headerlink" href="#18-argocd-argocd" title="Permanent link">&para;</a></h2>
<ul>
<li>In this tutorial, we will learn the essentials of <code>ArgoCD</code>, a declarative GitOps continuous delivery tool for Kubernetes.</li>
<li>We will install <code>ArgoCD</code>, deploy applications, sync resources from Git repositories, and gain practical experience with GitOps workflows.</li>
</ul>
<hr />
<!-- omit in toc -->
<h3 id="18-argocd-prerequisites">Prerequisites<a class="headerlink" href="#18-argocd-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>K8S cluster - <a href="#00-verifycluster">Setting up minikube cluster instruction</a></li>
<li><a href="https://kubernetes.io/docs/tasks/tools/"><strong>kubectl</strong></a> configured to interact with your cluster</li>
<li>A <code>Git repository</code> (GitHub, GitLab, or Bitbucket) for storing application manifests</li>
<li>Basic understanding of Kubernetes resources (Deployments, Services, etc.)</li>
</ul>
<p><a href="https://ide.cloud.google.com/?cloudshell_git_repo=https://github.com/nirgeier/KubernetesLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a></p>
<h3 id="18-argocd-ctrl-click-to-open-in-new-window"><strong><kbd>CTRL</kbd> + <kbd>click</kbd> to open in new window</strong><a class="headerlink" href="#18-argocd-ctrl-click-to-open-in-new-window" title="Permanent link">&para;</a></h3>
<!-- omit in toc -->
<hr />
<h2 id="18-argocd-what-will-we-learn">What will we learn?<a class="headerlink" href="#18-argocd-what-will-we-learn" title="Permanent link">&para;</a></h2>
<ul>
<li>What <code>ArgoCD</code> is and why it&rsquo;s useful for GitOps.</li>
<li>How to install and configure <code>ArgoCD</code> on Kubernetes.</li>
<li><code>ArgoCD</code> core concepts: Applications, Projects, and Sync.</li>
<li>How to deploy applications from <code>Git repositories</code>.</li>
<li>Application health and sync status monitoring.</li>
<li>Rollback and sync strategies.</li>
<li>Best practices for GitOps workflows.</li>
</ul>
<hr />
<h3 id="18-argocd-what-is-argocd">What is ArgoCD?<a class="headerlink" href="#18-argocd-what-is-argocd" title="Permanent link">&para;</a></h3>
<ul>
<li><code>ArgoCD</code> is a declarative, GitOps continuous delivery tool for Kubernetes.</li>
<li>It follows the <code>GitOps</code> pattern where Git repositories are the source of truth for defining the desired application state.</li>
<li><code>ArgoCD</code> automates the deployment of the desired application states in the specified target environments.</li>
</ul>
<h3 id="18-argocd-why-argocd">Why ArgoCD?<a class="headerlink" href="#18-argocd-why-argocd" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>GitOps Workflow</strong>: Uses Git as the single source of truth.</li>
<li><strong>Automated Deployment</strong>: Automatically syncs your Kubernetes cluster with Git repositories.</li>
<li><strong>Application Health Monitoring</strong>: Continuous monitoring of deployed applications.</li>
<li><strong>Rollback Capabilities</strong>: Easy rollback to previous versions.</li>
<li><strong>Multi-Cluster Support</strong>: Manage applications across multiple clusters.</li>
<li><strong>SSO Integration</strong>: Supports various SSO providers for authentication.</li>
<li><strong>RBAC</strong>: Fine-grained access control.</li>
<li><strong>Audit Trail</strong>: Full audit trail of all operations.</li>
</ul>
<h3 id="18-argocd-terminology">Terminology<a class="headerlink" href="#18-argocd-terminology" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p><strong>Application</strong></p>
<ul>
<li>An <code>ArgoCD</code> <strong>Application</strong> is a Kubernetes resource object representing a deployed application instance in an environment.</li>
<li>It defines the source repository, target cluster, and sync policies.</li>
</ul>
</li>
<li>
<p><strong>Project</strong></p>
<ul>
<li>An <code>ArgoCD</code> <strong>Project</strong> provides a logical grouping of applications.</li>
<li>Projects are useful for organizing applications and implementing RBAC.</li>
</ul>
</li>
<li>
<p><strong>Sync</strong></p>
<ul>
<li><strong>Sync</strong> is the process of making a live cluster state match the desired state defined in Git.</li>
<li>Sync can run manually or automatically.</li>
</ul>
</li>
<li>
<p><strong>Sync Status</strong></p>
<ul>
<li>Indicates whether the live state matches the Git state.</li>
<li>Status can be: <strong>Synced</strong>, <strong>OutOfSync</strong>, or <strong>Unknown</strong>.</li>
</ul>
</li>
<li>
<p><strong>Health Status</strong></p>
<ul>
<li>Indicates the health of the application resources.</li>
<li>Status can be: <strong>Healthy</strong>, <strong>Progressing</strong>, <strong>Degraded</strong>, <strong>Suspended</strong>, or <strong>Missing</strong>.</li>
</ul>
</li>
</ul>
<h3 id="18-argocd-argocd-architecture">ArgoCD Architecture<a class="headerlink" href="#18-argocd-argocd-architecture" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Component</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><strong>API Server</strong></td>
<td>Exposes the API consumed by Web UI, CLI, and CI/CD systems</td>
</tr>
<tr>
<td><strong>Repository Server</strong></td>
<td>Maintains a local cache of Git repositories holding application manifests</td>
</tr>
<tr>
<td><strong>Application Controller</strong></td>
<td>Monitors running applications and compares the current live state against the desired state</td>
</tr>
<tr>
<td><strong>Dex</strong></td>
<td>Identity service for integrating with external identity providers</td>
</tr>
<tr>
<td><strong>Redis</strong></td>
<td>Used for caching</td>
</tr>
</tbody>
</table>
<h3 id="18-argocd-common-argocd-cli-commands">Common ArgoCD CLI Commands<a class="headerlink" href="#18-argocd-common-argocd-cli-commands" title="Permanent link">&para;</a></h3>
<table>
<thead>
<tr>
<th>Command</th>
<th>Description</th>
</tr>
</thead>
<tbody>
<tr>
<td><code>argocd login &lt;server&gt;</code></td>
<td>Login to <code>ArgoCD</code> server</td>
</tr>
<tr>
<td><code>argocd app create &lt;app-name&gt;</code></td>
<td>Create a new application</td>
</tr>
<tr>
<td><code>argocd app list</code></td>
<td>List all applications</td>
</tr>
<tr>
<td><code>argocd app get &lt;app-name&gt;</code></td>
<td>Get application details</td>
</tr>
<tr>
<td><code>argocd app sync &lt;app-name&gt;</code></td>
<td>Sync (deploy) an application</td>
</tr>
<tr>
<td><code>argocd app delete &lt;app-name&gt;</code></td>
<td>Delete an application</td>
</tr>
<tr>
<td><code>argocd app set &lt;app-name&gt;</code></td>
<td>Update application parameters</td>
</tr>
<tr>
<td><code>argocd app diff &lt;app-name&gt;</code></td>
<td>Show differences between Git and live state</td>
</tr>
<tr>
<td><code>argocd app history &lt;app-name&gt;</code></td>
<td>Show application deployment history</td>
</tr>
<tr>
<td><code>argocd app rollback &lt;app-name&gt; &lt;revision&gt;</code></td>
<td>Rollback to a previous revision</td>
</tr>
</tbody>
</table>
<hr />
<h2 id="18-argocd-lab">Lab<a class="headerlink" href="#18-argocd-lab" title="Permanent link">&para;</a></h2>
<h2 id="18-argocd-part-01-installing-argocd">Part 01 - Installing ArgoCD<a class="headerlink" href="#18-argocd-part-01-installing-argocd" title="Permanent link">&para;</a></h2>
<h3 id="18-argocd-step-01-create-an-argocd-namespace">Step 01 - Create an ArgoCD Namespace<a class="headerlink" href="#18-argocd-step-01-create-an-argocd-namespace" title="Permanent link">&para;</a></h3>
<ul>
<li>Create a dedicated namespace for <code>ArgoCD</code>:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#18-argocd-__codelineno-0-1"></a>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>argocd
</span></code></pre></div>
<h3 id="18-argocd-step-02-install-argocd">Step 02 - Install ArgoCD<a class="headerlink" href="#18-argocd-step-02-install-argocd" title="Permanent link">&para;</a></h3>
<ul>
<li>Install <code>ArgoCD</code> using the official installation manifest:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#18-argocd-__codelineno-1-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-n<span class="w"> </span>argocd<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
</span></code></pre></div>
<h3 id="18-argocd-step-03-verify-installation">Step 03 - Verify Installation<a class="headerlink" href="#18-argocd-step-03-verify-installation" title="Permanent link">&para;</a></h3>
<ul>
<li>Check that all <code>ArgoCD</code> pods are running:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#18-argocd-__codelineno-2-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>argocd
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#18-argocd-__codelineno-3-1"></a>NAME                                  READY   STATUS    RESTARTS   AGE
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#18-argocd-__codelineno-3-2"></a>argocd-application-controller-0       1/1     Running   0          2m
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#18-argocd-__codelineno-3-3"></a>argocd-dex-server-xxx                 1/1     Running   0          2m
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#18-argocd-__codelineno-3-4"></a>argocd-redis-xxx                      1/1     Running   0          2m
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#18-argocd-__codelineno-3-5"></a>argocd-repo-server-xxx                1/1     Running   0          2m
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#18-argocd-__codelineno-3-6"></a>argocd-server-xxx                     1/1     Running   0          2m
</span></code></pre></div>
</div>
<h3 id="18-argocd-step-04-expose-argocd-server">Step 04 - Expose ArgoCD Server<a class="headerlink" href="#18-argocd-step-04-expose-argocd-server" title="Permanent link">&para;</a></h3>
<ul>
<li>By default, the <code>ArgoCD</code> API server is not exposed externally. </li>
<li>We&rsquo;ll use port-forwarding to access it, by running:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#18-argocd-__codelineno-4-1"></a>kubectl<span class="w"> </span>port-forward<span class="w"> </span>svc/argocd-server<span class="w"> </span>-n<span class="w"> </span>argocd<span class="w"> </span><span class="m">8080</span>:443
</span></code></pre></div>
<ul>
<li>Alternatively, you can change the service type to <strong>LoadBalancer</strong> or create an <strong>Ingress</strong>:</li>
</ul>
<p><strong>Change to LoadBalancer (for cloud environments)</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#18-argocd-__codelineno-5-1"></a>kubectl<span class="w"> </span>patch<span class="w"> </span>svc<span class="w"> </span>argocd-server<span class="w"> </span>-n<span class="w"> </span>argocd<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;{&quot;spec&quot;: {&quot;type&quot;: &quot;LoadBalancer&quot;}}&#39;</span>
</span></code></pre></div></p>
<p><strong>Or use NodePort (for local/development)</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#18-argocd-__codelineno-6-1"></a>kubectl<span class="w"> </span>patch<span class="w"> </span>svc<span class="w"> </span>argocd-server<span class="w"> </span>-n<span class="w"> </span>argocd<span class="w"> </span>-p<span class="w"> </span><span class="s1">&#39;{&quot;spec&quot;: {&quot;type&quot;: &quot;NodePort&quot;}}&#39;</span>
</span></code></pre></div></p>
<h3 id="18-argocd-step-05-get-initial-admin-password">Step 05 - Get Initial Admin Password<a class="headerlink" href="#18-argocd-step-05-get-initial-admin-password" title="Permanent link">&para;</a></h3>
<ul>
<li>The initial password for the <code>admin</code> user is auto-generated and stored as a secret by running the following command:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#18-argocd-__codelineno-7-1"></a><span class="c1"># Get the initial admin password</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#18-argocd-__codelineno-7-2"></a>kubectl<span class="w"> </span>-n<span class="w"> </span>argocd<span class="w"> </span>get<span class="w"> </span>secret<span class="w"> </span>argocd-initial-admin-secret<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.data.password}&quot;</span><span class="w"> </span><span class="p">|</span><span class="w"> </span>base64<span class="w"> </span>-d<span class="p">;</span><span class="w"> </span><span class="nb">echo</span>
</span></code></pre></div>
<div class="admonition note">
<p class="admonition-title">Note</p>
<p>Save this password - you&rsquo;ll need it to login to the ArgoCD UI later.</p>
</div>
<h3 id="18-argocd-step-06-access-argocd-ui">Step 06 - Access ArgoCD UI<a class="headerlink" href="#18-argocd-step-06-access-argocd-ui" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Open your browser and navigate to:</p>
<ul>
<li><strong>Port-forward</strong>: <code>https://localhost:8080</code></li>
<li><strong>LoadBalancer</strong>: Use the external IP</li>
<li><strong>NodePort</strong>: Use <code>http://&lt;node-ip&gt;:&lt;node-port&gt;</code></li>
</ul>
</li>
<li>
<p>Login with:</p>
<ul>
<li><strong>Username</strong>: <code>admin</code></li>
<li><strong>Password</strong>: (from Step 05)</li>
</ul>
</li>
</ul>
<hr />
<h2 id="18-argocd-part-02-installing-argocd-cli">Part 02 - Installing ArgoCD CLI<a class="headerlink" href="#18-argocd-part-02-installing-argocd-cli" title="Permanent link">&para;</a></h2>
<h3 id="18-argocd-step-01-download-and-install-argocd-cli">Step 01 - Download and Install ArgoCD CLI<a class="headerlink" href="#18-argocd-step-01-download-and-install-argocd-cli" title="Permanent link">&para;</a></h3>
<ul>
<li>Install the <code>ArgoCD CLI</code> based on your operating system:</li>
</ul>
<p><strong>Linux:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#18-argocd-__codelineno-8-1"></a>curl<span class="w"> </span>-sSL<span class="w"> </span>-o<span class="w"> </span>argocd-linux-amd64<span class="w"> </span>https://github.com/argoproj/argo-cd/releases/latest/download/argocd-linux-amd64
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#18-argocd-__codelineno-8-2"></a>sudo<span class="w"> </span>install<span class="w"> </span>-m<span class="w"> </span><span class="m">555</span><span class="w"> </span>argocd-linux-amd64<span class="w"> </span>/usr/local/bin/argocd
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#18-argocd-__codelineno-8-3"></a>rm<span class="w"> </span>argocd-linux-amd64
</span></code></pre></div></p>
<p><strong>macOS:</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#18-argocd-__codelineno-9-1"></a>brew<span class="w"> </span>install<span class="w"> </span>argocd
</span></code></pre></div></p>
<p><strong>Windows (via Chocolatey):</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#18-argocd-__codelineno-10-1"></a>choco<span class="w"> </span>install<span class="w"> </span>argocd-cli
</span></code></pre></div></p>
<h3 id="18-argocd-step-02-verify-cli-installation">Step 02 - Verify CLI Installation<a class="headerlink" href="#18-argocd-step-02-verify-cli-installation" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#18-argocd-__codelineno-11-1"></a>argocd<span class="w"> </span>version<span class="w"> </span>--short
</span></code></pre></div>
<h3 id="18-argocd-step-03-login-via-cli">Step 03 - Login via CLI<a class="headerlink" href="#18-argocd-step-03-login-via-cli" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#18-argocd-__codelineno-12-1"></a><span class="c1"># If using port-forward</span>
</span><span id="__span-12-2"><a id="__codelineno-12-2" name="__codelineno-12-2" href="#18-argocd-__codelineno-12-2"></a>argocd<span class="w"> </span>login<span class="w"> </span>localhost:8080<span class="w"> </span>--insecure
</span><span id="__span-12-3"><a id="__codelineno-12-3" name="__codelineno-12-3" href="#18-argocd-__codelineno-12-3"></a>
</span><span id="__span-12-4"><a id="__codelineno-12-4" name="__codelineno-12-4" href="#18-argocd-__codelineno-12-4"></a><span class="c1"># You&#39;ll be prompted for username and password</span>
</span></code></pre></div>
<h3 id="18-argocd-step-04-change-admin-password-optional-but-highly-recommended">Step 04 - Change Admin Password (optional, but highly recommended)<a class="headerlink" href="#18-argocd-step-04-change-admin-password-optional-but-highly-recommended" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#18-argocd-__codelineno-13-1"></a>argocd<span class="w"> </span>account<span class="w"> </span>update-password
</span></code></pre></div>
<hr />
<h2 id="18-argocd-part-03-deploying-your-first-application">Part 03 - Deploying Your First Application<a class="headerlink" href="#18-argocd-part-03-deploying-your-first-application" title="Permanent link">&para;</a></h2>
<h3 id="18-argocd-step-01-prepare-a-git-repository">Step 01 - Prepare a Git Repository<a class="headerlink" href="#18-argocd-step-01-prepare-a-git-repository" title="Permanent link">&para;</a></h3>
<ul>
<li>For this lab, we will use a sample Git repository with Kubernetes manifests.</li>
<li>You can use the <code>ArgoCD</code> example repository or your own:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#18-argocd-__codelineno-14-1"></a><span class="c1"># Sample repository URL</span>
</span><span id="__span-14-2"><a id="__codelineno-14-2" name="__codelineno-14-2" href="#18-argocd-__codelineno-14-2"></a>https://github.com/argoproj/argocd-example-apps.git
</span></code></pre></div>
<h3 id="18-argocd-step-02-create-an-application-via-cli">Step 02 - Create an Application via CLI<a class="headerlink" href="#18-argocd-step-02-create-an-application-via-cli" title="Permanent link">&para;</a></h3>
<ul>
<li>Create an <code>ArgoCD</code> application that deploys the guestbook app:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#18-argocd-__codelineno-15-1"></a>argocd<span class="w"> </span>app<span class="w"> </span>create<span class="w"> </span>guestbook<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#18-argocd-__codelineno-15-2"></a><span class="w">  </span>--repo<span class="w"> </span>https://github.com/argoproj/argocd-example-apps.git<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#18-argocd-__codelineno-15-3"></a><span class="w">  </span>--path<span class="w"> </span>guestbook<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#18-argocd-__codelineno-15-4"></a><span class="w">  </span>--dest-server<span class="w"> </span>https://kubernetes.default.svc<span class="w"> </span><span class="se">\</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#18-argocd-__codelineno-15-5"></a><span class="w">  </span>--dest-namespace<span class="w"> </span>default
</span></code></pre></div>
<details class="info">
<summary>Command Explanation</summary>
<ul>
<li><code>--repo</code>: The Git repository URL</li>
<li><code>--path</code>: Path within the repository where manifests are located</li>
<li><code>--dest-server</code>: Target Kubernetes cluster (default is the cluster where ArgoCD is installed)</li>
<li><code>--dest-namespace</code>: Target namespace for deployment</li>
</ul>
</details>
<h3 id="18-argocd-step-03-view-application-status">Step 03 - View Application Status<a class="headerlink" href="#18-argocd-step-03-view-application-status" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#18-argocd-__codelineno-16-1"></a><span class="c1"># List all applications</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#18-argocd-__codelineno-16-2"></a>argocd<span class="w"> </span>app<span class="w"> </span>list
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#18-argocd-__codelineno-16-3"></a>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#18-argocd-__codelineno-16-4"></a><span class="c1"># Get detailed information about the application</span>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#18-argocd-__codelineno-16-5"></a>argocd<span class="w"> </span>app<span class="w"> </span>get<span class="w"> </span>guestbook
</span></code></pre></div>
<h3 id="18-argocd-step-04-sync-the-application">Step 04 - Sync the Application<a class="headerlink" href="#18-argocd-step-04-sync-the-application" title="Permanent link">&para;</a></h3>
<ul>
<li>Initially, the application status will be <strong>OutOfSync</strong>. </li>
<li>Sync it to deploy by running:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#18-argocd-__codelineno-17-1"></a>argocd<span class="w"> </span>app<span class="w"> </span>sync<span class="w"> </span>guestbook
</span></code></pre></div>
<h3 id="18-argocd-step-05-verify-deployment">Step 05 - Verify Deployment<a class="headerlink" href="#18-argocd-step-05-verify-deployment" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#18-argocd-__codelineno-18-1"></a><span class="c1"># Check the deployed resources</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#18-argocd-__codelineno-18-2"></a>kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>default
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#18-argocd-__codelineno-18-3"></a>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#18-argocd-__codelineno-18-4"></a><span class="c1"># You should see the guestbook deployment, service, and pods</span>
</span></code></pre></div>
<h3 id="18-argocd-step-06-access-the-application">Step 06 - Access the Application<a class="headerlink" href="#18-argocd-step-06-access-the-application" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#18-argocd-__codelineno-19-1"></a><span class="c1"># Port-forward to access the guestbook service</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#18-argocd-__codelineno-19-2"></a>kubectl<span class="w"> </span>port-forward<span class="w"> </span>svc/guestbook-ui<span class="w"> </span>-n<span class="w"> </span>default<span class="w"> </span><span class="m">8081</span>:80
</span><span id="__span-19-3"><a id="__codelineno-19-3" name="__codelineno-19-3" href="#18-argocd-__codelineno-19-3"></a>
</span><span id="__span-19-4"><a id="__codelineno-19-4" name="__codelineno-19-4" href="#18-argocd-__codelineno-19-4"></a><span class="c1"># Open browser to http://localhost:8081</span>
</span></code></pre></div>
<hr />
<h2 id="18-argocd-part-04-creating-application-via-ui">Part 04 - Creating Application via UI<a class="headerlink" href="#18-argocd-part-04-creating-application-via-ui" title="Permanent link">&para;</a></h2>
<h3 id="18-argocd-step-01-access-argocd-ui">Step 01 - Access ArgoCD UI<a class="headerlink" href="#18-argocd-step-01-access-argocd-ui" title="Permanent link">&para;</a></h3>
<ul>
<li>Navigate to the <code>ArgoCD</code> UI at <code>https://localhost:8080</code></li>
</ul>
<h3 id="18-argocd-step-02-create-a-new-application">Step 02 - Create a New Application<a class="headerlink" href="#18-argocd-step-02-create-a-new-application" title="Permanent link">&para;</a></h3>
<ol>
<li>Click on <strong>&rdquo;+ NEW APP&rdquo;</strong> button.</li>
<li>
<p>Fill in the following details:</p>
<ul>
<li><strong>Application Name</strong>: <code>helm-guestbook</code></li>
<li><strong>Project</strong>: <code>default</code></li>
<li><strong>Sync Policy</strong>: <code>Manual</code> (or <code>Automatic</code> for auto-sync)</li>
<li><strong>Repository URL</strong>: <code>https://github.com/argoproj/argocd-example-apps.git</code></li>
<li><strong>Revision</strong>: <code>HEAD</code></li>
<li><strong>Path</strong>: <code>helm-guestbook</code></li>
<li><strong>Cluster URL</strong>: <code>https://kubernetes.default.svc</code></li>
<li><strong>Namespace</strong>: <code>default</code></li>
</ul>
</li>
<li>
<p>Click <strong>&ldquo;CREATE&rdquo;</strong>.</p>
</li>
</ol>
<h3 id="18-argocd-step-03-view-application-in-ui">Step 03 - View Application in UI<a class="headerlink" href="#18-argocd-step-03-view-application-in-ui" title="Permanent link">&para;</a></h3>
<ul>
<li>You should now be able to see the <code>helm-guestbook</code> application tile in the UI.</li>
<li>Click on it to see the application topology.</li>
</ul>
<h3 id="18-argocd-step-04-sync-via-ui">Step 04 - Sync via UI<a class="headerlink" href="#18-argocd-step-04-sync-via-ui" title="Permanent link">&para;</a></h3>
<ul>
<li>Click the <strong>&ldquo;SYNC&rdquo;</strong> button.</li>
<li>Select the resources you want to sync (or select all).</li>
<li>Click <strong>&ldquo;SYNCHRONIZE&rdquo;</strong>.</li>
</ul>
<h3 id="18-argocd-step-05-monitor-sync-progress">Step 05 - Monitor Sync Progress<a class="headerlink" href="#18-argocd-step-05-monitor-sync-progress" title="Permanent link">&para;</a></h3>
<ul>
<li>Watch the sync progress in real-time.</li>
<li>The UI will show each resource being created/updated.</li>
<li>Once completed, all resources should show as <strong>Healthy</strong> and <strong>Synced</strong>.</li>
</ul>
<hr />
<h2 id="18-argocd-part-05-application-management">Part 05 - Application Management<a class="headerlink" href="#18-argocd-part-05-application-management" title="Permanent link">&para;</a></h2>
<h3 id="18-argocd-step-01-view-application-details">Step 01 - View Application Details<a class="headerlink" href="#18-argocd-step-01-view-application-details" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#18-argocd-__codelineno-20-1"></a><span class="c1"># Get full application details</span>
</span><span id="__span-20-2"><a id="__codelineno-20-2" name="__codelineno-20-2" href="#18-argocd-__codelineno-20-2"></a>argocd<span class="w"> </span>app<span class="w"> </span>get<span class="w"> </span>guestbook
</span><span id="__span-20-3"><a id="__codelineno-20-3" name="__codelineno-20-3" href="#18-argocd-__codelineno-20-3"></a>
</span><span id="__span-20-4"><a id="__codelineno-20-4" name="__codelineno-20-4" href="#18-argocd-__codelineno-20-4"></a><span class="c1"># View application parameters</span>
</span><span id="__span-20-5"><a id="__codelineno-20-5" name="__codelineno-20-5" href="#18-argocd-__codelineno-20-5"></a>argocd<span class="w"> </span>app<span class="w"> </span>get<span class="w"> </span>guestbook<span class="w"> </span>--show-params
</span></code></pre></div>
<h3 id="18-argocd-step-02-view-sync-history">Step 02 - View Sync History<a class="headerlink" href="#18-argocd-step-02-view-sync-history" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-21-1"><a id="__codelineno-21-1" name="__codelineno-21-1" href="#18-argocd-__codelineno-21-1"></a><span class="c1"># View deployment history</span>
</span><span id="__span-21-2"><a id="__codelineno-21-2" name="__codelineno-21-2" href="#18-argocd-__codelineno-21-2"></a>argocd<span class="w"> </span>app<span class="w"> </span><span class="nb">history</span><span class="w"> </span>guestbook
</span></code></pre></div>
<h3 id="18-argocd-step-03-view-differences">Step 03 - View Differences<a class="headerlink" href="#18-argocd-step-03-view-differences" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-22-1"><a id="__codelineno-22-1" name="__codelineno-22-1" href="#18-argocd-__codelineno-22-1"></a><span class="c1"># Show differences between Git and live state</span>
</span><span id="__span-22-2"><a id="__codelineno-22-2" name="__codelineno-22-2" href="#18-argocd-__codelineno-22-2"></a>argocd<span class="w"> </span>app<span class="w"> </span>diff<span class="w"> </span>guestbook
</span></code></pre></div>
<h3 id="18-argocd-step-04-manual-sync-with-options">Step 04 - Manual Sync with Options<a class="headerlink" href="#18-argocd-step-04-manual-sync-with-options" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-23-1"><a id="__codelineno-23-1" name="__codelineno-23-1" href="#18-argocd-__codelineno-23-1"></a><span class="c1"># Sync with prune (removes resources not in Git)</span>
</span><span id="__span-23-2"><a id="__codelineno-23-2" name="__codelineno-23-2" href="#18-argocd-__codelineno-23-2"></a>argocd<span class="w"> </span>app<span class="w"> </span>sync<span class="w"> </span>guestbook<span class="w"> </span>--prune
</span><span id="__span-23-3"><a id="__codelineno-23-3" name="__codelineno-23-3" href="#18-argocd-__codelineno-23-3"></a>
</span><span id="__span-23-4"><a id="__codelineno-23-4" name="__codelineno-23-4" href="#18-argocd-__codelineno-23-4"></a><span class="c1"># Sync specific resources</span>
</span><span id="__span-23-5"><a id="__codelineno-23-5" name="__codelineno-23-5" href="#18-argocd-__codelineno-23-5"></a>argocd<span class="w"> </span>app<span class="w"> </span>sync<span class="w"> </span>guestbook<span class="w"> </span>--resource<span class="w"> </span>Deployment:guestbook-ui
</span><span id="__span-23-6"><a id="__codelineno-23-6" name="__codelineno-23-6" href="#18-argocd-__codelineno-23-6"></a>
</span><span id="__span-23-7"><a id="__codelineno-23-7" name="__codelineno-23-7" href="#18-argocd-__codelineno-23-7"></a><span class="c1"># Dry-run sync</span>
</span><span id="__span-23-8"><a id="__codelineno-23-8" name="__codelineno-23-8" href="#18-argocd-__codelineno-23-8"></a>argocd<span class="w"> </span>app<span class="w"> </span>sync<span class="w"> </span>guestbook<span class="w"> </span>--dry-run
</span></code></pre></div>
<hr />
<h2 id="18-argocd-part-06-auto-sync-and-self-healing">Part 06 - Auto-Sync and Self-Healing<a class="headerlink" href="#18-argocd-part-06-auto-sync-and-self-healing" title="Permanent link">&para;</a></h2>
<h3 id="18-argocd-step-01-enable-auto-sync">Step 01 - Enable Auto-Sync<a class="headerlink" href="#18-argocd-step-01-enable-auto-sync" title="Permanent link">&para;</a></h3>
<ul>
<li>Enable automatic synchronization so <code>ArgoCD</code> automatically deploys changes from Git:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-24-1"><a id="__codelineno-24-1" name="__codelineno-24-1" href="#18-argocd-__codelineno-24-1"></a>argocd<span class="w"> </span>app<span class="w"> </span><span class="nb">set</span><span class="w"> </span>guestbook<span class="w"> </span>--sync-policy<span class="w"> </span>automated
</span></code></pre></div>
<h3 id="18-argocd-step-02-enable-self-healing">Step 02 - Enable Self-Healing<a class="headerlink" href="#18-argocd-step-02-enable-self-healing" title="Permanent link">&para;</a></h3>
<ul>
<li>Enable self-healing to automatically fix out-of-sync resources:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-25-1"><a id="__codelineno-25-1" name="__codelineno-25-1" href="#18-argocd-__codelineno-25-1"></a>argocd<span class="w"> </span>app<span class="w"> </span><span class="nb">set</span><span class="w"> </span>guestbook<span class="w"> </span>--self-heal
</span></code></pre></div>
<h3 id="18-argocd-step-03-enable-auto-prune">Step 03 - Enable Auto-Prune<a class="headerlink" href="#18-argocd-step-03-enable-auto-prune" title="Permanent link">&para;</a></h3>
<ul>
<li>Enable auto-prune to automatically delete resources removed from Git:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-26-1"><a id="__codelineno-26-1" name="__codelineno-26-1" href="#18-argocd-__codelineno-26-1"></a>argocd<span class="w"> </span>app<span class="w"> </span><span class="nb">set</span><span class="w"> </span>guestbook<span class="w"> </span>--auto-prune
</span></code></pre></div>
<h3 id="18-argocd-step-04-test-auto-sync">Step 04 - Test Auto-Sync<a class="headerlink" href="#18-argocd-step-04-test-auto-sync" title="Permanent link">&para;</a></h3>
<ol>
<li>Make a change to your Git repository (e.g., change replica count).</li>
<li>Commit and push the change.</li>
<li>Watch as <code>ArgoCD</code> automatically detects and syncs the change:</li>
</ol>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-27-1"><a id="__codelineno-27-1" name="__codelineno-27-1" href="#18-argocd-__codelineno-27-1"></a><span class="c1"># Watch the application sync status</span>
</span><span id="__span-27-2"><a id="__codelineno-27-2" name="__codelineno-27-2" href="#18-argocd-__codelineno-27-2"></a>watch<span class="w"> </span>argocd<span class="w"> </span>app<span class="w"> </span>get<span class="w"> </span>guestbook
</span></code></pre></div>
<h3 id="18-argocd-step-05-test-self-healing">Step 05 - Test Self-Healing<a class="headerlink" href="#18-argocd-step-05-test-self-healing" title="Permanent link">&para;</a></h3>
<ol>
<li>Manually modify a deployed resource by running:</li>
</ol>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-28-1"><a id="__codelineno-28-1" name="__codelineno-28-1" href="#18-argocd-__codelineno-28-1"></a><span class="c1"># Manually scale the deployment</span>
</span><span id="__span-28-2"><a id="__codelineno-28-2" name="__codelineno-28-2" href="#18-argocd-__codelineno-28-2"></a>kubectl<span class="w"> </span>scale<span class="w"> </span>deployment<span class="w"> </span>guestbook-ui<span class="w"> </span>--replicas<span class="o">=</span><span class="m">5</span>
</span></code></pre></div>
<ol>
<li>Watch as <code>ArgoCD</code> detects the drift and automatically restores the desired state:</li>
</ol>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-29-1"><a id="__codelineno-29-1" name="__codelineno-29-1" href="#18-argocd-__codelineno-29-1"></a><span class="c1"># ArgoCD will revert the replica count to what&#39;s in Git</span>
</span><span id="__span-29-2"><a id="__codelineno-29-2" name="__codelineno-29-2" href="#18-argocd-__codelineno-29-2"></a>argocd<span class="w"> </span>app<span class="w"> </span>get<span class="w"> </span>guestbook
</span></code></pre></div>
<hr />
<h2 id="18-argocd-part-07-rollback">Part 07 - Rollback<a class="headerlink" href="#18-argocd-part-07-rollback" title="Permanent link">&para;</a></h2>
<h3 id="18-argocd-step-01-view-application-history">Step 01 - View Application History<a class="headerlink" href="#18-argocd-step-01-view-application-history" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-30-1"><a id="__codelineno-30-1" name="__codelineno-30-1" href="#18-argocd-__codelineno-30-1"></a><span class="c1"># View all deployment revisions</span>
</span><span id="__span-30-2"><a id="__codelineno-30-2" name="__codelineno-30-2" href="#18-argocd-__codelineno-30-2"></a>argocd<span class="w"> </span>app<span class="w"> </span><span class="nb">history</span><span class="w"> </span>guestbook
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-31-1"><a id="__codelineno-31-1" name="__codelineno-31-1" href="#18-argocd-__codelineno-31-1"></a>ID  DATE                 REVISION
</span><span id="__span-31-2"><a id="__codelineno-31-2" name="__codelineno-31-2" href="#18-argocd-__codelineno-31-2"></a>0   2025-11-10 10:15:30  abc123 (HEAD)
</span><span id="__span-31-3"><a id="__codelineno-31-3" name="__codelineno-31-3" href="#18-argocd-__codelineno-31-3"></a>1   2025-11-10 10:20:45  def456
</span><span id="__span-31-4"><a id="__codelineno-31-4" name="__codelineno-31-4" href="#18-argocd-__codelineno-31-4"></a>2   2025-11-10 10:25:30  ghi789
</span></code></pre></div>
</div>
<h3 id="18-argocd-step-02-rollback-to-previous-revision">Step 02 - Rollback to Previous Revision<a class="headerlink" href="#18-argocd-step-02-rollback-to-previous-revision" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-32-1"><a id="__codelineno-32-1" name="__codelineno-32-1" href="#18-argocd-__codelineno-32-1"></a><span class="c1"># Rollback to revision ID 1</span>
</span><span id="__span-32-2"><a id="__codelineno-32-2" name="__codelineno-32-2" href="#18-argocd-__codelineno-32-2"></a>argocd<span class="w"> </span>app<span class="w"> </span>rollback<span class="w"> </span>guestbook<span class="w"> </span><span class="m">1</span>
</span></code></pre></div>
<h3 id="18-argocd-step-03-verify-rollback">Step 03 - Verify Rollback<a class="headerlink" href="#18-argocd-step-03-verify-rollback" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-33-1"><a id="__codelineno-33-1" name="__codelineno-33-1" href="#18-argocd-__codelineno-33-1"></a><span class="c1"># Verify the application state</span>
</span><span id="__span-33-2"><a id="__codelineno-33-2" name="__codelineno-33-2" href="#18-argocd-__codelineno-33-2"></a>argocd<span class="w"> </span>app<span class="w"> </span>get<span class="w"> </span>guestbook
</span><span id="__span-33-3"><a id="__codelineno-33-3" name="__codelineno-33-3" href="#18-argocd-__codelineno-33-3"></a>
</span><span id="__span-33-4"><a id="__codelineno-33-4" name="__codelineno-33-4" href="#18-argocd-__codelineno-33-4"></a><span class="c1"># Check deployed resources</span>
</span><span id="__span-33-5"><a id="__codelineno-33-5" name="__codelineno-33-5" href="#18-argocd-__codelineno-33-5"></a>kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>default
</span></code></pre></div>
<hr />
<h2 id="18-argocd-part-08-working-with-helm-charts">Part 08 - Working with Helm Charts<a class="headerlink" href="#18-argocd-part-08-working-with-helm-charts" title="Permanent link">&para;</a></h2>
<h3 id="18-argocd-step-01-create-helm-based-application">Step 01 - Create Helm-Based Application<a class="headerlink" href="#18-argocd-step-01-create-helm-based-application" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-34-1"><a id="__codelineno-34-1" name="__codelineno-34-1" href="#18-argocd-__codelineno-34-1"></a>argocd<span class="w"> </span>app<span class="w"> </span>create<span class="w"> </span>nginx-helm<span class="w"> </span><span class="se">\</span>
</span><span id="__span-34-2"><a id="__codelineno-34-2" name="__codelineno-34-2" href="#18-argocd-__codelineno-34-2"></a><span class="w">  </span>--repo<span class="w"> </span>https://charts.bitnami.com/bitnami<span class="w"> </span><span class="se">\</span>
</span><span id="__span-34-3"><a id="__codelineno-34-3" name="__codelineno-34-3" href="#18-argocd-__codelineno-34-3"></a><span class="w">  </span>--helm-chart<span class="w"> </span>nginx<span class="w"> </span><span class="se">\</span>
</span><span id="__span-34-4"><a id="__codelineno-34-4" name="__codelineno-34-4" href="#18-argocd-__codelineno-34-4"></a><span class="w">  </span>--revision<span class="w"> </span><span class="m">15</span>.1.0<span class="w"> </span><span class="se">\</span>
</span><span id="__span-34-5"><a id="__codelineno-34-5" name="__codelineno-34-5" href="#18-argocd-__codelineno-34-5"></a><span class="w">  </span>--dest-server<span class="w"> </span>https://kubernetes.default.svc<span class="w"> </span><span class="se">\</span>
</span><span id="__span-34-6"><a id="__codelineno-34-6" name="__codelineno-34-6" href="#18-argocd-__codelineno-34-6"></a><span class="w">  </span>--dest-namespace<span class="w"> </span>default
</span></code></pre></div>
<h3 id="18-argocd-step-02-set-helm-values">Step 02 - Set Helm Values<a class="headerlink" href="#18-argocd-step-02-set-helm-values" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-35-1"><a id="__codelineno-35-1" name="__codelineno-35-1" href="#18-argocd-__codelineno-35-1"></a><span class="c1"># Set Helm values</span>
</span><span id="__span-35-2"><a id="__codelineno-35-2" name="__codelineno-35-2" href="#18-argocd-__codelineno-35-2"></a>argocd<span class="w"> </span>app<span class="w"> </span><span class="nb">set</span><span class="w"> </span>nginx-helm<span class="w"> </span><span class="se">\</span>
</span><span id="__span-35-3"><a id="__codelineno-35-3" name="__codelineno-35-3" href="#18-argocd-__codelineno-35-3"></a><span class="w">  </span>--helm-set<span class="w"> </span>service.type<span class="o">=</span>NodePort<span class="w"> </span><span class="se">\</span>
</span><span id="__span-35-4"><a id="__codelineno-35-4" name="__codelineno-35-4" href="#18-argocd-__codelineno-35-4"></a><span class="w">  </span>--helm-set<span class="w"> </span><span class="nv">replicaCount</span><span class="o">=</span><span class="m">3</span>
</span></code></pre></div>
<h3 id="18-argocd-step-03-sync-helm-application">Step 03 - Sync Helm Application<a class="headerlink" href="#18-argocd-step-03-sync-helm-application" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-36-1"><a id="__codelineno-36-1" name="__codelineno-36-1" href="#18-argocd-__codelineno-36-1"></a>argocd<span class="w"> </span>app<span class="w"> </span>sync<span class="w"> </span>nginx-helm
</span></code></pre></div>
<h3 id="18-argocd-step-04-view-helm-parameters">Step 04 - View Helm Parameters<a class="headerlink" href="#18-argocd-step-04-view-helm-parameters" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-37-1"><a id="__codelineno-37-1" name="__codelineno-37-1" href="#18-argocd-__codelineno-37-1"></a><span class="c1"># View all Helm parameters</span>
</span><span id="__span-37-2"><a id="__codelineno-37-2" name="__codelineno-37-2" href="#18-argocd-__codelineno-37-2"></a>argocd<span class="w"> </span>app<span class="w"> </span>get<span class="w"> </span>nginx-helm<span class="w"> </span>--show-params
</span></code></pre></div>
<hr />
<h2 id="18-argocd-part-09-working-with-kustomize">Part 09 - Working with Kustomize<a class="headerlink" href="#18-argocd-part-09-working-with-kustomize" title="Permanent link">&para;</a></h2>
<h3 id="18-argocd-step-01-create-kustomize-based-application">Step 01 - Create Kustomize-Based Application<a class="headerlink" href="#18-argocd-step-01-create-kustomize-based-application" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-38-1"><a id="__codelineno-38-1" name="__codelineno-38-1" href="#18-argocd-__codelineno-38-1"></a>argocd<span class="w"> </span>app<span class="w"> </span>create<span class="w"> </span>kustomize-guestbook<span class="w"> </span><span class="se">\</span>
</span><span id="__span-38-2"><a id="__codelineno-38-2" name="__codelineno-38-2" href="#18-argocd-__codelineno-38-2"></a><span class="w">  </span>--repo<span class="w"> </span>https://github.com/argoproj/argocd-example-apps.git<span class="w"> </span><span class="se">\</span>
</span><span id="__span-38-3"><a id="__codelineno-38-3" name="__codelineno-38-3" href="#18-argocd-__codelineno-38-3"></a><span class="w">  </span>--path<span class="w"> </span>kustomize-guestbook<span class="w"> </span><span class="se">\</span>
</span><span id="__span-38-4"><a id="__codelineno-38-4" name="__codelineno-38-4" href="#18-argocd-__codelineno-38-4"></a><span class="w">  </span>--dest-server<span class="w"> </span>https://kubernetes.default.svc<span class="w"> </span><span class="se">\</span>
</span><span id="__span-38-5"><a id="__codelineno-38-5" name="__codelineno-38-5" href="#18-argocd-__codelineno-38-5"></a><span class="w">  </span>--dest-namespace<span class="w"> </span>default
</span></code></pre></div>
<h3 id="18-argocd-step-02-sync-kustomize-application">Step 02 - Sync Kustomize Application<a class="headerlink" href="#18-argocd-step-02-sync-kustomize-application" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-39-1"><a id="__codelineno-39-1" name="__codelineno-39-1" href="#18-argocd-__codelineno-39-1"></a>argocd<span class="w"> </span>app<span class="w"> </span>sync<span class="w"> </span>kustomize-guestbook
</span></code></pre></div>
<h3 id="18-argocd-step-03-verify-deployment">Step 03 - Verify Deployment<a class="headerlink" href="#18-argocd-step-03-verify-deployment" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-40-1"><a id="__codelineno-40-1" name="__codelineno-40-1" href="#18-argocd-__codelineno-40-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>all<span class="w"> </span>-n<span class="w"> </span>default<span class="w"> </span>-l<span class="w"> </span><span class="nv">app</span><span class="o">=</span>kustomize-guestbook
</span></code></pre></div>
<hr />
<h2 id="18-argocd-part-10-projects-and-rbac">Part 10 - Projects and RBAC<a class="headerlink" href="#18-argocd-part-10-projects-and-rbac" title="Permanent link">&para;</a></h2>
<h3 id="18-argocd-step-01-create-a-new-project">Step 01 - Create a New Project<a class="headerlink" href="#18-argocd-step-01-create-a-new-project" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-41-1"><a id="__codelineno-41-1" name="__codelineno-41-1" href="#18-argocd-__codelineno-41-1"></a>argocd<span class="w"> </span>proj<span class="w"> </span>create<span class="w"> </span>my-project<span class="w"> </span><span class="se">\</span>
</span><span id="__span-41-2"><a id="__codelineno-41-2" name="__codelineno-41-2" href="#18-argocd-__codelineno-41-2"></a><span class="w">  </span>--description<span class="w"> </span><span class="s2">&quot;My demo project&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-41-3"><a id="__codelineno-41-3" name="__codelineno-41-3" href="#18-argocd-__codelineno-41-3"></a><span class="w">  </span>--src<span class="w"> </span>https://github.com/argoproj/argocd-example-apps.git<span class="w"> </span><span class="se">\</span>
</span><span id="__span-41-4"><a id="__codelineno-41-4" name="__codelineno-41-4" href="#18-argocd-__codelineno-41-4"></a><span class="w">  </span>--dest<span class="w"> </span>https://kubernetes.default.svc,default<span class="w"> </span><span class="se">\</span>
</span><span id="__span-41-5"><a id="__codelineno-41-5" name="__codelineno-41-5" href="#18-argocd-__codelineno-41-5"></a><span class="w">  </span>--dest<span class="w"> </span>https://kubernetes.default.svc,my-namespace
</span></code></pre></div>
<h3 id="18-argocd-step-02-list-projects">Step 02 - List Projects<a class="headerlink" href="#18-argocd-step-02-list-projects" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-42-1"><a id="__codelineno-42-1" name="__codelineno-42-1" href="#18-argocd-__codelineno-42-1"></a>argocd<span class="w"> </span>proj<span class="w"> </span>list
</span></code></pre></div>
<h3 id="18-argocd-step-03-view-project-details">Step 03 - View Project Details<a class="headerlink" href="#18-argocd-step-03-view-project-details" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-43-1"><a id="__codelineno-43-1" name="__codelineno-43-1" href="#18-argocd-__codelineno-43-1"></a>argocd<span class="w"> </span>proj<span class="w"> </span>get<span class="w"> </span>my-project
</span></code></pre></div>
<h3 id="18-argocd-step-04-create-application-in-project">Step 04 - Create Application in Project<a class="headerlink" href="#18-argocd-step-04-create-application-in-project" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-44-1"><a id="__codelineno-44-1" name="__codelineno-44-1" href="#18-argocd-__codelineno-44-1"></a>argocd<span class="w"> </span>app<span class="w"> </span>create<span class="w"> </span>my-app<span class="w"> </span><span class="se">\</span>
</span><span id="__span-44-2"><a id="__codelineno-44-2" name="__codelineno-44-2" href="#18-argocd-__codelineno-44-2"></a><span class="w">  </span>--project<span class="w"> </span>my-project<span class="w"> </span><span class="se">\</span>
</span><span id="__span-44-3"><a id="__codelineno-44-3" name="__codelineno-44-3" href="#18-argocd-__codelineno-44-3"></a><span class="w">  </span>--repo<span class="w"> </span>https://github.com/argoproj/argocd-example-apps.git<span class="w"> </span><span class="se">\</span>
</span><span id="__span-44-4"><a id="__codelineno-44-4" name="__codelineno-44-4" href="#18-argocd-__codelineno-44-4"></a><span class="w">  </span>--path<span class="w"> </span>guestbook<span class="w"> </span><span class="se">\</span>
</span><span id="__span-44-5"><a id="__codelineno-44-5" name="__codelineno-44-5" href="#18-argocd-__codelineno-44-5"></a><span class="w">  </span>--dest-server<span class="w"> </span>https://kubernetes.default.svc<span class="w"> </span><span class="se">\</span>
</span><span id="__span-44-6"><a id="__codelineno-44-6" name="__codelineno-44-6" href="#18-argocd-__codelineno-44-6"></a><span class="w">  </span>--dest-namespace<span class="w"> </span>default
</span></code></pre></div>
<hr />
<h2 id="18-argocd-part-11-multi-source-applications">Part 11 - Multi-Source Applications<a class="headerlink" href="#18-argocd-part-11-multi-source-applications" title="Permanent link">&para;</a></h2>
<h3 id="18-argocd-step-01-create-multi-source-application">Step 01 - Create Multi-Source Application<a class="headerlink" href="#18-argocd-step-01-create-multi-source-application" title="Permanent link">&para;</a></h3>
<ul>
<li><code>ArgoCD</code> supports applications with multiple source repositories:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-45-1"><a id="__codelineno-45-1" name="__codelineno-45-1" href="#18-argocd-__codelineno-45-1"></a><span class="c1"># Save as multi-source-app.yaml</span>
</span><span id="__span-45-2"><a id="__codelineno-45-2" name="__codelineno-45-2" href="#18-argocd-__codelineno-45-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">argoproj.io/v1alpha1</span>
</span><span id="__span-45-3"><a id="__codelineno-45-3" name="__codelineno-45-3" href="#18-argocd-__codelineno-45-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Application</span>
</span><span id="__span-45-4"><a id="__codelineno-45-4" name="__codelineno-45-4" href="#18-argocd-__codelineno-45-4"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-45-5"><a id="__codelineno-45-5" name="__codelineno-45-5" href="#18-argocd-__codelineno-45-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">multi-source-app</span>
</span><span id="__span-45-6"><a id="__codelineno-45-6" name="__codelineno-45-6" href="#18-argocd-__codelineno-45-6"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">argocd</span>
</span><span id="__span-45-7"><a id="__codelineno-45-7" name="__codelineno-45-7" href="#18-argocd-__codelineno-45-7"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-45-8"><a id="__codelineno-45-8" name="__codelineno-45-8" href="#18-argocd-__codelineno-45-8"></a><span class="w">  </span><span class="nt">project</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
</span><span id="__span-45-9"><a id="__codelineno-45-9" name="__codelineno-45-9" href="#18-argocd-__codelineno-45-9"></a><span class="w">  </span><span class="nt">sources</span><span class="p">:</span>
</span><span id="__span-45-10"><a id="__codelineno-45-10" name="__codelineno-45-10" href="#18-argocd-__codelineno-45-10"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">repoURL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/argoproj/argocd-example-apps.git</span>
</span><span id="__span-45-11"><a id="__codelineno-45-11" name="__codelineno-45-11" href="#18-argocd-__codelineno-45-11"></a><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">guestbook</span>
</span><span id="__span-45-12"><a id="__codelineno-45-12" name="__codelineno-45-12" href="#18-argocd-__codelineno-45-12"></a><span class="w">      </span><span class="nt">targetRevision</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HEAD</span>
</span><span id="__span-45-13"><a id="__codelineno-45-13" name="__codelineno-45-13" href="#18-argocd-__codelineno-45-13"></a><span class="w">    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">repoURL</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://github.com/another-repo/configs.git</span>
</span><span id="__span-45-14"><a id="__codelineno-45-14" name="__codelineno-45-14" href="#18-argocd-__codelineno-45-14"></a><span class="w">      </span><span class="nt">path</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">overlays/prod</span>
</span><span id="__span-45-15"><a id="__codelineno-45-15" name="__codelineno-45-15" href="#18-argocd-__codelineno-45-15"></a><span class="w">      </span><span class="nt">targetRevision</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HEAD</span>
</span><span id="__span-45-16"><a id="__codelineno-45-16" name="__codelineno-45-16" href="#18-argocd-__codelineno-45-16"></a><span class="w">  </span><span class="nt">destination</span><span class="p">:</span>
</span><span id="__span-45-17"><a id="__codelineno-45-17" name="__codelineno-45-17" href="#18-argocd-__codelineno-45-17"></a><span class="w">    </span><span class="nt">server</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">https://kubernetes.default.svc</span>
</span><span id="__span-45-18"><a id="__codelineno-45-18" name="__codelineno-45-18" href="#18-argocd-__codelineno-45-18"></a><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
</span><span id="__span-45-19"><a id="__codelineno-45-19" name="__codelineno-45-19" href="#18-argocd-__codelineno-45-19"></a><span class="w">  </span><span class="nt">syncPolicy</span><span class="p">:</span>
</span><span id="__span-45-20"><a id="__codelineno-45-20" name="__codelineno-45-20" href="#18-argocd-__codelineno-45-20"></a><span class="w">    </span><span class="nt">automated</span><span class="p">:</span>
</span><span id="__span-45-21"><a id="__codelineno-45-21" name="__codelineno-45-21" href="#18-argocd-__codelineno-45-21"></a><span class="w">      </span><span class="nt">prune</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span><span id="__span-45-22"><a id="__codelineno-45-22" name="__codelineno-45-22" href="#18-argocd-__codelineno-45-22"></a><span class="w">      </span><span class="nt">selfHeal</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">true</span>
</span></code></pre></div>
<h3 id="18-argocd-step-02-apply-multi-source-application">Step 02 - Apply Multi-Source Application<a class="headerlink" href="#18-argocd-step-02-apply-multi-source-application" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-46-1"><a id="__codelineno-46-1" name="__codelineno-46-1" href="#18-argocd-__codelineno-46-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>multi-source-app.yaml
</span></code></pre></div>
<hr />
<h2 id="18-argocd-part-12-sync-windows-and-waves">Part 12 - Sync Windows and Waves<a class="headerlink" href="#18-argocd-part-12-sync-windows-and-waves" title="Permanent link">&para;</a></h2>
<h3 id="18-argocd-step-01-configure-sync-windows">Step 01 - Configure Sync Windows<a class="headerlink" href="#18-argocd-step-01-configure-sync-windows" title="Permanent link">&para;</a></h3>
<ul>
<li>Sync windows allow you to define time periods when syncs are allowed or denied:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-47-1"><a id="__codelineno-47-1" name="__codelineno-47-1" href="#18-argocd-__codelineno-47-1"></a><span class="c1"># Add a sync window to allow syncs only during business hours</span>
</span><span id="__span-47-2"><a id="__codelineno-47-2" name="__codelineno-47-2" href="#18-argocd-__codelineno-47-2"></a>argocd<span class="w"> </span>proj<span class="w"> </span>windows<span class="w"> </span>add<span class="w"> </span>my-project<span class="w"> </span><span class="se">\</span>
</span><span id="__span-47-3"><a id="__codelineno-47-3" name="__codelineno-47-3" href="#18-argocd-__codelineno-47-3"></a><span class="w">  </span>--kind<span class="w"> </span>allow<span class="w"> </span><span class="se">\</span>
</span><span id="__span-47-4"><a id="__codelineno-47-4" name="__codelineno-47-4" href="#18-argocd-__codelineno-47-4"></a><span class="w">  </span>--schedule<span class="w"> </span><span class="s2">&quot;0 9 * * 1-5&quot;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-47-5"><a id="__codelineno-47-5" name="__codelineno-47-5" href="#18-argocd-__codelineno-47-5"></a><span class="w">  </span>--duration<span class="w"> </span>8h<span class="w"> </span><span class="se">\</span>
</span><span id="__span-47-6"><a id="__codelineno-47-6" name="__codelineno-47-6" href="#18-argocd-__codelineno-47-6"></a><span class="w">  </span>--applications<span class="w"> </span><span class="s2">&quot;*&quot;</span>
</span></code></pre></div>
<h3 id="18-argocd-step-02-configure-sync-waves">Step 02 - Configure Sync Waves<a class="headerlink" href="#18-argocd-step-02-configure-sync-waves" title="Permanent link">&para;</a></h3>
<ul>
<li>Use annotations to control the order of resource synchronization:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-48-1"><a id="__codelineno-48-1" name="__codelineno-48-1" href="#18-argocd-__codelineno-48-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-48-2"><a id="__codelineno-48-2" name="__codelineno-48-2" href="#18-argocd-__codelineno-48-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-48-3"><a id="__codelineno-48-3" name="__codelineno-48-3" href="#18-argocd-__codelineno-48-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-48-4"><a id="__codelineno-48-4" name="__codelineno-48-4" href="#18-argocd-__codelineno-48-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database</span>
</span><span id="__span-48-5"><a id="__codelineno-48-5" name="__codelineno-48-5" href="#18-argocd-__codelineno-48-5"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-48-6"><a id="__codelineno-48-6" name="__codelineno-48-6" href="#18-argocd-__codelineno-48-6"></a><span class="w">    </span><span class="nt">argocd.argoproj.io/sync-wave</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;0&quot;</span><span class="w">  </span><span class="c1"># Deploy first</span>
</span><span id="__span-48-7"><a id="__codelineno-48-7" name="__codelineno-48-7" href="#18-argocd-__codelineno-48-7"></a><span class="nn">---</span>
</span><span id="__span-48-8"><a id="__codelineno-48-8" name="__codelineno-48-8" href="#18-argocd-__codelineno-48-8"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-48-9"><a id="__codelineno-48-9" name="__codelineno-48-9" href="#18-argocd-__codelineno-48-9"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-48-10"><a id="__codelineno-48-10" name="__codelineno-48-10" href="#18-argocd-__codelineno-48-10"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-48-11"><a id="__codelineno-48-11" name="__codelineno-48-11" href="#18-argocd-__codelineno-48-11"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">backend</span>
</span><span id="__span-48-12"><a id="__codelineno-48-12" name="__codelineno-48-12" href="#18-argocd-__codelineno-48-12"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-48-13"><a id="__codelineno-48-13" name="__codelineno-48-13" href="#18-argocd-__codelineno-48-13"></a><span class="w">    </span><span class="nt">argocd.argoproj.io/sync-wave</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;1&quot;</span><span class="w">  </span><span class="c1"># Deploy after database</span>
</span><span id="__span-48-14"><a id="__codelineno-48-14" name="__codelineno-48-14" href="#18-argocd-__codelineno-48-14"></a><span class="nn">---</span>
</span><span id="__span-48-15"><a id="__codelineno-48-15" name="__codelineno-48-15" href="#18-argocd-__codelineno-48-15"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-48-16"><a id="__codelineno-48-16" name="__codelineno-48-16" href="#18-argocd-__codelineno-48-16"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-48-17"><a id="__codelineno-48-17" name="__codelineno-48-17" href="#18-argocd-__codelineno-48-17"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-48-18"><a id="__codelineno-48-18" name="__codelineno-48-18" href="#18-argocd-__codelineno-48-18"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">frontend</span>
</span><span id="__span-48-19"><a id="__codelineno-48-19" name="__codelineno-48-19" href="#18-argocd-__codelineno-48-19"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-48-20"><a id="__codelineno-48-20" name="__codelineno-48-20" href="#18-argocd-__codelineno-48-20"></a><span class="w">    </span><span class="nt">argocd.argoproj.io/sync-wave</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;2&quot;</span><span class="w">  </span><span class="c1"># Deploy last</span>
</span></code></pre></div>
<hr />
<h2 id="18-argocd-part-13-health-checks-and-hooks">Part 13 - Health Checks and Hooks<a class="headerlink" href="#18-argocd-part-13-health-checks-and-hooks" title="Permanent link">&para;</a></h2>
<h3 id="18-argocd-step-01-custom-health-checks">Step 01 - Custom Health Checks<a class="headerlink" href="#18-argocd-step-01-custom-health-checks" title="Permanent link">&para;</a></h3>
<ul>
<li>Define custom health checks for your resources:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-49-1"><a id="__codelineno-49-1" name="__codelineno-49-1" href="#18-argocd-__codelineno-49-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1</span>
</span><span id="__span-49-2"><a id="__codelineno-49-2" name="__codelineno-49-2" href="#18-argocd-__codelineno-49-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">ConfigMap</span>
</span><span id="__span-49-3"><a id="__codelineno-49-3" name="__codelineno-49-3" href="#18-argocd-__codelineno-49-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-49-4"><a id="__codelineno-49-4" name="__codelineno-49-4" href="#18-argocd-__codelineno-49-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">argocd-cm</span>
</span><span id="__span-49-5"><a id="__codelineno-49-5" name="__codelineno-49-5" href="#18-argocd-__codelineno-49-5"></a><span class="w">  </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">argocd</span>
</span><span id="__span-49-6"><a id="__codelineno-49-6" name="__codelineno-49-6" href="#18-argocd-__codelineno-49-6"></a><span class="nt">data</span><span class="p">:</span>
</span><span id="__span-49-7"><a id="__codelineno-49-7" name="__codelineno-49-7" href="#18-argocd-__codelineno-49-7"></a><span class="w">  </span><span class="nt">resource.customizations</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">|</span>
</span><span id="__span-49-8"><a id="__codelineno-49-8" name="__codelineno-49-8" href="#18-argocd-__codelineno-49-8"></a><span class="w">    </span><span class="no">cert-manager.io/Certificate:</span>
</span><span id="__span-49-9"><a id="__codelineno-49-9" name="__codelineno-49-9" href="#18-argocd-__codelineno-49-9"></a><span class="w">      </span><span class="no">health.lua: |</span>
</span><span id="__span-49-10"><a id="__codelineno-49-10" name="__codelineno-49-10" href="#18-argocd-__codelineno-49-10"></a><span class="w">        </span><span class="no">hs = {}</span>
</span><span id="__span-49-11"><a id="__codelineno-49-11" name="__codelineno-49-11" href="#18-argocd-__codelineno-49-11"></a><span class="w">        </span><span class="no">if obj.status ~= nil then</span>
</span><span id="__span-49-12"><a id="__codelineno-49-12" name="__codelineno-49-12" href="#18-argocd-__codelineno-49-12"></a><span class="w">          </span><span class="no">if obj.status.conditions ~= nil then</span>
</span><span id="__span-49-13"><a id="__codelineno-49-13" name="__codelineno-49-13" href="#18-argocd-__codelineno-49-13"></a><span class="w">            </span><span class="no">for i, condition in ipairs(obj.status.conditions) do</span>
</span><span id="__span-49-14"><a id="__codelineno-49-14" name="__codelineno-49-14" href="#18-argocd-__codelineno-49-14"></a><span class="w">              </span><span class="no">if condition.type == &quot;Ready&quot; and condition.status == &quot;False&quot; then</span>
</span><span id="__span-49-15"><a id="__codelineno-49-15" name="__codelineno-49-15" href="#18-argocd-__codelineno-49-15"></a><span class="w">                </span><span class="no">hs.status = &quot;Degraded&quot;</span>
</span><span id="__span-49-16"><a id="__codelineno-49-16" name="__codelineno-49-16" href="#18-argocd-__codelineno-49-16"></a><span class="w">                </span><span class="no">hs.message = condition.message</span>
</span><span id="__span-49-17"><a id="__codelineno-49-17" name="__codelineno-49-17" href="#18-argocd-__codelineno-49-17"></a><span class="w">                </span><span class="no">return hs</span>
</span><span id="__span-49-18"><a id="__codelineno-49-18" name="__codelineno-49-18" href="#18-argocd-__codelineno-49-18"></a><span class="w">              </span><span class="no">end</span>
</span><span id="__span-49-19"><a id="__codelineno-49-19" name="__codelineno-49-19" href="#18-argocd-__codelineno-49-19"></a><span class="w">              </span><span class="no">if condition.type == &quot;Ready&quot; and condition.status == &quot;True&quot; then</span>
</span><span id="__span-49-20"><a id="__codelineno-49-20" name="__codelineno-49-20" href="#18-argocd-__codelineno-49-20"></a><span class="w">                </span><span class="no">hs.status = &quot;Healthy&quot;</span>
</span><span id="__span-49-21"><a id="__codelineno-49-21" name="__codelineno-49-21" href="#18-argocd-__codelineno-49-21"></a><span class="w">                </span><span class="no">hs.message = condition.message</span>
</span><span id="__span-49-22"><a id="__codelineno-49-22" name="__codelineno-49-22" href="#18-argocd-__codelineno-49-22"></a><span class="w">                </span><span class="no">return hs</span>
</span><span id="__span-49-23"><a id="__codelineno-49-23" name="__codelineno-49-23" href="#18-argocd-__codelineno-49-23"></a><span class="w">              </span><span class="no">end</span>
</span><span id="__span-49-24"><a id="__codelineno-49-24" name="__codelineno-49-24" href="#18-argocd-__codelineno-49-24"></a><span class="w">            </span><span class="no">end</span>
</span><span id="__span-49-25"><a id="__codelineno-49-25" name="__codelineno-49-25" href="#18-argocd-__codelineno-49-25"></a><span class="w">          </span><span class="no">end</span>
</span><span id="__span-49-26"><a id="__codelineno-49-26" name="__codelineno-49-26" href="#18-argocd-__codelineno-49-26"></a><span class="w">        </span><span class="no">end</span>
</span><span id="__span-49-27"><a id="__codelineno-49-27" name="__codelineno-49-27" href="#18-argocd-__codelineno-49-27"></a><span class="w">        </span><span class="no">hs.status = &quot;Progressing&quot;</span>
</span><span id="__span-49-28"><a id="__codelineno-49-28" name="__codelineno-49-28" href="#18-argocd-__codelineno-49-28"></a><span class="w">        </span><span class="no">hs.message = &quot;Waiting for certificate&quot;</span>
</span><span id="__span-49-29"><a id="__codelineno-49-29" name="__codelineno-49-29" href="#18-argocd-__codelineno-49-29"></a><span class="w">        </span><span class="no">return hs</span>
</span></code></pre></div>
<h3 id="18-argocd-step-02-sync-hooks">Step 02 - Sync Hooks<a class="headerlink" href="#18-argocd-step-02-sync-hooks" title="Permanent link">&para;</a></h3>
<ul>
<li>Use hooks to execute actions during sync:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-50-1"><a id="__codelineno-50-1" name="__codelineno-50-1" href="#18-argocd-__codelineno-50-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">batch/v1</span>
</span><span id="__span-50-2"><a id="__codelineno-50-2" name="__codelineno-50-2" href="#18-argocd-__codelineno-50-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Job</span>
</span><span id="__span-50-3"><a id="__codelineno-50-3" name="__codelineno-50-3" href="#18-argocd-__codelineno-50-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-50-4"><a id="__codelineno-50-4" name="__codelineno-50-4" href="#18-argocd-__codelineno-50-4"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">database-migration</span>
</span><span id="__span-50-5"><a id="__codelineno-50-5" name="__codelineno-50-5" href="#18-argocd-__codelineno-50-5"></a><span class="w">  </span><span class="nt">annotations</span><span class="p">:</span>
</span><span id="__span-50-6"><a id="__codelineno-50-6" name="__codelineno-50-6" href="#18-argocd-__codelineno-50-6"></a><span class="w">    </span><span class="nt">argocd.argoproj.io/hook</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">PreSync</span>
</span><span id="__span-50-7"><a id="__codelineno-50-7" name="__codelineno-50-7" href="#18-argocd-__codelineno-50-7"></a><span class="w">    </span><span class="nt">argocd.argoproj.io/hook-delete-policy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">HookSucceeded</span>
</span><span id="__span-50-8"><a id="__codelineno-50-8" name="__codelineno-50-8" href="#18-argocd-__codelineno-50-8"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-50-9"><a id="__codelineno-50-9" name="__codelineno-50-9" href="#18-argocd-__codelineno-50-9"></a><span class="w">  </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-50-10"><a id="__codelineno-50-10" name="__codelineno-50-10" href="#18-argocd-__codelineno-50-10"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-50-11"><a id="__codelineno-50-11" name="__codelineno-50-11" href="#18-argocd-__codelineno-50-11"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-50-12"><a id="__codelineno-50-12" name="__codelineno-50-12" href="#18-argocd-__codelineno-50-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">migration</span>
</span><span id="__span-50-13"><a id="__codelineno-50-13" name="__codelineno-50-13" href="#18-argocd-__codelineno-50-13"></a><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">myapp/migration:latest</span>
</span><span id="__span-50-14"><a id="__codelineno-50-14" name="__codelineno-50-14" href="#18-argocd-__codelineno-50-14"></a><span class="w">        </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="p p-Indicator">[</span><span class="s">&quot;./run-migrations.sh&quot;</span><span class="p p-Indicator">]</span>
</span><span id="__span-50-15"><a id="__codelineno-50-15" name="__codelineno-50-15" href="#18-argocd-__codelineno-50-15"></a><span class="w">      </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Never</span>
</span></code></pre></div>
<hr />
<h2 id="18-argocd-finalize-cleanup">Finalize &amp; Cleanup<a class="headerlink" href="#18-argocd-finalize-cleanup" title="Permanent link">&para;</a></h2>
<h3 id="18-argocd-clean-up-applications">Clean Up Applications<a class="headerlink" href="#18-argocd-clean-up-applications" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-51-1"><a id="__codelineno-51-1" name="__codelineno-51-1" href="#18-argocd-__codelineno-51-1"></a><span class="c1"># Delete all applications</span>
</span><span id="__span-51-2"><a id="__codelineno-51-2" name="__codelineno-51-2" href="#18-argocd-__codelineno-51-2"></a>argocd<span class="w"> </span>app<span class="w"> </span>delete<span class="w"> </span>guestbook<span class="w"> </span>--cascade
</span><span id="__span-51-3"><a id="__codelineno-51-3" name="__codelineno-51-3" href="#18-argocd-__codelineno-51-3"></a>argocd<span class="w"> </span>app<span class="w"> </span>delete<span class="w"> </span>helm-guestbook<span class="w"> </span>--cascade
</span><span id="__span-51-4"><a id="__codelineno-51-4" name="__codelineno-51-4" href="#18-argocd-__codelineno-51-4"></a>argocd<span class="w"> </span>app<span class="w"> </span>delete<span class="w"> </span>nginx-helm<span class="w"> </span>--cascade
</span><span id="__span-51-5"><a id="__codelineno-51-5" name="__codelineno-51-5" href="#18-argocd-__codelineno-51-5"></a>argocd<span class="w"> </span>app<span class="w"> </span>delete<span class="w"> </span>kustomize-guestbook<span class="w"> </span>--cascade
</span><span id="__span-51-6"><a id="__codelineno-51-6" name="__codelineno-51-6" href="#18-argocd-__codelineno-51-6"></a>
</span><span id="__span-51-7"><a id="__codelineno-51-7" name="__codelineno-51-7" href="#18-argocd-__codelineno-51-7"></a><span class="c1"># Or delete via kubectl</span>
</span><span id="__span-51-8"><a id="__codelineno-51-8" name="__codelineno-51-8" href="#18-argocd-__codelineno-51-8"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>applications<span class="w"> </span>-n<span class="w"> </span>argocd<span class="w"> </span>--all
</span></code></pre></div>
<h3 id="18-argocd-uninstall-argocd">Uninstall ArgoCD<a class="headerlink" href="#18-argocd-uninstall-argocd" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-52-1"><a id="__codelineno-52-1" name="__codelineno-52-1" href="#18-argocd-__codelineno-52-1"></a><span class="c1"># Delete ArgoCD installation</span>
</span><span id="__span-52-2"><a id="__codelineno-52-2" name="__codelineno-52-2" href="#18-argocd-__codelineno-52-2"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>-n<span class="w"> </span>argocd<span class="w"> </span>-f<span class="w"> </span>https://raw.githubusercontent.com/argoproj/argo-cd/stable/manifests/install.yaml
</span><span id="__span-52-3"><a id="__codelineno-52-3" name="__codelineno-52-3" href="#18-argocd-__codelineno-52-3"></a>
</span><span id="__span-52-4"><a id="__codelineno-52-4" name="__codelineno-52-4" href="#18-argocd-__codelineno-52-4"></a><span class="c1"># Delete the namespace</span>
</span><span id="__span-52-5"><a id="__codelineno-52-5" name="__codelineno-52-5" href="#18-argocd-__codelineno-52-5"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>namespace<span class="w"> </span>argocd
</span></code></pre></div>
<hr />
<h2 id="18-argocd-troubleshooting">Troubleshooting<a class="headerlink" href="#18-argocd-troubleshooting" title="Permanent link">&para;</a></h2>
<h3 id="18-argocd-argocd-server-not-accessible">ArgoCD Server Not Accessible<a class="headerlink" href="#18-argocd-argocd-server-not-accessible" title="Permanent link">&para;</a></h3>
<ul>
<li>Check if the <code>ArgoCD</code> server pod is running:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-53-1"><a id="__codelineno-53-1" name="__codelineno-53-1" href="#18-argocd-__codelineno-53-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span>-n<span class="w"> </span>argocd<span class="w"> </span>-l<span class="w"> </span>app.kubernetes.io/name<span class="o">=</span>argocd-server
</span></code></pre></div>
<ul>
<li>Check the service:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-54-1"><a id="__codelineno-54-1" name="__codelineno-54-1" href="#18-argocd-__codelineno-54-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span>-n<span class="w"> </span>argocd<span class="w"> </span>argocd-server
</span></code></pre></div>
<h3 id="18-argocd-application-stuck-in-progressing-state">Application Stuck in Progressing State<a class="headerlink" href="#18-argocd-application-stuck-in-progressing-state" title="Permanent link">&para;</a></h3>
<ul>
<li>Check application details:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-55-1"><a id="__codelineno-55-1" name="__codelineno-55-1" href="#18-argocd-__codelineno-55-1"></a>argocd<span class="w"> </span>app<span class="w"> </span>get<span class="w"> </span>&lt;app-name&gt;
</span><span id="__span-55-2"><a id="__codelineno-55-2" name="__codelineno-55-2" href="#18-argocd-__codelineno-55-2"></a>kubectl<span class="w"> </span>describe<span class="w"> </span>application<span class="w"> </span>&lt;app-name&gt;<span class="w"> </span>-n<span class="w"> </span>argocd
</span></code></pre></div>
<ul>
<li>Check pod logs:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-56-1"><a id="__codelineno-56-1" name="__codelineno-56-1" href="#18-argocd-__codelineno-56-1"></a>kubectl<span class="w"> </span>logs<span class="w"> </span>-n<span class="w"> </span>argocd<span class="w"> </span>-l<span class="w"> </span>app.kubernetes.io/name<span class="o">=</span>argocd-application-controller
</span></code></pre></div>
<h3 id="18-argocd-sync-fails-with-permission-errors">Sync Fails with Permission Errors<a class="headerlink" href="#18-argocd-sync-fails-with-permission-errors" title="Permanent link">&para;</a></h3>
<ul>
<li>Verify RBAC settings:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-57-1"><a id="__codelineno-57-1" name="__codelineno-57-1" href="#18-argocd-__codelineno-57-1"></a>argocd<span class="w"> </span>proj<span class="w"> </span>get<span class="w"> </span>&lt;project-name&gt;
</span></code></pre></div>
<ul>
<li>Check if the destination namespace exists:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-58-1"><a id="__codelineno-58-1" name="__codelineno-58-1" href="#18-argocd-__codelineno-58-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>namespace<span class="w"> </span>&lt;namespace&gt;
</span></code></pre></div>
<h3 id="18-argocd-out-of-sync-status">Out of Sync Status<a class="headerlink" href="#18-argocd-out-of-sync-status" title="Permanent link">&para;</a></h3>
<ul>
<li>View the differences:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-59-1"><a id="__codelineno-59-1" name="__codelineno-59-1" href="#18-argocd-__codelineno-59-1"></a>argocd<span class="w"> </span>app<span class="w"> </span>diff<span class="w"> </span>&lt;app-name&gt;
</span></code></pre></div>
<ul>
<li>Force sync:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-60-1"><a id="__codelineno-60-1" name="__codelineno-60-1" href="#18-argocd-__codelineno-60-1"></a>argocd<span class="w"> </span>app<span class="w"> </span>sync<span class="w"> </span>&lt;app-name&gt;<span class="w"> </span>--force
</span></code></pre></div>
<h3 id="18-argocd-repository-connection-issues">Repository Connection Issues<a class="headerlink" href="#18-argocd-repository-connection-issues" title="Permanent link">&para;</a></h3>
<ul>
<li>Test repository connectivity:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-61-1"><a id="__codelineno-61-1" name="__codelineno-61-1" href="#18-argocd-__codelineno-61-1"></a>argocd<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>&lt;repo-url&gt;<span class="w"> </span>--username<span class="w"> </span>&lt;username&gt;<span class="w"> </span>--password<span class="w"> </span>&lt;password&gt;
</span><span id="__span-61-2"><a id="__codelineno-61-2" name="__codelineno-61-2" href="#18-argocd-__codelineno-61-2"></a>argocd<span class="w"> </span>repo<span class="w"> </span>list
</span></code></pre></div>
<hr />
<h2 id="18-argocd-best-practices">Best Practices<a class="headerlink" href="#18-argocd-best-practices" title="Permanent link">&para;</a></h2>
<h3 id="18-argocd-gitops-workflow">GitOps Workflow<a class="headerlink" href="#18-argocd-gitops-workflow" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Single Source of Truth</strong>: Keep all Kubernetes manifests in Git.</li>
<li><strong>Branch Strategy</strong>: Use branches for different environments (dev, staging, prod).</li>
<li><strong>Pull Requests</strong>: Use PRs for all changes with proper reviews.</li>
<li><strong>Automated Testing</strong>: Validate manifests before merging.</li>
<li><strong>Rollback Strategy</strong>: Use Git revert for rollbacks.</li>
</ol>
<h3 id="18-argocd-application-organization">Application Organization<a class="headerlink" href="#18-argocd-application-organization" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Use Projects</strong>: Organize applications by team or environment.</li>
<li><strong>Naming Conventions</strong>: Use clear, consistent naming.</li>
<li><strong>Sync Policies</strong>: Choose appropriate sync policies per environment.</li>
<li><strong>Resource Limits</strong>: Set proper resource limits in manifests.</li>
<li><strong>Health Checks</strong>: Define custom health checks for complex resources.</li>
</ol>
<h3 id="18-argocd-security">Security<a class="headerlink" href="#18-argocd-security" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>RBAC</strong>: Implement fine-grained access control.</li>
<li><strong>SSO Integration</strong>: Use SSO for authentication.</li>
<li><strong>Secret Management</strong>: Use sealed-secrets or external secret managers.</li>
<li><strong>Network Policies</strong>: Restrict <code>ArgoCD</code> network access.</li>
<li><strong>Audit Logging</strong>: Enable and monitor audit logs.</li>
</ol>
<h3 id="18-argocd-monitoring">Monitoring<a class="headerlink" href="#18-argocd-monitoring" title="Permanent link">&para;</a></h3>
<ol>
<li><strong>Notifications</strong>: Configure notifications for sync failures.</li>
<li><strong>Metrics</strong>: Monitor <code>ArgoCD</code> metrics with <code>Prometheus</code>.</li>
<li><strong>Dashboards</strong>: Create Grafana dashboards for visibility.</li>
<li><strong>Alerts</strong>: Set up alerts for critical failures.</li>
<li><strong>Regular Reviews</strong>: Periodically review application health.</li>
</ol>
<hr />
<h2 id="18-argocd-next-steps">Next Steps<a class="headerlink" href="#18-argocd-next-steps" title="Permanent link">&para;</a></h2>
<ul>
<li>Explore <strong>ApplicationSets</strong> for managing multiple applications.</li>
<li>Integrate <code>ArgoCD</code> with <strong>CI/CD pipelines</strong>.</li>
<li>Set up <strong>notifications</strong> using Slack, email, or webhooks.</li>
<li>Implement <strong>Progressive Delivery</strong> with Argo Rollouts.</li>
<li>Configure <strong>SSO</strong> integration with your identity provider.</li>
<li>Set up <strong>multi-cluster</strong> management.</li>
<li>Explore <strong>ArgoCD Image Updater</strong> for automated image updates.</li>
<li>Read the <a href="https://argo-cd.readthedocs.io/">official ArgoCD documentation</a></li>
<li>Join the <a href="https://github.com/argoproj/argo-cd">ArgoCD community</a></li>
</ul>
<hr />
<h2 id="18-argocd-additional-resources">Additional Resources<a class="headerlink" href="#18-argocd-additional-resources" title="Permanent link">&para;</a></h2>
<ul>
<li><a href="https://argo-cd.readthedocs.io/">ArgoCD Official Documentation</a></li>
<li><a href="https://github.com/argoproj/argo-cd">ArgoCD GitHub Repository</a></li>
<li><a href="https://argo-cd.readthedocs.io/en/stable/user-guide/best_practices/">ArgoCD Best Practices</a></li>
<li><a href="https://www.gitops.tech/">GitOps Principles</a></li>
<li><a href="https://argoproj.github.io/argo-rollouts/">Argo Rollouts (Progressive Delivery)</a></li>
<li><a href="https://argo-cd.readthedocs.io/en/stable/user-guide/application-set/">ArgoCD ApplicationSet</a></li>
</ul></section><section class="print-page" id="19-customscheduler" heading-number="2.21"><h1 id="19-customscheduler-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#19-customscheduler-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="19-customscheduler-writing-custom-scheduler">Writing custom Scheduler<a class="headerlink" href="#19-customscheduler-writing-custom-scheduler" title="Permanent link">&para;</a></h2>
<ul>
<li><code>Scheduling</code> is the process of selecting a node for a pod to run on.</li>
<li>In this lab we will write our own pods <code>scheduler</code>.</li>
<li>It is probably not something that you will ever need to do, but still it&rsquo;s a good practice to understand how scheduling works in K8S and how you can extend it.</li>
</ul>
<hr />
<!-- omit in toc -->
<h3 id="19-customscheduler-prerequisites">Prerequisites<a class="headerlink" href="#19-customscheduler-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>K8S cluster - <a href="#00-verifycluster">Setting up minikube cluster instruction</a></li>
<li><a href="https://kubernetes.io/docs/tasks/tools/"><strong>kubectl</strong></a> configured to interact with your cluster</li>
<li>A <code>Git repository</code> (GitHub, GitLab, or Bitbucket) for storing application manifests</li>
<li>Basic understanding of Kubernetes resources (Deployments, Services, etc.)</li>
</ul>
<p><a href="https://ide.cloud.google.com/?cloudshell_git_repo=https://github.com/nirgeier/KubernetesLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a></p>
<h3 id="19-customscheduler-ctrl-click-to-open-in-new-window"><strong><kbd>CTRL</kbd> + <kbd>click</kbd> to open in new window</strong><a class="headerlink" href="#19-customscheduler-ctrl-click-to-open-in-new-window" title="Permanent link">&para;</a></h3>
<!-- omit in toc -->

<hr />
<h2 id="19-customscheduler-custom-scheduler">Custom Scheduler<a class="headerlink" href="#19-customscheduler-custom-scheduler" title="Permanent link">&para;</a></h2>
<ul>
<li>See further information in the official documentation: <a href="https://kubernetes.io/docs/reference/scheduling/config">Scheduler Configuration</a></li>
<li>To schedule a given pod using a specific scheduler, specify the name of the scheduler in that specification <code>.spec.schedulerName</code>.</li>
</ul>
<h2 id="19-customscheduler-a-bit-about-scheduler">A bit about scheduler<a class="headerlink" href="#19-customscheduler-a-bit-about-scheduler" title="Permanent link">&para;</a></h2>
<ul>
<li>Scheduling happens in a series of <strong>stages</strong> that are exposed through extension points.</li>
<li>We can define several scheduling Profile. A scheduling Profile allows you to configure the different stages of scheduling in the <code>kube-scheduler</code></li>
</ul>
<hr />
<h2 id="19-customscheduler-sample-kubeschedulerconfiguration">Sample <code>KubeSchedulerConfiguration</code><a class="headerlink" href="#19-customscheduler-sample-kubeschedulerconfiguration" title="Permanent link">&para;</a></h2>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#19-customscheduler-__codelineno-0-1"></a><span class="c1">###</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#19-customscheduler-__codelineno-0-2"></a><span class="c1"># Sample KubeSchedulerConfiguration</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#19-customscheduler-__codelineno-0-3"></a><span class="c1">###</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#19-customscheduler-__codelineno-0-4"></a><span class="c1">#</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#19-customscheduler-__codelineno-0-5"></a><span class="c1"># You can configure `kube-scheduler` to run more than one profile.</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#19-customscheduler-__codelineno-0-6"></a><span class="c1"># Each profile has an associated scheduler name and can have a different</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#19-customscheduler-__codelineno-0-7"></a><span class="c1"># set of plugins configured in its extension points.</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#19-customscheduler-__codelineno-0-8"></a>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#19-customscheduler-__codelineno-0-9"></a><span class="c1"># With the following sample configuration, </span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#19-customscheduler-__codelineno-0-10"></a><span class="c1"># the scheduler will run with two profiles: </span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#19-customscheduler-__codelineno-0-11"></a><span class="c1"># - default plugins </span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#19-customscheduler-__codelineno-0-12"></a><span class="c1"># - all scoring plugins disabled</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#19-customscheduler-__codelineno-0-13"></a>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#19-customscheduler-__codelineno-0-14"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubescheduler.config.k8s.io/v1beta1</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#19-customscheduler-__codelineno-0-15"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">KubeSchedulerConfiguration</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#19-customscheduler-__codelineno-0-16"></a><span class="nt">profiles</span><span class="p">:</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#19-customscheduler-__codelineno-0-17"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schedulerName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default-scheduler</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#19-customscheduler-__codelineno-0-18"></a><span class="w">  </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">schedulerName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">no-scoring-scheduler</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#19-customscheduler-__codelineno-0-19"></a><span class="w">    </span><span class="nt">plugins</span><span class="p">:</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#19-customscheduler-__codelineno-0-20"></a><span class="w">      </span><span class="nt">preScore</span><span class="p">:</span>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#19-customscheduler-__codelineno-0-21"></a><span class="w">        </span><span class="nt">disabled</span><span class="p">:</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#19-customscheduler-__codelineno-0-22"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;*&#39;</span>
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#19-customscheduler-__codelineno-0-23"></a><span class="w">      </span><span class="nt">score</span><span class="p">:</span>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#19-customscheduler-__codelineno-0-24"></a><span class="w">        </span><span class="nt">disabled</span><span class="p">:</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#19-customscheduler-__codelineno-0-25"></a><span class="w">        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="s">&#39;*&#39;</span>
</span></code></pre></div>
<ul>
<li>Once you have your scheduler code, you can use it in your pod scheduler: </li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#19-customscheduler-__codelineno-1-1"></a><span class="c1"># In this sample we use deployment but it will apply to any pod</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#19-customscheduler-__codelineno-1-2"></a><span class="nn">...</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#19-customscheduler-__codelineno-1-3"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#19-customscheduler-__codelineno-1-4"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Deployment</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#19-customscheduler-__codelineno-1-5"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#19-customscheduler-__codelineno-1-6"></a><span class="w">    </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#19-customscheduler-__codelineno-1-7"></a><span class="w">      </span><span class="c1"># This is the import part of this file.</span>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#19-customscheduler-__codelineno-1-8"></a><span class="w">      </span><span class="c1"># Here we define our custom scheduler</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#19-customscheduler-__codelineno-1-9"></a><span class="w">      </span><span class="nt">schedulerName</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CodeWizardScheduler</span><span class="w"> </span><span class="c1"># &lt;------</span>
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#19-customscheduler-__codelineno-1-10"></a><span class="w">      </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#19-customscheduler-__codelineno-1-11"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#19-customscheduler-__codelineno-1-12"></a><span class="w">        </span><span class="nt">image</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx</span>
</span></code></pre></div>
<h3 id="19-customscheduler-sample-bash-scheduler">Sample bash scheduler<a class="headerlink" href="#19-customscheduler-sample-bash-scheduler" title="Permanent link">&para;</a></h3>
<ul>
<li>The &ldquo;trick&rdquo; is loop over all the waiting pods and search for the custom scheduler match in <code>spec.schedulerName</code> </li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#19-customscheduler-__codelineno-2-1"></a>...
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#19-customscheduler-__codelineno-2-2"></a><span class="w">  </span><span class="c1"># Get a list of all our pods in pending state</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#19-customscheduler-__codelineno-2-3"></a><span class="w">  </span><span class="k">for</span><span class="w"> </span>POD<span class="w"> </span><span class="k">in</span><span class="w"> </span><span class="k">$(</span>kubectl<span class="w">  </span>get<span class="w"> </span>pods<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#19-customscheduler-__codelineno-2-4"></a><span class="w">                        </span>--server<span class="w"> </span><span class="si">${</span><span class="nv">CLUSTER_URL</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#19-customscheduler-__codelineno-2-5"></a><span class="w">                        </span>--all-namespaces<span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#19-customscheduler-__codelineno-2-6"></a><span class="w">                        </span>--output<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.items..metadata.name}&#39;</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#19-customscheduler-__codelineno-2-7"></a><span class="w">                        </span>--field-selector<span class="o">=</span>status.phase<span class="o">==</span>Pending<span class="k">)</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#19-customscheduler-__codelineno-2-8"></a><span class="w">    </span><span class="k">do</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#19-customscheduler-__codelineno-2-9"></a>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#19-customscheduler-__codelineno-2-10"></a><span class="w">    </span><span class="c1"># Get the desired schedulerName if the pod has defined any schedulerName</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#19-customscheduler-__codelineno-2-11"></a><span class="w">    </span><span class="nv">CUSTOM_SCHEDULER_NAME</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span><span class="si">${</span><span class="nv">POD</span><span class="si">}</span><span class="w"> </span><span class="se">\</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#19-customscheduler-__codelineno-2-12"></a><span class="w">                                    </span>--output<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s1">&#39;{.spec.schedulerName}&#39;</span><span class="k">)</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#19-customscheduler-__codelineno-2-13"></a>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#19-customscheduler-__codelineno-2-14"></a><span class="w">    </span><span class="c1"># Check if the desired schedulerName is our custom one</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#19-customscheduler-__codelineno-2-15"></a><span class="w">    </span><span class="c1"># If its a match this is where our custom scheduler will &quot;jump in&quot;</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#19-customscheduler-__codelineno-2-16"></a><span class="w">    </span><span class="k">if</span><span class="w"> </span><span class="o">[</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CUSTOM_SCHEDULER_NAME</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">==</span><span class="w"> </span><span class="s2">&quot;</span><span class="si">${</span><span class="nv">CUSTOM_SCHEDULER</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span><span class="o">]</span><span class="p">;</span><span class="w"> </span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#19-customscheduler-__codelineno-2-17"></a><span class="w">      </span><span class="k">then</span>
</span><span id="__span-2-18"><a id="__codelineno-2-18" name="__codelineno-2-18" href="#19-customscheduler-__codelineno-2-18"></a><span class="w">        </span><span class="c1"># Do your magic here ......</span>
</span><span id="__span-2-19"><a id="__codelineno-2-19" name="__codelineno-2-19" href="#19-customscheduler-__codelineno-2-19"></a><span class="w">        </span><span class="c1"># Schedule the PODS as you wish</span>
</span><span id="__span-2-20"><a id="__codelineno-2-20" name="__codelineno-2-20" href="#19-customscheduler-__codelineno-2-20"></a><span class="w">    </span><span class="k">fi</span>
</span><span id="__span-2-21"><a id="__codelineno-2-21" name="__codelineno-2-21" href="#19-customscheduler-__codelineno-2-21"></a><span class="w">    </span>...
</span></code></pre></div></section><section class="print-page" id="20-cronjob" heading-number="2.22"><h1 id="20-cronjob-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#20-cronjob-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="20-cronjob-cronjobs">CronJobs<a class="headerlink" href="#20-cronjob-cronjobs" title="Permanent link">&para;</a></h2>
<ul>
<li>In this lab, we will learn how to create and manage <code>CronJobs</code> in Kubernetes.</li>
<li>A <code>CronJob</code> creates <code>Jobs</code> on a time-based schedule. It is useful for running periodic and recurring tasks, such as backups or report generation.</li>
</ul>
<hr />
<h3 id="20-cronjob-prerequisites">Prerequisites<a class="headerlink" href="#20-cronjob-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>K8S cluster - <a href="#00-verifycluster">Setting up minikube cluster instruction</a></li>
<li><a href="https://kubernetes.io/docs/tasks/tools/"><strong>kubectl</strong></a> configured to interact with your cluster</li>
</ul>
<p><a href="https://ide.cloud.google.com/?cloudshell_git_repo=https://github.com/nirgeier/KubernetesLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a><br />
<strong><kbd>CTRL</kbd> + <kbd>click</kbd> to open in new window</strong></p>
<hr />
<h3 id="20-cronjob-what-is-a-cronjob">What is a CronJob?<a class="headerlink" href="#20-cronjob-what-is-a-cronjob" title="Permanent link">&para;</a></h3>
<ul>
<li>A <code>CronJob</code> in Kubernetes runs Jobs on a time-based schedule, similar to Linux cron.</li>
<li>Useful for periodic tasks like backups, reports, or cleanup.</li>
</ul>
<hr />
<h3 id="20-cronjob-step-01-create-a-cronjob-yaml">Step 01 - Create a CronJob YAML<a class="headerlink" href="#20-cronjob-step-01-create-a-cronjob-yaml" title="Permanent link">&para;</a></h3>
<ul>
<li>Create a file named <code>hello-cronjob.yaml</code> with the following content:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#20-cronjob-__codelineno-0-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">batch/v1</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#20-cronjob-__codelineno-0-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">CronJob</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#20-cronjob-__codelineno-0-3"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#20-cronjob-__codelineno-0-4"></a><span class="w">    </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hello</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#20-cronjob-__codelineno-0-5"></a><span class="w">    </span><span class="nt">namespace</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">default</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#20-cronjob-__codelineno-0-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#20-cronjob-__codelineno-0-7"></a><span class="w">    </span><span class="nt">schedule</span><span class="p">:</span><span class="w"> </span><span class="s">&quot;*/1</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*</span><span class="nv"> </span><span class="s">*&quot;</span><span class="w"> </span><span class="c1"># Every 1 minute</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#20-cronjob-__codelineno-0-8"></a><span class="w">    </span><span class="nt">jobTemplate</span><span class="p">:</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#20-cronjob-__codelineno-0-9"></a><span class="w">        </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#20-cronjob-__codelineno-0-10"></a><span class="w">            </span><span class="nt">template</span><span class="p">:</span>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#20-cronjob-__codelineno-0-11"></a><span class="w">                </span><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#20-cronjob-__codelineno-0-12"></a><span class="w">                    </span><span class="nt">containers</span><span class="p">:</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#20-cronjob-__codelineno-0-13"></a><span class="w">                    </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">hello</span>
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#20-cronjob-__codelineno-0-14"></a><span class="w">                        </span><span class="l l-Scalar l-Scalar-Plain">image</span><span class="p p-Indicator">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">busybox</span>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#20-cronjob-__codelineno-0-15"></a><span class="w">                        </span><span class="l l-Scalar l-Scalar-Plain">args</span><span class="p p-Indicator">:</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#20-cronjob-__codelineno-0-16"></a><span class="w">                        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">/bin/sh</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#20-cronjob-__codelineno-0-17"></a><span class="w">                        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-c</span>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#20-cronjob-__codelineno-0-18"></a><span class="w">                        </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">date; echo Hello from the Kubernetes CronJob!</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#20-cronjob-__codelineno-0-19"></a><span class="w">                    </span><span class="nt">restartPolicy</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">OnFailure</span>
</span></code></pre></div>
<h3 id="20-cronjob-step-02-apply-the-cronjob">Step 02 - Apply the CronJob<a class="headerlink" href="#20-cronjob-step-02-apply-the-cronjob" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#20-cronjob-__codelineno-1-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>hello-cronjob.yaml
</span></code></pre></div>
<h3 id="20-cronjob-step-03-verify-cronjob-creation">Step 03 - Verify CronJob Creation<a class="headerlink" href="#20-cronjob-step-03-verify-cronjob-creation" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#20-cronjob-__codelineno-2-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>cronjob<span class="w"> </span>hello
</span></code></pre></div>
<h3 id="20-cronjob-step-04-check-cronjob-and-jobs">Step 04 - Check CronJob and Jobs<a class="headerlink" href="#20-cronjob-step-04-check-cronjob-and-jobs" title="Permanent link">&para;</a></h3>
<ul>
<li>List CronJobs:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#20-cronjob-__codelineno-3-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>cronjobs
</span></code></pre></div>
<ul>
<li>List Jobs created by the CronJob:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#20-cronjob-__codelineno-4-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span><span class="nb">jobs</span>
</span></code></pre></div>
<ul>
<li>List Pods created by Jobs:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#20-cronjob-__codelineno-5-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods
</span></code></pre></div>
<h3 id="20-cronjob-step-05-view-job-output">Step 05 - View Job Output<a class="headerlink" href="#20-cronjob-step-05-view-job-output" title="Permanent link">&para;</a></h3>
<ul>
<li>Get the name of a pod created by the CronJob, then view its logs:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#20-cronjob-__codelineno-6-1"></a>kubectl<span class="w"> </span>logs<span class="w"> </span>&lt;pod-name&gt;
</span></code></pre></div>
<div class="admonition success">
<p class="admonition-title">Expected Result</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#20-cronjob-__codelineno-7-1"></a>Mon Nov 10 12:00:00 UTC 2025
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#20-cronjob-__codelineno-7-2"></a>Hello from the Kubernetes CronJob!
</span></code></pre></div>
</div>
<h3 id="20-cronjob-step-06-clean-up">Step 06 - Clean Up<a class="headerlink" href="#20-cronjob-step-06-clean-up" title="Permanent link">&para;</a></h3>
<ul>
<li>Delete the CronJob and its Jobs:</li>
</ul>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#20-cronjob-__codelineno-8-1"></a>kubectl<span class="w"> </span>delete<span class="w"> </span>cronjob<span class="w"> </span>hello
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#20-cronjob-__codelineno-8-2"></a>kubectl<span class="w"> </span>delete<span class="w"> </span><span class="nb">jobs</span><span class="w"> </span>--all
</span></code></pre></div>
<hr />
<h3 id="20-cronjob-questions">Questions:<a class="headerlink" href="#20-cronjob-questions" title="Permanent link">&para;</a></h3>
<ul>
<li>What happens if the job takes longer than the schedule interval?</li>
<li>How would you change the schedule to run every 5 minutes?</li>
<li>How can you limit the number of successful or failed jobs to keep?</li>
</ul></section><section class="print-page" id="21-auditing" heading-number="2.23"><h1 id="21-auditing-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#21-auditing-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="21-auditing-auditing">Auditing<a class="headerlink" href="#21-auditing-auditing" title="Permanent link">&para;</a></h2>
<h3 id="21-auditing-prerequisites">Prerequisites<a class="headerlink" href="#21-auditing-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>A running Kubernetes cluster (Minikube, Kind, or Cloud Shell).</li>
<li><code>kubectl</code> configured to access your cluster.</li>
</ul>
<hr />
<h2 id="21-auditing-introduction-to-auditing">Introduction to Auditing<a class="headerlink" href="#21-auditing-introduction-to-auditing" title="Permanent link">&para;</a></h2>
<p>Kubernetes auditing provides a security-relevant, chronological set of records documenting the sequence of activities that have affected the system by individual users, administrators, or other components of the system. It allows cluster administrators to answer the following questions:
- What happened?
- When did it happen?
- Who initiated it?
- On what resource did it happen?
- Where was it observed?
- From where was it initiated?
- To where was it going?</p>
<h3 id="21-auditing-step-01-understanding-audit-policies">Step 01 - Understanding Audit Policies<a class="headerlink" href="#21-auditing-step-01-understanding-audit-policies" title="Permanent link">&para;</a></h3>
<p>Audit policies define rules about what events should be recorded and what data they should include. The audit policy object structure is defined in the <code>audit.k8s.io</code> API group. </p>
<h3 id="21-auditing-step-02-example-audit-policy">Step 02 - Example Audit Policy<a class="headerlink" href="#21-auditing-step-02-example-audit-policy" title="Permanent link">&para;</a></h3>
<p>A basic policy might look like this:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#21-auditing-__codelineno-0-1"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">audit.k8s.io/v1</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#21-auditing-__codelineno-0-2"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Policy</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#21-auditing-__codelineno-0-3"></a><span class="nt">rules</span><span class="p">:</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#21-auditing-__codelineno-0-4"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">level</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Metadata</span>
</span></code></pre></div></p>
<h3 id="21-auditing-step-03-enabling-auditing">Step 03 - Enabling Auditing<a class="headerlink" href="#21-auditing-step-03-enabling-auditing" title="Permanent link">&para;</a></h3>
<p>To enable auditing, you must pass specific flags to the <code>kube-apiserver</code>:
- <code>--audit-policy-file</code>: Path to the file that defines the policy.
- <code>--audit-log-path</code>: Path to the log file where audit events will be written.</p>
<hr />
<p><em>Note: This is a placeholder for the full detailed walkthrough.</em></p></section><section class="print-page" id="21-kubeapi" heading-number="2.24"><h1 id="21-kubeapi-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#21-kubeapi-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="21-kubeapi-kube-api-access-from-pod">Kube API Access from Pod<a class="headerlink" href="#21-kubeapi-kube-api-access-from-pod" title="Permanent link">&para;</a></h2>
<ul>
<li>In this lab, we will learn how to access the Kubernetes API from within a Pod.</li>
<li>We will create a simple Pod that runs a script to query the Kubernetes API server and retrieve information about the cluster.</li>
</ul>
<hr />
<h3 id="21-kubeapi-prerequisites">Prerequisites<a class="headerlink" href="#21-kubeapi-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>K8S cluster - <a href="#00-verifycluster">Setting up minikube cluster instruction</a></li>
<li><a href="https://kubernetes.io/docs/tasks/tools/"><strong>kubectl</strong></a> configured to interact with your cluster</li>
</ul>
<p><a href="https://ide.cloud.google.com/?cloudshell_git_repo=https://github.com/nirgeier/KubernetesLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a><br />
<strong><kbd>CTRL</kbd> + <kbd>click</kbd> to open in new window</strong></p>
<hr />
<h3 id="21-kubeapi-part-01-build-the-docker-image">Part 01 - Build the docker image<a class="headerlink" href="#21-kubeapi-part-01-build-the-docker-image" title="Permanent link">&para;</a></h3>
<ul>
<li>In order to demonstrate the API query we will build a custom docker image.</li>
<li>It is optional to use the pre-build image and skip this step.</li>
</ul>
<h3 id="21-kubeapi-step-01-the-script-which-will-be-used-for-query-k8s-api">Step 01 - The script which will be used for query K8S API<a class="headerlink" href="#21-kubeapi-step-01-the-script-which-will-be-used-for-query-k8s-api" title="Permanent link">&para;</a></h3>
<ul>
<li>In order to be able to access K8S API from within a pod, we will be using the following script:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#21-kubeapi-__codelineno-0-1"></a><span class="c1"># `api_query.sh`</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#21-kubeapi-__codelineno-0-2"></a>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#21-kubeapi-__codelineno-0-3"></a><span class="c1">#!/bin/sh</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#21-kubeapi-__codelineno-0-4"></a>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#21-kubeapi-__codelineno-0-5"></a><span class="c1">#################################</span>
</span><span id="__span-0-6"><a id="__codelineno-0-6" name="__codelineno-0-6" href="#21-kubeapi-__codelineno-0-6"></a><span class="c1">## Access the internal K8S API ##</span>
</span><span id="__span-0-7"><a id="__codelineno-0-7" name="__codelineno-0-7" href="#21-kubeapi-__codelineno-0-7"></a><span class="c1">#################################</span>
</span><span id="__span-0-8"><a id="__codelineno-0-8" name="__codelineno-0-8" href="#21-kubeapi-__codelineno-0-8"></a><span class="c1"># Point to the internal API server hostname</span>
</span><span id="__span-0-9"><a id="__codelineno-0-9" name="__codelineno-0-9" href="#21-kubeapi-__codelineno-0-9"></a><span class="nv">API_SERVER_URL</span><span class="o">=</span>https://kubernetes.default.svc
</span><span id="__span-0-10"><a id="__codelineno-0-10" name="__codelineno-0-10" href="#21-kubeapi-__codelineno-0-10"></a>
</span><span id="__span-0-11"><a id="__codelineno-0-11" name="__codelineno-0-11" href="#21-kubeapi-__codelineno-0-11"></a><span class="c1"># Path to ServiceAccount token</span>
</span><span id="__span-0-12"><a id="__codelineno-0-12" name="__codelineno-0-12" href="#21-kubeapi-__codelineno-0-12"></a><span class="c1"># The service account is mapped by the K8S Api server in the pods</span>
</span><span id="__span-0-13"><a id="__codelineno-0-13" name="__codelineno-0-13" href="#21-kubeapi-__codelineno-0-13"></a><span class="nv">SERVICE_ACCOUNT_FOLDER</span><span class="o">=</span>/var/run/secrets/kubernetes.io/serviceaccount
</span><span id="__span-0-14"><a id="__codelineno-0-14" name="__codelineno-0-14" href="#21-kubeapi-__codelineno-0-14"></a>
</span><span id="__span-0-15"><a id="__codelineno-0-15" name="__codelineno-0-15" href="#21-kubeapi-__codelineno-0-15"></a><span class="c1"># Read this Pod&#39;s namespace if required</span>
</span><span id="__span-0-16"><a id="__codelineno-0-16" name="__codelineno-0-16" href="#21-kubeapi-__codelineno-0-16"></a><span class="c1"># NAMESPACE=$(cat ${SERVICE_ACCOUNT_FOLDER}/namespace)</span>
</span><span id="__span-0-17"><a id="__codelineno-0-17" name="__codelineno-0-17" href="#21-kubeapi-__codelineno-0-17"></a>
</span><span id="__span-0-18"><a id="__codelineno-0-18" name="__codelineno-0-18" href="#21-kubeapi-__codelineno-0-18"></a><span class="c1"># Read the ServiceAccount bearer token</span>
</span><span id="__span-0-19"><a id="__codelineno-0-19" name="__codelineno-0-19" href="#21-kubeapi-__codelineno-0-19"></a><span class="nv">TOKEN</span><span class="o">=</span><span class="k">$(</span>cat<span class="w"> </span><span class="si">${</span><span class="nv">SERVICE_ACCOUNT_FOLDER</span><span class="si">}</span>/token<span class="k">)</span>
</span><span id="__span-0-20"><a id="__codelineno-0-20" name="__codelineno-0-20" href="#21-kubeapi-__codelineno-0-20"></a>
</span><span id="__span-0-21"><a id="__codelineno-0-21" name="__codelineno-0-21" href="#21-kubeapi-__codelineno-0-21"></a><span class="c1"># Reference the internal certificate authority (CA)</span>
</span><span id="__span-0-22"><a id="__codelineno-0-22" name="__codelineno-0-22" href="#21-kubeapi-__codelineno-0-22"></a><span class="nv">CACERT</span><span class="o">=</span><span class="si">${</span><span class="nv">SERVICE_ACCOUNT_FOLDER</span><span class="si">}</span>/ca.crt
</span><span id="__span-0-23"><a id="__codelineno-0-23" name="__codelineno-0-23" href="#21-kubeapi-__codelineno-0-23"></a>
</span><span id="__span-0-24"><a id="__codelineno-0-24" name="__codelineno-0-24" href="#21-kubeapi-__codelineno-0-24"></a><span class="c1"># Explore the API with TOKEN and the Certificate</span>
</span><span id="__span-0-25"><a id="__codelineno-0-25" name="__codelineno-0-25" href="#21-kubeapi-__codelineno-0-25"></a>curl<span class="w"> </span>--cacert<span class="w"> </span><span class="si">${</span><span class="nv">CACERT</span><span class="si">}</span><span class="w"> </span>--header<span class="w"> </span><span class="s2">&quot;Authorization: Bearer </span><span class="si">${</span><span class="nv">TOKEN</span><span class="si">}</span><span class="s2">&quot;</span><span class="w"> </span>-X<span class="w"> </span>GET<span class="w"> </span><span class="si">${</span><span class="nv">API_SERVER_URL</span><span class="si">}</span>/api
</span></code></pre></div>
<h3 id="21-kubeapi-step-02-build-the-docker-image">Step 02 - Build the docker image<a class="headerlink" href="#21-kubeapi-step-02-build-the-docker-image" title="Permanent link">&para;</a></h3>
<ul>
<li>For the pod image we will use the following Dockerfile:</li>
</ul>
<div class="language-Dockerfile highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#21-kubeapi-__codelineno-1-1"></a><span class="c"># `Dockerfile`</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#21-kubeapi-__codelineno-1-2"></a>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#21-kubeapi-__codelineno-1-3"></a><span class="k">FROM</span><span class="w">    </span><span class="s">alpine</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#21-kubeapi-__codelineno-1-4"></a>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#21-kubeapi-__codelineno-1-5"></a><span class="c"># Update and install dependencies</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#21-kubeapi-__codelineno-1-6"></a><span class="k">RUN</span><span class="w">     </span>apk<span class="w"> </span>add<span class="w"> </span>--update<span class="w"> </span>nodejs<span class="w"> </span>npm<span class="w"> </span>curl
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#21-kubeapi-__codelineno-1-7"></a>
</span><span id="__span-1-8"><a id="__codelineno-1-8" name="__codelineno-1-8" href="#21-kubeapi-__codelineno-1-8"></a><span class="c"># Copy the endpoint script</span>
</span><span id="__span-1-9"><a id="__codelineno-1-9" name="__codelineno-1-9" href="#21-kubeapi-__codelineno-1-9"></a><span class="k">COPY</span><span class="w">    </span>api_query.sh<span class="w"> </span>.
</span><span id="__span-1-10"><a id="__codelineno-1-10" name="__codelineno-1-10" href="#21-kubeapi-__codelineno-1-10"></a>
</span><span id="__span-1-11"><a id="__codelineno-1-11" name="__codelineno-1-11" href="#21-kubeapi-__codelineno-1-11"></a><span class="c"># Set the execution bit</span>
</span><span id="__span-1-12"><a id="__codelineno-1-12" name="__codelineno-1-12" href="#21-kubeapi-__codelineno-1-12"></a><span class="k">RUN</span><span class="w">     </span>chmod<span class="w"> </span>+x<span class="w"> </span>api_query.sh<span class="w"> </span>.
</span></code></pre></div>
<hr />
<h3 id="21-kubeapi-part-02-deploy-the-pod-to-k8s">Part 02 - Deploy the Pod to K8S<a class="headerlink" href="#21-kubeapi-part-02-deploy-the-pod-to-k8s" title="Permanent link">&para;</a></h3>
<ul>
<li>Once the image is ready, we can deploy it as a pod to the cluster.</li>
<li>The required resources are under the k8s folder.</li>
</ul>
<h3 id="21-kubeapi-step-01-run-kustomization-to-deploy">Step 01 - Run kustomization to deploy<a class="headerlink" href="#21-kubeapi-step-01-run-kustomization-to-deploy" title="Permanent link">&para;</a></h3>
<ul>
<li>Deploy to the cluster</li>
</ul>
<p><strong>Remove old content if any</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#21-kubeapi-__codelineno-2-1"></a>kubectl<span class="w"> </span>kustomize<span class="w"> </span>k8s<span class="w"> </span><span class="p">|</span><span class="w"> </span>kubectl<span class="w"> </span>delete<span class="w"> </span>-f<span class="w"> </span>-
</span></code></pre></div></p>
<p><strong>Deploy the content</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#21-kubeapi-__codelineno-3-1"></a>kubectl<span class="w"> </span>kustomize<span class="w"> </span>k8s<span class="w"> </span><span class="p">|</span><span class="w"> </span>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>-
</span></code></pre></div></p>
<h3 id="21-kubeapi-step-02-query-the-k8s-api">Step 02 - Query the K8S API<a class="headerlink" href="#21-kubeapi-step-02-query-the-k8s-api" title="Permanent link">&para;</a></h3>
<ul>
<li>Run the following script to verify that the connection to the API is working:</li>
</ul>
<p><strong>Get the deployment pod name</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#21-kubeapi-__codelineno-4-1"></a><span class="nv">POD_NAME</span><span class="o">=</span><span class="k">$(</span>kubectl<span class="w"> </span>get<span class="w"> </span>pod<span class="w"> </span>-A<span class="w"> </span>-l<span class="w"> </span><span class="nv">app</span><span class="o">=</span>monitor-app<span class="w"> </span>-o<span class="w"> </span><span class="nv">jsonpath</span><span class="o">=</span><span class="s2">&quot;{.items[0].metadata.name}&quot;</span><span class="k">)</span>
</span></code></pre></div></p>
<h1 id="21-kubeapi-print-out-the-logs-to-verify-that-the-pods-is-connected-to-the-api">Print out the logs to verify that the pods is connected to the API<a class="headerlink" href="#21-kubeapi-print-out-the-logs-to-verify-that-the-pods-is-connected-to-the-api" title="Permanent link">&para;</a></h1>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#21-kubeapi-__codelineno-5-1"></a>kubectl<span class="w"> </span><span class="nb">exec</span><span class="w"> </span>-it<span class="w"> </span>-n<span class="w"> </span>codewizard<span class="w"> </span><span class="nv">$POD_NAME</span><span class="w"> </span>sh<span class="w"> </span>./api_query.sh
</span></code></pre></div></section><section class="print-page" id="22-rancher" heading-number="2.25"><h1 id="22-rancher-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#22-rancher-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="22-rancher-rancher">Rancher<a class="headerlink" href="#22-rancher-rancher" title="Permanent link">&para;</a></h2>
<h3 id="22-rancher-prerequisites">Prerequisites<a class="headerlink" href="#22-rancher-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>A Kubernetes cluster with at least 4GB of RAM (Rancher is resource-intensive).</li>
<li>Helm installed on your local machine.</li>
</ul>
<hr />
<h2 id="22-rancher-introduction-to-rancher">Introduction to Rancher<a class="headerlink" href="#22-rancher-introduction-to-rancher" title="Permanent link">&para;</a></h2>
<p>Rancher is an open-source software stack for teams adopting containers. It addresses the operational and security challenges of managing multiple Kubernetes clusters across any infrastructure, while providing DevOps teams with integrated tools for running containerized workloads.</p>
<h3 id="22-rancher-step-01-adding-the-rancher-helm-repository">Step 01 - Adding the Rancher Helm Repository<a class="headerlink" href="#22-rancher-step-01-adding-the-rancher-helm-repository" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#22-rancher-__codelineno-0-1"></a>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>rancher-latest<span class="w"> </span>https://releases.rancher.com/server-charts/latest
</span></code></pre></div>
<h3 id="22-rancher-step-02-creating-a-namespace-for-rancher">Step 02 - Creating a Namespace for Rancher<a class="headerlink" href="#22-rancher-step-02-creating-a-namespace-for-rancher" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#22-rancher-__codelineno-1-1"></a>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>cattle-system
</span></code></pre></div>
<h3 id="22-rancher-step-03-installing-cert-manager">Step 03 - Installing cert-manager<a class="headerlink" href="#22-rancher-step-03-installing-cert-manager" title="Permanent link">&para;</a></h3>
<p>Rancher relies on cert-manager to issue certificates for its UI.
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#22-rancher-__codelineno-2-1"></a>helm<span class="w"> </span>install<span class="w"> </span>cert-manager<span class="w"> </span>jetstack/cert-manager<span class="w"> </span>--namespace<span class="w"> </span>cert-manager<span class="w"> </span>--create-namespace<span class="w"> </span>--set<span class="w"> </span><span class="nv">installCRDs</span><span class="o">=</span><span class="nb">true</span>
</span></code></pre></div></p>
<h3 id="22-rancher-step-04-installing-rancher-with-helm">Step 04 - Installing Rancher with Helm<a class="headerlink" href="#22-rancher-step-04-installing-rancher-with-helm" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#22-rancher-__codelineno-3-1"></a>helm<span class="w"> </span>install<span class="w"> </span>rancher<span class="w"> </span>rancher-latest/rancher<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#22-rancher-__codelineno-3-2"></a><span class="w">  </span>--namespace<span class="w"> </span>cattle-system<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#22-rancher-__codelineno-3-3"></a><span class="w">  </span>--set<span class="w"> </span><span class="nv">hostname</span><span class="o">=</span>rancher.my.org<span class="w"> </span><span class="se">\</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#22-rancher-__codelineno-3-4"></a><span class="w">  </span>--set<span class="w"> </span><span class="nv">bootstrapPassword</span><span class="o">=</span>admin
</span></code></pre></div>
<hr />
<p><em>Note: This is a placeholder for the full detailed walkthrough.</em></p></section><section class="print-page" id="23-metricserver" heading-number="2.26"><h1 id="23-metricserver-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#23-metricserver-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="23-metricserver-metric-server">Metric Server<a class="headerlink" href="#23-metricserver-metric-server" title="Permanent link">&para;</a></h2>
<h3 id="23-metricserver-prerequisites">Prerequisites<a class="headerlink" href="#23-metricserver-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>A running Kubernetes cluster.</li>
<li><code>kubectl</code> installed.</li>
</ul>
<hr />
<h2 id="23-metricserver-introduction-to-metric-server">Introduction to Metric Server<a class="headerlink" href="#23-metricserver-introduction-to-metric-server" title="Permanent link">&para;</a></h2>
<p>Metrics Server is a scalable, efficient source of container resource metrics for Kubernetes built-in autoscaling pipelines. It collects resource metrics from Kubelets and exposes them in Kubernetes apiserver through Metrics API for use by Horizontal Pod Autoscaler and Vertical Pod Autoscaler.</p>
<h3 id="23-metricserver-step-01-installing-metrics-server">Step 01 - Installing Metrics Server<a class="headerlink" href="#23-metricserver-step-01-installing-metrics-server" title="Permanent link">&para;</a></h3>
<p>You can install Metrics Server using the official high-availability manifest:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#23-metricserver-__codelineno-0-1"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>https://github.com/kubernetes-sigs/metrics-server/releases/latest/download/components.yaml
</span></code></pre></div></p>
<h3 id="23-metricserver-step-02-handling-insecure-certificates-minikubekind">Step 02 - Handling Insecure Certificates (Minikube/Kind)<a class="headerlink" href="#23-metricserver-step-02-handling-insecure-certificates-minikubekind" title="Permanent link">&para;</a></h3>
<p>Usually, in local environments, you need to allow insecure certificates:
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#23-metricserver-__codelineno-1-1"></a><span class="c1"># Add this to the metrics-server deployment args</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#23-metricserver-__codelineno-1-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--kubelet-insecure-tls</span>
</span></code></pre></div></p>
<h3 id="23-metricserver-step-03-verifying-installation">Step 03 - Verifying Installation<a class="headerlink" href="#23-metricserver-step-03-verifying-installation" title="Permanent link">&para;</a></h3>
<p>Once installed, you can use the <code>top</code> command:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#23-metricserver-__codelineno-2-1"></a>kubectl<span class="w"> </span>top<span class="w"> </span>nodes
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#23-metricserver-__codelineno-2-2"></a>kubectl<span class="w"> </span>top<span class="w"> </span>pods
</span></code></pre></div></p>
<hr />
<p><em>Note: This is a placeholder for the full detailed walkthrough.</em></p></section><section class="print-page" id="24-helmoperator" heading-number="2.27"><h1 id="24-helmoperator-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#24-helmoperator-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="24-helmoperator-helm-operator">Helm Operator<a class="headerlink" href="#24-helmoperator-helm-operator" title="Permanent link">&para;</a></h2>
<ul>
<li>An in-depth Helm-based operator tutorial.</li>
<li>The <code>Helm Operator</code> is a Kubernetes operator, allowing one to declaratively manage Helm chart releases.</li>
</ul>
<hr />
<h3 id="24-helmoperator-prerequisites">Prerequisites<a class="headerlink" href="#24-helmoperator-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>K8S cluster - <a href="#00-verifycluster">Setting up minikube cluster instruction</a></li>
<li><a href="https://kubernetes.io/docs/tasks/tools/"><strong>kubectl</strong></a> configured to interact with your cluster</li>
</ul>
<p><a href="https://ide.cloud.google.com/?cloudshell_git_repo=https://github.com/nirgeier/KubernetesLabs"><img alt="Open in Cloud Shell" src="https://gstatic.com/cloudssh/images/open-btn.svg" /></a><br />
<strong><kbd>CTRL</kbd> + <kbd>click</kbd> to open in new window</strong></p>
<ul>
<li>Docker</li>
<li>kubectl</li>
<li>operator-sdk installed and configured</li>
<li><code>cluster-admin</code> permissions</li>
</ul>
<h3 id="24-helmoperator-install-operator-sdk">Install <code>operator-sdk</code><a class="headerlink" href="#24-helmoperator-install-operator-sdk" title="Permanent link">&para;</a></h3>
<p><strong>Grab the ARCH and OS</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#24-helmoperator-__codelineno-0-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">ARCH</span><span class="o">=</span><span class="k">$(case</span><span class="w"> </span><span class="k">$(</span>uname<span class="w"> </span>-m<span class="k">)</span><span class="w"> </span><span class="k">in</span><span class="w"> </span>x86_64<span class="k">)</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span>amd64<span class="w"> </span><span class="p">;;</span><span class="w"> </span>aarch64<span class="o">)</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span>arm64<span class="w"> </span><span class="p">;;</span><span class="w"> </span>*<span class="o">)</span><span class="w"> </span><span class="nb">echo</span><span class="w"> </span>-n<span class="w"> </span><span class="k">$(</span>uname<span class="w"> </span>-m<span class="k">)</span><span class="w"> </span><span class="p">;;</span><span class="w"> </span><span class="k">esac</span><span class="o">)</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#24-helmoperator-__codelineno-0-2"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OS</span><span class="o">=</span><span class="k">$(</span>uname<span class="w"> </span><span class="p">|</span><span class="w"> </span>awk<span class="w"> </span><span class="s1">&#39;{print tolower($0)}&#39;</span><span class="k">)</span>
</span></code></pre></div></p>
<p><strong>Get the desired download URL</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#24-helmoperator-__codelineno-1-1"></a><span class="nb">export</span><span class="w"> </span><span class="nv">OPERATOR_SDK_DL_URL</span><span class="o">=</span>https://github.com/operator-framework/operator-sdk/releases/download/v1.23.0
</span></code></pre></div></p>
<p><strong>Download the Operator binaries</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#24-helmoperator-__codelineno-2-1"></a>curl<span class="w"> </span>-LO<span class="w"> </span><span class="si">${</span><span class="nv">OPERATOR_SDK_DL_URL</span><span class="si">}</span>/operator-sdk_<span class="si">${</span><span class="nv">OS</span><span class="si">}</span>_<span class="si">${</span><span class="nv">ARCH</span><span class="si">}</span>
</span></code></pre></div></p>
<p><strong>Install the release binary in your PATH</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#24-helmoperator-__codelineno-3-1"></a>chmod<span class="w"> </span>+x<span class="w"> </span>operator-sdk_<span class="si">${</span><span class="nv">OS</span><span class="si">}</span>_<span class="si">${</span><span class="nv">ARCH</span><span class="si">}</span><span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>mv<span class="w"> </span>operator-sdk_<span class="si">${</span><span class="nv">OS</span><span class="si">}</span>_<span class="si">${</span><span class="nv">ARCH</span><span class="si">}</span><span class="w"> </span>/usr/local/bin/operator-sdk
</span></code></pre></div></p>
<hr />
<h3 id="24-helmoperator-step-01-create-a-new-project">Step 01 - Create a new project<a class="headerlink" href="#24-helmoperator-step-01-create-a-new-project" title="Permanent link">&para;</a></h3>
<ul>
<li>Use the CLI to create a new Helm-based nginx-operator project:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-4-1"><a id="__codelineno-4-1" name="__codelineno-4-1" href="#24-helmoperator-__codelineno-4-1"></a><span class="c1"># Create the desired folder</span>
</span><span id="__span-4-2"><a id="__codelineno-4-2" name="__codelineno-4-2" href="#24-helmoperator-__codelineno-4-2"></a>mkdir<span class="w"> </span>nginx-operator
</span><span id="__span-4-3"><a id="__codelineno-4-3" name="__codelineno-4-3" href="#24-helmoperator-__codelineno-4-3"></a>
</span><span id="__span-4-4"><a id="__codelineno-4-4" name="__codelineno-4-4" href="#24-helmoperator-__codelineno-4-4"></a><span class="c1"># Switch to the desired folder</span>
</span><span id="__span-4-5"><a id="__codelineno-4-5" name="__codelineno-4-5" href="#24-helmoperator-__codelineno-4-5"></a><span class="nb">cd</span><span class="w"> </span>nginx-operator
</span><span id="__span-4-6"><a id="__codelineno-4-6" name="__codelineno-4-6" href="#24-helmoperator-__codelineno-4-6"></a>
</span><span id="__span-4-7"><a id="__codelineno-4-7" name="__codelineno-4-7" href="#24-helmoperator-__codelineno-4-7"></a><span class="c1"># Create the helm operator</span>
</span><span id="__span-4-8"><a id="__codelineno-4-8" name="__codelineno-4-8" href="#24-helmoperator-__codelineno-4-8"></a>operator-sdk<span class="w">                </span><span class="se">\</span>
</span><span id="__span-4-9"><a id="__codelineno-4-9" name="__codelineno-4-9" href="#24-helmoperator-__codelineno-4-9"></a><span class="w">        </span>init<span class="w">                </span><span class="se">\</span>
</span><span id="__span-4-10"><a id="__codelineno-4-10" name="__codelineno-4-10" href="#24-helmoperator-__codelineno-4-10"></a><span class="w">        </span>--kind<span class="w">    </span>Nginx<span class="w">     </span><span class="se">\</span>
</span><span id="__span-4-11"><a id="__codelineno-4-11" name="__codelineno-4-11" href="#24-helmoperator-__codelineno-4-11"></a><span class="w">        </span>--group<span class="w">   </span>demo<span class="w">      </span><span class="se">\</span>
</span><span id="__span-4-12"><a id="__codelineno-4-12" name="__codelineno-4-12" href="#24-helmoperator-__codelineno-4-12"></a><span class="w">        </span>--plugins<span class="w"> </span>helm<span class="w">      </span><span class="se">\</span>
</span><span id="__span-4-13"><a id="__codelineno-4-13" name="__codelineno-4-13" href="#24-helmoperator-__codelineno-4-13"></a><span class="w">        </span>--version<span class="w"> </span>v1alpha1<span class="w">  </span><span class="se">\</span>
</span><span id="__span-4-14"><a id="__codelineno-4-14" name="__codelineno-4-14" href="#24-helmoperator-__codelineno-4-14"></a><span class="w">        </span>--domain<span class="w">  </span>codewizard.co.il
</span></code></pre></div>
<ul>
<li>This creates the <code>nginx-operator</code> project specifically for watching the <code>Nginx</code> resource with APIVersion <code>demo.codewizard.co.il/v1alpha1</code> and Kind <code>Nginx</code>.</li>
</ul>
<h3 id="24-helmoperator-operator-sdk-project-layout">Operator SDK Project Layout<a class="headerlink" href="#24-helmoperator-operator-sdk-project-layout" title="Permanent link">&para;</a></h3>
<ul>
<li>The command will generate the following structure:</li>
</ul>
<div class="admonition success">
<p class="admonition-title">Generated Project Structure</p>
<div class="language-text highlight"><pre><span></span><code><span id="__span-5-1"><a id="__codelineno-5-1" name="__codelineno-5-1" href="#24-helmoperator-__codelineno-5-1"></a>.
</span><span id="__span-5-2"><a id="__codelineno-5-2" name="__codelineno-5-2" href="#24-helmoperator-__codelineno-5-2"></a>‚îú‚îÄ‚îÄ Dockerfile
</span><span id="__span-5-3"><a id="__codelineno-5-3" name="__codelineno-5-3" href="#24-helmoperator-__codelineno-5-3"></a>‚îú‚îÄ‚îÄ Makefile
</span><span id="__span-5-4"><a id="__codelineno-5-4" name="__codelineno-5-4" href="#24-helmoperator-__codelineno-5-4"></a>‚îú‚îÄ‚îÄ PROJECT
</span><span id="__span-5-5"><a id="__codelineno-5-5" name="__codelineno-5-5" href="#24-helmoperator-__codelineno-5-5"></a>‚îú‚îÄ‚îÄ config
</span><span id="__span-5-6"><a id="__codelineno-5-6" name="__codelineno-5-6" href="#24-helmoperator-__codelineno-5-6"></a>‚îÇ¬†¬† ‚îú‚îÄ‚îÄ crd
</span><span id="__span-5-7"><a id="__codelineno-5-7" name="__codelineno-5-7" href="#24-helmoperator-__codelineno-5-7"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ bases
</span><span id="__span-5-8"><a id="__codelineno-5-8" name="__codelineno-5-8" href="#24-helmoperator-__codelineno-5-8"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ demo.codewizard.co.il_nginxes.yaml
</span><span id="__span-5-9"><a id="__codelineno-5-9" name="__codelineno-5-9" href="#24-helmoperator-__codelineno-5-9"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ kustomization.yaml
</span><span id="__span-5-10"><a id="__codelineno-5-10" name="__codelineno-5-10" href="#24-helmoperator-__codelineno-5-10"></a>‚îÇ¬†¬† ‚îú‚îÄ‚îÄ default
</span><span id="__span-5-11"><a id="__codelineno-5-11" name="__codelineno-5-11" href="#24-helmoperator-__codelineno-5-11"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ kustomization.yaml
</span><span id="__span-5-12"><a id="__codelineno-5-12" name="__codelineno-5-12" href="#24-helmoperator-__codelineno-5-12"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ manager_auth_proxy_patch.yaml
</span><span id="__span-5-13"><a id="__codelineno-5-13" name="__codelineno-5-13" href="#24-helmoperator-__codelineno-5-13"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ manager_config_patch.yaml
</span><span id="__span-5-14"><a id="__codelineno-5-14" name="__codelineno-5-14" href="#24-helmoperator-__codelineno-5-14"></a>‚îÇ¬†¬† ‚îú‚îÄ‚îÄ manager
</span><span id="__span-5-15"><a id="__codelineno-5-15" name="__codelineno-5-15" href="#24-helmoperator-__codelineno-5-15"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ controller_manager_config.yaml
</span><span id="__span-5-16"><a id="__codelineno-5-16" name="__codelineno-5-16" href="#24-helmoperator-__codelineno-5-16"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ kustomization.yaml
</span><span id="__span-5-17"><a id="__codelineno-5-17" name="__codelineno-5-17" href="#24-helmoperator-__codelineno-5-17"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ manager.yaml
</span><span id="__span-5-18"><a id="__codelineno-5-18" name="__codelineno-5-18" href="#24-helmoperator-__codelineno-5-18"></a>‚îÇ¬†¬† ‚îú‚îÄ‚îÄ manifests
</span><span id="__span-5-19"><a id="__codelineno-5-19" name="__codelineno-5-19" href="#24-helmoperator-__codelineno-5-19"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ kustomization.yaml
</span><span id="__span-5-20"><a id="__codelineno-5-20" name="__codelineno-5-20" href="#24-helmoperator-__codelineno-5-20"></a>‚îÇ¬†¬† ‚îú‚îÄ‚îÄ prometheus
</span><span id="__span-5-21"><a id="__codelineno-5-21" name="__codelineno-5-21" href="#24-helmoperator-__codelineno-5-21"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ kustomization.yaml
</span><span id="__span-5-22"><a id="__codelineno-5-22" name="__codelineno-5-22" href="#24-helmoperator-__codelineno-5-22"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ monitor.yaml
</span><span id="__span-5-23"><a id="__codelineno-5-23" name="__codelineno-5-23" href="#24-helmoperator-__codelineno-5-23"></a>‚îÇ¬†¬† ‚îú‚îÄ‚îÄ rbac
</span><span id="__span-5-24"><a id="__codelineno-5-24" name="__codelineno-5-24" href="#24-helmoperator-__codelineno-5-24"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ auth_proxy_client_clusterrole.yaml
</span><span id="__span-5-25"><a id="__codelineno-5-25" name="__codelineno-5-25" href="#24-helmoperator-__codelineno-5-25"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ auth_proxy_role.yaml
</span><span id="__span-5-26"><a id="__codelineno-5-26" name="__codelineno-5-26" href="#24-helmoperator-__codelineno-5-26"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ auth_proxy_role_binding.yaml
</span><span id="__span-5-27"><a id="__codelineno-5-27" name="__codelineno-5-27" href="#24-helmoperator-__codelineno-5-27"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ auth_proxy_service.yaml
</span><span id="__span-5-28"><a id="__codelineno-5-28" name="__codelineno-5-28" href="#24-helmoperator-__codelineno-5-28"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ kustomization.yaml
</span><span id="__span-5-29"><a id="__codelineno-5-29" name="__codelineno-5-29" href="#24-helmoperator-__codelineno-5-29"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ leader_election_role.yaml
</span><span id="__span-5-30"><a id="__codelineno-5-30" name="__codelineno-5-30" href="#24-helmoperator-__codelineno-5-30"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ leader_election_role_binding.yaml
</span><span id="__span-5-31"><a id="__codelineno-5-31" name="__codelineno-5-31" href="#24-helmoperator-__codelineno-5-31"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ nginx_editor_role.yaml
</span><span id="__span-5-32"><a id="__codelineno-5-32" name="__codelineno-5-32" href="#24-helmoperator-__codelineno-5-32"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ nginx_viewer_role.yaml
</span><span id="__span-5-33"><a id="__codelineno-5-33" name="__codelineno-5-33" href="#24-helmoperator-__codelineno-5-33"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ role.yaml
</span><span id="__span-5-34"><a id="__codelineno-5-34" name="__codelineno-5-34" href="#24-helmoperator-__codelineno-5-34"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ role_binding.yaml
</span><span id="__span-5-35"><a id="__codelineno-5-35" name="__codelineno-5-35" href="#24-helmoperator-__codelineno-5-35"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ service_account.yaml
</span><span id="__span-5-36"><a id="__codelineno-5-36" name="__codelineno-5-36" href="#24-helmoperator-__codelineno-5-36"></a>‚îÇ¬†¬† ‚îú‚îÄ‚îÄ samples
</span><span id="__span-5-37"><a id="__codelineno-5-37" name="__codelineno-5-37" href="#24-helmoperator-__codelineno-5-37"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ demo_v1alpha1_nginx.yaml
</span><span id="__span-5-38"><a id="__codelineno-5-38" name="__codelineno-5-38" href="#24-helmoperator-__codelineno-5-38"></a>‚îÇ¬†¬† ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ kustomization.yaml
</span><span id="__span-5-39"><a id="__codelineno-5-39" name="__codelineno-5-39" href="#24-helmoperator-__codelineno-5-39"></a>‚îÇ¬†¬† ‚îî‚îÄ‚îÄ scorecard
</span><span id="__span-5-40"><a id="__codelineno-5-40" name="__codelineno-5-40" href="#24-helmoperator-__codelineno-5-40"></a>‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ bases
</span><span id="__span-5-41"><a id="__codelineno-5-41" name="__codelineno-5-41" href="#24-helmoperator-__codelineno-5-41"></a>‚îÇ¬†¬†     ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ config.yaml
</span><span id="__span-5-42"><a id="__codelineno-5-42" name="__codelineno-5-42" href="#24-helmoperator-__codelineno-5-42"></a>‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ kustomization.yaml
</span><span id="__span-5-43"><a id="__codelineno-5-43" name="__codelineno-5-43" href="#24-helmoperator-__codelineno-5-43"></a>‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ patches
</span><span id="__span-5-44"><a id="__codelineno-5-44" name="__codelineno-5-44" href="#24-helmoperator-__codelineno-5-44"></a>‚îÇ¬†¬†         ‚îú‚îÄ‚îÄ basic.config.yaml
</span><span id="__span-5-45"><a id="__codelineno-5-45" name="__codelineno-5-45" href="#24-helmoperator-__codelineno-5-45"></a>‚îÇ¬†¬†         ‚îî‚îÄ‚îÄ olm.config.yaml
</span><span id="__span-5-46"><a id="__codelineno-5-46" name="__codelineno-5-46" href="#24-helmoperator-__codelineno-5-46"></a>‚îú‚îÄ‚îÄ helm-charts
</span><span id="__span-5-47"><a id="__codelineno-5-47" name="__codelineno-5-47" href="#24-helmoperator-__codelineno-5-47"></a>‚îÇ¬†¬† ‚îî‚îÄ‚îÄ nginx
</span><span id="__span-5-48"><a id="__codelineno-5-48" name="__codelineno-5-48" href="#24-helmoperator-__codelineno-5-48"></a>‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ Chart.yaml
</span><span id="__span-5-49"><a id="__codelineno-5-49" name="__codelineno-5-49" href="#24-helmoperator-__codelineno-5-49"></a>‚îÇ¬†¬†     ‚îú‚îÄ‚îÄ templates
</span><span id="__span-5-50"><a id="__codelineno-5-50" name="__codelineno-5-50" href="#24-helmoperator-__codelineno-5-50"></a>‚îÇ¬†¬†     ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ NOTES.txt
</span><span id="__span-5-51"><a id="__codelineno-5-51" name="__codelineno-5-51" href="#24-helmoperator-__codelineno-5-51"></a>‚îÇ¬†¬†     ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ _helpers.tpl
</span><span id="__span-5-52"><a id="__codelineno-5-52" name="__codelineno-5-52" href="#24-helmoperator-__codelineno-5-52"></a>‚îÇ¬†¬†     ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ deployment.yaml
</span><span id="__span-5-53"><a id="__codelineno-5-53" name="__codelineno-5-53" href="#24-helmoperator-__codelineno-5-53"></a>‚îÇ¬†¬†     ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ hpa.yaml
</span><span id="__span-5-54"><a id="__codelineno-5-54" name="__codelineno-5-54" href="#24-helmoperator-__codelineno-5-54"></a>‚îÇ¬†¬†     ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ ingress.yaml
</span><span id="__span-5-55"><a id="__codelineno-5-55" name="__codelineno-5-55" href="#24-helmoperator-__codelineno-5-55"></a>‚îÇ¬†¬†     ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ service.yaml
</span><span id="__span-5-56"><a id="__codelineno-5-56" name="__codelineno-5-56" href="#24-helmoperator-__codelineno-5-56"></a>‚îÇ¬†¬†     ‚îÇ¬†¬† ‚îú‚îÄ‚îÄ serviceaccount.yaml
</span><span id="__span-5-57"><a id="__codelineno-5-57" name="__codelineno-5-57" href="#24-helmoperator-__codelineno-5-57"></a>‚îÇ¬†¬†     ‚îÇ¬†¬† ‚îî‚îÄ‚îÄ tests
</span><span id="__span-5-58"><a id="__codelineno-5-58" name="__codelineno-5-58" href="#24-helmoperator-__codelineno-5-58"></a>‚îÇ¬†¬†     ‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ test-connection.yaml
</span><span id="__span-5-59"><a id="__codelineno-5-59" name="__codelineno-5-59" href="#24-helmoperator-__codelineno-5-59"></a>‚îÇ¬†¬†     ‚îî‚îÄ‚îÄ values.yaml
</span><span id="__span-5-60"><a id="__codelineno-5-60" name="__codelineno-5-60" href="#24-helmoperator-__codelineno-5-60"></a>‚îú‚îÄ‚îÄ tree.txt
</span><span id="__span-5-61"><a id="__codelineno-5-61" name="__codelineno-5-61" href="#24-helmoperator-__codelineno-5-61"></a>‚îî‚îÄ‚îÄ watches.yaml
</span><span id="__span-5-62"><a id="__codelineno-5-62" name="__codelineno-5-62" href="#24-helmoperator-__codelineno-5-62"></a>
</span><span id="__span-5-63"><a id="__codelineno-5-63" name="__codelineno-5-63" href="#24-helmoperator-__codelineno-5-63"></a>16 directories, 44 files
</span></code></pre></div>
</div>
<h3 id="24-helmoperator-step-02-customize-the-operator-logic">Step 02 - Customize the operator logic<a class="headerlink" href="#24-helmoperator-step-02-customize-the-operator-logic" title="Permanent link">&para;</a></h3>
<ul>
<li>For this example the nginx-operator will execute the following reconciliation logic for each Nginx Custom Resource (CR):</li>
<li>Create an nginx Deployment, if it doesn&rsquo;t exist.</li>
<li>Create an nginx Service, if it doesn&rsquo;t exist.</li>
<li>Create an nginx Ingress, if it is enabled and doesn&rsquo;t exist.</li>
<li>Update the Deployment, Service, and Ingress, if they already exist but don&rsquo;t match the desired configuration as specified by the Nginx CR.</li>
<li>Ensure that the Deployment, Service, and optional Ingress all match the desired configuration (e.g. replica count, image, service type, etc) as specified by the Nginx CR.</li>
</ul>
<p><br> </p>
<h4 id="24-helmoperator-watch-the-nginx-cr">Watch the Nginx CR<a class="headerlink" href="#24-helmoperator-watch-the-nginx-cr" title="Permanent link">&para;</a></h4>
<ul>
<li>By default, the Nginx-operator watches Nginx resource events as shown in <code>watches.yaml</code> and executes Helm releases using the specified chart:</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-6-1"><a id="__codelineno-6-1" name="__codelineno-6-1" href="#24-helmoperator-__codelineno-6-1"></a><span class="c1"># Use the &#39;create api&#39; subcommand to add watches to this file.</span>
</span><span id="__span-6-2"><a id="__codelineno-6-2" name="__codelineno-6-2" href="#24-helmoperator-__codelineno-6-2"></a><span class="p p-Indicator">-</span><span class="w"> </span><span class="nt">group</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">demo</span>
</span><span id="__span-6-3"><a id="__codelineno-6-3" name="__codelineno-6-3" href="#24-helmoperator-__codelineno-6-3"></a><span class="w">  </span><span class="nt">version</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1alpha1</span>
</span><span id="__span-6-4"><a id="__codelineno-6-4" name="__codelineno-6-4" href="#24-helmoperator-__codelineno-6-4"></a><span class="w">  </span><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Nginx</span>
</span><span id="__span-6-5"><a id="__codelineno-6-5" name="__codelineno-6-5" href="#24-helmoperator-__codelineno-6-5"></a><span class="w">  </span><span class="nt">chart</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">helm-charts/nginx</span>
</span></code></pre></div>
<p><br></p>
<h3 id="24-helmoperator-reviewing-the-nginx-helm-chart">Reviewing the Nginx Helm Chart<a class="headerlink" href="#24-helmoperator-reviewing-the-nginx-helm-chart" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>When a Helm operator project is created, the SDK creates an example Helm chart that contains a set of templates for a simple Nginx release.</p>
</li>
<li>
<p>For this example, we have templates for deployment, service, and ingress resources, along with a <code>NOTES.txt</code> template, which Helm chart developers use to convey helpful information about a release.</p>
</li>
</ul>
<p><br></p>
<h3 id="24-helmoperator-understanding-the-nginx-cr-spec">Understanding the Nginx CR spec<a class="headerlink" href="#24-helmoperator-understanding-the-nginx-cr-spec" title="Permanent link">&para;</a></h3>
<ul>
<li>
<p>Helm uses a concept called <code>values</code> to provide customizations to a Helm chart&rsquo;s defaults, which are defined in the Helm chart&rsquo;s <code>values.yaml</code> file.</p>
</li>
<li>
<p>Overriding these defaults is as simple as setting the desired values in the CR spec.</p>
</li>
<li>
<p>Let&rsquo;s use the number of replicas value as an example.</p>
</li>
<li>
<p>First, inspecting <code>helm-charts/nginx/values.yaml</code>, we can see that the chart has a value called <code>replicaCount</code> and it is set to <code>1</code> by default.</p>
</li>
<li>
<p>Let&rsquo;s update the value to 3 - <code>replicaCount: 3</code>.</p>
</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-7-1"><a id="__codelineno-7-1" name="__codelineno-7-1" href="#24-helmoperator-__codelineno-7-1"></a><span class="c1"># Update `config/samples/demo_v1alpha1_nginx.yaml` to look like the following:</span>
</span><span id="__span-7-2"><a id="__codelineno-7-2" name="__codelineno-7-2" href="#24-helmoperator-__codelineno-7-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">demo.codewizard.co.il/v1alpha1</span>
</span><span id="__span-7-3"><a id="__codelineno-7-3" name="__codelineno-7-3" href="#24-helmoperator-__codelineno-7-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Nginx</span>
</span><span id="__span-7-4"><a id="__codelineno-7-4" name="__codelineno-7-4" href="#24-helmoperator-__codelineno-7-4"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-7-5"><a id="__codelineno-7-5" name="__codelineno-7-5" href="#24-helmoperator-__codelineno-7-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-sample</span>
</span><span id="__span-7-6"><a id="__codelineno-7-6" name="__codelineno-7-6" href="#24-helmoperator-__codelineno-7-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-7-7"><a id="__codelineno-7-7" name="__codelineno-7-7" href="#24-helmoperator-__codelineno-7-7"></a><span class="w">  </span><span class="c1">#... (Around line 33)</span>
</span><span id="__span-7-8"><a id="__codelineno-7-8" name="__codelineno-7-8" href="#24-helmoperator-__codelineno-7-8"></a><span class="w">  </span><span class="nt">replicaCount</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">3</span><span class="w"> </span><span class="c1"># &lt;------- Adding our replicas count</span>
</span></code></pre></div>
<ul>
<li>Similarly, we see that the default service port is set to <code>80</code>, but we would like to use <code>8888</code>, so we will again update config/samples/demo_v1alpha1_nginx.yaml by adding the service port override.</li>
</ul>
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-8-1"><a id="__codelineno-8-1" name="__codelineno-8-1" href="#24-helmoperator-__codelineno-8-1"></a><span class="c1"># Update `config/samples/demo_v1alpha1_nginx.yaml` to look like the following:</span>
</span><span id="__span-8-2"><a id="__codelineno-8-2" name="__codelineno-8-2" href="#24-helmoperator-__codelineno-8-2"></a><span class="nt">apiVersion</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">demo.codewizard.co.il/v1alpha1</span>
</span><span id="__span-8-3"><a id="__codelineno-8-3" name="__codelineno-8-3" href="#24-helmoperator-__codelineno-8-3"></a><span class="nt">kind</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Nginx</span>
</span><span id="__span-8-4"><a id="__codelineno-8-4" name="__codelineno-8-4" href="#24-helmoperator-__codelineno-8-4"></a><span class="nt">metadata</span><span class="p">:</span>
</span><span id="__span-8-5"><a id="__codelineno-8-5" name="__codelineno-8-5" href="#24-helmoperator-__codelineno-8-5"></a><span class="w">  </span><span class="nt">name</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">nginx-sample</span>
</span><span id="__span-8-6"><a id="__codelineno-8-6" name="__codelineno-8-6" href="#24-helmoperator-__codelineno-8-6"></a><span class="nt">spec</span><span class="p">:</span>
</span><span id="__span-8-7"><a id="__codelineno-8-7" name="__codelineno-8-7" href="#24-helmoperator-__codelineno-8-7"></a><span class="w">  </span><span class="c1">#... (Around line 36)</span>
</span><span id="__span-8-8"><a id="__codelineno-8-8" name="__codelineno-8-8" href="#24-helmoperator-__codelineno-8-8"></a><span class="w">  </span><span class="nt">service</span><span class="p">:</span>
</span><span id="__span-8-9"><a id="__codelineno-8-9" name="__codelineno-8-9" href="#24-helmoperator-__codelineno-8-9"></a><span class="w">    </span><span class="nt">port</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">8888</span><span class="w"> </span><span class="c1"># &lt;------- Updating our service port</span>
</span></code></pre></div>
<h3 id="24-helmoperator-step-03-build-the-operators-image">Step 03 - Build the operator&rsquo;s image<a class="headerlink" href="#24-helmoperator-step-03-build-the-operators-image" title="Permanent link">&para;</a></h3>
<p><strong>Login to your DockerHub / acr / ecr or any other registry account</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-9-1"><a id="__codelineno-9-1" name="__codelineno-9-1" href="#24-helmoperator-__codelineno-9-1"></a><span class="c1"># Set the desired image name and tag</span>
</span></code></pre></div></p>
<p><strong>In the Makefile update the following line</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-10-1"><a id="__codelineno-10-1" name="__codelineno-10-1" href="#24-helmoperator-__codelineno-10-1"></a><span class="c1"># Image URL to use all building/pushing image targets</span>
</span><span id="__span-10-2"><a id="__codelineno-10-2" name="__codelineno-10-2" href="#24-helmoperator-__codelineno-10-2"></a>IMG<span class="w"> </span>?<span class="o">=</span><span class="w"> </span>controller:latest
</span></code></pre></div></p>
<p><strong>change it to your registry account</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-11-1"><a id="__codelineno-11-1" name="__codelineno-11-1" href="#24-helmoperator-__codelineno-11-1"></a>IMG<span class="w"> </span>?<span class="o">=</span><span class="w"> </span>nirgeier/helm_operator:latest
</span></code></pre></div></p>
<ul>
<li>Now let&rsquo;s build and push the image:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-12-1"><a id="__codelineno-12-1" name="__codelineno-12-1" href="#24-helmoperator-__codelineno-12-1"></a>make<span class="w"> </span>docker-build<span class="w"> </span>docker-push
</span></code></pre></div>
<h3 id="24-helmoperator-step-04-deploy-the-operator-to-the-cluster">Step 04 - Deploy the operator to the cluster<a class="headerlink" href="#24-helmoperator-step-04-deploy-the-operator-to-the-cluster" title="Permanent link">&para;</a></h3>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-13-1"><a id="__codelineno-13-1" name="__codelineno-13-1" href="#24-helmoperator-__codelineno-13-1"></a>make<span class="w"> </span>deploy
</span></code></pre></div>
<p><strong>Verify that the operator is deployed</strong>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-14-1"><a id="__codelineno-14-1" name="__codelineno-14-1" href="#24-helmoperator-__codelineno-14-1"></a>kubectl<span class="w"> </span>get<span class="w"> </span>deployment<span class="w"> </span>-n<span class="w"> </span>nginx-operator-system
</span></code></pre></div></p>
<h3 id="24-helmoperator-step-05-create-the-custom-nginx">Step 05 - Create the custom Nginx<a class="headerlink" href="#24-helmoperator-step-05-create-the-custom-nginx" title="Permanent link">&para;</a></h3>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-15-1"><a id="__codelineno-15-1" name="__codelineno-15-1" href="#24-helmoperator-__codelineno-15-1"></a><span class="c1"># Deploy the custom nginx we created earlier</span>
</span><span id="__span-15-2"><a id="__codelineno-15-2" name="__codelineno-15-2" href="#24-helmoperator-__codelineno-15-2"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>config/samples/demo_v1alpha1_nginx.yaml
</span><span id="__span-15-3"><a id="__codelineno-15-3" name="__codelineno-15-3" href="#24-helmoperator-__codelineno-15-3"></a>
</span><span id="__span-15-4"><a id="__codelineno-15-4" name="__codelineno-15-4" href="#24-helmoperator-__codelineno-15-4"></a><span class="c1"># Ensure that the nginx-operator created</span>
</span><span id="__span-15-5"><a id="__codelineno-15-5" name="__codelineno-15-5" href="#24-helmoperator-__codelineno-15-5"></a>kubectl<span class="w"> </span>get<span class="w"> </span>deployment<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>nginx-sample
</span><span id="__span-15-6"><a id="__codelineno-15-6" name="__codelineno-15-6" href="#24-helmoperator-__codelineno-15-6"></a>
</span><span id="__span-15-7"><a id="__codelineno-15-7" name="__codelineno-15-7" href="#24-helmoperator-__codelineno-15-7"></a><span class="c1"># Check that we have 3 replicas as defined earlier</span>
</span><span id="__span-15-8"><a id="__codelineno-15-8" name="__codelineno-15-8" href="#24-helmoperator-__codelineno-15-8"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>nginx-sample
</span><span id="__span-15-9"><a id="__codelineno-15-9" name="__codelineno-15-9" href="#24-helmoperator-__codelineno-15-9"></a>
</span><span id="__span-15-10"><a id="__codelineno-15-10" name="__codelineno-15-10" href="#24-helmoperator-__codelineno-15-10"></a><span class="c1"># Check that the port is set to 8888</span>
</span><span id="__span-15-11"><a id="__codelineno-15-11" name="__codelineno-15-11" href="#24-helmoperator-__codelineno-15-11"></a>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>nginx-sample
</span></code></pre></div>
<h3 id="24-helmoperator-step-06-check-the-operator-logic">Step 06 - Check the operator logic<a class="headerlink" href="#24-helmoperator-step-06-check-the-operator-logic" title="Permanent link">&para;</a></h3>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-16-1"><a id="__codelineno-16-1" name="__codelineno-16-1" href="#24-helmoperator-__codelineno-16-1"></a><span class="c1"># Update the replicaCount and remove the port</span>
</span><span id="__span-16-2"><a id="__codelineno-16-2" name="__codelineno-16-2" href="#24-helmoperator-__codelineno-16-2"></a><span class="c1"># Once we update the yaml we will check that the operator is working</span>
</span><span id="__span-16-3"><a id="__codelineno-16-3" name="__codelineno-16-3" href="#24-helmoperator-__codelineno-16-3"></a><span class="c1"># and updating the desired values</span>
</span><span id="__span-16-4"><a id="__codelineno-16-4" name="__codelineno-16-4" href="#24-helmoperator-__codelineno-16-4"></a>
</span><span id="__span-16-5"><a id="__codelineno-16-5" name="__codelineno-16-5" href="#24-helmoperator-__codelineno-16-5"></a><span class="c1"># Update the replicaCount in `config/samples/demo_v1alpha1_nginx.yaml`</span>
</span><span id="__span-16-6"><a id="__codelineno-16-6" name="__codelineno-16-6" href="#24-helmoperator-__codelineno-16-6"></a>replicaCount:<span class="w"> </span><span class="m">5</span>
</span><span id="__span-16-7"><a id="__codelineno-16-7" name="__codelineno-16-7" href="#24-helmoperator-__codelineno-16-7"></a>
</span><span id="__span-16-8"><a id="__codelineno-16-8" name="__codelineno-16-8" href="#24-helmoperator-__codelineno-16-8"></a><span class="c1"># Remark the service section in the yaml file</span>
</span><span id="__span-16-9"><a id="__codelineno-16-9" name="__codelineno-16-9" href="#24-helmoperator-__codelineno-16-9"></a><span class="c1"># We wish to see that the operator will use the default values</span>
</span><span id="__span-16-10"><a id="__codelineno-16-10" name="__codelineno-16-10" href="#24-helmoperator-__codelineno-16-10"></a><span class="m">36</span><span class="w">   </span><span class="c1">#service:</span>
</span><span id="__span-16-11"><a id="__codelineno-16-11" name="__codelineno-16-11" href="#24-helmoperator-__codelineno-16-11"></a><span class="m">37</span><span class="w">   </span><span class="c1">#  port: 8888</span>
</span><span id="__span-16-12"><a id="__codelineno-16-12" name="__codelineno-16-12" href="#24-helmoperator-__codelineno-16-12"></a><span class="m">38</span><span class="w">   </span><span class="c1">#  type: ClusterIP</span>
</span></code></pre></div>
<ul>
<li>Apply the changes:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-17-1"><a id="__codelineno-17-1" name="__codelineno-17-1" href="#24-helmoperator-__codelineno-17-1"></a><span class="c1"># Apply the changes</span>
</span><span id="__span-17-2"><a id="__codelineno-17-2" name="__codelineno-17-2" href="#24-helmoperator-__codelineno-17-2"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>config/samples/demo_v1alpha1_nginx.yaml
</span></code></pre></div>
<ul>
<li>Check to see that the operator is working as expected:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-18-1"><a id="__codelineno-18-1" name="__codelineno-18-1" href="#24-helmoperator-__codelineno-18-1"></a><span class="c1"># Ensure that the nginx-operator still running</span>
</span><span id="__span-18-2"><a id="__codelineno-18-2" name="__codelineno-18-2" href="#24-helmoperator-__codelineno-18-2"></a>kubectl<span class="w"> </span>get<span class="w"> </span>deployment<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>nginx-sample
</span><span id="__span-18-3"><a id="__codelineno-18-3" name="__codelineno-18-3" href="#24-helmoperator-__codelineno-18-3"></a>
</span><span id="__span-18-4"><a id="__codelineno-18-4" name="__codelineno-18-4" href="#24-helmoperator-__codelineno-18-4"></a><span class="c1"># Deploy the custom nginx we created earlier</span>
</span><span id="__span-18-5"><a id="__codelineno-18-5" name="__codelineno-18-5" href="#24-helmoperator-__codelineno-18-5"></a>kubectl<span class="w"> </span>apply<span class="w"> </span>-f<span class="w"> </span>config/samples/demo_v1alpha1_nginx.yaml
</span><span id="__span-18-6"><a id="__codelineno-18-6" name="__codelineno-18-6" href="#24-helmoperator-__codelineno-18-6"></a>
</span><span id="__span-18-7"><a id="__codelineno-18-7" name="__codelineno-18-7" href="#24-helmoperator-__codelineno-18-7"></a><span class="c1"># Check that we have 5 replicas as defined earlier</span>
</span><span id="__span-18-8"><a id="__codelineno-18-8" name="__codelineno-18-8" href="#24-helmoperator-__codelineno-18-8"></a>kubectl<span class="w"> </span>get<span class="w"> </span>pods<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>nginx-sample
</span><span id="__span-18-9"><a id="__codelineno-18-9" name="__codelineno-18-9" href="#24-helmoperator-__codelineno-18-9"></a>
</span><span id="__span-18-10"><a id="__codelineno-18-10" name="__codelineno-18-10" href="#24-helmoperator-__codelineno-18-10"></a><span class="c1"># Check that the port is set back to its default (80)</span>
</span><span id="__span-18-11"><a id="__codelineno-18-11" name="__codelineno-18-11" href="#24-helmoperator-__codelineno-18-11"></a>kubectl<span class="w"> </span>get<span class="w"> </span>svc<span class="w"> </span><span class="p">|</span><span class="w"> </span>grep<span class="w"> </span>nginx-sample
</span></code></pre></div>
<h3 id="24-helmoperator-step-07-logging-debugging">Step 07 - Logging / Debugging<a class="headerlink" href="#24-helmoperator-step-07-logging-debugging" title="Permanent link">&para;</a></h3>
<ul>
<li>We can view the operator&rsquo;s logs using the following command:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-19-1"><a id="__codelineno-19-1" name="__codelineno-19-1" href="#24-helmoperator-__codelineno-19-1"></a><span class="c1"># View the operator logs</span>
</span><span id="__span-19-2"><a id="__codelineno-19-2" name="__codelineno-19-2" href="#24-helmoperator-__codelineno-19-2"></a>kubectl<span class="w"> </span>logs<span class="w"> </span>deployment.apps/nginx-operator-controller-manager<span class="w">  </span>-n<span class="w"> </span>nginx-operator-system<span class="w"> </span>-c<span class="w"> </span>manager
</span></code></pre></div>
<ul>
<li>Review the CR status and events:</li>
</ul>
<div class="language-sh highlight"><pre><span></span><code><span id="__span-20-1"><a id="__codelineno-20-1" name="__codelineno-20-1" href="#24-helmoperator-__codelineno-20-1"></a>kubectl<span class="w"> </span>describe<span class="w"> </span>nginxes.demo.codewizard.co.il
</span></code></pre></div></section><section class="print-page" id="25-kubebuilder" heading-number="2.28"><h1 id="25-kubebuilder-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#25-kubebuilder-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="25-kubebuilder-kubebuilder">Kubebuilder<a class="headerlink" href="#25-kubebuilder-kubebuilder" title="Permanent link">&para;</a></h2>
<h3 id="25-kubebuilder-prerequisites">Prerequisites<a class="headerlink" href="#25-kubebuilder-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>Go (Golang) installed.</li>
<li>Docker installed (for building controller images).</li>
<li><code>kubectl</code> and a test cluster.</li>
</ul>
<hr />
<h2 id="25-kubebuilder-introduction-to-kubebuilder">Introduction to Kubebuilder<a class="headerlink" href="#25-kubebuilder-introduction-to-kubebuilder" title="Permanent link">&para;</a></h2>
<p>Kubebuilder is a framework for building Kubernetes APIs using custom resource definitions (CRDs). It&rsquo;s similar to the Ruby on Rails or Play frameworks for web development, providing a set of tools and libraries to quickly scaffold and build Kubernetes Operators.</p>
<h3 id="25-kubebuilder-step-01-installing-kubebuilder">Step 01 - Installing Kubebuilder<a class="headerlink" href="#25-kubebuilder-step-01-installing-kubebuilder" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#25-kubebuilder-__codelineno-0-1"></a>curl<span class="w"> </span>-L<span class="w"> </span>-o<span class="w"> </span>kubebuilder<span class="w"> </span>https://go.kubebuilder.io/dl/latest/<span class="k">$(</span>go<span class="w"> </span>env<span class="w"> </span>GOOS<span class="k">)</span>/<span class="k">$(</span>go<span class="w"> </span>env<span class="w"> </span>GOARCH<span class="k">)</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#25-kubebuilder-__codelineno-0-2"></a>chmod<span class="w"> </span>+x<span class="w"> </span>kubebuilder<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>mv<span class="w"> </span>kubebuilder<span class="w"> </span>/usr/local/bin/
</span></code></pre></div>
<h3 id="25-kubebuilder-step-02-initializing-a-project">Step 02 - Initializing a Project<a class="headerlink" href="#25-kubebuilder-step-02-initializing-a-project" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#25-kubebuilder-__codelineno-1-1"></a>kubebuilder<span class="w"> </span>init<span class="w"> </span>--domain<span class="w"> </span>my.domain<span class="w"> </span>--repo<span class="w"> </span>github.com/user/project
</span></code></pre></div>
<h3 id="25-kubebuilder-step-03-creating-an-api-crd-controller">Step 03 - Creating an API (CRD + Controller)<a class="headerlink" href="#25-kubebuilder-step-03-creating-an-api-crd-controller" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#25-kubebuilder-__codelineno-2-1"></a>kubebuilder<span class="w"> </span>create<span class="w"> </span>api<span class="w"> </span>--group<span class="w"> </span>webapp<span class="w"> </span>--version<span class="w"> </span>v1<span class="w"> </span>--kind<span class="w"> </span>Guestbook
</span></code></pre></div>
<h3 id="25-kubebuilder-step-04-understanding-the-reconciler">Step 04 - Understanding the Reconciler<a class="headerlink" href="#25-kubebuilder-step-04-understanding-the-reconciler" title="Permanent link">&para;</a></h3>
<p>The core of your operator is the <code>Reconcile</code> function, which ensures the current state of the cluster matches the desired state defined in your CRD.</p>
<hr />
<p><em>Note: This is a placeholder for the full detailed walkthrough.</em></p></section><section class="print-page" id="26-k9s-basics" heading-number="2.29"><h1 id="26-k9s-basics-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#26-k9s-basics-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="26-k9s-basics-k9s-basics">k9s Basics<a class="headerlink" href="#26-k9s-basics-k9s-basics" title="Permanent link">&para;</a></h2>
<h3 id="26-k9s-basics-prerequisites">Prerequisites<a class="headerlink" href="#26-k9s-basics-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>A running Kubernetes cluster.</li>
</ul>
<hr />
<h2 id="26-k9s-basics-introduction-to-k9s">Introduction to k9s<a class="headerlink" href="#26-k9s-basics-introduction-to-k9s" title="Permanent link">&para;</a></h2>
<p>k9s is a terminal-based UI to interact with your Kubernetes clusters. The goal of k9s is to make it easier to navigate, observe, and manage your applications in the wild. It continually watches Kubernetes for changes and offers subsequent commands to interact with your observed resources.</p>
<h3 id="26-k9s-basics-step-01-installation">Step 01 - Installation<a class="headerlink" href="#26-k9s-basics-step-01-installation" title="Permanent link">&para;</a></h3>
<ul>
<li><strong>macOS/Linux (Homebrew)</strong>: <code>brew install derailed/k9s/k9s</code></li>
<li><strong>Linux (Binary)</strong>: 
    <div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#26-k9s-basics-__codelineno-0-1"></a>curl<span class="w"> </span>-sS<span class="w"> </span>https://webinstall.dev/k9s<span class="w"> </span><span class="p">|</span><span class="w"> </span>bash
</span></code></pre></div></li>
<li><strong>Linux (Snap)</strong>: <code>sudo snap install k9s</code></li>
</ul>
<h3 id="26-k9s-basics-step-02-launching-k9s">Step 02 - Launching k9s<a class="headerlink" href="#26-k9s-basics-step-02-launching-k9s" title="Permanent link">&para;</a></h3>
<p>Simply type <code>k9s</code> in your terminal. It will use your current kubeconfig context.</p>
<h3 id="26-k9s-basics-step-03-common-usage-commands">Step 03 - Common Usage &amp; Commands<a class="headerlink" href="#26-k9s-basics-step-03-common-usage-commands" title="Permanent link">&para;</a></h3>
<p>k9s relies on powerful keyboard shortcuts. Once it&rsquo;s running, try these common commands:</p>
<h4 id="26-k9s-basics-navigation">Navigation<a class="headerlink" href="#26-k9s-basics-navigation" title="Permanent link">&para;</a></h4>
<ul>
<li><code>:pods</code> - List all Pods (Default view).</li>
<li><code>:svc</code> - List all Services.</li>
<li><code>:deploy</code> - List all Deployments.</li>
<li><code>:ns</code> - List all Namespaces.</li>
<li><code>:nodes</code> - List all cluster Nodes.</li>
</ul>
<h4 id="26-k9s-basics-core-shortcuts">Core Shortcuts<a class="headerlink" href="#26-k9s-basics-core-shortcuts" title="Permanent link">&para;</a></h4>
<ul>
<li><code>j</code> / <code>k</code> or <strong>Arrows</strong> - Move up and down in lists.</li>
<li><code>/</code> - <strong>Search</strong>: Type to filter resources in the current view.</li>
<li><code>0</code> - <strong>All Namespaces</strong>: View resources across all namespaces.</li>
<li><code>1-9</code> - <strong>Namespace Filter</strong>: Quick-jump to specific namespaces.</li>
<li><code>h</code> or <code>?</code> - <strong>Help</strong>: Open the built-in k9s cheat sheet.</li>
</ul>
<h4 id="26-k9s-basics-resource-operations">Resource Operations<a class="headerlink" href="#26-k9s-basics-resource-operations" title="Permanent link">&para;</a></h4>
<ul>
<li><code>d</code> - <strong>Describe</strong>: View the detailed descriptions of the selected resource.</li>
<li><code>e</code> - <strong>Edit</strong>: Open the resource manifest in your editor.</li>
<li><code>l</code> - <strong>Logs</strong>: View logs for the selected pod (use <code>f</code> to follow, <code>0</code> to tail).</li>
<li><code>s</code> - <strong>Shell</strong>: Drop into a shell within the selected container.</li>
<li><code>y</code> - <strong>YAML</strong>: View the resource&rsquo;s raw YAML manifest.</li>
<li><code>r</code> - <strong>Restart</strong>: Trigger a rollout restart of the selected deployment.</li>
<li><code>ctrl-d</code> - <strong>Delete</strong>: Safely delete the selected resource (requires confirmation).</li>
<li><code>ctrl-s</code> - <strong>Save</strong>: Save the current view or logs to a local file.</li>
</ul>
<h4 id="26-k9s-basics-view-options">View Options<a class="headerlink" href="#26-k9s-basics-view-options" title="Permanent link">&para;</a></h4>
<ul>
<li><code>f</code> - <strong>Full Screen</strong>: Toggle full-screen mode for the current view.</li>
<li><code>ctrl-w</code> - <strong>Wide Columns</strong>: Toggle wide/extended columns for more detail.</li>
</ul>
<h4 id="26-k9s-basics-management">Management<a class="headerlink" href="#26-k9s-basics-management" title="Permanent link">&para;</a></h4>
<ul>
<li><code>p</code> - <strong>Port Forward Mapping</strong>: Add a port forward for the selected pod or service.</li>
<li><code>shift-f</code> - <strong>Port Forward View</strong>: Manage and view active port forwards (use <code>:pf</code> as an alias).</li>
</ul>
<hr />
<p><em>Next: Learn advanced k9s features and power-user customizations in <a href="#30-k9s-advanced">Lab 30</a>.</em></p></section><section class="print-page" id="27-krew" heading-number="2.30"><h1 id="27-krew-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#27-krew-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="27-krew-krew">Krew<a class="headerlink" href="#27-krew-krew" title="Permanent link">&para;</a></h2>
<h3 id="27-krew-prerequisites">Prerequisites<a class="headerlink" href="#27-krew-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li><code>git</code> version 2.19.0 or later.</li>
<li><code>kubectl</code> installed.</li>
</ul>
<hr />
<h2 id="27-krew-introduction-to-krew">Introduction to Krew<a class="headerlink" href="#27-krew-introduction-to-krew" title="Permanent link">&para;</a></h2>
<p>Krew is the plugin manager for <code>kubectl</code> command-line tool. It helps you discover, install, and manage plugins that extend the functionality of <code>kubectl</code>.</p>
<h3 id="27-krew-step-01-installation">Step 01 - Installation<a class="headerlink" href="#27-krew-step-01-installation" title="Permanent link">&para;</a></h3>
<p>Follow the instructions at <a href="https://krew.sigs.k8s.io/docs/user-guide/setup/install/">krew.sigs.k8s.io</a> for your specific OS.</p>
<h3 id="27-krew-step-02-updating-the-plugin-list">Step 02 - Updating the Plugin List<a class="headerlink" href="#27-krew-step-02-updating-the-plugin-list" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#27-krew-__codelineno-0-1"></a>kubectl<span class="w"> </span>krew<span class="w"> </span>update
</span></code></pre></div>
<h3 id="27-krew-step-03-searching-for-plugins">Step 03 - Searching for Plugins<a class="headerlink" href="#27-krew-step-03-searching-for-plugins" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#27-krew-__codelineno-1-1"></a>kubectl<span class="w"> </span>krew<span class="w"> </span>search
</span></code></pre></div>
<h3 id="27-krew-step-04-installing-a-plugin">Step 04 - Installing a Plugin<a class="headerlink" href="#27-krew-step-04-installing-a-plugin" title="Permanent link">&para;</a></h3>
<p>For example, to install the <code>who-can</code> plugin:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#27-krew-__codelineno-2-1"></a>kubectl<span class="w"> </span>krew<span class="w"> </span>install<span class="w"> </span>who-can
</span></code></pre></div></p>
<hr />
<p><em>Note: This is a placeholder for the full detailed walkthrough.</em></p></section><section class="print-page" id="28-kubeapps" heading-number="2.31"><h1 id="28-kubeapps-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#28-kubeapps-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="28-kubeapps-kubeapps">Kubeapps<a class="headerlink" href="#28-kubeapps-kubeapps" title="Permanent link">&para;</a></h2>
<h3 id="28-kubeapps-prerequisites">Prerequisites<a class="headerlink" href="#28-kubeapps-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>A Kubernetes cluster with Helm 3 installed.</li>
</ul>
<hr />
<h2 id="28-kubeapps-introduction-to-kubeapps">Introduction to Kubeapps<a class="headerlink" href="#28-kubeapps-introduction-to-kubeapps" title="Permanent link">&para;</a></h2>
<p>Kubeapps is a web-based dashboard that allows users to deploy and manage applications on Kubernetes from a catalog of Helm charts and Operators.</p>
<h3 id="28-kubeapps-step-01-installing-kubeapps">Step 01 - Installing Kubeapps<a class="headerlink" href="#28-kubeapps-step-01-installing-kubeapps" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#28-kubeapps-__codelineno-0-1"></a>helm<span class="w"> </span>repo<span class="w"> </span>add<span class="w"> </span>bitnami<span class="w"> </span>https://charts.bitnami.com/bitnami
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#28-kubeapps-__codelineno-0-2"></a>kubectl<span class="w"> </span>create<span class="w"> </span>namespace<span class="w"> </span>kubeapps
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#28-kubeapps-__codelineno-0-3"></a>helm<span class="w"> </span>install<span class="w"> </span>kubeapps<span class="w"> </span>bitnami/kubeapps<span class="w"> </span>--namespace<span class="w"> </span>kubeapps
</span></code></pre></div>
<h3 id="28-kubeapps-step-02-accessing-the-dashboard">Step 02 - Accessing the Dashboard<a class="headerlink" href="#28-kubeapps-step-02-accessing-the-dashboard" title="Permanent link">&para;</a></h3>
<p>You can port-forward to access the UI:
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#28-kubeapps-__codelineno-1-1"></a>kubectl<span class="w"> </span>port-forward<span class="w"> </span>-n<span class="w"> </span>kubeapps<span class="w"> </span>svc/kubeapps<span class="w"> </span><span class="m">8080</span>:80
</span></code></pre></div></p>
<h3 id="28-kubeapps-step-03-authentication">Step 03 - Authentication<a class="headerlink" href="#28-kubeapps-step-03-authentication" title="Permanent link">&para;</a></h3>
<p>Kubeapps uses Kubernetes RBAC. You&rsquo;ll need to create a ServiceAccount and use its token to log in.</p>
<hr />
<p><em>Note: This is a placeholder for the full detailed walkthrough.</em></p></section><section class="print-page" id="29-kubeadm" heading-number="2.32"><h1 id="29-kubeadm-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#29-kubeadm-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="29-kubeadm-kubeadm">Kubeadm<a class="headerlink" href="#29-kubeadm-kubeadm" title="Permanent link">&para;</a></h2>
<h3 id="29-kubeadm-prerequisites">Prerequisites<a class="headerlink" href="#29-kubeadm-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li>Two or more Linux machines (Ubuntu 22.04 recommended).</li>
<li>Full network connectivity between all machines.</li>
<li>Unique hostname, MAC address, and product_uuid for every node.</li>
</ul>
<hr />
<h2 id="29-kubeadm-introduction-to-kubeadm">Introduction to Kubeadm<a class="headerlink" href="#29-kubeadm-introduction-to-kubeadm" title="Permanent link">&para;</a></h2>
<p>Kubeadm is the standard tool for bootstrapping a minimum viable Kubernetes cluster that conforms to best practices. While it focuses on the cluster lifecycle (init, join, upgrade, reset), it doesn&rsquo;t handle infrastructure provisioning.</p>
<h3 id="29-kubeadm-step-01-installing-runtime-dockercontainerd">Step 01 - Installing Runtime (Docker/containerd)<a class="headerlink" href="#29-kubeadm-step-01-installing-runtime-dockercontainerd" title="Permanent link">&para;</a></h3>
<p>Nodes must have a container runtime installed before <code>kubeadm</code> can run.</p>
<h3 id="29-kubeadm-step-02-installing-kubeadm-kubelet-and-kubectl">Step 02 - Installing Kubeadm, Kubelet, and Kubectl<a class="headerlink" href="#29-kubeadm-step-02-installing-kubeadm-kubelet-and-kubectl" title="Permanent link">&para;</a></h3>
<p><strong>Install packages</strong>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#29-kubeadm-__codelineno-0-1"></a>sudo<span class="w"> </span>apt-get<span class="w"> </span>update<span class="w"> </span><span class="o">&amp;&amp;</span><span class="w"> </span>sudo<span class="w"> </span>apt-get<span class="w"> </span>install<span class="w"> </span>-y<span class="w"> </span>apt-transport-https<span class="w"> </span>ca-certificates<span class="w"> </span>curl
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#29-kubeadm-__codelineno-0-2"></a><span class="c1"># Add Google Cloud public signing key</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#29-kubeadm-__codelineno-0-3"></a><span class="c1"># Add Kubernetes apt repository</span>
</span></code></pre></div></p>
<h3 id="29-kubeadm-step-03-initializing-the-control-plane">Step 03 - Initializing the Control Plane<a class="headerlink" href="#29-kubeadm-step-03-initializing-the-control-plane" title="Permanent link">&para;</a></h3>
<div class="language-bash highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#29-kubeadm-__codelineno-1-1"></a>sudo<span class="w"> </span>kubeadm<span class="w"> </span>init<span class="w"> </span>--pod-network-cidr<span class="o">=</span><span class="m">192</span>.168.0.0/16
</span></code></pre></div>
<h3 id="29-kubeadm-step-04-joining-worker-nodes">Step 04 - Joining Worker Nodes<a class="headerlink" href="#29-kubeadm-step-04-joining-worker-nodes" title="Permanent link">&para;</a></h3>
<p>Run the join command provided at the end of <code>kubeadm init</code> on your worker machines.</p>
<hr />
<p><em>Note: This is a placeholder for the full detailed walkthrough.</em></p></section><section class="print-page" id="30-k9s-advanced" heading-number="2.33"><h1 id="30-k9s-advanced-k8s-hands-on">K8S Hands-on<a class="headerlink" href="#30-k9s-advanced-k8s-hands-on" title="Permanent link">&para;</a></h1>
<hr />
<h2 id="30-k9s-advanced-k9s-advanced">k9s Advanced<a class="headerlink" href="#30-k9s-advanced-k9s-advanced" title="Permanent link">&para;</a></h2>
<h3 id="30-k9s-advanced-prerequisites">Prerequisites<a class="headerlink" href="#30-k9s-advanced-prerequisites" title="Permanent link">&para;</a></h3>
<ul>
<li><code>k9s</code> installed and basic familiarity (see Lab 26).</li>
</ul>
<hr />
<h3 id="30-k9s-advanced-step-01-resource-utilization-top">Step 01 - Resource Utilization (<code>top</code>)<a class="headerlink" href="#30-k9s-advanced-step-01-resource-utilization-top" title="Permanent link">&para;</a></h3>
<p>K9s integrates real-time metrics to help you identify resource-heavy pods or nodes.
- <code>:top pod</code> - View pods sorted by CPU/Memory utilization.
- <code>:top node</code> - View cluster nodes and their resource pressure.</p>
<h3 id="30-k9s-advanced-step-02-xray-pulses-cluster-health">Step 02 - XRay &amp; Pulses (Cluster Health)<a class="headerlink" href="#30-k9s-advanced-step-02-xray-pulses-cluster-health" title="Permanent link">&para;</a></h3>
<p>Visualize your cluster from a high-level &ldquo;cockpit&rdquo; view.
- <code>:pulses</code> - A high-level dashboard showing deployment health, pod status, and resource usage in real-time.
- <code>:xray pods</code> - Visualizes the hierarchy of your pods, showing their associated Services, ConfigMaps, and Secrets.
- <code>:xray svc</code> - Visualizes services and their corresponding endpoints.</p>
<h3 id="30-k9s-advanced-step-03-rbac-inspection-can-i">Step 03 - RBAC Inspection (<code>can-i</code>)<a class="headerlink" href="#30-k9s-advanced-step-03-rbac-inspection-can-i" title="Permanent link">&para;</a></h3>
<p>Check permissions without leave the UI.
- <code>:can-i</code> - Enter the RBAC view to see exactly what you can (and cannot) do across the cluster.
- Reverse lookup: Find which Roles or ClusterRoles grant a specific permission.</p>
<h3 id="30-k9s-advanced-step-04-multi-cluster-context-management">Step 04 - Multi-Cluster Context Management<a class="headerlink" href="#30-k9s-advanced-step-04-multi-cluster-context-management" title="Permanent link">&para;</a></h3>
<p>Switch between clusters seamlessly.
- <code>:ctx</code> - List all contexts in your <code>kubeconfig</code>.
- Select and hit <code>enter</code> to switch to a different cluster instantly without restarting k9s.</p>
<h3 id="30-k9s-advanced-step-05-configuration-plugins-power-user">Step 05 - Configuration &amp; Plugins (Power User)<a class="headerlink" href="#30-k9s-advanced-step-05-configuration-plugins-power-user" title="Permanent link">&para;</a></h3>
<p>K9s behavior and appearance are defined in YAML files located in <code>~/.config/k9s/</code> (on Linux) or <code>%LOCALAPPDATA%\k9s\</code> (on Windows).</p>
<h4 id="30-k9s-advanced-configyaml-the-ui-skin">üé® <code>config.yaml</code> (The UI Skin)<a class="headerlink" href="#30-k9s-advanced-configyaml-the-ui-skin" title="Permanent link">&para;</a></h4>
<p>Use this to customize the look and feel. You can point to custom skins here.
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-0-1"><a id="__codelineno-0-1" name="__codelineno-0-1" href="#30-k9s-advanced-__codelineno-0-1"></a><span class="nt">k9s</span><span class="p">:</span>
</span><span id="__span-0-2"><a id="__codelineno-0-2" name="__codelineno-0-2" href="#30-k9s-advanced-__codelineno-0-2"></a><span class="w">  </span><span class="nt">ui</span><span class="p">:</span>
</span><span id="__span-0-3"><a id="__codelineno-0-3" name="__codelineno-0-3" href="#30-k9s-advanced-__codelineno-0-3"></a><span class="w">    </span><span class="nt">skin</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">catppuccin-mocha</span><span class="w"> </span><span class="c1"># Reference a skin file in the /skins folder</span>
</span><span id="__span-0-4"><a id="__codelineno-0-4" name="__codelineno-0-4" href="#30-k9s-advanced-__codelineno-0-4"></a><span class="w">    </span><span class="nt">noIcons</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span><span class="w">         </span><span class="c1"># Enable/Disable FontAwesome icons</span>
</span><span id="__span-0-5"><a id="__codelineno-0-5" name="__codelineno-0-5" href="#30-k9s-advanced-__codelineno-0-5"></a><span class="w">  </span><span class="nt">refreshRate</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">2</span><span class="w">           </span><span class="c1"># Update UI every 2 seconds</span>
</span></code></pre></div></p>
<h4 id="30-k9s-advanced-aliasesyaml-custom-commands">‚ö° <code>aliases.yaml</code> (Custom Commands)<a class="headerlink" href="#30-k9s-advanced-aliasesyaml-custom-commands" title="Permanent link">&para;</a></h4>
<p>Speed up your navigation by creating short aliases for common resources.
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-1-1"><a id="__codelineno-1-1" name="__codelineno-1-1" href="#30-k9s-advanced-__codelineno-1-1"></a><span class="nt">alias</span><span class="p">:</span>
</span><span id="__span-1-2"><a id="__codelineno-1-2" name="__codelineno-1-2" href="#30-k9s-advanced-__codelineno-1-2"></a><span class="w">  </span><span class="c1"># Type &#39;:p&#39; instead of &#39;:pods&#39;</span>
</span><span id="__span-1-3"><a id="__codelineno-1-3" name="__codelineno-1-3" href="#30-k9s-advanced-__codelineno-1-3"></a><span class="w">  </span><span class="nt">p</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1/pods</span>
</span><span id="__span-1-4"><a id="__codelineno-1-4" name="__codelineno-1-4" href="#30-k9s-advanced-__codelineno-1-4"></a><span class="w">  </span><span class="c1"># Type &#39;:s&#39; instead of &#39;:services&#39;</span>
</span><span id="__span-1-5"><a id="__codelineno-1-5" name="__codelineno-1-5" href="#30-k9s-advanced-__codelineno-1-5"></a><span class="w">  </span><span class="nt">s</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">v1/services</span>
</span><span id="__span-1-6"><a id="__codelineno-1-6" name="__codelineno-1-6" href="#30-k9s-advanced-__codelineno-1-6"></a><span class="w">  </span><span class="c1"># Type &#39;:d&#39; instead of &#39;:deployments&#39;</span>
</span><span id="__span-1-7"><a id="__codelineno-1-7" name="__codelineno-1-7" href="#30-k9s-advanced-__codelineno-1-7"></a><span class="w">  </span><span class="nt">d</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">apps/v1/deployments</span>
</span></code></pre></div></p>
<h4 id="30-k9s-advanced-pluginyml-extend-functionality">üîå <code>plugin.yml</code> (Extend Functionality)<a class="headerlink" href="#30-k9s-advanced-pluginyml-extend-functionality" title="Permanent link">&para;</a></h4>
<p>Plugins allow you to trigger external tools directly from the k9s UI.
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-2-1"><a id="__codelineno-2-1" name="__codelineno-2-1" href="#30-k9s-advanced-__codelineno-2-1"></a><span class="nt">plugin</span><span class="p">:</span>
</span><span id="__span-2-2"><a id="__codelineno-2-2" name="__codelineno-2-2" href="#30-k9s-advanced-__codelineno-2-2"></a><span class="w">  </span><span class="c1"># Press &#39;Shift-D&#39; on a pod to instantly run a debug sidecar</span>
</span><span id="__span-2-3"><a id="__codelineno-2-3" name="__codelineno-2-3" href="#30-k9s-advanced-__codelineno-2-3"></a><span class="w">  </span><span class="nt">debug</span><span class="p">:</span>
</span><span id="__span-2-4"><a id="__codelineno-2-4" name="__codelineno-2-4" href="#30-k9s-advanced-__codelineno-2-4"></a><span class="w">    </span><span class="nt">shortCut</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Shift-D</span>
</span><span id="__span-2-5"><a id="__codelineno-2-5" name="__codelineno-2-5" href="#30-k9s-advanced-__codelineno-2-5"></a><span class="w">    </span><span class="nt">confirm</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-2-6"><a id="__codelineno-2-6" name="__codelineno-2-6" href="#30-k9s-advanced-__codelineno-2-6"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Add Debug Sidecar</span>
</span><span id="__span-2-7"><a id="__codelineno-2-7" name="__codelineno-2-7" href="#30-k9s-advanced-__codelineno-2-7"></a><span class="w">    </span><span class="nt">scopes</span><span class="p">:</span>
</span><span id="__span-2-8"><a id="__codelineno-2-8" name="__codelineno-2-8" href="#30-k9s-advanced-__codelineno-2-8"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pods</span>
</span><span id="__span-2-9"><a id="__codelineno-2-9" name="__codelineno-2-9" href="#30-k9s-advanced-__codelineno-2-9"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">kubectl</span>
</span><span id="__span-2-10"><a id="__codelineno-2-10" name="__codelineno-2-10" href="#30-k9s-advanced-__codelineno-2-10"></a><span class="w">    </span><span class="nt">background</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">false</span>
</span><span id="__span-2-11"><a id="__codelineno-2-11" name="__codelineno-2-11" href="#30-k9s-advanced-__codelineno-2-11"></a><span class="w">    </span><span class="nt">args</span><span class="p">:</span>
</span><span id="__span-2-12"><a id="__codelineno-2-12" name="__codelineno-2-12" href="#30-k9s-advanced-__codelineno-2-12"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">debug</span>
</span><span id="__span-2-13"><a id="__codelineno-2-13" name="__codelineno-2-13" href="#30-k9s-advanced-__codelineno-2-13"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">-it</span>
</span><span id="__span-2-14"><a id="__codelineno-2-14" name="__codelineno-2-14" href="#30-k9s-advanced-__codelineno-2-14"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">$NAME</span>
</span><span id="__span-2-15"><a id="__codelineno-2-15" name="__codelineno-2-15" href="#30-k9s-advanced-__codelineno-2-15"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--image=busybox</span>
</span><span id="__span-2-16"><a id="__codelineno-2-16" name="__codelineno-2-16" href="#30-k9s-advanced-__codelineno-2-16"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--target=$NAME</span>
</span><span id="__span-2-17"><a id="__codelineno-2-17" name="__codelineno-2-17" href="#30-k9s-advanced-__codelineno-2-17"></a><span class="w">      </span><span class="p p-Indicator">-</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">--namespace=$NAMESPACE</span>
</span></code></pre></div></p>
<h4 id="30-k9s-advanced-hotkeysyaml-global-shortcuts">‚å®Ô∏è <code>hotkeys.yaml</code> (Global Shortcuts)<a class="headerlink" href="#30-k9s-advanced-hotkeysyaml-global-shortcuts" title="Permanent link">&para;</a></h4>
<p>Create global hotkeys to jump to specific views from anywhere.
<div class="language-yaml highlight"><pre><span></span><code><span id="__span-3-1"><a id="__codelineno-3-1" name="__codelineno-3-1" href="#30-k9s-advanced-__codelineno-3-1"></a><span class="nt">hotkeys</span><span class="p">:</span>
</span><span id="__span-3-2"><a id="__codelineno-3-2" name="__codelineno-3-2" href="#30-k9s-advanced-__codelineno-3-2"></a><span class="w">  </span><span class="c1"># Press &#39;Shift-0&#39; to jump back to the &#39;All Namespaces Pods&#39; view instantly</span>
</span><span id="__span-3-3"><a id="__codelineno-3-3" name="__codelineno-3-3" href="#30-k9s-advanced-__codelineno-3-3"></a><span class="w">  </span><span class="nt">hotKey1</span><span class="p">:</span>
</span><span id="__span-3-4"><a id="__codelineno-3-4" name="__codelineno-3-4" href="#30-k9s-advanced-__codelineno-3-4"></a><span class="w">    </span><span class="nt">shortCut</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">Shift-0</span>
</span><span id="__span-3-5"><a id="__codelineno-3-5" name="__codelineno-3-5" href="#30-k9s-advanced-__codelineno-3-5"></a><span class="w">    </span><span class="nt">description</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">View All Pods</span>
</span><span id="__span-3-6"><a id="__codelineno-3-6" name="__codelineno-3-6" href="#30-k9s-advanced-__codelineno-3-6"></a><span class="w">    </span><span class="nt">command</span><span class="p">:</span><span class="w"> </span><span class="l l-Scalar l-Scalar-Plain">pods --all-namespaces</span>
</span></code></pre></div></p>
<h3 id="30-k9s-advanced-step-06-benchmarking">Step 06 - Benchmarking<a class="headerlink" href="#30-k9s-advanced-step-06-benchmarking" title="Permanent link">&para;</a></h3>
<p>If you have <code>hey</code> installed, you can benchmark services directly.
- Navigate to a Service or Pod.
- Use <code>ctrl-b</code> to initiate a benchmark and view performance results inside the TUI.</p>
<h3 id="30-k9s-advanced-step-07-real-world-reference-files">Step 07 - Real-World Reference Files<a class="headerlink" href="#30-k9s-advanced-step-07-real-world-reference-files" title="Permanent link">&para;</a></h3>
<p>For your convenience, we have provided a full set of production-ready configuration files in the <code>config_examples/</code> directory of this lab. You can use these as a starting point for your own environment.</p>
<ul>
<li><a href="../30-k9s-Advanced/config_examples/config.yaml">config.yaml</a>: Standard UI and behavior settings.</li>
<li><a href="../30-k9s-Advanced/config_examples/aliases.yaml">aliases.yaml</a>: Speed up navigation with short commands like <code>:p</code> and <code>:s</code>.</li>
<li><a href="../30-k9s-Advanced/config_examples/plugin.yml">plugin.yml</a>: Powerful extensions like <code>stern</code> logs and <code>kubectl debug</code>.</li>
<li><a href="../30-k9s-Advanced/config_examples/hotkeys.yaml">hotkeys.yaml</a>: Global shortcuts for rapid context switching.</li>
</ul>
<hr />
<p><em>Note: This concludes the k9s series. You are now equipped with a professional, terminal-based cockpit for Kubernetes.</em></p></section></section></div><style>.print-site-enumerate-headings #welcome > h1:before { content: '1 ' }

                .print-site-enumerate-headings #welcome h2:before { content: '1.' counter(counter-welcome-2) ' ' }
                .print-site-enumerate-headings #welcome h2 {  counter-reset: counter-welcome-3 ;  counter-increment: counter-welcome-2 }
            
                .print-site-enumerate-headings #welcome h3:before { content: '1.' counter(counter-welcome-2) '.' counter(counter-welcome-3) ' ' }
                .print-site-enumerate-headings #welcome h3 {  counter-increment: counter-welcome-3 }
            
.print-site-enumerate-headings #section-2 > h1:before { content: '2 ' }
.print-site-enumerate-headings #index > h1:before { content: '2.1 ' }

                .print-site-enumerate-headings #index h2:before { content: '2.1.' counter(counter-index-2) ' ' }
                .print-site-enumerate-headings #index h2 {  counter-increment: counter-index-2 }
            
.print-site-enumerate-headings #00-verifycluster > h1:before { content: '2.2 ' }

                .print-site-enumerate-headings #00-verifycluster h2:before { content: '2.2.' counter(counter-00-verifycluster-2) ' ' }
                .print-site-enumerate-headings #00-verifycluster h2 {  counter-increment: counter-00-verifycluster-2 }
            
.print-site-enumerate-headings #01-namespace > h1:before { content: '2.3 ' }

                .print-site-enumerate-headings #01-namespace h2:before { content: '2.3.' counter(counter-01-namespace-2) ' ' }
                .print-site-enumerate-headings #01-namespace h2 {  counter-increment: counter-01-namespace-2 }
            
.print-site-enumerate-headings #02-deployments-imperative > h1:before { content: '2.4 ' }

                .print-site-enumerate-headings #02-deployments-imperative h2:before { content: '2.4.' counter(counter-02-deployments-imperative-2) ' ' }
                .print-site-enumerate-headings #02-deployments-imperative h2 {  counter-increment: counter-02-deployments-imperative-2 }
            
.print-site-enumerate-headings #03-deployments-declarative > h1:before { content: '2.5 ' }

                .print-site-enumerate-headings #03-deployments-declarative h2:before { content: '2.5.' counter(counter-03-deployments-declarative-2) ' ' }
                .print-site-enumerate-headings #03-deployments-declarative h2 {  counter-increment: counter-03-deployments-declarative-2 }
            
.print-site-enumerate-headings #04-rollout > h1:before { content: '2.6 ' }

                .print-site-enumerate-headings #04-rollout h2:before { content: '2.6.' counter(counter-04-rollout-2) ' ' }
                .print-site-enumerate-headings #04-rollout h2 {  counter-increment: counter-04-rollout-2 }
            
.print-site-enumerate-headings #05-services > h1:before { content: '2.7 ' }

                .print-site-enumerate-headings #05-services h2:before { content: '2.7.' counter(counter-05-services-2) ' ' }
                .print-site-enumerate-headings #05-services h2 {  counter-increment: counter-05-services-2 }
            
.print-site-enumerate-headings #06-datastore > h1:before { content: '2.8 ' }

                .print-site-enumerate-headings #06-datastore h2:before { content: '2.8.' counter(counter-06-datastore-2) ' ' }
                .print-site-enumerate-headings #06-datastore h2 {  counter-increment: counter-06-datastore-2 }
            
.print-site-enumerate-headings #07-nginx-ingress > h1:before { content: '2.9 ' }

                .print-site-enumerate-headings #07-nginx-ingress h2:before { content: '2.9.' counter(counter-07-nginx-ingress-2) ' ' }
                .print-site-enumerate-headings #07-nginx-ingress h2 {  counter-increment: counter-07-nginx-ingress-2 }
            
.print-site-enumerate-headings #08-kustomization > h1:before { content: '2.10 ' }

                .print-site-enumerate-headings #08-kustomization h2:before { content: '2.10.' counter(counter-08-kustomization-2) ' ' }
                .print-site-enumerate-headings #08-kustomization h2 {  counter-increment: counter-08-kustomization-2 }
            
.print-site-enumerate-headings #09-statefulset > h1:before { content: '2.11 ' }

                .print-site-enumerate-headings #09-statefulset h2:before { content: '2.11.' counter(counter-09-statefulset-2) ' ' }
                .print-site-enumerate-headings #09-statefulset h2 {  counter-increment: counter-09-statefulset-2 }
            
.print-site-enumerate-headings #10-istio > h1:before { content: '2.12 ' }

                .print-site-enumerate-headings #10-istio h2:before { content: '2.12.' counter(counter-10-istio-2) ' ' }
                .print-site-enumerate-headings #10-istio h2 {  counter-increment: counter-10-istio-2 }
            
.print-site-enumerate-headings #11-crd-custom-resource-definition > h1:before { content: '2.13 ' }

                .print-site-enumerate-headings #11-crd-custom-resource-definition h2:before { content: '2.13.' counter(counter-11-crd-custom-resource-definition-2) ' ' }
                .print-site-enumerate-headings #11-crd-custom-resource-definition h2 {  counter-increment: counter-11-crd-custom-resource-definition-2 }
            
.print-site-enumerate-headings #12-wordpress-mysql-pvc > h1:before { content: '2.14 ' }

                .print-site-enumerate-headings #12-wordpress-mysql-pvc h2:before { content: '2.14.' counter(counter-12-wordpress-mysql-pvc-2) ' ' }
                .print-site-enumerate-headings #12-wordpress-mysql-pvc h2 {  counter-increment: counter-12-wordpress-mysql-pvc-2 }
            
.print-site-enumerate-headings #13-helmchart > h1:before { content: '2.15 ' }

                .print-site-enumerate-headings #13-helmchart h2:before { content: '2.15.' counter(counter-13-helmchart-2) ' ' }
                .print-site-enumerate-headings #13-helmchart h2 {  counter-increment: counter-13-helmchart-2 }
            
.print-site-enumerate-headings #14-logging > h1:before { content: '2.16 ' }

                .print-site-enumerate-headings #14-logging h2:before { content: '2.16.' counter(counter-14-logging-2) ' ' }
                .print-site-enumerate-headings #14-logging h2 {  counter-increment: counter-14-logging-2 }
            
.print-site-enumerate-headings #15-prometheus-grafana > h1:before { content: '2.17 ' }

                .print-site-enumerate-headings #15-prometheus-grafana h2:before { content: '2.17.' counter(counter-15-prometheus-grafana-2) ' ' }
                .print-site-enumerate-headings #15-prometheus-grafana h2 {  counter-increment: counter-15-prometheus-grafana-2 }
            
.print-site-enumerate-headings #16-affinity-taint-toleration > h1:before { content: '2.18 ' }

                .print-site-enumerate-headings #16-affinity-taint-toleration h2:before { content: '2.18.' counter(counter-16-affinity-taint-toleration-2) ' ' }
                .print-site-enumerate-headings #16-affinity-taint-toleration h2 {  counter-increment: counter-16-affinity-taint-toleration-2 }
            
.print-site-enumerate-headings #17-poddisruptionbudgets-pdb > h1:before { content: '2.19 ' }

                .print-site-enumerate-headings #17-poddisruptionbudgets-pdb h2:before { content: '2.19.' counter(counter-17-poddisruptionbudgets-pdb-2) ' ' }
                .print-site-enumerate-headings #17-poddisruptionbudgets-pdb h2 {  counter-increment: counter-17-poddisruptionbudgets-pdb-2 }
            
.print-site-enumerate-headings #18-argocd > h1:before { content: '2.20 ' }

                .print-site-enumerate-headings #18-argocd h2:before { content: '2.20.' counter(counter-18-argocd-2) ' ' }
                .print-site-enumerate-headings #18-argocd h2 {  counter-increment: counter-18-argocd-2 }
            
.print-site-enumerate-headings #19-customscheduler > h1:before { content: '2.21 ' }

                .print-site-enumerate-headings #19-customscheduler h2:before { content: '2.21.' counter(counter-19-customscheduler-2) ' ' }
                .print-site-enumerate-headings #19-customscheduler h2 {  counter-increment: counter-19-customscheduler-2 }
            
.print-site-enumerate-headings #20-cronjob > h1:before { content: '2.22 ' }

                .print-site-enumerate-headings #20-cronjob h2:before { content: '2.22.' counter(counter-20-cronjob-2) ' ' }
                .print-site-enumerate-headings #20-cronjob h2 {  counter-increment: counter-20-cronjob-2 }
            
.print-site-enumerate-headings #21-auditing > h1:before { content: '2.23 ' }

                .print-site-enumerate-headings #21-auditing h2:before { content: '2.23.' counter(counter-21-auditing-2) ' ' }
                .print-site-enumerate-headings #21-auditing h2 {  counter-increment: counter-21-auditing-2 }
            
.print-site-enumerate-headings #21-kubeapi > h1:before { content: '2.24 ' }

                .print-site-enumerate-headings #21-kubeapi h2:before { content: '2.24.' counter(counter-21-kubeapi-2) ' ' }
                .print-site-enumerate-headings #21-kubeapi h2 {  counter-increment: counter-21-kubeapi-2 }
            
.print-site-enumerate-headings #22-rancher > h1:before { content: '2.25 ' }

                .print-site-enumerate-headings #22-rancher h2:before { content: '2.25.' counter(counter-22-rancher-2) ' ' }
                .print-site-enumerate-headings #22-rancher h2 {  counter-increment: counter-22-rancher-2 }
            
.print-site-enumerate-headings #23-metricserver > h1:before { content: '2.26 ' }

                .print-site-enumerate-headings #23-metricserver h2:before { content: '2.26.' counter(counter-23-metricserver-2) ' ' }
                .print-site-enumerate-headings #23-metricserver h2 {  counter-increment: counter-23-metricserver-2 }
            
.print-site-enumerate-headings #24-helmoperator > h1:before { content: '2.27 ' }

                .print-site-enumerate-headings #24-helmoperator h2:before { content: '2.27.' counter(counter-24-helmoperator-2) ' ' }
                .print-site-enumerate-headings #24-helmoperator h2 {  counter-increment: counter-24-helmoperator-2 }
            
.print-site-enumerate-headings #25-kubebuilder > h1:before { content: '2.28 ' }

                .print-site-enumerate-headings #25-kubebuilder h2:before { content: '2.28.' counter(counter-25-kubebuilder-2) ' ' }
                .print-site-enumerate-headings #25-kubebuilder h2 {  counter-increment: counter-25-kubebuilder-2 }
            
.print-site-enumerate-headings #26-k9s-basics > h1:before { content: '2.29 ' }

                .print-site-enumerate-headings #26-k9s-basics h2:before { content: '2.29.' counter(counter-26-k9s-basics-2) ' ' }
                .print-site-enumerate-headings #26-k9s-basics h2 {  counter-increment: counter-26-k9s-basics-2 }
            
.print-site-enumerate-headings #27-krew > h1:before { content: '2.30 ' }

                .print-site-enumerate-headings #27-krew h2:before { content: '2.30.' counter(counter-27-krew-2) ' ' }
                .print-site-enumerate-headings #27-krew h2 {  counter-increment: counter-27-krew-2 }
            
.print-site-enumerate-headings #28-kubeapps > h1:before { content: '2.31 ' }

                .print-site-enumerate-headings #28-kubeapps h2:before { content: '2.31.' counter(counter-28-kubeapps-2) ' ' }
                .print-site-enumerate-headings #28-kubeapps h2 {  counter-increment: counter-28-kubeapps-2 }
            
.print-site-enumerate-headings #29-kubeadm > h1:before { content: '2.32 ' }

                .print-site-enumerate-headings #29-kubeadm h2:before { content: '2.32.' counter(counter-29-kubeadm-2) ' ' }
                .print-site-enumerate-headings #29-kubeadm h2 {  counter-increment: counter-29-kubeadm-2 }
            
.print-site-enumerate-headings #30-k9s-advanced > h1:before { content: '2.33 ' }

                .print-site-enumerate-headings #30-k9s-advanced h2:before { content: '2.33.' counter(counter-30-k9s-advanced-2) ' ' }
                .print-site-enumerate-headings #30-k9s-advanced h2 {  counter-increment: counter-30-k9s-advanced-2 }
            </style>
<!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Render date of last update -->


<!-- Render date of creation -->


<!-- ---------------------------------------------------------------------- -->

<!-- Render authors -->


<!-- ---------------------------------------------------------------------- -->

<!-- Render committers from GitHub -->


<!-- Render committers from GitLab -->


<!-- Render committers -->


<!-- ---------------------------------------------------------------------- -->

<!-- Determine date of last update -->


<!-- Source file information -->





                
              </article>
            </div>
          
          
  <script>var tabs=__md_get("__tabs");if(Array.isArray(tabs))e:for(var set of document.querySelectorAll(".tabbed-set")){var labels=set.querySelector(".tabbed-labels");for(var tab of tabs)for(var label of labels.getElementsByTagName("label"))if(label.innerText.trim()===tab){var input=document.getElementById(label.htmlFor);input.checked=!0;continue e}}</script>

<script>var target=document.getElementById(location.hash.slice(1));target&&target.name&&(target.checked=target.name.startsWith("__tabbed_"))</script>
        </div>
        
      </main>
      
        <!--
  Copyright (c) 2016-2025 Martin Donath <martin.donath@squidfunk.com>

  Permission is hereby granted, free of charge, to any person obtaining a copy
  of this software and associated documentation files (the "Software"), to
  deal in the Software without restriction, including without limitation the
  rights to use, copy, modify, merge, publish, distribute, sublicense, and/or
  sell copies of the Software, and to permit persons to whom the Software is
  furnished to do so, subject to the following conditions:

  The above copyright notice and this permission notice shall be included in
  all copies or substantial portions of the Software.

  THE SOFTWARE IS PROVIDED "AS IS", WITHOUT WARRANTY OF ANY KIND, EXPRESS OR
  IMPLIED, INCLUDING BUT NOT LIMITED TO THE WARRANTIES OF MERCHANTABILITY,
  FITNESS FOR A PARTICULAR PURPOSE AND NON-INFRINGEMENT. IN NO EVENT SHALL THE
  AUTHORS OR COPYRIGHT HOLDERS BE LIABLE FOR ANY CLAIM, DAMAGES OR OTHER
  LIABILITY, WHETHER IN AN ACTION OF CONTRACT, TORT OR OTHERWISE, ARISING
  FROM, OUT OF OR IN CONNECTION WITH THE SOFTWARE OR THE USE OR OTHER DEALINGS
  IN THE SOFTWARE.
-->

<!-- Footer -->
<footer class="md-footer">
  <div class="logo1"></div>
  <div class="logo2"></div>

  <!-- Lab Navigator -->
  
  
  

  <!-- Further information -->
  <div class="md-footer-meta md-typeset">
    <div class="md-footer-meta__inner md-grid">
      <div class="md-copyright">
  
    <div class="md-copyright__highlight">
      ¬©2021-2025 Nir Geier<br/><a href="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" target="_blank" rel="noopener"><img src="https://visitor-badge.laobi.icu/badge?page_id=nirgeier" alt="Visitor Badge"></a>
    </div>
  
  
</div>

      <!-- Social links -->
      
      
<div class="md-social">
    
    
    
    
    
    <a href="https://github.com/ivana-devops/KubernetesLabs" target="_blank" rel="noopener" title="View on GitHub"
        class="md-social__link social-class__github">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M173.9 397.4c0 2-2.3 3.6-5.2 3.6-3.3.3-5.6-1.3-5.6-3.6 0-2 2.3-3.6 5.2-3.6 3-.3 5.6 1.3 5.6 3.6m-31.1-4.5c-.7 2 1.3 4.3 4.3 4.9 2.6 1 5.6 0 6.2-2s-1.3-4.3-4.3-5.2c-2.6-.7-5.5.3-6.2 2.3m44.2-1.7c-2.9.7-4.9 2.6-4.6 4.9.3 2 2.9 3.3 5.9 2.6 2.9-.7 4.9-2.6 4.6-4.6-.3-1.9-3-3.2-5.9-2.9M252.8 8C114.1 8 8 113.3 8 252c0 110.9 69.8 205.8 169.5 239.2 12.8 2.3 17.3-5.6 17.3-12.1 0-6.2-.3-40.4-.3-61.4 0 0-70 15-84.7-29.8 0 0-11.4-29.1-27.8-36.6 0 0-22.9-15.7 1.6-15.4 0 0 24.9 2 38.6 25.8 21.9 38.6 58.6 27.5 72.9 20.9 2.3-16 8.8-27.1 16-33.7-55.9-6.2-112.3-14.3-112.3-110.5 0-27.5 7.6-41.3 23.6-58.9-2.6-6.5-11.1-33.3 2.6-67.9 20.9-6.5 69 27 69 27 20-5.6 41.5-8.5 62.8-8.5s42.8 2.9 62.8 8.5c0 0 48.1-33.6 69-27 13.7 34.7 5.2 61.4 2.6 67.9 16 17.7 25.8 31.5 25.8 58.9 0 96.5-58.9 104.2-114.8 110.5 9.2 7.9 17 22.9 17 46.4 0 33.7-.3 75.4-.3 83.6 0 6.5 4.6 14.4 17.3 12.1C436.2 457.8 504 362.9 504 252 504 113.3 391.5 8 252.8 8M105.2 352.9c-1.3 1-1 3.3.7 5.2 1.6 1.6 3.9 2.3 5.2 1 1.3-1 1-3.3-.7-5.2-1.6-1.6-3.9-2.3-5.2-1m-10.8-8.1c-.7 1.3.3 2.9 2.3 3.9 1.6 1 3.6.7 4.3-.7.7-1.3-.3-2.9-2.3-3.9-2-.6-3.6-.3-4.3.7m32.4 35.6c-1.6 1.3-1 4.3 1.3 6.2 2.3 2.3 5.2 2.6 6.5 1 1.3-1.3.7-4.3-1.3-6.2-2.2-2.3-5.2-2.6-6.5-1m-11.4-14.7c-1.6 1-1.6 3.6 0 5.9s4.3 3.3 5.6 2.3c1.6-1.3 1.6-3.9 0-6.2-1.4-2.3-4-3.3-5.6-2"/></svg>
    </a>
    
    
    
    
    
    <a href="https://github.com/ivana-devops/KubernetesLabs/network/members" target="_blank" rel="noopener" title="Fork this repo"
        class="md-social__link social-class__fork">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M5 5.372v.878c0 .414.336.75.75.75h4.5a.75.75 0 0 0 .75-.75v-.878a2.25 2.25 0 1 1 1.5 0v.878a2.25 2.25 0 0 1-2.25 2.25h-1.5v2.128a2.251 2.251 0 1 1-1.5 0V8.5h-1.5A2.25 2.25 0 0 1 3.5 6.25v-.878a2.25 2.25 0 1 1 1.5 0M5 3.25a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0m6.75.75a.75.75 0 1 0 0-1.5.75.75 0 0 0 0 1.5m-3 8.75a.75.75 0 1 0-1.5 0 .75.75 0 0 0 1.5 0"/></svg>
    </a>
    
    
    
    
    
    <a href="https://github.com/ivana-devops/KubernetesLabs/stargazers" target="_blank" rel="noopener" title="Star this repo"
        class="md-social__link social-class__star">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 16 16"><path d="M8 .25a.75.75 0 0 1 .673.418l1.882 3.815 4.21.612a.75.75 0 0 1 .416 1.279l-3.046 2.97.719 4.192a.751.751 0 0 1-1.088.791L8 12.347l-3.766 1.98a.75.75 0 0 1-1.088-.79l.72-4.194L.818 6.374a.75.75 0 0 1 .416-1.28l4.21-.611L7.327.668A.75.75 0 0 1 8 .25m0 2.445L6.615 5.5a.75.75 0 0 1-.564.41l-3.097.45 2.24 2.184a.75.75 0 0 1 .216.664l-.528 3.084 2.769-1.456a.75.75 0 0 1 .698 0l2.77 1.456-.53-3.084a.75.75 0 0 1 .216-.664l2.24-2.183-3.096-.45a.75.75 0 0 1-.564-.41z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://www.linkedin.com/in/nirgeier/" target="_blank" rel="noopener" title="Connect on LinkedIn"
        class="md-social__link social-class__linkedin">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M416 32H31.9C14.3 32 0 46.5 0 64.3v383.4C0 465.5 14.3 480 31.9 480H416c17.6 0 32-14.5 32-32.3V64.3c0-17.8-14.4-32.3-32-32.3M135.4 416H69V202.2h66.5V416zM102.2 96a38.5 38.5 0 1 1 0 77 38.5 38.5 0 1 1 0-77m282.1 320h-66.4V312c0-24.8-.5-56.7-34.5-56.7-34.6 0-39.9 27-39.9 54.9V416h-66.4V202.2h63.7v29.2h.9c8.9-16.8 30.6-34.5 62.9-34.5 67.2 0 79.7 44.3 79.7 101.9z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://discord.gg/U6xW23Ss" target="_blank" rel="noopener" title="Follow me on Discord"
        class="md-social__link social-class__discord">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 576 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M492.5 69.8c-.2-.3-.4-.6-.8-.7-38.1-17.5-78.4-30-119.7-37.1-.4-.1-.8 0-1.1.1s-.6.4-.8.8c-5.5 9.9-10.5 20.2-14.9 30.6-44.6-6.8-89.9-6.8-134.4 0-4.5-10.5-9.5-20.7-15.1-30.6-.2-.3-.5-.6-.8-.8s-.7-.2-1.1-.2C162.5 39 122.2 51.5 84.1 69c-.3.1-.6.4-.8.7C7.1 183.5-13.8 294.6-3.6 404.2c0 .3.1.5.2.8s.3.4.5.6c44.4 32.9 94 58 146.8 74.2.4.1.8.1 1.1 0s.7-.4.9-.7c11.3-15.4 21.4-31.8 30-48.8.1-.2.2-.5.2-.8s0-.5-.1-.8-.2-.5-.4-.6-.4-.3-.7-.4c-15.8-6.1-31.2-13.4-45.9-21.9-.3-.2-.5-.4-.7-.6s-.3-.6-.3-.9 0-.6.2-.9.3-.5.6-.7c3.1-2.3 6.2-4.7 9.1-7.1.3-.2.6-.4.9-.4s.7 0 1 .1c96.2 43.9 200.4 43.9 295.5 0 .3-.1.7-.2 1-.2s.7.2.9.4c2.9 2.4 6 4.9 9.1 7.2.2.2.4.4.6.7s.2.6.2.9-.1.6-.3.9-.4.5-.6.6c-14.7 8.6-30 15.9-45.9 21.8-.2.1-.5.2-.7.4s-.3.4-.4.7-.1.5-.1.8.1.5.2.8c8.8 17 18.8 33.3 30 48.8.2.3.6.6.9.7s.8.1 1.1 0c52.9-16.2 102.6-41.3 147.1-74.2.2-.2.4-.4.5-.6s.2-.5.2-.8c12.3-126.8-20.5-236.9-86.9-334.5zm-302 267.7c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.4 59.2-52.8 59.2m195.4 0c-29 0-52.8-26.6-52.8-59.2s23.4-59.2 52.8-59.2c29.7 0 53.3 26.8 52.8 59.2 0 32.7-23.2 59.2-52.8 59.2"/></svg>
    </a>
    
    
    
    
    
    <a href="https://stackoverflow.com/users/1755598/codewizard" target="_blank" rel="noopener" title="Follow me on Stack Overflow"
        class="md-social__link social-class__stackoverflow">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 384 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M291 311 95.3 269.7 87.1 309l195.7 41zm51-87L188.5 95.7 163 126.5l153.5 128.3zm-31.2 39.7L129.5 179l-16.7 36.5L294 300zM262.3 32l-32 24 119.3 160.3 32-24zm20.5 328h-200v39.7h200zm39.7 80H43V320H3v160h359.5V320h-40z"/></svg>
    </a>
    
    
    
    
    
    <a href="https://wa.me/972548122310" target="_blank" rel="noopener" title="Follow me on WhatsApp"
        class="md-social__link social-class__whatsapp">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 448 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M380.9 97.1C339 55.1 283.2 32 223.9 32c-122.4 0-222 99.6-222 222 0 39.1 10.2 77.3 29.6 111L0 480l117.7-30.9c32.4 17.7 68.9 27 106.1 27h.1c122.3 0 224.1-99.6 224.1-222 0-59.3-25.2-115-67.1-157m-157 341.6c-33.2 0-65.7-8.9-94-25.7l-6.7-4-69.8 18.3L72 359.2l-4.4-7c-18.5-29.4-28.2-63.3-28.2-98.2 0-101.7 82.8-184.5 184.6-184.5 49.3 0 95.6 19.2 130.4 54.1s56.2 81.2 56.1 130.5c0 101.8-84.9 184.6-186.6 184.6m101.2-138.2c-5.5-2.8-32.8-16.2-37.9-18-5.1-1.9-8.8-2.8-12.5 2.8s-14.3 18-17.6 21.8c-3.2 3.7-6.5 4.2-12 1.4-32.6-16.3-54-29.1-75.5-66-5.7-9.8 5.7-9.1 16.3-30.3 1.8-3.7.9-6.9-.5-9.7s-12.5-30.1-17.1-41.2c-4.5-10.8-9.1-9.3-12.5-9.5-3.2-.2-6.9-.2-10.6-.2s-9.7 1.4-14.8 6.9c-5.1 5.6-19.4 19-19.4 46.3s19.9 53.7 22.6 57.4c2.8 3.7 39.1 59.7 94.8 83.8 35.2 15.2 49 16.5 66.6 13.9 10.7-1.6 32.8-13.4 37.4-26.4s4.6-24.1 3.2-26.4c-1.3-2.5-5-3.9-10.5-6.6"/></svg>
    </a>
    
    
    
    
    
    <a href="mailto:nirg@codewizard.co.il" target="_blank" rel="noopener" title="Email me"
        class="md-social__link social-class__email">
        <svg xmlns="http://www.w3.org/2000/svg" viewBox="0 0 512 512"><!--! Font Awesome Free 7.1.0 by @fontawesome - https://fontawesome.com License - https://fontawesome.com/license/free (Icons: CC BY 4.0, Fonts: SIL OFL 1.1, Code: MIT License) Copyright 2025 Fonticons, Inc.--><path d="M48 64C21.5 64 0 85.5 0 112c0 15.1 7.1 29.3 19.2 38.4l208 156a48 48 0 0 0 57.6 0l208-156c12.1-9.1 19.2-23.3 19.2-38.4 0-26.5-21.5-48-48-48zM0 196v188c0 35.3 28.7 64 64 64h384c35.3 0 64-28.7 64-64V196L313.6 344.8c-34.1 25.6-81.1 25.6-115.2 0z"/></svg>
    </a>
    
</div>
      
    </div>
  </div>
</footer>
      
    </div>
    <div class="md-dialog" data-md-component="dialog">
      <div class="md-dialog__inner md-typeset"></div>
    </div>
    
      <div class="md-progress" data-md-component="progress" role="progressbar"></div>
    
    
    
      
      
      <script id="__config" type="application/json">{"annotate": null, "base": "/KubernetesLabs/", "features": ["announce.dismiss", "content.action.edit", "content.action.view", "content.code.annotate", "content.code.copy", "content.code.select", "content.footnote.tooltips", "content.tabs.link", "content.tooltips", "content.footer.last-updated", "content.footer.contributors", {"navigation.expand": false}, "navigation.footer", "navigation.indexes", "navigation.instant", "navigation.instant.prefetch", "navigation.instant.progress", "navigation.prune", "navigation.sections", "navigation.tabs", {"navigation.top": true}, "navigation.tracking", "search.highlight", "search.share", "search.suggest", "toc.follow", "toc.sticky"], "search": "../assets/javascripts/workers/search.2c215733.min.js", "tags": null, "translations": {"clipboard.copied": "Copied to clipboard", "clipboard.copy": "Copy to clipboard", "search.result.more.one": "1 more on this page", "search.result.more.other": "# more on this page", "search.result.none": "No matching documents", "search.result.one": "1 matching document", "search.result.other": "# matching documents", "search.result.placeholder": "Type to start searching", "search.result.term.missing": "Missing", "select.version": "Select version"}, "version": null}</script>
    
    
      <script src="../assets/javascripts/bundle.79ae519e.min.js"></script>
      
        <script src="../js/print-site.js"></script>
      
        <script src="https://buttons.github.io/buttons.js?v=1765676292"></script>
      
    
  </body>
</html>